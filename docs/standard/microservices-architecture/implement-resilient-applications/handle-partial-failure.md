---
title: Controlar errores parciales
description: Arquitectura de microservicios de .NET para aplicaciones .NET en contenedor | Controlar errores parciales
author: CESARDELATORRE
ms.author: wiwagn
ms.date: 05/26/2017
ms.openlocfilehash: 26e3d6b4cd1df051c00cef4ee8370ca9c213363e
ms.sourcegitcommit: 3d5d33f384eeba41b2dff79d096f47ccc8d8f03d
ms.translationtype: HT
ms.contentlocale: es-ES
ms.lasthandoff: 05/04/2018
ms.locfileid: "33577269"
---
# <a name="handling-partial-failure"></a><span data-ttu-id="f9949-103">Controlar errores parciales</span><span class="sxs-lookup"><span data-stu-id="f9949-103">Handling partial failure</span></span>

<span data-ttu-id="f9949-104">En sistemas distribuidos como las aplicaciones basadas en microservicios, hay un riesgo siempre presente de error parcial.</span><span class="sxs-lookup"><span data-stu-id="f9949-104">In distributed systems like microservices-based applications, there is an ever-present risk of partial failure.</span></span> <span data-ttu-id="f9949-105">Por ejemplo, se puede producir un error en un único contenedor o microservicio o este podría no estar disponible para responder durante un breve período, o se podría bloquear una única máquina virtual o un servidor.</span><span class="sxs-lookup"><span data-stu-id="f9949-105">For instance, a single microservice/container can fail or might not be available to respond for a short time, or a single VM or server can crash.</span></span> <span data-ttu-id="f9949-106">Puesto que los clientes y los servicios son procesos independientes, es posible que un servicio no pueda responder de forma oportuna a una solicitud del cliente.</span><span class="sxs-lookup"><span data-stu-id="f9949-106">Since clients and services are separate processes, a service might not be able to respond in a timely way to a client’s request.</span></span> <span data-ttu-id="f9949-107">El servicio podría estar sobrecargado y responder muy lentamente a las solicitudes, o simplemente no estar accesible durante un breve período debido a problemas de red.</span><span class="sxs-lookup"><span data-stu-id="f9949-107">The service might be overloaded and responding extremely slowly to requests, or might simply not be accessible for a short time because of network issues.</span></span>

<span data-ttu-id="f9949-108">Por ejemplo, considere la página de detalles Order de la aplicación de ejemplo eShopOnContainers.</span><span class="sxs-lookup"><span data-stu-id="f9949-108">For example, consider the Order details page from the eShopOnContainers sample application.</span></span> <span data-ttu-id="f9949-109">Si el microservicio Ordering no responde cuando el usuario intenta enviar un pedido, una implementación incorrecta del proceso del cliente (la aplicación web MVC), por ejemplo, si el código de cliente usara RPC sincrónicas sin tiempo de espera, bloquearía los subprocesos indefinidamente en espera de una respuesta.</span><span class="sxs-lookup"><span data-stu-id="f9949-109">If the ordering microservice is unresponsive when the user tries to submit an order, a bad implementation of the client process (the MVC web application)—for example, if the client code were to use synchronous RPCs with no timeout—would block threads indefinitely waiting for a response.</span></span> <span data-ttu-id="f9949-110">Además de la mala experiencia del usuario, cada espera sin respuesta usa o bloquea un subproceso, y los subprocesos son muy valiosos en aplicaciones altamente escalables.</span><span class="sxs-lookup"><span data-stu-id="f9949-110">In addition to creating a bad user experience, every unresponsive wait consumes or blocks a thread, and threads are extremely valuable in highly scalable applications.</span></span> <span data-ttu-id="f9949-111">Si hay muchos subprocesos bloqueados, al final el tiempo de ejecución de la aplicación puede quedarse sin subprocesos.</span><span class="sxs-lookup"><span data-stu-id="f9949-111">If there are many blocked threads, eventually the application’s runtime can run out of threads.</span></span> <span data-ttu-id="f9949-112">En ese caso, la aplicación puede no responder globalmente en lugar de solo parcialmente, como se muestra en la figura 10-1.</span><span class="sxs-lookup"><span data-stu-id="f9949-112">In that case, the application can become globally unresponsive instead of just partially unresponsive, as show in Figure 10-1.</span></span>

![](./media/image1.png)

<span data-ttu-id="f9949-113">**Figura 10-1**.</span><span class="sxs-lookup"><span data-stu-id="f9949-113">**Figure 10-1**.</span></span> <span data-ttu-id="f9949-114">Errores parciales debido a dependencias que afectan a la disponibilidad del subproceso de servicio</span><span class="sxs-lookup"><span data-stu-id="f9949-114">Partial failures because of dependencies that impact service thread availability</span></span>

<span data-ttu-id="f9949-115">En una aplicación basada en microservicios de gran tamaño, cualquier error parcial se puede amplificar, especialmente si la mayor parte de la interacción de los microservicios internos se basa en llamadas HTTP sincrónicas (lo que se considera un anti-patrón).</span><span class="sxs-lookup"><span data-stu-id="f9949-115">In a large microservices-based application, any partial failure can be amplified, especially if most of the internal microservices interaction is based on synchronous HTTP calls (which is considered an anti-pattern).</span></span> <span data-ttu-id="f9949-116">Piense en un sistema que recibe millones de llamadas entrantes al día.</span><span class="sxs-lookup"><span data-stu-id="f9949-116">Think about a system that receives millions of incoming calls per day.</span></span> <span data-ttu-id="f9949-117">Si el sistema tiene un diseño incorrecto basado en cadenas largas de llamadas HTTP sincrónicas, estas llamadas entrantes podrían dar lugar a muchos más millones de llamadas salientes (supongamos una proporción 1:4) a decenas de microservicios internos como dependencias sincrónicas.</span><span class="sxs-lookup"><span data-stu-id="f9949-117">If your system has a bad design that is based on long chains of synchronous HTTP calls, these incoming calls might result in many more millions of outgoing calls (let’s suppose a ratio of 1:4) to dozens of internal microservices as synchronous dependencies.</span></span> <span data-ttu-id="f9949-118">Esta situación se muestra en la figura 10-2, especialmente la dependencia \#3.</span><span class="sxs-lookup"><span data-stu-id="f9949-118">This situation is shown in Figure 10-2, especially dependency \#3.</span></span>

![](./media/image2.png)

<span data-ttu-id="f9949-119">**Figura 10-2**.</span><span class="sxs-lookup"><span data-stu-id="f9949-119">**Figure 10-2**.</span></span> <span data-ttu-id="f9949-120">Impacto de tener un diseño incorrecto que incluye cadenas largas de solicitudes HTTP</span><span class="sxs-lookup"><span data-stu-id="f9949-120">The impact of having an incorrect design featuring long chains of HTTP requests</span></span>

<span data-ttu-id="f9949-121">Los errores intermitentes están prácticamente garantizados en un sistema distribuido basado en la nube, aunque cada dependencia tenga una disponibilidad excelente.</span><span class="sxs-lookup"><span data-stu-id="f9949-121">Intermittent failure is virtually guaranteed in a distributed and cloud based system, even if every dependency itself has excellent availability.</span></span> <span data-ttu-id="f9949-122">Este debe ser un hecho que tenga en cuenta.</span><span class="sxs-lookup"><span data-stu-id="f9949-122">This should be a fact you need to consider.</span></span>

<span data-ttu-id="f9949-123">Si no diseña ni implementa técnicas para asegurar la tolerancia a errores, incluso se pueden magnificar los pequeños tiempos de inactividad.</span><span class="sxs-lookup"><span data-stu-id="f9949-123">If you do not design and implement techniques to ensure fault tolerance, even small downtimes can be amplified.</span></span> <span data-ttu-id="f9949-124">Por ejemplo, 50 dependencias con un 99,99 % de disponibilidad cada una darían lugar a varias horas de tiempo de inactividad al mes debido a este efecto dominó.</span><span class="sxs-lookup"><span data-stu-id="f9949-124">As an example, 50 dependencies each with 99.99% of availability would result in several hours of downtime each month because of this ripple effect.</span></span> <span data-ttu-id="f9949-125">Cuando se produce un error en una dependencia de un microservicio al controlar un gran volumen de solicitudes, ese error puede saturar rápidamente todos los subprocesos de solicitudes disponibles en cada servicio y bloquear toda la aplicación.</span><span class="sxs-lookup"><span data-stu-id="f9949-125">When a microservice dependency fails while handling a high volume of requests, that failure can quickly saturate all available request threads in each service and crash the whole application.</span></span>

![](./media/image3.png)

<span data-ttu-id="f9949-126">**Figura 10-3**.</span><span class="sxs-lookup"><span data-stu-id="f9949-126">**Figure 10-3**.</span></span> <span data-ttu-id="f9949-127">Error parcial amplificado por los microservicios con cadenas largas de llamadas HTTP sincrónicas</span><span class="sxs-lookup"><span data-stu-id="f9949-127">Partial failure amplified by microservices with long chains of synchronous HTTP calls</span></span>

<span data-ttu-id="f9949-128">Para minimizar este problema, en la sección "*La integración asincrónica del microservicio obliga a su autonomía*" (en el capítulo sobre arquitectura), se recomienda usar la comunicación asincrónica entre los microservicios internos.</span><span class="sxs-lookup"><span data-stu-id="f9949-128">To minimize this problem, in the section "*Asynchronous microservice integration enforce microservice’s autonomy*” (in the architecture chapter), we encouraged you to use asynchronous communication across the internal microservices.</span></span> <span data-ttu-id="f9949-129">En la sección siguiente se explica más brevemente.</span><span class="sxs-lookup"><span data-stu-id="f9949-129">We briefly explain more in the next section.</span></span>

<span data-ttu-id="f9949-130">Además, es fundamental que diseñe las aplicaciones cliente y los microservicios para controlar los errores parciales, es decir, que compile microservicios y aplicaciones cliente resistentes.</span><span class="sxs-lookup"><span data-stu-id="f9949-130">In addition, it is essential that you design your microservices and client applications to handle partial failures—that is, to build resilient microservices and client applications.</span></span>


>[!div class="step-by-step"]
<span data-ttu-id="f9949-131">[Previous] (index.md) [Next] (partial-failure-strategies.md)</span><span class="sxs-lookup"><span data-stu-id="f9949-131">[Previous] (index.md) [Next] (partial-failure-strategies.md)</span></span>
