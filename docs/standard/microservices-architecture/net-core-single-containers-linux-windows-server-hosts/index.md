---
title: Implementar aplicaciones web de .NET Core basadas en un solo contenedor en hosts de Linux o Windows Nano Server
description: Arquitectura de microservicios de .NET para aplicaciones .NET en contenedor | Implementar aplicaciones web de .NET Core basadas en un solo contenedor en hosts de Linux o Windows Nano Server
author: CESARDELATORRE
ms.author: wiwagn
ms.date: 06/27/2018
ms.openlocfilehash: 45be99a86a52ed450b795ca5f91c01ab82c7da47
ms.sourcegitcommit: efff8f331fd9467f093f8ab8d23a203d6ecb5b60
ms.translationtype: HT
ms.contentlocale: es-ES
ms.lasthandoff: 09/01/2018
ms.locfileid: "43388633"
---
# <a name="deploying-single-container-based-net-core-web-applications-on-linux-or-windows-nano-server-hosts"></a><span data-ttu-id="dbe96-103">Implementar aplicaciones web de .NET Core basadas en un solo contenedor en hosts de Linux o Windows Nano Server</span><span class="sxs-lookup"><span data-stu-id="dbe96-103">Deploying Single-Container-Based .NET Core Web Applications on Linux or Windows Nano Server Hosts</span></span>

<span data-ttu-id="dbe96-104">_Puede usar contenedores de Docker para la implementación monolítica de aplicaciones web más sencillas. Esto mejora la integración continua y las canalizaciones de implementación continua y ayuda a llevar a cabo correctamente el proceso desde la implementación hasta la producción. Ya no se volverá a preguntar: "Funciona en mi equipo, ¿por qué no funciona en producción?"_</span><span class="sxs-lookup"><span data-stu-id="dbe96-104">_You can use Docker containers for monolithic deployment of simpler web applications. This improves continuous integration and continuous deployment pipelines and helps achieve deployment-to-production success. No more “It works in my machine, why does it not work in production?”_</span></span>

<span data-ttu-id="dbe96-105">Una arquitectura basada en microservicios tiene muchas ventajas, pero a costa de una mayor complejidad.</span><span class="sxs-lookup"><span data-stu-id="dbe96-105">A microservices-based architecture has many benefits, but those benefits come at a cost of increased complexity.</span></span> <span data-ttu-id="dbe96-106">En algunos casos, los costos superan las ventajas, por lo que es una mejor opción una aplicación de implementación monolítica que se ejecute en un solo contenedor o en unos pocos contenedores.</span><span class="sxs-lookup"><span data-stu-id="dbe96-106">In some cases, the costs outweigh the benefits and a monolithic deployment application running in one or a few containers is a better option.</span></span>

<span data-ttu-id="dbe96-107">Es posible que una aplicación monolítica no se pueda descomponer fácilmente en microservicios bien separados.</span><span class="sxs-lookup"><span data-stu-id="dbe96-107">A monolithic application might not be easily decomposable into well-separated microservices.</span></span> <span data-ttu-id="dbe96-108">Ya ha aprendido que estos microservicios se deben particionar por función: deben funcionar de manera independiente para proporcionar una aplicación más resistente.</span><span class="sxs-lookup"><span data-stu-id="dbe96-108">You've learned that these microservices should be partitioned by function: they should work independently of each other to provide a more resilient application.</span></span> <span data-ttu-id="dbe96-109">Si no puede proporcionar sectores de características de una aplicación, el hecho de separarla solo conlleva más complejidad.</span><span class="sxs-lookup"><span data-stu-id="dbe96-109">If you can't deliver feature slices of the application, separating it only adds complexity.</span></span>

<span data-ttu-id="dbe96-110">Una aplicación podría no necesitar inicialmente el escalado de las características por separado.</span><span class="sxs-lookup"><span data-stu-id="dbe96-110">An application might not yet need to scale features independently.</span></span> <span data-ttu-id="dbe96-111">Supongamos que en una fase temprana del ciclo de vida de la aplicación de referencia `eShopOnContainers`, el tráfico no justificaba separar las características en diferentes microservicios.</span><span class="sxs-lookup"><span data-stu-id="dbe96-111">Let’s suppose that in the early stages of the `eShopOnContainers` reference application, the traffic didn't justify separating features into different microservices.</span></span> <span data-ttu-id="dbe96-112">El tráfico era bastante reducido y el hecho de agregar recursos a un servicio normalmente suponía agregar recursos a todos los servicios.</span><span class="sxs-lookup"><span data-stu-id="dbe96-112">Traffic was small enough that adding resources to one service typically meant adding resources to all services.</span></span> <span data-ttu-id="dbe96-113">El trabajo adicional que suponía separar la aplicación en servicios diferenciados apenas proporcionaba beneficio.</span><span class="sxs-lookup"><span data-stu-id="dbe96-113">The additional work to separate the application into discrete services provided minimal benefit.</span></span>

<span data-ttu-id="dbe96-114">Además, en las fases tempranas del desarrollo de una aplicación, es posible que no se tenga una idea clara de dónde están los límites funcionales naturales.</span><span class="sxs-lookup"><span data-stu-id="dbe96-114">Also, early in the development of an application you might not have a clear idea where the natural functional boundaries are.</span></span> <span data-ttu-id="dbe96-115">Mientras desarrolla un producto mínimamente viable, puede que todavía no sea evidente la separación natural.</span><span class="sxs-lookup"><span data-stu-id="dbe96-115">As you develop a minimum viable product, the natural separation might not yet have emerged.</span></span>

<span data-ttu-id="dbe96-116">Algunas de estas condiciones pueden ser temporales.</span><span class="sxs-lookup"><span data-stu-id="dbe96-116">Some of these conditions might be temporary.</span></span> <span data-ttu-id="dbe96-117">Podría empezar creando una aplicación monolítica y, más adelante, separar algunas características para desarrollarlas e implementarlas como microservicios.</span><span class="sxs-lookup"><span data-stu-id="dbe96-117">You might start by creating a monolithic application, and later separate some features to be developed and deployed as microservices.</span></span> <span data-ttu-id="dbe96-118">Otras condiciones podrían ser básicas para el espacio de problemas de la aplicación y, en consecuencia, tal vez no se pueda dividir nunca en varios microservicios.</span><span class="sxs-lookup"><span data-stu-id="dbe96-118">Other conditions might be essential to the application’s problem space, meaning that the application might never be broken into multiple microservices.</span></span>

<span data-ttu-id="dbe96-119">La separación de una aplicación en varios procesos diferenciados también introduce una sobrecarga.</span><span class="sxs-lookup"><span data-stu-id="dbe96-119">Separating an application into many discrete processes also introduces overhead.</span></span> <span data-ttu-id="dbe96-120">La separación de funciones en procesos diferentes conlleva una mayor complejidad.</span><span class="sxs-lookup"><span data-stu-id="dbe96-120">There's more complexity in separating features into different processes.</span></span> <span data-ttu-id="dbe96-121">Los protocolos de comunicación se vuelven más complejos.</span><span class="sxs-lookup"><span data-stu-id="dbe96-121">The communication protocols become more complex.</span></span> <span data-ttu-id="dbe96-122">En lugar de llamadas a métodos, debe usar comunicaciones asincrónicas entre servicios.</span><span class="sxs-lookup"><span data-stu-id="dbe96-122">Instead of method calls, you must use asynchronous communications between services.</span></span> <span data-ttu-id="dbe96-123">Cuando cambie a una arquitectura de microservicios, debe agregar muchos de los bloques de creación que se implementan en la versión de microservicios de la aplicación `eShopOnContainers`: control de bus de eventos, reintentos y resistencia de mensajes, coherencia eventual y mucho más.</span><span class="sxs-lookup"><span data-stu-id="dbe96-123">As you move to a microservices architecture, you need to add many of the building blocks implemented in the microservices version of the `eShopOnContainers` application: event bus handling, message resiliency and retries, eventual consistency, and more.</span></span>

<span data-ttu-id="dbe96-124">Una versión muy simplificada de eShopOnContainers (denominada [eShopWeb](https://github.com/dotnet-architecture/eShopOnContainers/tree/master/src/Web/WebMonolithic) e incluida en el mismo repositorio de GitHub) se ejecuta como una aplicación de MVC monolítica.</span><span class="sxs-lookup"><span data-stu-id="dbe96-124">A much-simplified version of eShopOnContainers (named [eShopWeb](https://github.com/dotnet-architecture/eShopOnContainers/tree/master/src/Web/WebMonolithic) and included in the same GitHub repository) runs as a monolithic MVC application.</span></span> <span data-ttu-id="dbe96-125">Como ya se ha descrito, esa opción de diseño ofrece una serie de ventajas.</span><span class="sxs-lookup"><span data-stu-id="dbe96-125">As described, there are advantages offered by that design choice.</span></span> <span data-ttu-id="dbe96-126">Puede descargar de GitHub el código fuente para esta aplicación y ejecutarlo de forma local.</span><span class="sxs-lookup"><span data-stu-id="dbe96-126">You can download the source for this application from GitHub and run it locally.</span></span> <span data-ttu-id="dbe96-127">Incluso esta aplicación monolítica se beneficia de la implementación en un entorno de contenedor.</span><span class="sxs-lookup"><span data-stu-id="dbe96-127">Even this monolithic application benefits from being deployed in a container environment.</span></span>

<span data-ttu-id="dbe96-128">Ante todo, la implementación en contenedor implica que cada instancia de la aplicación se ejecuta en el mismo entorno.</span><span class="sxs-lookup"><span data-stu-id="dbe96-128">For one, the containerized deployment means that every instance of the application runs in the same environment.</span></span> <span data-ttu-id="dbe96-129">Esto incluye el entorno de desarrollo donde tienen lugar las pruebas y el desarrollo iniciales.</span><span class="sxs-lookup"><span data-stu-id="dbe96-129">This includes the developer environment where early testing and development take place.</span></span> <span data-ttu-id="dbe96-130">El equipo de desarrollo puede ejecutar la aplicación en un entorno en contenedor que coincida con el entorno de producción.</span><span class="sxs-lookup"><span data-stu-id="dbe96-130">The development team can run the application in a containerized environment that matches the production environment.</span></span>

<span data-ttu-id="dbe96-131">Además, las aplicaciones en contenedor se escalan horizontalmente con un costo inferior.</span><span class="sxs-lookup"><span data-stu-id="dbe96-131">Also, containerized applications scale out at lower cost.</span></span> <span data-ttu-id="dbe96-132">Como ya ha visto, el entorno en contenedor permite un mayor uso compartido de recursos que los entornos de máquina virtual tradicionales.</span><span class="sxs-lookup"><span data-stu-id="dbe96-132">As you saw earlier, the container environment enables greater resource sharing than traditional VM environments.</span></span>

<span data-ttu-id="dbe96-133">Por último, el hecho de incluir la aplicación en un contenedor fuerza la separación entre la lógica de negocios y el servidor de almacenamiento.</span><span class="sxs-lookup"><span data-stu-id="dbe96-133">Finally, containerizing the application forces a separation between the business logic and the storage server.</span></span> <span data-ttu-id="dbe96-134">Cuando la aplicación se escala horizontalmente, los diversos contenedores usan un único medio de almacenamiento físico.</span><span class="sxs-lookup"><span data-stu-id="dbe96-134">As the application scales out, the various containers will all rely on a single physical storage medium.</span></span> <span data-ttu-id="dbe96-135">Normalmente, este almacenamiento es un servidor de alta disponibilidad que ejecuta una base de datos de SQL Server.</span><span class="sxs-lookup"><span data-stu-id="dbe96-135">This storage would typically be a high-availability server running a SQL Server database.</span></span>

## <a name="application-tour"></a><span data-ttu-id="dbe96-136">Paseo por la aplicación</span><span class="sxs-lookup"><span data-stu-id="dbe96-136">Application tour</span></span>

<span data-ttu-id="dbe96-137">La aplicación [eShopWeb](https://github.com/dotnet-architecture/eShopOnContainers/tree/master/src/Web/WebMonolithic) representa una parte de la aplicación eShopOnContainers que se ejecuta como una aplicación monolítica, es decir, una aplicación basada en MVC de ASP.NET Core que se ejecuta en .NET Core.</span><span class="sxs-lookup"><span data-stu-id="dbe96-137">The [eShopWeb](https://github.com/dotnet-architecture/eShopOnContainers/tree/master/src/Web/WebMonolithic) application represents some of the eShopOnContainers application running as a monolithic application — an ASP.NET Core MVC-based application running on .NET Core.</span></span> <span data-ttu-id="dbe96-138">Básicamente, proporciona las funciones de exploración del catálogo tal como se han descrito en secciones anteriores.</span><span class="sxs-lookup"><span data-stu-id="dbe96-138">It mainly provides the catalog browsing capabilities as described in earlier sections.</span></span>

<span data-ttu-id="dbe96-139">La aplicación usa una base de datos de SQL Server para el almacenamiento del catálogo.</span><span class="sxs-lookup"><span data-stu-id="dbe96-139">The application uses a SQL Server database for the catalog storage.</span></span> <span data-ttu-id="dbe96-140">En las implementaciones basadas en contenedor, esta aplicación monolítica puede tener acceso al mismo almacén de datos que la aplicación basada en microservicios.</span><span class="sxs-lookup"><span data-stu-id="dbe96-140">In container-based deployments, this monolithic application can access the same data store as the microservices-based application.</span></span> <span data-ttu-id="dbe96-141">La aplicación está configurada para ejecutar SQL Server en un contenedor junto con la aplicación monolítica.</span><span class="sxs-lookup"><span data-stu-id="dbe96-141">The application is configured to run SQL Server in a container alongside the monolithic application.</span></span> <span data-ttu-id="dbe96-142">En un entorno de producción, SQL Server se ejecutaría en una máquina con alta disponibilidad, fuera del host de Docker.</span><span class="sxs-lookup"><span data-stu-id="dbe96-142">In a production environment, SQL Server would run on a high-availability machine, outside of the Docker host.</span></span> <span data-ttu-id="dbe96-143">Para mayor comodidad en un entorno de desarrollo o pruebas, se recomienda ejecutar SQL Server en su propio contenedor.</span><span class="sxs-lookup"><span data-stu-id="dbe96-143">For convenience, in a development or test environment, running SQL Server in its own container is recommended.</span></span>

<span data-ttu-id="dbe96-144">El conjunto de características iniciales solo permite examinar el catálogo.</span><span class="sxs-lookup"><span data-stu-id="dbe96-144">The initial feature set only enables browsing the catalog.</span></span> <span data-ttu-id="dbe96-145">Mediante las actualizaciones se habilitará el conjunto completo de características de la aplicación en contenedor.</span><span class="sxs-lookup"><span data-stu-id="dbe96-145">Updates would enable the full feature set of the containerized application.</span></span> <span data-ttu-id="dbe96-146">Encontrará la descripción de una arquitectura de aplicación web monolítica en el libro electrónico [ASP.NET Web Application architecture practices](https://aka.ms/webappebook) (Prácticas de la arquitectura de aplicaciones web ASP.NET) y en la [aplicación de ejemplo eShopOnWeb](https://aka.ms/WebAppArchitecture) relacionada.</span><span class="sxs-lookup"><span data-stu-id="dbe96-146">A more advanced monolithic web application architecture is described in the [ASP.NET Web Application architecture practices](https://aka.ms/webappebook) e-book and related [eShopOnWeb sample application](https://aka.ms/WebAppArchitecture).</span></span>

## <a name="docker-support"></a><span data-ttu-id="dbe96-147">Compatibilidad con Docker</span><span class="sxs-lookup"><span data-stu-id="dbe96-147">Docker support</span></span>

<span data-ttu-id="dbe96-148">El proyecto eShopOnWeb se ejecuta en .NET Core.</span><span class="sxs-lookup"><span data-stu-id="dbe96-148">The eShopOnWeb project runs on .NET Core.</span></span> <span data-ttu-id="dbe96-149">Por lo tanto, se puede ejecutar en contenedores basados en Linux o en Windows.</span><span class="sxs-lookup"><span data-stu-id="dbe96-149">That means it can run in either Linux-based or Windows-based containers.</span></span> <span data-ttu-id="dbe96-150">Tenga en cuenta que, para la implementación de Docker, le interesa usar el mismo tipo de host para SQL Server.</span><span class="sxs-lookup"><span data-stu-id="dbe96-150">Note that for Docker deployment, you want to use the same host type for SQL Server.</span></span> <span data-ttu-id="dbe96-151">Los contenedores basados en Linux permiten una superficie menor y son preferibles.</span><span class="sxs-lookup"><span data-stu-id="dbe96-151">Linux-based containers allow a smaller footprint and are preferred.</span></span>

<span data-ttu-id="dbe96-152">Visual Studio proporciona una plantilla de proyecto que agrega compatibilidad con Docker a una solución.</span><span class="sxs-lookup"><span data-stu-id="dbe96-152">Visual Studio provides a project template that adds support for Docker to a solution.</span></span> <span data-ttu-id="dbe96-153">Para ello, haga clic con el botón derecho en el proyecto y haga clic en **Agregar** y en **Compatibilidad con Docker**.</span><span class="sxs-lookup"><span data-stu-id="dbe96-153">You right-click the project, click **Add** followed by **Docker Support**.</span></span> <span data-ttu-id="dbe96-154">La plantilla agrega un archivo Dockerfile al proyecto y un nuevo proyecto **docker-compose** que proporciona un archivo de inicio *docker-compose.yml*.</span><span class="sxs-lookup"><span data-stu-id="dbe96-154">The template adds a Dockerfile to your project, and a new **docker-compose** project that provides a starter *docker-compose.yml* file.</span></span> <span data-ttu-id="dbe96-155">Este paso ya se ha llevado a cabo en el proyecto eShopOnWeb descargado de GitHub.</span><span class="sxs-lookup"><span data-stu-id="dbe96-155">This step has already been done in the eShopOnWeb project downloaded from GitHub.</span></span> <span data-ttu-id="dbe96-156">Verá que la solución contiene el proyecto **eShopOnWeb** y el proyecto **docker-compose** tal como se muestra en la figura 6-1.</span><span class="sxs-lookup"><span data-stu-id="dbe96-156">You can see that the solution contains the **eShopOnWeb** project and the **docker-compose** project as shown in Figure 6-1.</span></span>

![](./media/image1.png)

<span data-ttu-id="dbe96-157">**Figura 6-1**.</span><span class="sxs-lookup"><span data-stu-id="dbe96-157">**Figure 6-1**.</span></span> <span data-ttu-id="dbe96-158">Proyecto **docker-compose** en una aplicación web de un solo contenedor.</span><span class="sxs-lookup"><span data-stu-id="dbe96-158">The **docker-compose** project in a single-container web application</span></span>

<span data-ttu-id="dbe96-159">Estos archivos son archivos estándar docker-compose, coherentes con cualquier proyecto de Docker.</span><span class="sxs-lookup"><span data-stu-id="dbe96-159">These files are standard docker-compose files, consistent with any Docker project.</span></span> <span data-ttu-id="dbe96-160">Puede usarlos con Visual Studio o desde la línea de comandos.</span><span class="sxs-lookup"><span data-stu-id="dbe96-160">You can use them with Visual Studio or from the command line.</span></span> <span data-ttu-id="dbe96-161">Esta aplicación se ejecuta en .NET Core y usa contenedores de Linux.</span><span class="sxs-lookup"><span data-stu-id="dbe96-161">This application runs on .NET Core and uses Linux containers.</span></span> <span data-ttu-id="dbe96-162">Por lo tanto, también la puede programar, compilar y ejecutar en un equipo Linux o Mac.</span><span class="sxs-lookup"><span data-stu-id="dbe96-162">So, you can also code, build, and run it on a Mac or on a Linux machine.</span></span>

<span data-ttu-id="dbe96-163">El archivo *docker-compose.yml* contiene información sobre qué imágenes se van a compilar y qué contenedores se van a iniciar.</span><span class="sxs-lookup"><span data-stu-id="dbe96-163">The *docker-compose.yml* file contains information about what images to build and what containers to launch.</span></span> <span data-ttu-id="dbe96-164">Las plantillas especifican cómo se compila la imagen `eshopweb` y cómo se inician los contenedores de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="dbe96-164">The templates specify how to build the `eshopweb` image and launch the application’s containers.</span></span> <span data-ttu-id="dbe96-165">Debe agregar la dependencia en SQL Server incluyendo una imagen para ella (por ejemplo, `mssql-server-linux`) y un servicio para la imagen sql.data de modo que Docker compile e inicie ese contenedor.</span><span class="sxs-lookup"><span data-stu-id="dbe96-165">You need to add the dependency on SQL Server by including an image for it (for example, `mssql-server-linux`), and a service for the sql.data image for Docker to build and launch that container.</span></span> <span data-ttu-id="dbe96-166">Esta configuración se muestra en el ejemplo siguiente:</span><span class="sxs-lookup"><span data-stu-id="dbe96-166">These settings are shown in the following example:</span></span>

```yml
version: '2'

services:
  eshopweb:
    image: eshop/web
    build:
    context: ./eShopWeb
    dockerfile: Dockerfile
    depends_on:
      - sql.data

  sql.data:
    image: microsoft/mssql-server-linux
```

<span data-ttu-id="dbe96-167">La directiva `depends_on` indica a Docker que la imagen eShopWeb depende de la imagen sql.data.</span><span class="sxs-lookup"><span data-stu-id="dbe96-167">The `depends_on` directive tells Docker that the eShopWeb image depends on the sql.data image.</span></span> <span data-ttu-id="dbe96-168">Las líneas que hay a continuación de `depends_on` son instrucciones para compilar una imagen con la etiqueta `sql.data` usando la imagen `microsoft/mssql-server-linux`.</span><span class="sxs-lookup"><span data-stu-id="dbe96-168">The lines below `depends_on` are the instructions to build an image tagged `sql.data` using the `microsoft/mssql-server-linux` image.</span></span>

<span data-ttu-id="dbe96-169">En el proyecto **docker-compose** se muestran los demás archivos docker-compose bajo el nodo principal *docker-compose.yml*. Esto ayuda a señalar visualmente la relación entre estos archivos.</span><span class="sxs-lookup"><span data-stu-id="dbe96-169">The **docker-compose** project displays the other docker-compose files under the main *docker-compose.yml* node to provide a visual indication that these files are related.</span></span> <span data-ttu-id="dbe96-170">El archivo *docker-compose-override.yml* contiene los valores de configuración de ambos servicios, como las cadenas de conexión y otros valores para las aplicaciones.</span><span class="sxs-lookup"><span data-stu-id="dbe96-170">The *docker-compose-override.yml* file contains settings for both services, such as connection strings and other application settings.</span></span>

<span data-ttu-id="dbe96-171">En el ejemplo siguiente se muestra el archivo *docker-compose.vs.debug.yml*, que contiene los valores usados para la depuración en Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="dbe96-171">The following example shows the *docker-compose.vs.debug.yml* file, which contains settings used for debugging in Visual Studio.</span></span> <span data-ttu-id="dbe96-172">En ese archivo, la imagen eshopweb tiene anexada la etiqueta de desarrollo.</span><span class="sxs-lookup"><span data-stu-id="dbe96-172">In that file, the eshopweb image has the dev tag appended to it.</span></span> <span data-ttu-id="dbe96-173">Esto permite separar las imágenes de depuración de las imágenes de publicación para que no se implemente sin querer la información de depuración en un entorno de producción:</span><span class="sxs-lookup"><span data-stu-id="dbe96-173">That helps separate debug from release images so that you don't accidentally deploy the debug information to a production environment:</span></span>

```yml
version: '2'

services:
  eshopweb:
    image: eshop/web:dev
    build:
    args:
    source: ${DOCKER_BUILD_SOURCE}
    environment:
      - DOTNET_USE_POLLING_FILE_WATCHER=1
    volumes:
      - ./eShopWeb:/app
      - ~/.nuget/packages:/root/.nuget/packages:ro
      - ~/clrdbg:/clrdbg:ro
    entrypoint: tail -f /dev/null
    labels:
      - "com.microsoft.visualstudio.targetoperatingsystem=linux"
```

<span data-ttu-id="dbe96-174">El último archivo agregado es *docker-compose.ci.build.yml*,</span><span class="sxs-lookup"><span data-stu-id="dbe96-174">The last file added is *docker-compose.ci.build.yml*.</span></span> <span data-ttu-id="dbe96-175">que se usaría desde la línea de comandos para compilar el proyecto desde un servidor CI.</span><span class="sxs-lookup"><span data-stu-id="dbe96-175">This file would be used from the command line to build the project from a CI server.</span></span> <span data-ttu-id="dbe96-176">Este archivo compuesto inicia un contenedor de Docker que compila las imágenes necesarias para la aplicación.</span><span class="sxs-lookup"><span data-stu-id="dbe96-176">This compose file starts a Docker container that builds the images needed for your application.</span></span> <span data-ttu-id="dbe96-177">En el ejemplo siguiente se muestra el contenido del archivo *docker-compose.ci.build.yml*:</span><span class="sxs-lookup"><span data-stu-id="dbe96-177">The following example shows the contents of the *docker-compose.ci.build.yml* file:</span></span>

```yml
version: '2'

services:
  ci-build:
    image: microsoft/aspnetcore-build:latest
    volumes:
      - .:/src
    working_dir: /src
  command: /bin/bash -c "dotnet restore ./eShopWeb.sln && dotnet publish  ./eShopWeb.sln -c Release -o ./obj/Docker/publish"
```

> [!NOTE]
> <span data-ttu-id="dbe96-178">A partir del SDK 2.0 de .NET Core, el comando [dotnet restore](../../../core/tools/dotnet-restore.md) se ejecuta automáticamente al ejecutar [dotnet publish](../../../core/tools/dotnet-publish.md).</span><span class="sxs-lookup"><span data-stu-id="dbe96-178">Starting with .NET Core SDK 2.0, the [dotnet restore](../../../core/tools/dotnet-restore.md) command executes automatically when [dotnet publish](../../../core/tools/dotnet-publish.md) is executed.</span></span>

<span data-ttu-id="dbe96-179">Tenga en cuenta que la imagen es una imagen de compilación de ASP.NET Core.</span><span class="sxs-lookup"><span data-stu-id="dbe96-179">Notice that the image is an ASP.NET Core build image.</span></span> <span data-ttu-id="dbe96-180">Esta imagen incluye las herramientas de compilación y el SDK para compilar la aplicación y crear las imágenes necesarias.</span><span class="sxs-lookup"><span data-stu-id="dbe96-180">That image includes the SDK and build tools to build your application and create the required images.</span></span> <span data-ttu-id="dbe96-181">Al ejecutar el proyecto **docker-compose** con este archivo, se inicia el contenedor de compilación desde la imagen y se compila la imagen de la aplicación en ese contenedor.</span><span class="sxs-lookup"><span data-stu-id="dbe96-181">Running the **docker-compose** project using this file starts the build container from the image, then builds your application’s image in that container.</span></span> <span data-ttu-id="dbe96-182">Debe especificar ese archivo *docker-compose* como parte de la línea de comandos para compilar la aplicación en un contenedor de Docker y, después, iniciarlo.</span><span class="sxs-lookup"><span data-stu-id="dbe96-182">You specify that *docker-compose* file as part of the command line to build your application in a Docker container, then launch it.</span></span>

<span data-ttu-id="dbe96-183">En Visual Studio, puede ejecutar la aplicación en contenedores de Docker. Para ello, seleccione el proyecto **docker-compose** como proyecto de inicio y presione Ctrl+F5 (F5 para depurar), como haría con cualquier otra aplicación.</span><span class="sxs-lookup"><span data-stu-id="dbe96-183">In Visual Studio, you can run your application in Docker containers by selecting the **docker-compose** project as the startup project, and then pressing Ctrl+F5 (F5 to debug), as you can with any other application.</span></span> <span data-ttu-id="dbe96-184">Cuando se inicia el proyecto **docker-compose**, Visual Studio ejecuta **docker-compose** mediante el archivo *docker-compose.yml*, el archivo *docker-compose.override.yml* y uno de los archivos docker-compose.vs\*.</span><span class="sxs-lookup"><span data-stu-id="dbe96-184">When you start the **docker-compose** project, Visual Studio runs **docker-compose** using the *docker-compose.yml* file, the *docker-compose.override.yml* file, and one of the docker-compose.vs.\* files.</span></span> <span data-ttu-id="dbe96-185">Una vez que se ha iniciado la aplicación, Visual Studio abre automáticamente el explorador.</span><span class="sxs-lookup"><span data-stu-id="dbe96-185">Once the application has started, Visual Studio launches the browser for you.</span></span>

<span data-ttu-id="dbe96-186">Si inicia la aplicación en el depurador, Visual Studio se asociará a la aplicación en ejecución en Docker.</span><span class="sxs-lookup"><span data-stu-id="dbe96-186">If you launch the application in the debugger, Visual Studio attaches to the running application in Docker.</span></span>

## <a name="troubleshooting"></a><span data-ttu-id="dbe96-187">Solución de problemas</span><span class="sxs-lookup"><span data-stu-id="dbe96-187">Troubleshooting</span></span>

<span data-ttu-id="dbe96-188">En esta sección se describen algunos de los problemas que pueden surgir cuando se ejecutan contenedores de manera local y se sugieren diversas correcciones.</span><span class="sxs-lookup"><span data-stu-id="dbe96-188">This section describes a few issues that might arise when your run containers locally and suggests some fixes.</span></span>

### <a name="stop-docker-containers"></a><span data-ttu-id="dbe96-189">Detener contenedores de Docker</span><span class="sxs-lookup"><span data-stu-id="dbe96-189">Stop Docker containers</span></span>

<span data-ttu-id="dbe96-190">Después de iniciar la aplicación en contenedor, los contenedores siguen ejecutándose incluso después de que se haya detenido la depuración.</span><span class="sxs-lookup"><span data-stu-id="dbe96-190">After you launch the containerized application, the containers continue to run, even after you have stopped debugging.</span></span> <span data-ttu-id="dbe96-191">Puede ejecutar el comando `docker ps` desde la línea de comandos para ver qué contenedores se están ejecutando.</span><span class="sxs-lookup"><span data-stu-id="dbe96-191">You can run the `docker ps` command from the command line to see which containers are running.</span></span> <span data-ttu-id="dbe96-192">El comando `docker stop` detiene un contenedor en ejecución, tal como se muestra en la figura 6-2.</span><span class="sxs-lookup"><span data-stu-id="dbe96-192">The `docker stop` command stops a running container, as shown in Figure 6-2.</span></span>

![](./media/image2.png)

<span data-ttu-id="dbe96-193">**Figura 6-2**.</span><span class="sxs-lookup"><span data-stu-id="dbe96-193">**Figure 6-2**.</span></span> <span data-ttu-id="dbe96-194">Mostrar y detener contenedores con los comandos docker ps y docker stop de la CLI</span><span class="sxs-lookup"><span data-stu-id="dbe96-194">Listing and stopping containers with the docker ps and docker stop CLI commands</span></span>

<span data-ttu-id="dbe96-195">Es posible que necesite detener procesos en ejecución cuando cambie entre diferentes configuraciones.</span><span class="sxs-lookup"><span data-stu-id="dbe96-195">You might need to stop running processes when you switch between different configurations.</span></span> <span data-ttu-id="dbe96-196">En caso contrario, el contenedor que ejecuta la aplicación web usará el puerto para la aplicación (5106 en este ejemplo).</span><span class="sxs-lookup"><span data-stu-id="dbe96-196">Otherwise, the container that is running the web application is using the port for your application (5106 in this example).</span></span>

### <a name="add-docker-to-your-projects"></a><span data-ttu-id="dbe96-197">Agregar Docker a los proyectos</span><span class="sxs-lookup"><span data-stu-id="dbe96-197">Add Docker to your projects</span></span>

<span data-ttu-id="dbe96-198">El asistente que agrega compatibilidad con Docker se comunica con el proceso de Docker que se está ejecutando.</span><span class="sxs-lookup"><span data-stu-id="dbe96-198">The wizard that adds Docker support communicates with the running Docker process.</span></span> <span data-ttu-id="dbe96-199">Si Docker no está funcionando cuando se inicie el asistente, el asistente no se ejecutará correctamente.</span><span class="sxs-lookup"><span data-stu-id="dbe96-199">If Docker isn't running when you start the wizard, the wizard won't run correctly.</span></span> <span data-ttu-id="dbe96-200">El asistente examinará el contenedor que ha elegido actualmente para agregar la compatibilidad correcta con Docker.</span><span class="sxs-lookup"><span data-stu-id="dbe96-200">The wizard examines your current container choice to add the correct Docker support.</span></span> <span data-ttu-id="dbe96-201">Para agregar compatibilidad con contenedores de Windows, ejecute el asistente mientras Docker se ejecuta con los contenedores de Windows configurados.</span><span class="sxs-lookup"><span data-stu-id="dbe96-201">To add support for Windows Containers, run the wizard while you have Docker running with Windows Containers configured.</span></span> <span data-ttu-id="dbe96-202">Para agregar compatibilidad con contenedores de Linux, ejecute el asistente mientras Docker se ejecuta con los contenedores de Linux configurados.</span><span class="sxs-lookup"><span data-stu-id="dbe96-202">To add support for Linux containers, run the wizard while you have Docker running with Linux containers configured.</span></span>

>[!div class="step-by-step"]
<span data-ttu-id="dbe96-203">[Anterior](../docker-application-development-process/docker-app-development-workflow.md)
[Siguiente](../containerize-net-framework-applications/index.md)</span><span class="sxs-lookup"><span data-stu-id="dbe96-203">[Previous](../docker-application-development-process/docker-app-development-workflow.md)
[Next](../containerize-net-framework-applications/index.md)</span></span>
