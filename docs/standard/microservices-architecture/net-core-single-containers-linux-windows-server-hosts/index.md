---
title: Implementar aplicaciones web de .NET Core basadas en un solo contenedor en hosts de Linux o Windows Nano Server
description: Arquitectura de microservicios de .NET para aplicaciones .NET en contenedor | Implementar aplicaciones web de .NET Core basadas en un solo contenedor en hosts de Linux o Windows Nano Server
author: CESARDELATORRE
ms.author: wiwagn
ms.date: 05/26/2017
ms.openlocfilehash: f429bc0c6e76c2be2e4f491768a15ab36ecb0d34
ms.sourcegitcommit: 3d5d33f384eeba41b2dff79d096f47ccc8d8f03d
ms.translationtype: HT
ms.contentlocale: es-ES
ms.lasthandoff: 05/04/2018
ms.locfileid: "33591099"
---
# <a name="deploying-single-container-based-net-core-web-applications-on-linux-or-windows-nano-server-hosts"></a><span data-ttu-id="80825-103">Implementar aplicaciones web de .NET Core basadas en un solo contenedor en hosts de Linux o Windows Nano Server</span><span class="sxs-lookup"><span data-stu-id="80825-103">Deploying Single-Container-Based .NET Core Web Applications on Linux or Windows Nano Server Hosts</span></span>

<span data-ttu-id="80825-104">*Puede usar contenedores de Docker para la implementación monolítica de aplicaciones web más sencillas. Esto mejora la integración continua y las canalizaciones de implementación continua y ayuda a llevar a cabo correctamente el proceso desde la implementación hasta la producción. Ya no se volverá a preguntar: "Funciona en mi equipo, ¿por qué no funciona en producción?".*</span><span class="sxs-lookup"><span data-stu-id="80825-104">*You can use Docker containers for monolithic deployment of simpler web applications. This improves continuous integration and continuous deployment pipelines and helps achieve deployment-to-production success. No more “It works in my machine, why does not work in production?”*</span></span>

<span data-ttu-id="80825-105">Una arquitectura basada en microservicios tiene muchas ventajas, pero a costa de una mayor complejidad.</span><span class="sxs-lookup"><span data-stu-id="80825-105">A microservices-based architecture has many benefits, but those benefits come at a cost of increased complexity.</span></span> <span data-ttu-id="80825-106">En algunos casos, los costos superan a las ventajas y podría resultarle más útil una aplicación de implementación monolítica que se ejecute en un solo contenedor o en unos pocos contenedores.</span><span class="sxs-lookup"><span data-stu-id="80825-106">In some cases, the costs outweigh the benefits, and you will be better served with a monolithic deployment application running in a single container or in just a few containers.</span></span> 

<span data-ttu-id="80825-107">Es posible que una aplicación monolítica no se pueda descomponer fácilmente en microservicios bien separados.</span><span class="sxs-lookup"><span data-stu-id="80825-107">A monolithic application might not be easily decomposable into well-separated microservices.</span></span> <span data-ttu-id="80825-108">Ya ha aprendido que estos se deben particionar por función: los microservicios deberían funcionar de manera independiente para proporcionar una aplicación más resistente.</span><span class="sxs-lookup"><span data-stu-id="80825-108">You have learned that these should be partitioned by function: microservices should work independently of each other to provide a more resilient application.</span></span> <span data-ttu-id="80825-109">Si no puede proporcionar sectores de características de la aplicación, el hecho de separarla solo agrega complejidad.</span><span class="sxs-lookup"><span data-stu-id="80825-109">If you cannot deliver feature slices of the application, separating it only adds complexity.</span></span>

<span data-ttu-id="80825-110">Una aplicación podría no necesitar inicialmente el escalado de las características por separado.</span><span class="sxs-lookup"><span data-stu-id="80825-110">An application might not yet need to scale features independently.</span></span> <span data-ttu-id="80825-111">Supongamos que en una fase temprana del ciclo de vida de la aplicación de referencia eShopOnContainers, el tráfico no justificaba separar las características en diferentes microservicios.</span><span class="sxs-lookup"><span data-stu-id="80825-111">Let’s suppose that early in the life of our eShopOnContainers reference application, the traffic did not justify separating features into different microservices.</span></span> <span data-ttu-id="80825-112">El tráfico era bastante reducido y el hecho de agregar recursos a un servicio normalmente suponía agregar recursos a todos los servicios.</span><span class="sxs-lookup"><span data-stu-id="80825-112">Traffic was small enough that adding resources to one service typically meant adding resources to all services.</span></span> <span data-ttu-id="80825-113">El trabajo adicional que suponía separar la aplicación en servicios diferenciados apenas proporcionaba beneficio.</span><span class="sxs-lookup"><span data-stu-id="80825-113">The additional work to separate the application into discrete services provided minimal benefit.</span></span>

<span data-ttu-id="80825-114">Además, en las fases tempranas del desarrollo de una aplicación, es posible que no se tenga una idea clara de dónde están los límites funcionales naturales.</span><span class="sxs-lookup"><span data-stu-id="80825-114">Also, early in the development of an application you might not have a clear idea where the natural functional boundaries are.</span></span> <span data-ttu-id="80825-115">Mientras desarrolla un producto mínimamente viable, puede que todavía no sea evidente la separación natural.</span><span class="sxs-lookup"><span data-stu-id="80825-115">As you develop a minimum viable product, the natural separation might not yet have emerged.</span></span>

<span data-ttu-id="80825-116">Algunas de estas condiciones pueden ser temporales.</span><span class="sxs-lookup"><span data-stu-id="80825-116">Some of these conditions might be temporary.</span></span> <span data-ttu-id="80825-117">Podría empezar creando una aplicación monolítica y, más adelante, separar algunas características para desarrollarlas e implementarlas como microservicios.</span><span class="sxs-lookup"><span data-stu-id="80825-117">You might start by creating a monolithic application, and later separate some features to be developed and deployed as microservices.</span></span> <span data-ttu-id="80825-118">Otras condiciones podrían ser básicas para el espacio de problemas de la aplicación y, en consecuencia, tal vez no se pueda dividir nunca en varios microservicios.</span><span class="sxs-lookup"><span data-stu-id="80825-118">Other conditions might be essential to the application’s problem space, meaning that the application might never be broken into multiple microservices.</span></span>

<span data-ttu-id="80825-119">La separación de una aplicación en varios procesos diferenciados también introduce una sobrecarga.</span><span class="sxs-lookup"><span data-stu-id="80825-119">Separating an application into many discrete processes also introduces overhead.</span></span> <span data-ttu-id="80825-120">La separación de funciones en procesos diferentes conlleva una mayor complejidad.</span><span class="sxs-lookup"><span data-stu-id="80825-120">There is more complexity in separating features into different processes.</span></span> <span data-ttu-id="80825-121">Los protocolos de comunicación se vuelven más complejos.</span><span class="sxs-lookup"><span data-stu-id="80825-121">The communication protocols become more complex.</span></span> <span data-ttu-id="80825-122">En lugar de llamadas a métodos, debe usar comunicaciones asincrónicas entre servicios.</span><span class="sxs-lookup"><span data-stu-id="80825-122">Instead of method calls, you must use asynchronous communications between services.</span></span> <span data-ttu-id="80825-123">Cuando cambie a una arquitectura de microservicios, deberá agregar muchos de los bloques de creación que se implementan en la versión de microservicios de la aplicación eShopOnContainers: control de bus de eventos, reintentos y resistencia de mensajes, coherencia eventual y mucho más.</span><span class="sxs-lookup"><span data-stu-id="80825-123">As you move to a microservices architecture, you need to add many of the building blocks implemented in the microservices version of the eShopOnContainers application: event bus handling, message resiliency and retries, eventual consistency, and more.</span></span>

<span data-ttu-id="80825-124">Una versión muy simplificada de eShopOnContainers (denominada [eShopWeb](https://github.com/dotnet-architecture/eShopOnContainers/tree/master/src/Web/WebMonolithic) e incluida en el mismo repositorio de GitHub) se ejecuta como una aplicación de MVC monolítica y, tal como se ha indicado, esta opción de diseño ofrece una serie de ventajas.</span><span class="sxs-lookup"><span data-stu-id="80825-124">A much-simplified version of eShopOnContainers (named [eShopWeb](https://github.com/dotnet-architecture/eShopOnContainers/tree/master/src/Web/WebMonolithic) and included in the same GitHub repo) runs as a monolithic MVC application, and as just described, there are advantages offered by that design choice.</span></span> <span data-ttu-id="80825-125">Puede descargar de GitHub el código fuente para esta aplicación y ejecutarlo de forma local.</span><span class="sxs-lookup"><span data-stu-id="80825-125">You can download the source for this application from GitHub and run it locally.</span></span> <span data-ttu-id="80825-126">Incluso esta aplicación monolítica se beneficia de la implementación en un entorno de contenedor.</span><span class="sxs-lookup"><span data-stu-id="80825-126">Even this monolithic application benefits from being deployed in a container environment.</span></span>

<span data-ttu-id="80825-127">Ante todo, la implementación en contenedor implica que cada instancia de la aplicación se ejecuta en el mismo entorno.</span><span class="sxs-lookup"><span data-stu-id="80825-127">For one, the containerized deployment means that every instance of the application runs in the same environment.</span></span> <span data-ttu-id="80825-128">Esto incluye el entorno de desarrollo donde tienen lugar las pruebas y el desarrollo iniciales.</span><span class="sxs-lookup"><span data-stu-id="80825-128">This includes the developer environment where early testing and development take place.</span></span> <span data-ttu-id="80825-129">El equipo de desarrollo puede ejecutar la aplicación en un entorno en contenedor que coincida con el entorno de producción.</span><span class="sxs-lookup"><span data-stu-id="80825-129">The development team can run the application in a containerized environment that matches the production environment.</span></span>

<span data-ttu-id="80825-130">Además, las aplicaciones en contenedor se escalan horizontalmente con un costo menor.</span><span class="sxs-lookup"><span data-stu-id="80825-130">In addition, containerized applications scale out at lower cost.</span></span> <span data-ttu-id="80825-131">Como ya ha visto, el entorno en contenedor permite un mayor uso compartido de recursos que los entornos de máquina virtual tradicionales.</span><span class="sxs-lookup"><span data-stu-id="80825-131">As you saw earlier, the container environment enables greater resource sharing than traditional VM environments.</span></span>

<span data-ttu-id="80825-132">Por último, el hecho de incluir la aplicación en un contenedor fuerza la separación entre la lógica de negocios y el servidor de almacenamiento.</span><span class="sxs-lookup"><span data-stu-id="80825-132">Finally, containerizing the application forces a separation between the business logic and the storage server.</span></span> <span data-ttu-id="80825-133">Cuando la aplicación se escala horizontalmente, los diversos contenedores se basan en un único medio de almacenamiento físico.</span><span class="sxs-lookup"><span data-stu-id="80825-133">As the application scales out, the multiple containers will all rely on a single physical storage medium.</span></span> <span data-ttu-id="80825-134">Normalmente, se trata de un servidor de alta disponibilidad que ejecuta una base de datos de SQL Server.</span><span class="sxs-lookup"><span data-stu-id="80825-134">This would typically be a high-availability server running a SQL Server database.</span></span>

## <a name="application-tour"></a><span data-ttu-id="80825-135">Paseo por la aplicación</span><span class="sxs-lookup"><span data-stu-id="80825-135">Application tour</span></span>

<span data-ttu-id="80825-136">La aplicación [eShopWeb](https://github.com/dotnet-architecture/eShopOnContainers/tree/master/src/Web/WebMonolithic) representa una parte de la aplicación eShopOnContainers que se ejecuta como una aplicación monolítica (una aplicación basada en MVC de ASP.NET Core que se ejecuta en .NET Core).</span><span class="sxs-lookup"><span data-stu-id="80825-136">The [eShopWeb](https://github.com/dotnet-architecture/eShopOnContainers/tree/master/src/Web/WebMonolithic) application represents some of the eShopOnContainers application running as a monolithic application—an ASP.NET Core MVC based application running on .NET Core.</span></span> <span data-ttu-id="80825-137">Básicamente, proporciona las funciones de exploración del catálogo que se han descrito en secciones anteriores.</span><span class="sxs-lookup"><span data-stu-id="80825-137">It mainly provides the catalog browsing capabilities that we described in earlier sections.</span></span>

<span data-ttu-id="80825-138">La aplicación usa una base de datos de SQL Server para el almacenamiento del catálogo.</span><span class="sxs-lookup"><span data-stu-id="80825-138">The application uses a SQL Server database for the catalog storage.</span></span> <span data-ttu-id="80825-139">En las implementaciones basadas en contenedor, esta aplicación monolítica puede tener acceso al mismo almacén de datos que la aplicación basada en microservicios.</span><span class="sxs-lookup"><span data-stu-id="80825-139">In container-based deployments, this monolithic application can access the same data store as the microservices-based application.</span></span> <span data-ttu-id="80825-140">La aplicación está configurada para ejecutar SQL Server en un contenedor junto con la aplicación monolítica.</span><span class="sxs-lookup"><span data-stu-id="80825-140">The application is configured to run SQL Server in a container alongside the monolithic application.</span></span> <span data-ttu-id="80825-141">En un entorno de producción, SQL Server se ejecutaría en una máquina con alta disponibilidad, fuera del host de Docker.</span><span class="sxs-lookup"><span data-stu-id="80825-141">In a production environment, SQL Server would run on a high-availability machine, outside of the Docker host.</span></span> <span data-ttu-id="80825-142">Para mayor comodidad en un entorno de desarrollo o de pruebas, se recomienda ejecutar SQL Server en su propio contenedor.</span><span class="sxs-lookup"><span data-stu-id="80825-142">For convenience in a dev or test environment, we recommend running SQL Server in its own container.</span></span>

<span data-ttu-id="80825-143">El conjunto de características iniciales solo permite examinar el catálogo.</span><span class="sxs-lookup"><span data-stu-id="80825-143">The initial feature set only enables browsing the catalog.</span></span> <span data-ttu-id="80825-144">Mediante las actualizaciones se habilitará el conjunto completo de características de la aplicación en contenedor.</span><span class="sxs-lookup"><span data-stu-id="80825-144">Updates would enable the full feature set of the containerized application.</span></span> <span data-ttu-id="80825-145">En el libro electrónico [ASP.NET Web Application architecture practices](https://aka.ms/webappebook) (Prácticas de la arquitectura de aplicaciones web ASP.NET) y en la [aplicación de ejemplo eShopOnWeb](http://aka.ms/WebAppArchitecture) relacionada se describe una arquitectura de aplicaciones web monolítica más avanzada, aunque en este caso no se ejecuta en contenedores de Docker, ya que el escenario se centra en el desarrollo web simple con ASP.NET Core.</span><span class="sxs-lookup"><span data-stu-id="80825-145">A more advanced monolithic web application architecture is described in the [ASP.NET Web Application architecture practices](https://aka.ms/webappebook) e-book and related [eShopOnWeb sample application](http://aka.ms/WebAppArchitecture), although in that case it is not running on Docker containers because that scenario focuses on plain web development with ASP.NET Core.</span></span>

<span data-ttu-id="80825-146">Aun así, la versión simplificada disponible en eShopOnContainers (eShopWeb) se ejecuta en un contenedor de Docker.</span><span class="sxs-lookup"><span data-stu-id="80825-146">However, the simplified version available in eShopOnContainers (eShopWeb) runs in a Docker container.</span></span>

## <a name="docker-support"></a><span data-ttu-id="80825-147">Compatibilidad con Docker</span><span class="sxs-lookup"><span data-stu-id="80825-147">Docker support</span></span>

<span data-ttu-id="80825-148">El proyecto eShopOnWeb se ejecuta en .NET Core.</span><span class="sxs-lookup"><span data-stu-id="80825-148">The eShopOnWeb project runs on .NET Core.</span></span> <span data-ttu-id="80825-149">Por lo tanto, se puede ejecutar en contenedores basados en Linux o en Windows.</span><span class="sxs-lookup"><span data-stu-id="80825-149">Therefore, it can run in either Linux-based or Windows-based containers.</span></span> <span data-ttu-id="80825-150">Tenga en cuenta que, para la implementación de Docker, le interesa usar el mismo tipo de host para SQL Server.</span><span class="sxs-lookup"><span data-stu-id="80825-150">Note that for Docker deployment, you want to use the same host type for SQL Server.</span></span> <span data-ttu-id="80825-151">Los contenedores basados en Linux permiten una superficie menor y son preferibles.</span><span class="sxs-lookup"><span data-stu-id="80825-151">Linux-based containers allow a smaller footprint and are preferred.</span></span>

<span data-ttu-id="80825-152">Visual Studio proporciona una plantilla de proyecto que agrega compatibilidad con Docker a una solución.</span><span class="sxs-lookup"><span data-stu-id="80825-152">Visual Studio provides a project template that adds support for Docker to a solution.</span></span> <span data-ttu-id="80825-153">Para ello, haga clic con el botón derecho en el proyecto y haga clic en **Agregar** y en **Compatibilidad con Docker**.</span><span class="sxs-lookup"><span data-stu-id="80825-153">You right-click the project, click **Add** followed by **Docker Support**.</span></span> <span data-ttu-id="80825-154">La plantilla agrega un archivo Dockerfile al proyecto y un nuevo proyecto **docker-compose** que proporciona un archivo de inicio docker-compose.yml.</span><span class="sxs-lookup"><span data-stu-id="80825-154">The template adds a Dockerfile to your project, and a new **docker-compose** project that provides a starter docker-compose.yml file.</span></span> <span data-ttu-id="80825-155">Este paso ya se ha llevado a cabo en el proyecto eShopOnWeb descargado de GitHub.</span><span class="sxs-lookup"><span data-stu-id="80825-155">This step has already been done in the eShopOnWeb project downloaded from GitHub.</span></span> <span data-ttu-id="80825-156">Verá que la solución contiene el proyecto **eShopOnWeb** y el proyecto **docker-compose** tal como se muestra en la figura 6-1.</span><span class="sxs-lookup"><span data-stu-id="80825-156">You will see that the solution contains the **eShopOnWeb** project and the **docker-compose** project as shown in Figure 6-1.</span></span>

![](./media/image1.png)

<span data-ttu-id="80825-157">**Figura 6-1**.</span><span class="sxs-lookup"><span data-stu-id="80825-157">**Figure 6-1**.</span></span> <span data-ttu-id="80825-158">Proyecto **docker-compose** en una aplicación web de un solo contenedor.</span><span class="sxs-lookup"><span data-stu-id="80825-158">The **docker-compose** project in a single-container web application</span></span>

<span data-ttu-id="80825-159">Estos archivos son archivos estándar docker-compose, coherentes con cualquier proyecto de Docker.</span><span class="sxs-lookup"><span data-stu-id="80825-159">These files are standard docker-compose files, consistent with any Docker project.</span></span> <span data-ttu-id="80825-160">Puede usarlos con Visual Studio o desde la línea de comandos.</span><span class="sxs-lookup"><span data-stu-id="80825-160">You can use them with Visual Studio or from the command line.</span></span> <span data-ttu-id="80825-161">Esta aplicación se ejecuta en .NET Core y usa contenedores de Linux, por lo que también puede codificar, compilar y ejecutar en un equipo Mac o en un equipo Linux.</span><span class="sxs-lookup"><span data-stu-id="80825-161">This application runs on .NET Core and uses Linux containers, so you can also code, build, and run on a Mac or on a Linux machine.</span></span>

<span data-ttu-id="80825-162">El archivo docker-compose.yml contiene información sobre qué imágenes se van a compilar y qué contenedores se van a iniciar.</span><span class="sxs-lookup"><span data-stu-id="80825-162">The docker-compose.yml file contains information about what images to build and what containers to launch.</span></span> <span data-ttu-id="80825-163">Las plantillas especifican cómo se compila la imagen eshopweb y cómo se inician los contenedores de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="80825-163">The templates specify how to build the eshopweb image and launch the application’s containers.</span></span> <span data-ttu-id="80825-164">Debe agregar la dependencia en SQL Server. Para hacerlo, incluya una imagen para ella (por ejemplo, mssql-server-linux) y un servicio para la imagen sql.data de modo que Docker compile e inicie ese contenedor.</span><span class="sxs-lookup"><span data-stu-id="80825-164">You need to add the dependency on SQL Server by including an image for it (for example, mssql-server-linux), and a service for the sql.data image for Docker to build and launch that container.</span></span> <span data-ttu-id="80825-165">Esta configuración se muestra en el ejemplo siguiente:</span><span class="sxs-lookup"><span data-stu-id="80825-165">These settings are shown in the following example:</span></span>

```yml
version: '2'

services:
  eshopweb:
    image: eshop/web
    build:
    context: ./eShopWeb
    dockerfile: Dockerfile
    depends_on:
      - sql.data

  sql.data:
    image: microsoft/mssql-server-linux
```

<span data-ttu-id="80825-166">La directiva depends\_on le indica a Docker que la imagen eShopWeb depende de la imagen sql.data.</span><span class="sxs-lookup"><span data-stu-id="80825-166">The depends\_on directive tells Docker that the eShopWeb image depends on the sql.data image.</span></span> <span data-ttu-id="80825-167">Unas líneas por debajo se encuentran las instrucciones para compilar una imagen etiquetada como sql.data mediante la imagen microsoft/mssql-server-linux.</span><span class="sxs-lookup"><span data-stu-id="80825-167">Lines below that are the instructions to build an image tagged sql.data using the microsoft/mssql-server-linux image.</span></span>

<span data-ttu-id="80825-168">En el proyecto **docker-compose** se muestran los demás archivos docker-compose bajo el nodo principal docker-compose.yml. Esto ayuda a señalar visualmente la relación entre estos archivos.</span><span class="sxs-lookup"><span data-stu-id="80825-168">The **docker-compose** project displays the other docker-compose files under the main docker-compose.yml node to provide a visual indication that these files are related.</span></span> <span data-ttu-id="80825-169">El archivo docker-compose-override.yml contiene los valores de configuración de ambos servicios, como las cadenas de conexión y otros valores para las aplicaciones.</span><span class="sxs-lookup"><span data-stu-id="80825-169">The docker-compose-override.yml file contains settings for both services, such as connection strings and other application settings.</span></span>

<span data-ttu-id="80825-170">En el ejemplo siguiente se muestra el archivo docker-compose.vs.debug.yml, que contiene los valores usados para la depuración en Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="80825-170">The following example shows the docker-compose.vs.debug.yml file, which contains settings used for debugging in Visual Studio.</span></span> <span data-ttu-id="80825-171">En ese archivo, la imagen eshopweb tiene anexada la etiqueta de desarrollo.</span><span class="sxs-lookup"><span data-stu-id="80825-171">In that file, the eshopweb image has the dev tag appended to it.</span></span> <span data-ttu-id="80825-172">Esto ayuda a separar las imágenes de depuración de las imágenes de lanzamiento, para que no se implemente accidentalmente la información de depuración en un entorno de producción:</span><span class="sxs-lookup"><span data-stu-id="80825-172">That helps separate debug from release images so that you do not accidentally deploy the debug information to a production environment:</span></span>

```yml
version: '2'
  
services:
  eshopweb:
    image: eshop/web:dev
    build:
    args:
    source: ${DOCKER_BUILD_SOURCE}
    environment:
      - DOTNET_USE_POLLING_FILE_WATCHER=1
    volumes:
      - ./eShopWeb:/app
      - ~/.nuget/packages:/root/.nuget/packages:ro
      - ~/clrdbg:/clrdbg:ro
    entrypoint: tail -f /dev/null
    labels:
      - "com.microsoft.visualstudio.targetoperatingsystem=linux"
```

<span data-ttu-id="80825-173">El último archivo agregado es docker-compose.ci.build.yml,</span><span class="sxs-lookup"><span data-stu-id="80825-173">The last file added is docker-compose.ci.build.yml.</span></span> <span data-ttu-id="80825-174">que se usaría desde la línea de comandos para compilar el proyecto desde un servidor CI.</span><span class="sxs-lookup"><span data-stu-id="80825-174">This would be used from the command line to build the project from a CI server.</span></span> <span data-ttu-id="80825-175">Este archivo compuesto inicia un contenedor de Docker que compila las imágenes necesarias para la aplicación.</span><span class="sxs-lookup"><span data-stu-id="80825-175">This compose file starts a Docker container that builds the images needed for your application.</span></span> <span data-ttu-id="80825-176">En el ejemplo siguiente se muestra el contenido del archivo docker-compose.ci.build.yml.</span><span class="sxs-lookup"><span data-stu-id="80825-176">The following example shows the contents of the docker-compose.ci.build.yml file.</span></span>

```yml
version: '2'
  
services:
  ci-build:
    image: microsoft/aspnetcore-build:latest
    volumes:
      - .:/src
    working_dir: /src
  command: /bin/bash -c "dotnet restore ./eShopWeb.sln && dotnet publish  ./eShopWeb.sln -c Release -o ./obj/Docker/publish"
```

<span data-ttu-id="80825-177">**Nota**: A partir de .NET Core 2.0, el comando de restauración dotnet se ejecuta automáticamente cuando se ejecuta la publicación de dotnet.</span><span class="sxs-lookup"><span data-stu-id="80825-177">**Note**: Starting with .NET Core 2.0, the dotnet restore command executes automatically when dotnet publish is executed.</span></span>

<span data-ttu-id="80825-178">Tenga en cuenta que la imagen es una imagen de compilación de ASP.NET Core.</span><span class="sxs-lookup"><span data-stu-id="80825-178">Notice that the image is an ASP.NET Core build image.</span></span> <span data-ttu-id="80825-179">Esta imagen incluye las herramientas de compilación y el SDK para compilar la aplicación y crear las imágenes necesarias.</span><span class="sxs-lookup"><span data-stu-id="80825-179">That image includes the SDK and build tools to build your application and create the required images.</span></span> <span data-ttu-id="80825-180">Al ejecutar el proyecto **docker-compose** con este archivo, se inicia el contenedor de compilación desde la imagen y se compila la imagen de la aplicación en ese contenedor.</span><span class="sxs-lookup"><span data-stu-id="80825-180">Running the **docker-compose** project using this file starts the build container from the image, then builds your application’s image in that container.</span></span> <span data-ttu-id="80825-181">Debe especificar ese archivo docker-compose como parte de la línea de comandos para compilar la aplicación en un contenedor de Docker y, después, iniciarlo.</span><span class="sxs-lookup"><span data-stu-id="80825-181">You specify that docker-compose file as part of the command line to build your application in a Docker container, then launch it.</span></span>

<span data-ttu-id="80825-182">En Visual Studio, puede ejecutar la aplicación en contenedores de Docker. Para ello, seleccione el proyecto **docker-compose** como proyecto de inicio y presione Ctrl+F5 (F5 para depurar), como haría con cualquier otra aplicación.</span><span class="sxs-lookup"><span data-stu-id="80825-182">In Visual Studio, you can run your application in Docker containers by selecting the **docker-compose** project as the startup project, and then pressing Ctrl+F5 (F5 to debug), as you can with any other application.</span></span> <span data-ttu-id="80825-183">Cuando se inicia el proyecto **docker-compose**, Visual Studio ejecuta **docker-compose** mediante el archivo docker-compose.yml, el archivo docker-compose.override.yml y uno de los archivos docker-compose.vs\*.</span><span class="sxs-lookup"><span data-stu-id="80825-183">When you start the **docker-compose** project, Visual Studio runs **docker-compose** using the docker-compose.yml file, the docker-compose.override.yml file, and one of the docker-compose.vs.\* files.</span></span> <span data-ttu-id="80825-184">Una vez que se ha iniciado la aplicación, Visual Studio abre automáticamente el explorador.</span><span class="sxs-lookup"><span data-stu-id="80825-184">Once the application has started, Visual Studio launches the browser for you.</span></span>

<span data-ttu-id="80825-185">Si inicia la aplicación en el depurador, Visual Studio se asociará a la aplicación en ejecución en Docker.</span><span class="sxs-lookup"><span data-stu-id="80825-185">If you launch the application in the debugger, Visual Studio will attach to the running application in Docker.</span></span>

## <a name="troubleshooting"></a><span data-ttu-id="80825-186">Solución de problemas</span><span class="sxs-lookup"><span data-stu-id="80825-186">Troubleshooting</span></span>

<span data-ttu-id="80825-187">En esta sección se describen algunos de los problemas que pueden surgir cuando se ejecutan contenedores de manera local y se sugieren diversas correcciones.</span><span class="sxs-lookup"><span data-stu-id="80825-187">This section describes a few issues that might arise when your run containers locally and suggests some fixes.</span></span>

### <a name="stopping-docker-containers"></a><span data-ttu-id="80825-188">Detener contenedores de Docker</span><span class="sxs-lookup"><span data-stu-id="80825-188">Stopping Docker containers</span></span> 

<span data-ttu-id="80825-189">Después de iniciar la aplicación en contenedor, los contenedores siguen ejecutándose incluso después de que se haya detenido la depuración.</span><span class="sxs-lookup"><span data-stu-id="80825-189">After you launch the containerized application, the containers continue to run, even after you have stopped debugging.</span></span> <span data-ttu-id="80825-190">Puede ejecutar el comando docker ps desde la línea de comandos para ver qué contenedores se están ejecutando.</span><span class="sxs-lookup"><span data-stu-id="80825-190">You can run the docker ps command from the command line to see which containers are running.</span></span> <span data-ttu-id="80825-191">El comando docker stop detiene un contenedor en ejecución, tal como se muestra en la figura 6-2.</span><span class="sxs-lookup"><span data-stu-id="80825-191">The docker stop command stops a running container, as shown in Figure 6-2.</span></span>

![](./media/image2.png)

<span data-ttu-id="80825-192">**Figura 6-2**.</span><span class="sxs-lookup"><span data-stu-id="80825-192">**Figure 6-2**.</span></span> <span data-ttu-id="80825-193">Mostrar y detener contenedores con los comandos docker ps y docker stop de la CLI</span><span class="sxs-lookup"><span data-stu-id="80825-193">Listing and stopping containers with the docker ps and docker stop CLI commands</span></span>

<span data-ttu-id="80825-194">Es posible que necesite detener procesos en ejecución cuando cambie entre diferentes configuraciones.</span><span class="sxs-lookup"><span data-stu-id="80825-194">You might need to stop running processes when you switch between different configurations.</span></span> <span data-ttu-id="80825-195">En caso contrario, el contenedor que ejecuta la aplicación web usará el puerto para la aplicación (5106 en este ejemplo).</span><span class="sxs-lookup"><span data-stu-id="80825-195">Otherwise, the container that is running the web application is using the port for your application (5106 in this example).</span></span>

### <a name="adding-docker-to-your-projects"></a><span data-ttu-id="80825-196">Agregar Docker a los proyectos</span><span class="sxs-lookup"><span data-stu-id="80825-196">Adding Docker to your projects</span></span>

<span data-ttu-id="80825-197">El asistente que agrega compatibilidad con Docker se comunica con el proceso de Docker que se está ejecutando.</span><span class="sxs-lookup"><span data-stu-id="80825-197">The wizard that adds Docker support communicates with the running Docker process.</span></span> <span data-ttu-id="80825-198">El asistente no se ejecutará correctamente si Docker no está funcionando cuando se inicie el asistente.</span><span class="sxs-lookup"><span data-stu-id="80825-198">The wizard will not run correctly if Docker is not running when you start the wizard.</span></span> <span data-ttu-id="80825-199">Además, el asistente examinará el contenedor que ha elegido actualmente para agregar la compatibilidad correcta con Docker.</span><span class="sxs-lookup"><span data-stu-id="80825-199">In addition, the wizard examines your current container choice to add the correct Docker support.</span></span> <span data-ttu-id="80825-200">Si quiere agregar compatibilidad con contenedores de Windows, debe ejecutar el asistente mientras Docker se ejecuta con contenedores de Windows configurados.</span><span class="sxs-lookup"><span data-stu-id="80825-200">If you want to add support for Windows Containers, you need to run the wizard while you have Docker running with Windows Containers configured.</span></span> <span data-ttu-id="80825-201">Si quiere agregar compatibilidad con contenedores de Linux, ejecute el asistente mientras Docker se ejecuta con contenedores de Linux configurados.</span><span class="sxs-lookup"><span data-stu-id="80825-201">If you want to add support for Linux containers, run the wizard while you have Docker running with Linux containers configured.</span></span>

>[!div class="step-by-step"]
<span data-ttu-id="80825-202">[Anterior] (../docker-application-development-process/docker-app-development-workflow.md) [Siguiente] (../containerize-net-framework-applications/index.md)</span><span class="sxs-lookup"><span data-stu-id="80825-202">[Previous] (../docker-application-development-process/docker-app-development-workflow.md) [Next] (../containerize-net-framework-applications/index.md)</span></span>
