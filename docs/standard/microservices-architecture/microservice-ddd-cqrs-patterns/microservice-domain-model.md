---
title: "Diseñar un modelo de dominio de microservicio"
description: "Arquitectura de Microservicios de .NET para aplicaciones .NET en contenedores | Diseñar un modelo de dominio de microservicio"
keywords: Docker, microservicios, ASP.NET, contenedor
author: CESARDELATORRE
ms.author: wiwagn
ms.date: 05/26/2017
ms.prod: .net-core
ms.technology: dotnet-docker
ms.topic: article
ms.openlocfilehash: 455a2c5a39fb9b765b557610ab108f8c75882dbd
ms.sourcegitcommit: bd1ef61f4bb794b25383d3d72e71041a5ced172e
ms.translationtype: HT
ms.contentlocale: es-ES
ms.lasthandoff: 10/18/2017
---
# <a name="designing-a-microservice-domain-model"></a><span data-ttu-id="e4224-104">Diseñar un modelo de dominio de microservicio</span><span class="sxs-lookup"><span data-stu-id="e4224-104">Designing a microservice domain model</span></span>

<span data-ttu-id="e4224-105">*Definir un modelo de dominio enriquecido para cada microservicio de negocios o contexto limitado*</span><span class="sxs-lookup"><span data-stu-id="e4224-105">*Define one rich domain model for each business microservice or Bounded Context*</span></span>

<span data-ttu-id="e4224-106">El objetivo es crear un modelo de dominio coherente único para cada microservicio de negocios o contexto limitado (BC).</span><span class="sxs-lookup"><span data-stu-id="e4224-106">Your goal is to create a single cohesive domain model for each business microservice or Bounded Context (BC).</span></span> <span data-ttu-id="e4224-107">Tenga en cuenta, sin embargo, que una continuidad del negocio o business microservicio a veces podría estar compuesto por varios servicios físicos que comparten un modelo de dominio único.</span><span class="sxs-lookup"><span data-stu-id="e4224-107">Keep in mind, however, that a BC or business microservice could sometimes be composed of several physical services that share a single domain model.</span></span> <span data-ttu-id="e4224-108">El modelo de dominio debe capturar las reglas, comportamiento, lenguaje de negocios y las restricciones del único contexto limitado o microservicio de negocios que representa.</span><span class="sxs-lookup"><span data-stu-id="e4224-108">The domain model must capture the rules, behavior, business language, and constraints of the single Bounded Context or business microservice that it represents.</span></span>

## <a name="the-domain-entity-pattern"></a><span data-ttu-id="e4224-109">El modelo de entidad del dominio</span><span class="sxs-lookup"><span data-stu-id="e4224-109">The Domain Entity pattern</span></span>

<span data-ttu-id="e4224-110">Las entidades representan objetos del dominio y se definen principalmente por su identidad, la continuidad y la persistencia con el tiempo y no solo por los atributos que se componen de ellos.</span><span class="sxs-lookup"><span data-stu-id="e4224-110">Entities represent domain objects and are primarily defined by their identity, continuity, and persistence over time, and not only by the attributes that comprise them.</span></span> <span data-ttu-id="e4224-111">Tal y como se indica Eric Evans, "un objeto definido principalmente por su identidad se denomina una entidad."</span><span class="sxs-lookup"><span data-stu-id="e4224-111">As Eric Evans says, “an object primarily defined by its identity is called an Entity.”</span></span> <span data-ttu-id="e4224-112">Las entidades son muy importantes en el modelo de dominio, ya que son la base para un modelo.</span><span class="sxs-lookup"><span data-stu-id="e4224-112">Entities are very important in the domain model, since they are the base for a model.</span></span> <span data-ttu-id="e4224-113">Por lo tanto, debe identificar y diseñarlos cuidadosamente.</span><span class="sxs-lookup"><span data-stu-id="e4224-113">Therefore, you should identify and design them carefully.</span></span>

<span data-ttu-id="e4224-114">*Identidad de una entidad puede cruzar varios microservicios o contextos limitado.*</span><span class="sxs-lookup"><span data-stu-id="e4224-114">*An entity’s identity can cross multiple microservices or Bounded Contexts.*</span></span>

<span data-ttu-id="e4224-115">La misma identidad (aunque no es la misma entidad) se pueden modelar en varios contextos limitado o microservicios.</span><span class="sxs-lookup"><span data-stu-id="e4224-115">The same identity (though not the same entity) can be modeled across multiple Bounded Contexts or microservices.</span></span> <span data-ttu-id="e4224-116">Sin embargo, que no implica que la misma entidad, con los mismos atributos y lógica se implementa en varios contextos limitado.</span><span class="sxs-lookup"><span data-stu-id="e4224-116">However, that does not imply that the same entity, with the same attributes and logic would be implemented in multiple Bounded Contexts.</span></span> <span data-ttu-id="e4224-117">En su lugar, las entidades en cada contexto limitado limitan sus atributos y comportamientos a los requeridos en el dominio de ese contexto limitado.</span><span class="sxs-lookup"><span data-stu-id="e4224-117">Instead, entities in each Bounded Context limit their attributes and behaviors to those required in that Bounded Context’s domain.</span></span>

<span data-ttu-id="e4224-118">Por ejemplo, la entidad de comprador podría tener la mayoría de los atributos de una persona que están definidos en la entidad de usuario en el perfil o la identidad microservicio, incluida la identidad.</span><span class="sxs-lookup"><span data-stu-id="e4224-118">For instance, the buyer entity might have most of a person’s attributes that are defined in the user entity in the profile or identity microservice, including the identity.</span></span> <span data-ttu-id="e4224-119">Pero la entidad de comprador en la ordenación microservicio podría tener menos de los atributos, porque solo determinados datos comprador está relacionado con el proceso de pedido.</span><span class="sxs-lookup"><span data-stu-id="e4224-119">But the buyer entity in the ordering microservice might have fewer attributes, because only certain buyer data is related to the order process.</span></span> <span data-ttu-id="e4224-120">El contexto de cada microservicio o contexto limitado afecta a su modelo de dominio.</span><span class="sxs-lookup"><span data-stu-id="e4224-120">The context of each microservice or Bounded Context impacts its domain model.</span></span>

<span data-ttu-id="e4224-121">*Las entidades de dominio deben implementar el comportamiento además de implementar los atributos de datos*</span><span class="sxs-lookup"><span data-stu-id="e4224-121">*Domain entities must implement behavior in addition to implementing data attributes*</span></span>

<span data-ttu-id="e4224-122">Una entidad de dominio en DDD debe implementar la lógica del dominio o el comportamiento relacionado con los datos de entidad (es decir, el objeto al que obtuvo acceso memoria).</span><span class="sxs-lookup"><span data-stu-id="e4224-122">A domain entity in DDD must implement the domain logic or behavior related to the entity data (the object accessed in memory).</span></span> <span data-ttu-id="e4224-123">Por ejemplo, como parte de una clase de entidad order deben tener lógica de negocios y las operaciones que se implementan como métodos para realizar tareas como agregar un elemento de pedido, la validación de datos y el cálculo total.</span><span class="sxs-lookup"><span data-stu-id="e4224-123">For example, as part of an order entity class you must have business logic and operations implemented as methods for tasks such as adding an order item, data validation, and total calculation.</span></span> <span data-ttu-id="e4224-124">Métodos de la entidad ocupan de las reglas de la entidad en lugar de tener esas reglas se propagan a través de la capa de aplicación e invariables.</span><span class="sxs-lookup"><span data-stu-id="e4224-124">The entity’s methods take care of the invariants and rules of the entity instead of having those rules spread across the application layer.</span></span>

<span data-ttu-id="e4224-125">Figura 9-8 muestra una entidad del dominio que implementa no solo los atributos de datos, pero las operaciones o métodos con lógica de dominio relacionadas.</span><span class="sxs-lookup"><span data-stu-id="e4224-125">Figure 9-8 shows a domain entity that implements not only data attributes but operations or methods with related domain logic.</span></span>

![](./media/image9.png)

<span data-ttu-id="e4224-126">**Figura 9-8**.</span><span class="sxs-lookup"><span data-stu-id="e4224-126">**Figure 9-8**.</span></span> <span data-ttu-id="e4224-127">Ejemplo de un diseño de la entidad de dominio implementar datos más comportamiento</span><span class="sxs-lookup"><span data-stu-id="e4224-127">Example of a domain entity design implementing data plus behavior</span></span>

<span data-ttu-id="e4224-128">Por supuesto, a veces puede tener entidades que implementar ninguna lógica como parte de la clase de entidad.</span><span class="sxs-lookup"><span data-stu-id="e4224-128">Of course, sometimes you can have entities that do not implement any logic as part of the entity class.</span></span> <span data-ttu-id="e4224-129">Esto puede ocurrir en las entidades secundarias dentro de un agregado si la entidad secundaria no tiene ninguna lógica especial porque la mayor parte de la lógica se define en la raíz agregada.</span><span class="sxs-lookup"><span data-stu-id="e4224-129">This can happen in child entities within an aggregate if the child entity does not have any special logic because most of the logic is defined in the aggregate root.</span></span> <span data-ttu-id="e4224-130">Si tiene un microservicio complejo que tiene mucha lógica implementada en las clases de servicio en lugar de en las entidades de dominio, podría encontrarse en el modelo de dominio anemic, que se explica en la sección siguiente.</span><span class="sxs-lookup"><span data-stu-id="e4224-130">If you have a complex microservice that has a lot of logic implemented in the service classes instead of in the domain entities, you could be falling into the anemic domain model, explained in the following section.</span></span>

### <a name="rich-domain-model-versus-anemic-domain-model"></a><span data-ttu-id="e4224-131">Modelo de dominio enriquecido frente al modelo de dominio anemic</span><span class="sxs-lookup"><span data-stu-id="e4224-131">Rich domain model versus anemic domain model</span></span>

<span data-ttu-id="e4224-132">En su entrada [AnemicDomainModel](https://martinfowler.com/bliki/AnemicDomainModel.html), Martin Fowler describe un modelo de dominio anemic de esta manera:</span><span class="sxs-lookup"><span data-stu-id="e4224-132">In his post [AnemicDomainModel](https://martinfowler.com/bliki/AnemicDomainModel.html), Martin Fowler describes an anemic domain model this way:</span></span>

<span data-ttu-id="e4224-133">El síntoma de un modelo de dominio Anemic básico es que a primera vista parece lo real.</span><span class="sxs-lookup"><span data-stu-id="e4224-133">The basic symptom of an Anemic Domain Model is that at first blush it looks like the real thing.</span></span> <span data-ttu-id="e4224-134">Hay objetos, muchos denominado después de los nombres en el espacio de dominio y estos objetos están conectados con las relaciones enriquecidas y la estructura que tienen los modelos de dominio es true.</span><span class="sxs-lookup"><span data-stu-id="e4224-134">There are objects, many named after the nouns in the domain space, and these objects are connected with the rich relationships and structure that true domain models have.</span></span> <span data-ttu-id="e4224-135">La instrucción catch lleguen al mirar el comportamiento y tenga en cuenta que hay casi cualquier comportamiento que en estos objetos, hacerlos poco más de bolsas de captadores y establecedores.</span><span class="sxs-lookup"><span data-stu-id="e4224-135">The catch comes when you look at the behavior, and you realize that there is hardly any behavior on these objects, making them little more than bags of getters and setters.</span></span>

<span data-ttu-id="e4224-136">Por supuesto, cuando se usa un modelo de dominio anemic, se utilizará los modelos de datos de un conjunto de objetos de servicio (con nombre tradicionalmente la *capa empresarial*) que captura toda la lógica de negocios o de dominio.</span><span class="sxs-lookup"><span data-stu-id="e4224-136">Of course, when you use an anemic domain model, those data models will be used from a set of service objects (traditionally named the *business layer*) which capture all the domain or business logic.</span></span> <span data-ttu-id="e4224-137">La capa de negocio se encuentra en la parte superior del modelo de datos y utiliza el modelo de datos al igual que los datos.</span><span class="sxs-lookup"><span data-stu-id="e4224-137">The business layer sits on top of the data model and uses the data model just as data.</span></span>

<span data-ttu-id="e4224-138">El modelo de dominio anemic es simplemente un diseño de estilo de procedimientos.</span><span class="sxs-lookup"><span data-stu-id="e4224-138">The anemic domain model is just a procedural style design.</span></span> <span data-ttu-id="e4224-139">Objetos entidad anemic no son objetos reales, ya que carecen de comportamiento (métodos).</span><span class="sxs-lookup"><span data-stu-id="e4224-139">Anemic entity objects are not real objects because they lack behavior (methods).</span></span> <span data-ttu-id="e4224-140">Solo contienen propiedades de datos y, por tanto, no es diseño orientado a objetos.</span><span class="sxs-lookup"><span data-stu-id="e4224-140">They only hold data properties and thus it is not object-oriented design.</span></span> <span data-ttu-id="e4224-141">Al colocar todo el comportamiento de alejar en objetos de servicio (la capa de negocio) básicamente terminará con [código spaghetti](https://en.wikipedia.org/wiki/Spaghetti_code) o [secuencias de comandos de transacción](https://martinfowler.com/eaaCatalog/transactionScript.html), y, por tanto, se pierde las ventajas que un modelo de dominio proporciona.</span><span class="sxs-lookup"><span data-stu-id="e4224-141">By putting all the behavior out into service objects (the business layer) you essentially end up with [spaghetti code](https://en.wikipedia.org/wiki/Spaghetti_code) or [transaction scripts](https://martinfowler.com/eaaCatalog/transactionScript.html), and therefore you lose the advantages that a domain model provides.</span></span>

<span data-ttu-id="e4224-142">Sin tener en cuenta, si su microservicio o contexto limitado es muy sencilla (un servicio CRUD), el modelo de dominio anemic en forma de objetos entidad con propiedades de datos simplemente podría bastar y puede que no sea la pena implementar modelos más complejos de DDD.</span><span class="sxs-lookup"><span data-stu-id="e4224-142">Regardless, if your microservice or Bounded Context is very simple (a CRUD service), the anemic domain model in the form of entity objects with just data properties might be good enough, and it might not be worth implementing more complex DDD patterns.</span></span> <span data-ttu-id="e4224-143">En ese caso, será simplemente un modelo de persistencia, como ha creado deliberadamente una entidad con datos de solo para fines CRUD.</span><span class="sxs-lookup"><span data-stu-id="e4224-143">In that case, it will be simply a persistence model, because you have intentionally created an entity with only data for CRUD purposes.</span></span>

<span data-ttu-id="e4224-144">Para eso están microservicios arquitecturas son perfectas para varias arquitecturas según cada contexto limitado.</span><span class="sxs-lookup"><span data-stu-id="e4224-144">That is why microservices architectures are perfect for a multi-architectural approach depending on each Bounded Context.</span></span> <span data-ttu-id="e4224-145">Por ejemplo, en eShopOnContainers, la ordenación microservicio implementa patrones DDD, pero la microservicio de catálogo, que es un servicio CRUD simple, no lo hace.</span><span class="sxs-lookup"><span data-stu-id="e4224-145">For instance, in eShopOnContainers, the ordering microservice implements DDD patterns, but the catalog microservice, which is a simple CRUD service, does not.</span></span>

<span data-ttu-id="e4224-146">Algunas personas, supongamos que el modelo de dominio anemic es un antipatrón.</span><span class="sxs-lookup"><span data-stu-id="e4224-146">Some people say that the anemic domain model is an anti-pattern.</span></span> <span data-ttu-id="e4224-147">Realmente depende de lo que va a implementar.</span><span class="sxs-lookup"><span data-stu-id="e4224-147">It really depends on what you are implementing.</span></span> <span data-ttu-id="e4224-148">Si el microservicio que se va a crear es bastante sencillo (por ejemplo, un servicio CRUD), según el modelo de dominio anemic no es un antipatrón.</span><span class="sxs-lookup"><span data-stu-id="e4224-148">If the microservice you are creating is simple enough (for example, a CRUD service), following the anemic domain model it is not an anti-pattern.</span></span> <span data-ttu-id="e4224-149">Sin embargo, si necesita para abordar la complejidad del dominio de microservicio que tiene muchos cambiantes de reglas de negocios, el modelo de dominio anemic sería un antipatrón para ese microservicio o contexto limitado.</span><span class="sxs-lookup"><span data-stu-id="e4224-149">However, if you need to tackle the complexity of a microservice’s domain that has a lot of ever-changing business rules, the anemic domain model might be an anti-pattern for that microservice or Bounded Context.</span></span> <span data-ttu-id="e4224-150">En ese caso, se diseña como datos completos de un modelo con entidades que contiene los datos más comportamiento así como implementar otros patrones que DDD (agregados, objetos de valor, etc.) puede tener enormes ventajas para el éxito a largo plazo de este tipo un microservicio.</span><span class="sxs-lookup"><span data-stu-id="e4224-150">In that case, designing it as a rich model with entities containing data plus behavior as well as implementing additional DDD patterns (aggregates, value objects, etc.) might have huge benefits for the long-term success of such a microservice.</span></span>

#### <a name="additional-resources"></a><span data-ttu-id="e4224-151">Recursos adicionales</span><span class="sxs-lookup"><span data-stu-id="e4224-151">Additional resources</span></span>

-   <span data-ttu-id="e4224-152">**DevIQ. Entidad del dominio**
    [*http://deviq.com/entity/*](http://deviq.com/entity/)</span><span class="sxs-lookup"><span data-stu-id="e4224-152">**DevIQ. Domain Entity**
[*http://deviq.com/entity/*](http://deviq.com/entity/)</span></span>

-   <span data-ttu-id="e4224-153">**Martin Fowler. El modelo de dominio**
    [*https://martinfowler.com/eaaCatalog/domainModel.html*](https://martinfowler.com/eaaCatalog/domainModel.html)</span><span class="sxs-lookup"><span data-stu-id="e4224-153">**Martin Fowler. The Domain Model**
[*https://martinfowler.com/eaaCatalog/domainModel.html*](https://martinfowler.com/eaaCatalog/domainModel.html)</span></span>

-   <span data-ttu-id="e4224-154">**Martin Fowler. El modelo de dominio Anemic**</span><span class="sxs-lookup"><span data-stu-id="e4224-154">**Martin Fowler. The Anemic Domain Model**</span></span>

    <span data-ttu-id="e4224-155"><https://martinfowler.com/bliki/AnemicDomainModel.HTML></span><span class="sxs-lookup"><span data-stu-id="e4224-155"><https://martinfowler.com/bliki/AnemicDomainModel.html></span></span>

### <a name="the-value-object-pattern"></a><span data-ttu-id="e4224-156">El patrón de objeto de valor</span><span class="sxs-lookup"><span data-stu-id="e4224-156">The Value Object pattern</span></span>

<span data-ttu-id="e4224-157">Tal y como se ha detectado Eric Evans, "muchos objetos no tienen identidad conceptual.</span><span class="sxs-lookup"><span data-stu-id="e4224-157">As Eric Evans has noted, “Many objects do not have conceptual identity.</span></span> <span data-ttu-id="e4224-158">Estos objetos describen ciertas características de una cosa."</span><span class="sxs-lookup"><span data-stu-id="e4224-158">These objects describe certain characteristics of a thing.”</span></span>

<span data-ttu-id="e4224-159">Una entidad requiere una identidad, pero hay muchos objetos en un sistema que no lo hace, al igual que el modelo de objeto de valor.</span><span class="sxs-lookup"><span data-stu-id="e4224-159">An entity requires an identity, but there are many objects in a system that do not, like the Value Object pattern.</span></span> <span data-ttu-id="e4224-160">Un objeto de valor es un objeto con ninguna identidad conceptual que describe un aspecto de dominio.</span><span class="sxs-lookup"><span data-stu-id="e4224-160">A value object is an object with no conceptual identity that describes a domain aspect.</span></span> <span data-ttu-id="e4224-161">Se trata de objetos que crea una instancia para representar elementos de diseño que solo le interesan temporalmente.</span><span class="sxs-lookup"><span data-stu-id="e4224-161">These are objects that you instantiate to represent design elements that only concern you temporarily.</span></span> <span data-ttu-id="e4224-162">Le preocupa la *qué* , no son *que* son.</span><span class="sxs-lookup"><span data-stu-id="e4224-162">You care about *what* they are, not *who* they are.</span></span> <span data-ttu-id="e4224-163">Ejemplos incluyen números y cadenas, pero también pueden ser un nivel más alto conceptos como grupos de atributos.</span><span class="sxs-lookup"><span data-stu-id="e4224-163">Examples include numbers and strings, but can also be higher-level concepts like groups of attributes.</span></span>

<span data-ttu-id="e4224-164">Algo que es una entidad en un microservicio podría no ser una entidad en otra microservicio, porque en el segundo caso, el contexto limitado podría tener un significado diferente.</span><span class="sxs-lookup"><span data-stu-id="e4224-164">Something that is an entity in a microservice might not be an entity in another microservice, because in the second case, the Bounded Context might have a different meaning.</span></span> <span data-ttu-id="e4224-165">Por ejemplo, una dirección en una aplicación de comercio electrónico podría no tener una identidad en absoluto, ya que solo puede representar un grupo de atributos de perfil del cliente para una persona o empresa.</span><span class="sxs-lookup"><span data-stu-id="e4224-165">For example, an address in an e-commerce application might not have an identity at all, since it might only represent a group of attributes of the customer’s profile for a person or company.</span></span> <span data-ttu-id="e4224-166">En este caso, la dirección debe clasificarse como un objeto de valor.</span><span class="sxs-lookup"><span data-stu-id="e4224-166">In this case, the address should be classified as a value object.</span></span> <span data-ttu-id="e4224-167">Sin embargo, en una aplicación para una empresa de la utilidad de energía eléctrica, la dirección del cliente podría ser importante para el dominio de negocio.</span><span class="sxs-lookup"><span data-stu-id="e4224-167">However, in an application for an electric power utility company, the customer address could be important for the business domain.</span></span> <span data-ttu-id="e4224-168">Por lo tanto, la dirección debe tener una identidad para que el sistema de facturación puede estar relacionado directamente con la dirección.</span><span class="sxs-lookup"><span data-stu-id="e4224-168">Therefore, the address must have an identity so the billing system can be directly linked to the address.</span></span> <span data-ttu-id="e4224-169">En ese caso, una dirección debe clasificarse como una entidad de dominio.</span><span class="sxs-lookup"><span data-stu-id="e4224-169">In that case, an address should be classified as a domain entity.</span></span>

<span data-ttu-id="e4224-170">Una persona con un nombre y apellido normalmente es una entidad debido a una persona que tiene identidad, incluso si el nombre y apellido coincidan con otro conjunto de valores, por ejemplo, si esos nombres también hace referencia a una persona diferente.</span><span class="sxs-lookup"><span data-stu-id="e4224-170">A person with a name and surname is usually an entity because a person has identity, even if the name and surname coincide with another set of values, such as if those names also refers to a different person.</span></span>

<span data-ttu-id="e4224-171">Objetos de valor son difíciles de administrar en bases de datos relacionales y ORM como EF, mientras que en el documento orientado a las bases de datos sean más fáciles de implementar y utilizar.</span><span class="sxs-lookup"><span data-stu-id="e4224-171">Value objects are hard to manage in relational databases and ORMs like EF, whereas in document oriented databases they are easier to implement and use.</span></span>

#### <a name="additional-resources"></a><span data-ttu-id="e4224-172">Recursos adicionales</span><span class="sxs-lookup"><span data-stu-id="e4224-172">Additional resources</span></span>

-   <span data-ttu-id="e4224-173">**Martin Fowler. Patrón de objeto de valor**
    [*https://martinfowler.com/bliki/ValueObject.html*](https://martinfowler.com/bliki/ValueObject.html)</span><span class="sxs-lookup"><span data-stu-id="e4224-173">**Martin Fowler. Value Object pattern**
[*https://martinfowler.com/bliki/ValueObject.html*](https://martinfowler.com/bliki/ValueObject.html)</span></span>

-   <span data-ttu-id="e4224-174">**Valor de objeto**
    [*http://deviq.com/value-object/*](http://deviq.com/value-object/)</span><span class="sxs-lookup"><span data-stu-id="e4224-174">**Value Object**
[*http://deviq.com/value-object/*](http://deviq.com/value-object/)</span></span>

-   <span data-ttu-id="e4224-175">**Valor de objetos en el desarrollo controlado por pruebas**
    [*https://leanpub.com/tdd-ebook/read\#leanpub-auto-objetos de valor*](https://leanpub.com/tdd-ebook/read#leanpub-auto-value-objects)</span><span class="sxs-lookup"><span data-stu-id="e4224-175">**Value Objects in Test-Driven Development**
[*https://leanpub.com/tdd-ebook/read\#leanpub-auto-value-objects*](https://leanpub.com/tdd-ebook/read#leanpub-auto-value-objects)</span></span>

-   <span data-ttu-id="e4224-176">**Eric Evans. Diseño basado en dominio: Realiza para complejidad en el centro de Software.**</span><span class="sxs-lookup"><span data-stu-id="e4224-176">**Eric Evans. Domain-Driven Design: Tackling Complexity in the Heart of Software.**</span></span> <span data-ttu-id="e4224-177">(Libro; incluye una explicación de los objetos de valor) [ *https://www.amazon.com/Domain-Driven-Design-Tackling-Complexity-Software/dp/0321125215/*](https://www.amazon.com/Domain-Driven-Design-Tackling-Complexity-Software/dp/0321125215/)</span><span class="sxs-lookup"><span data-stu-id="e4224-177">(Book; includes a discussion of value objects) [*https://www.amazon.com/Domain-Driven-Design-Tackling-Complexity-Software/dp/0321125215/*](https://www.amazon.com/Domain-Driven-Design-Tackling-Complexity-Software/dp/0321125215/)</span></span>

### <a name="the-aggregate-pattern"></a><span data-ttu-id="e4224-178">El patrón de agregado</span><span class="sxs-lookup"><span data-stu-id="e4224-178">The Aggregate pattern</span></span>

<span data-ttu-id="e4224-179">Un modelo de dominio contiene grupos de entidades de datos diferentes y procesos que pueden controlar un área importante de funcionalidad, como el cumplimiento de pedido o inventario.</span><span class="sxs-lookup"><span data-stu-id="e4224-179">A domain model contains clusters of different data entities and processes that can control a significant area of functionality, such as order fulfilment or inventory.</span></span> <span data-ttu-id="e4224-180">Una unidad DDD más específica es la agregación, que describe un clúster o un grupo de entidades y comportamientos que se pueden tratar como una unidad coherente.</span><span class="sxs-lookup"><span data-stu-id="e4224-180">A more fine-grained DDD unit is the aggregate, which describes a cluster or group of entities and behaviors that can be treated as a cohesive unit.</span></span>

<span data-ttu-id="e4224-181">Normalmente definen un agregado basado en las transacciones que necesite.</span><span class="sxs-lookup"><span data-stu-id="e4224-181">You usually define an aggregate based on the transactions that you need.</span></span> <span data-ttu-id="e4224-182">Un ejemplo clásico es un pedido que también contiene una lista de elementos de pedido.</span><span class="sxs-lookup"><span data-stu-id="e4224-182">A classic example is an order that also contains a list of order items.</span></span> <span data-ttu-id="e4224-183">Normalmente, un elemento de pedido será una entidad.</span><span class="sxs-lookup"><span data-stu-id="e4224-183">An order item will usually be an entity.</span></span> <span data-ttu-id="e4224-184">Pero será una entidad secundaria dentro de la agregación de orden, que también contendrá la entidad pedido como su entidad raíz, denominada normalmente una raíz agregada.</span><span class="sxs-lookup"><span data-stu-id="e4224-184">But it will be a child entity within the order aggregate, which will also contain the order entity as its root entity, typically called an aggregate root.</span></span>

<span data-ttu-id="e4224-185">Puede ser difícil identificar agregados.</span><span class="sxs-lookup"><span data-stu-id="e4224-185">Identifying aggregates can be hard.</span></span> <span data-ttu-id="e4224-186">Un agregado es un grupo de objetos que deben ser coherentes entre sí, pero simplemente no se puede seleccionar un grupo de objetos y etiquetarlas un agregado.</span><span class="sxs-lookup"><span data-stu-id="e4224-186">An aggregate is a group of objects that must be consistent together, but you cannot just pick a group of objects and label them an aggregate.</span></span> <span data-ttu-id="e4224-187">Debe empezar por un concepto de dominio y pensar en las entidades que se usan en las transacciones más comunes relacionados con dicho concepto.</span><span class="sxs-lookup"><span data-stu-id="e4224-187">You must start with a domain concept and think about the entities that are used in the most common transactions related to that concept.</span></span> <span data-ttu-id="e4224-188">Las entidades que deben ser transaccionalmente coherente son lo que constituye un agregado.</span><span class="sxs-lookup"><span data-stu-id="e4224-188">Those entities that need to be transactionally consistent are what forms an aggregate.</span></span> <span data-ttu-id="e4224-189">Pensar acerca de las operaciones de transacción es probablemente la mejor manera de identificar agregados.</span><span class="sxs-lookup"><span data-stu-id="e4224-189">Thinking about transaction operations is probably the best way to identify aggregates.</span></span>

### <a name="the-aggregate-root-or-root-entity-pattern"></a><span data-ttu-id="e4224-190">El modelo raíz agregada o entidad raíz</span><span class="sxs-lookup"><span data-stu-id="e4224-190">The Aggregate Root or Root Entity pattern</span></span>

<span data-ttu-id="e4224-191">Un agregado se compone de al menos una entidad: la raíz de agregado, también se denomina entidad raíz o ientity principal.</span><span class="sxs-lookup"><span data-stu-id="e4224-191">An aggregate is composed of at least one entity: the aggregate root, also called root entity or primary ientity.</span></span> <span data-ttu-id="e4224-192">Además, puede tener varios objetos de valor, con todas las entidades y objetos trabajan juntos para implementar las transacciones y el comportamiento necesario y las entidades secundarias.</span><span class="sxs-lookup"><span data-stu-id="e4224-192">Additionally, it can have multiple child entities and value objects, with all entities and objects working together to implement required behavior and transactions.</span></span>

<span data-ttu-id="e4224-193">El propósito de una raíz agregada es asegurar la coherencia del agregado; debe ser el único punto de entrada para las actualizaciones al agregado a través de métodos o las operaciones de clase raíz en conjunto.</span><span class="sxs-lookup"><span data-stu-id="e4224-193">The purpose of an aggregate root is to ensure the consistency of the aggregate; it should be the only entry point for updates to the aggregate through methods or operations in the aggregate root class.</span></span> <span data-ttu-id="e4224-194">Debe realizar cambios en las entidades dentro del agregado sólo a través de la raíz agregado.</span><span class="sxs-lookup"><span data-stu-id="e4224-194">You should make changes to entities within the aggregate only via the aggregate root.</span></span> <span data-ttu-id="e4224-195">Es guardián de coherencia del agregado, teniendo en cuenta todas las invariantes y tendrá que cumplir en el agregado de reglas de coherencia.</span><span class="sxs-lookup"><span data-stu-id="e4224-195">It is the aggregate’s consistency guardian, taking into account all the invariants and consistency rules you might need to comply with in your aggregate.</span></span> <span data-ttu-id="e4224-196">Si cambia un objeto de entidad o un valor de secundario por separado, la raíz agregada no puede garantizar que el agregado está en un estado válido.</span><span class="sxs-lookup"><span data-stu-id="e4224-196">If you change a child entity or value object independently, the aggregate root cannot ensure that the aggregate is in a valid state.</span></span> <span data-ttu-id="e4224-197">Sería como una tabla con una sección flexible.</span><span class="sxs-lookup"><span data-stu-id="e4224-197">It would be like a table with a loose leg.</span></span> <span data-ttu-id="e4224-198">Coherencia de mantenimiento es el propósito principal de la raíz agregado.</span><span class="sxs-lookup"><span data-stu-id="e4224-198">Maintaining consistency is the main purpose of the aggregate root.</span></span>

<span data-ttu-id="e4224-199">En la figura 9-9, puede ver los agregados de ejemplo como comprador agregado, que contiene una sola entidad (la raíz agregada comprador).</span><span class="sxs-lookup"><span data-stu-id="e4224-199">In Figure 9-9, you can see sample aggregates like the buyer aggregate, which contains a single entity (the aggregate root Buyer).</span></span> <span data-ttu-id="e4224-200">El agregado de pedido contiene varias entidades y un objeto de valor.</span><span class="sxs-lookup"><span data-stu-id="e4224-200">The order aggregate contains multiple entities and a value object.</span></span>

![](./media/image10.png)

<span data-ttu-id="e4224-201">**Figura 9-9**.</span><span class="sxs-lookup"><span data-stu-id="e4224-201">**Figure 9-9**.</span></span> <span data-ttu-id="e4224-202">Ejemplo de agregados con varias o únicas entidades</span><span class="sxs-lookup"><span data-stu-id="e4224-202">Example of aggregates with multiple or single entities</span></span>

<span data-ttu-id="e4224-203">Tenga en cuenta que el agregado de comprador podría tener entidades secundarias adicionales, dependiendo de su dominio, como ocurre en la ordenación microservicio en la aplicación de referencia de eShopOnContainers.</span><span class="sxs-lookup"><span data-stu-id="e4224-203">Note that the Buyer aggregate could have additional child entities, depending on your domain, as it does in the ordering microservice in the eShopOnContainers reference application.</span></span> <span data-ttu-id="e4224-204">Figura 9-9 solo ilustra un caso en el que el comprador tiene una sola entidad, como un ejemplo de una función de agregado que contiene solo una raíz agregada.</span><span class="sxs-lookup"><span data-stu-id="e4224-204">Figure 9-9 just illustrates a case in which the buyer has a single entity, as an example of an aggregate that contains only an aggregate root.</span></span>

<span data-ttu-id="e4224-205">Con el fin de mantener la separación de agregados y mantener límites claros entre ellos, es una buena práctica en un modelo de dominio DDD para no permitir la navegación directa entre agregados y solo con el campo de clave externa (FK), tal y como se implementa en el [ Orden de modelo de dominio de microservicio](https://github.com/dotnet-architecture/eShopOnContainers/blob/master/src/Services/Ordering/Ordering.Domain/AggregatesModel/OrderAggregate/Order.cs) en eShopOnContainers.</span><span class="sxs-lookup"><span data-stu-id="e4224-205">In order to maintain separation of aggregates and keep clear boundaries between them, it is a good practice in a DDD domain model to disallow direct navigation between aggregates and only having the foreign key (FK) field, as implemented in the [Ordering microservice domain model](https://github.com/dotnet-architecture/eShopOnContainers/blob/master/src/Services/Ordering/Ordering.Domain/AggregatesModel/OrderAggregate/Order.cs) in eShopOnContainers.</span></span> <span data-ttu-id="e4224-206">La entidad Order solo tiene un campo de clave externa para el comprador, pero no una propiedad de navegación de EF principales, tal como se muestra en el código siguiente:</span><span class="sxs-lookup"><span data-stu-id="e4224-206">The Order entity only has a FK field for the buyer, but not an EF Core navigation property, as shown in the following code:</span></span>

```csharp
public class Order : Entity, IAggregateRoot
{
    private DateTime _orderDate;
    public Address Address { get; private set; }
    private int? _buyerId; //FK pointing to a different aggregate root
    public OrderStatus OrderStatus { get; private set; }
}
```

<span data-ttu-id="e4224-207">Identificar y trabajar con agregados requieren investigación y experiencia.</span><span class="sxs-lookup"><span data-stu-id="e4224-207">Identifying and working with aggregates requires research and experience.</span></span> <span data-ttu-id="e4224-208">Para obtener más información, vea la siguiente lista de recursos adicionales.</span><span class="sxs-lookup"><span data-stu-id="e4224-208">For more information, see the following Additional resources list.</span></span>

#### <a name="additional-resources"></a><span data-ttu-id="e4224-209">Recursos adicionales</span><span class="sxs-lookup"><span data-stu-id="e4224-209">Additional resources</span></span>

-   <span data-ttu-id="e4224-210">**Vaughn Vernon. Diseño de agregado efectivo - parte I: un único agregado de modelado**
    [*https://vaughnvernon.co/wordpress/wp-content/uploads/2014/10/DDD\_Comunidad\_REDACCIÓN\_ AGREGADOS\_parte\_pdf de 1.*](https://vaughnvernon.co/wordpress/wp-content/uploads/2014/10/DDD_COMMUNITY_ESSAY_AGGREGATES_PART_1.pdf)</span><span class="sxs-lookup"><span data-stu-id="e4224-210">**Vaughn Vernon. Effective Aggregate Design - Part I: Modeling a Single Aggregate**
[*https://vaughnvernon.co/wordpress/wp-content/uploads/2014/10/DDD\_COMMUNITY\_ESSAY\_AGGREGATES\_PART\_1.pdf*](https://vaughnvernon.co/wordpress/wp-content/uploads/2014/10/DDD_COMMUNITY_ESSAY_AGGREGATES_PART_1.pdf)</span></span>

-   <span data-ttu-id="e4224-211">**Vaughn Vernon. Diseño de agregado efectivo - parte II: Agregados hacer que funcionan conjuntamente**
    *<https://vaughnvernon.co/wordpress/wp-content/uploads/2014/10/DDD_COMMUNITY_ESSAY_AGGREGATES_PART_2.pdf>*</span><span class="sxs-lookup"><span data-stu-id="e4224-211">**Vaughn Vernon. Effective Aggregate Design - Part II: Making Aggregates Work Together**
*<https://vaughnvernon.co/wordpress/wp-content/uploads/2014/10/DDD_COMMUNITY_ESSAY_AGGREGATES_PART_2.pdf> *</span></span>

-   <span data-ttu-id="e4224-212">**Vaughn Vernon. Diseño de agregado efectivo - parte III: Obtener una perspectiva mediante la detección de**
    *<https://vaughnvernon.co/wordpress/wp-content/uploads/2014/10/DDD_COMMUNITY_ESSAY_AGGREGATES_PART_3.pdf>*</span><span class="sxs-lookup"><span data-stu-id="e4224-212">**Vaughn Vernon. Effective Aggregate Design - Part III: Gaining Insight Through Discovery**
*<https://vaughnvernon.co/wordpress/wp-content/uploads/2014/10/DDD_COMMUNITY_ESSAY_AGGREGATES_PART_3.pdf> *</span></span>

-   <span data-ttu-id="e4224-213">**Sergey Grybniak. Patrones de diseño tácticas de DDD**
    [*https://www.codeproject.com/Articles/1164363/Domain-Driven-Design-Tactical-Design-Patterns-Part*](https://www.codeproject.com/Articles/1164363/Domain-Driven-Design-Tactical-Design-Patterns-Part)</span><span class="sxs-lookup"><span data-stu-id="e4224-213">**Sergey Grybniak. DDD Tactical Design Patterns**
[*https://www.codeproject.com/Articles/1164363/Domain-Driven-Design-Tactical-Design-Patterns-Part*](https://www.codeproject.com/Articles/1164363/Domain-Driven-Design-Tactical-Design-Patterns-Part)</span></span>

-   <span data-ttu-id="e4224-214">**Chris Richardson. Desarrollar Microservicios transaccional con agregados**
    [*https://www.infoq.com/articles/microservices-aggregates-events-cqrs-part-1-richardson*](https://www.infoq.com/articles/microservices-aggregates-events-cqrs-part-1-richardson)</span><span class="sxs-lookup"><span data-stu-id="e4224-214">**Chris Richardson. Developing Transactional Microservices Using Aggregates**
[*https://www.infoq.com/articles/microservices-aggregates-events-cqrs-part-1-richardson*](https://www.infoq.com/articles/microservices-aggregates-events-cqrs-part-1-richardson)</span></span>

-   <span data-ttu-id="e4224-215">**DevIQ. El patrón agregado**
    [*http://deviq.com/aggregate-pattern/*](http://deviq.com/aggregate-pattern/)</span><span class="sxs-lookup"><span data-stu-id="e4224-215">**DevIQ. The Aggregate pattern**
[*http://deviq.com/aggregate-pattern/*](http://deviq.com/aggregate-pattern/)</span></span>


>[!div class="step-by-step"]
<span data-ttu-id="e4224-216">[Anterior] (ddd-orientada a servicios-microservice.md) [siguiente] (net-core-microservicio-dominio-model.md)</span><span class="sxs-lookup"><span data-stu-id="e4224-216">[Previous] (ddd-oriented-microservice.md) [Next] (net-core-microservice-domain-model.md)</span></span>
