---
title: "Diseñar un microservicio orientados a DDD"
description: "Arquitectura de Microservicios de .NET para aplicaciones .NET en contenedores | Diseñar un microservicio orientados a DDD"
keywords: Docker, microservicios, ASP.NET, contenedor
author: CESARDELATORRE
ms.author: wiwagn
ms.date: 05/26/2017
ms.prod: .net-core
ms.technology: dotnet-docker
ms.topic: article
ms.openlocfilehash: df45441089fd59d5e0e52b4bcec409adcc11fb71
ms.sourcegitcommit: bd1ef61f4bb794b25383d3d72e71041a5ced172e
ms.translationtype: HT
ms.contentlocale: es-ES
ms.lasthandoff: 10/18/2017
---
# <a name="designing-a-ddd-oriented-microservice"></a><span data-ttu-id="d0df2-104">Diseñar un microservicio orientados a DDD</span><span class="sxs-lookup"><span data-stu-id="d0df2-104">Designing a DDD-oriented microservice</span></span>

<span data-ttu-id="d0df2-105">Diseño basado en dominio (DDD) encarga modelado basado en la realidad de negocio que sea relevante para los casos de uso.</span><span class="sxs-lookup"><span data-stu-id="d0df2-105">Domain-driven design (DDD) advocates modeling based on the reality of business as relevant to your use cases.</span></span> <span data-ttu-id="d0df2-106">En el contexto de la creación de aplicaciones, DDD habla sobre los problemas como dominios.</span><span class="sxs-lookup"><span data-stu-id="d0df2-106">In the context of building applications, DDD talks about problems as domains.</span></span> <span data-ttu-id="d0df2-107">Describe áreas con problemas independientes como limitado contextos (cada contexto limitado se correlaciona con un microservicio) y resalta un lenguaje común de hablar acerca de estos problemas.</span><span class="sxs-lookup"><span data-stu-id="d0df2-107">It describes independent problem areas as Bounded Contexts (each Bounded Context correlates to a microservice), and emphasizes a common language to talk about these problems.</span></span> <span data-ttu-id="d0df2-108">También sugiere muchos conceptos técnicos y los patrones, similares a las entidades de dominio con modelos enriquecidos (no [modelo de dominio anemic](https://martinfowler.com/bliki/AnemicDomainModel.html)), valor objetos, agregados y raíz agregada (o entidad raíz), las reglas para admitir la implementación interna.</span><span class="sxs-lookup"><span data-stu-id="d0df2-108">It also suggests many technical concepts and patterns, like domain entities with rich models (no [anemic-domain model](https://martinfowler.com/bliki/AnemicDomainModel.html)), value objects, aggregates and aggregate root (or root entity) rules to support the internal implementation.</span></span> <span data-ttu-id="d0df2-109">Esta sección presenta el diseño e implementación de esos patrones internos.</span><span class="sxs-lookup"><span data-stu-id="d0df2-109">This section introduces the design and implementation of those internal patterns.</span></span>

<span data-ttu-id="d0df2-110">A veces dichas DDD técnicas reglas y patrones se perciban como obstáculos que tienen una pronunciada curva de aprendizaje para implementar métodos DDD.</span><span class="sxs-lookup"><span data-stu-id="d0df2-110">Sometimes these DDD technical rules and patterns are perceived as obstacles that have a steep learning curve for implementing DDD approaches.</span></span> <span data-ttu-id="d0df2-111">Pero lo importante es no los patrones a sí mismos, pero el código de la organización para que se alinee a los problemas empresariales y con los mismos términos de negocio (lenguaje ubicuo).</span><span class="sxs-lookup"><span data-stu-id="d0df2-111">But the important part is not the patterns themselves, but organizing the code so it is aligned to the business problems, and using the same business terms (ubiquitous language).</span></span> <span data-ttu-id="d0df2-112">Además, deben aplicarse DDD enfoques solo si está implementando microservicios complejos con reglas de negocios importantes.</span><span class="sxs-lookup"><span data-stu-id="d0df2-112">In addition, DDD approaches should be applied only if you are implementing complex microservices with significant business rules.</span></span> <span data-ttu-id="d0df2-113">Responsabilidades más sencillas, como un servicio CRUD, se pueden administrar con los enfoques más sencillos.</span><span class="sxs-lookup"><span data-stu-id="d0df2-113">Simpler responsibilities, like a CRUD service, can be managed with simpler approaches.</span></span>

<span data-ttu-id="d0df2-114">Dónde debe dibujar los límites de la tarea es la clave cuando diseñe y definir un microservicio.</span><span class="sxs-lookup"><span data-stu-id="d0df2-114">Where to draw the boundaries is the key task when designing and defining a microservice.</span></span> <span data-ttu-id="d0df2-115">Patrones DDD le ayudan a comprender la complejidad del dominio.</span><span class="sxs-lookup"><span data-stu-id="d0df2-115">DDD patterns help you understand the complexity in the domain.</span></span> <span data-ttu-id="d0df2-116">Para el modelo de dominio en cada contexto limitado, identificar y definir las entidades, los objetos de valor y los agregados que modelan el dominio.</span><span class="sxs-lookup"><span data-stu-id="d0df2-116">For the domain model for each Bounded Context, you identify and define the entities, value objects, and aggregates that model your domain.</span></span> <span data-ttu-id="d0df2-117">Crear y perfeccionar un modelo de dominio que se encuentra dentro de un límite que define el contexto.</span><span class="sxs-lookup"><span data-stu-id="d0df2-117">You build and refine a domain model that is contained within a boundary that defines your context.</span></span> <span data-ttu-id="d0df2-118">Y eso es muy explícita en forma de un microservicio.</span><span class="sxs-lookup"><span data-stu-id="d0df2-118">And that is very explicit in the form of a microservice.</span></span> <span data-ttu-id="d0df2-119">Los componentes dentro de esos límites acabar siendo su microservicios, aunque en algunos casos una continuidad del negocio o microservicios de negocios pueden estar compuesto de varios servicios físicos.</span><span class="sxs-lookup"><span data-stu-id="d0df2-119">The components within those boundaries end up being your microservices, although in some cases a BC or business microservices can be composed of several physical services.</span></span> <span data-ttu-id="d0df2-120">DDD es acerca de los límites y por lo tanto, son microservicios.</span><span class="sxs-lookup"><span data-stu-id="d0df2-120">DDD is about boundaries and so are microservices.</span></span>

## <a name="keep-the-microservice-context-boundaries-relatively-small"></a><span data-ttu-id="d0df2-121">Mantener los límites del contexto la microservicio relativamente pequeño</span><span class="sxs-lookup"><span data-stu-id="d0df2-121">Keep the microservice context boundaries relatively small</span></span>

<span data-ttu-id="d0df2-122">Determinar dónde colocar los límites entre contextos limitado equilibra dos objetivos de la competencia.</span><span class="sxs-lookup"><span data-stu-id="d0df2-122">Determining where to place boundaries between Bounded Contexts balances two competing goals.</span></span> <span data-ttu-id="d0df2-123">En primer lugar, desea crear inicialmente la microservicios más pequeño posible, aunque no debe ser el controlador principal; debe crear un límite alrededor, lo que necesita cohesión.</span><span class="sxs-lookup"><span data-stu-id="d0df2-123">First, you want to initially create the smallest possible microservices, although that should not be the main driver; you should create a boundary around things that need cohesion.</span></span> <span data-ttu-id="d0df2-124">En segundo lugar, desea evitar las comunicaciones locuaces entre microservicios.</span><span class="sxs-lookup"><span data-stu-id="d0df2-124">Second, you want to avoid chatty communications between microservices.</span></span> <span data-ttu-id="d0df2-125">Estos objetivos pueden contradecir entre sí.</span><span class="sxs-lookup"><span data-stu-id="d0df2-125">These goals can contradict one another.</span></span> <span data-ttu-id="d0df2-126">Se debe equilibrar por descomponer el sistema en tantos microservicios pequeños que lo haría con hasta que vea los límites de comunicación creciendo rápidamente con cada intento adicional para separar un nuevo contexto limitado.</span><span class="sxs-lookup"><span data-stu-id="d0df2-126">You should balance them by decomposing the system into as many small microservices as you can until you see communication boundaries growing quickly with each additional attempt to separate a new Bounded Context.</span></span> <span data-ttu-id="d0df2-127">Cohesión es clave dentro de un único contexto enlazado.</span><span class="sxs-lookup"><span data-stu-id="d0df2-127">Cohesion is key within a single bounded context.</span></span>

<span data-ttu-id="d0df2-128">Es similar a la [olor a código inapropiado intimidad](https://sourcemaking.com/refactoring/smells/inappropriate-intimacy) al implementar las clases.</span><span class="sxs-lookup"><span data-stu-id="d0df2-128">It is similar to the [Inappropriate Intimacy code smell](https://sourcemaking.com/refactoring/smells/inappropriate-intimacy) when implementing classes.</span></span> <span data-ttu-id="d0df2-129">Si necesitan dos microservicios mucho colaborar entre sí, probablemente deben ser el mismo microservicio.</span><span class="sxs-lookup"><span data-stu-id="d0df2-129">If two microservices need to collaborate a lot with each other, they should probably be the same microservice.</span></span>

<span data-ttu-id="d0df2-130">Otra manera de enfocar todo esto es autonomía.</span><span class="sxs-lookup"><span data-stu-id="d0df2-130">Another way to look at this is autonomy.</span></span> <span data-ttu-id="d0df2-131">Si un microservicio debe depende de otro servicio para una solicitud de servicio directamente, no es realmente autónomo.</span><span class="sxs-lookup"><span data-stu-id="d0df2-131">If a microservice must rely on another service to directly service a request, it is not truly autonomous.</span></span>

## <a name="layers-in-ddd-microservices"></a><span data-ttu-id="d0df2-132">Capas en DDD microservicios</span><span class="sxs-lookup"><span data-stu-id="d0df2-132">Layers in DDD microservices</span></span>

<span data-ttu-id="d0df2-133">La mayoría de las aplicaciones de enterprise con significativos para el negocio y complejidad técnica se definen mediante varias capas.</span><span class="sxs-lookup"><span data-stu-id="d0df2-133">Most enterprise applications with significant business and technical complexity are defined by multiple layers.</span></span> <span data-ttu-id="d0df2-134">Las capas son un artefacto de lógico y no están relacionadas con la implementación del servicio.</span><span class="sxs-lookup"><span data-stu-id="d0df2-134">The layers are a logical artifact, and are not related to the deployment of the service.</span></span> <span data-ttu-id="d0df2-135">Existen para ayudar a los desarrolladores administrar la complejidad del código.</span><span class="sxs-lookup"><span data-stu-id="d0df2-135">They exist to help developers manage the complexity in the code.</span></span> <span data-ttu-id="d0df2-136">Diferentes niveles (por ejemplo, el nivel de modelo de dominio frente a la capa de presentación, etc.) podrían tener diferentes tipos, que exige las traducciones entre dichos tipos.</span><span class="sxs-lookup"><span data-stu-id="d0df2-136">Different layers (like the domain model layer versus the presentation layer, etc.) might have different types, which mandates translations between those types.</span></span>

<span data-ttu-id="d0df2-137">Por ejemplo, una entidad se pudo cargar desde la base de datos.</span><span class="sxs-lookup"><span data-stu-id="d0df2-137">For example, an entity could be loaded from the database.</span></span> <span data-ttu-id="d0df2-138">A continuación, parte de esa información o una agregación de información que incluye datos adicionales de otras entidades, puede enviarse a la interfaz de usuario a través de una API de REST de Web de cliente.</span><span class="sxs-lookup"><span data-stu-id="d0df2-138">Then part of that information, or an aggregation of information including additional data from other entities, can be sent to the client UI through a REST Web API.</span></span> <span data-ttu-id="d0df2-139">El punto aquí es que la entidad de dominio está dentro de la capa del modelo de dominio y no se debería propagar a otras áreas que no pertenece a, al igual que en el nivel de presentación.</span><span class="sxs-lookup"><span data-stu-id="d0df2-139">The point here is that the domain entity is contained within the domain model layer and should not be propagated to other areas that it does not belong to, like to the presentation layer.</span></span>

<span data-ttu-id="d0df2-140">Además, debe tener entidades siempre válido (vea la [diseñar validaciones en el nivel de modelo de dominio](#designing-validations-in-the-domain-model-layer) sección) controla las raíces de agregado (entidades raíz).</span><span class="sxs-lookup"><span data-stu-id="d0df2-140">Additionally, you need to have always-valid entities (see the [Designing validations in the domain model layer](#designing-validations-in-the-domain-model-layer) section) controlled by aggregate roots (root entities).</span></span> <span data-ttu-id="d0df2-141">Por lo tanto, las entidades no se deberían enlazar a las vistas de cliente, porque en el nivel de interfaz de usuario algunos datos podrían no se pueden validar.</span><span class="sxs-lookup"><span data-stu-id="d0df2-141">Therefore, entities should not be bound to client views, because at the UI level some data might still not be validated.</span></span> <span data-ttu-id="d0df2-142">Para esto es el modelo de vista.</span><span class="sxs-lookup"><span data-stu-id="d0df2-142">This is what the ViewModel is for.</span></span> <span data-ttu-id="d0df2-143">El modelo de vista es un modelo de datos exclusivamente para las necesidades de la capa de presentación.</span><span class="sxs-lookup"><span data-stu-id="d0df2-143">The ViewModel is a data model exclusively for presentation layer needs.</span></span> <span data-ttu-id="d0df2-144">Las entidades de dominio no pertenecen directamente en el modelo de vista.</span><span class="sxs-lookup"><span data-stu-id="d0df2-144">The domain entities do not belong directly to the ViewModel.</span></span> <span data-ttu-id="d0df2-145">En su lugar, es necesario traducir entre entidades ViewModels y el dominio y viceversa.</span><span class="sxs-lookup"><span data-stu-id="d0df2-145">Instead, you need to translate between ViewModels and domain entities and vice versa.</span></span>

<span data-ttu-id="d0df2-146">Cuando abordar complejidad, es importante tener un modelo de dominio que controla las raíces agregadas (entraremos en esto con más detalle más adelante) que se aseguran de que todas las invariantes y reglas relacionadas con ese grupo de entidades (agregados) se realizan a través de una única entrada punto o puerta de la raíz agregada.</span><span class="sxs-lookup"><span data-stu-id="d0df2-146">When tackling complexity, it is important to have a domain model controlled by aggregate roots (we go into this in more detail later) that make sure that all the invariants and rules related to that group of entities (aggregate) are performed through a single entry point or gate, the aggregate root.</span></span>

<span data-ttu-id="d0df2-147">Figura 9-5 se muestra cómo se implementa un diseño en capas en la aplicación eShopOnContainers.</span><span class="sxs-lookup"><span data-stu-id="d0df2-147">Figure 9-5 shows how a layered design is implemented in the eShopOnContainers application.</span></span>

![](./media/image6.png)

<span data-ttu-id="d0df2-148">**Figura 9-5**.</span><span class="sxs-lookup"><span data-stu-id="d0df2-148">**Figure 9-5**.</span></span> <span data-ttu-id="d0df2-149">Capas DDD en la ordenación microservicio en eShopOnContainers</span><span class="sxs-lookup"><span data-stu-id="d0df2-149">DDD layers in the ordering microservice in eShopOnContainers</span></span>

<span data-ttu-id="d0df2-150">Desea diseñar el sistema para que cada nivel se comunica sólo con determinadas otras capas.</span><span class="sxs-lookup"><span data-stu-id="d0df2-150">You want to design the system so that each layer communicates only with certain other layers.</span></span> <span data-ttu-id="d0df2-151">Puede que sea más fácil aplicar si las capas se implementan como bibliotecas de clases diferentes, porque puede identificar claramente qué dependencias estén establecidas entre las bibliotecas.</span><span class="sxs-lookup"><span data-stu-id="d0df2-151">That may be easier to enforce if layers are implemented as different class libraries, because you can clearly identify what dependencies are set between libraries.</span></span> <span data-ttu-id="d0df2-152">Por ejemplo, el nivel de modelo de dominio no debe tomar una dependencia en cualquier otra capa (las clases del modelo de dominio deben ser objetos CLR antiguos sin formato o [POCO](https://en.wikipedia.org/wiki/Plain_Old_CLR_Object), clases).</span><span class="sxs-lookup"><span data-stu-id="d0df2-152">For instance, the domain model layer should not take a dependency on any other layer (the domain model classes should be Plain Old CLR Objects, or [POCO](https://en.wikipedia.org/wiki/Plain_Old_CLR_Object), classes).</span></span> <span data-ttu-id="d0df2-153">Como se muestra en la figura 9-6, la **Ordering.Domain** biblioteca de capa tiene dependencias sólo en las bibliotecas de .NET Core pero no en cualquier otra biblioteca personalizada (biblioteca de datos, biblioteca de persistencia, etcetera).</span><span class="sxs-lookup"><span data-stu-id="d0df2-153">As shown in Figure 9-6, the **Ordering.Domain** layer library has dependencies only on the .NET Core libraries but not on any other custom library (data library, persistence library, etc.).</span></span>

![](./media/image7.PNG)

<span data-ttu-id="d0df2-154">**Figura 9-6**.</span><span class="sxs-lookup"><span data-stu-id="d0df2-154">**Figure 9-6**.</span></span> <span data-ttu-id="d0df2-155">Capas que se implementa como bibliotecas permiten un mejor control de las dependencias existentes entre capas</span><span class="sxs-lookup"><span data-stu-id="d0df2-155">Layers implemented as libraries allow better control of dependencies between layers</span></span>

### <a name="the-domain-model-layer"></a><span data-ttu-id="d0df2-156">El nivel de modelo de dominio</span><span class="sxs-lookup"><span data-stu-id="d0df2-156">The domain model layer</span></span>

<span data-ttu-id="d0df2-157">Libro excelente de Eric Evans [dominio controlado por diseño](http://domainlanguage.com/ddd/) dice lo siguiente acerca de la capa del modelo de dominio y el nivel de aplicación.</span><span class="sxs-lookup"><span data-stu-id="d0df2-157">Eric Evans's excellent book [Domain Driven Design](http://domainlanguage.com/ddd/) says the following about the domain model layer and the application layer.</span></span>

<span data-ttu-id="d0df2-158">**Nivel de modelo de dominio**: responsables para representar conceptos del negocio, información sobre la situación de negocio y reglas de negocios.</span><span class="sxs-lookup"><span data-stu-id="d0df2-158">**Domain Model Layer**: Responsible for representing concepts of the business, information about the business situation, and business rules.</span></span> <span data-ttu-id="d0df2-159">Estado que refleja la situación empresarial se controla y usado aquí, aunque se delegan los detalles técnicos de almacenarla en la infraestructura.</span><span class="sxs-lookup"><span data-stu-id="d0df2-159">State that reflects the business situation is controlled and used here, even though the technical details of storing it are delegated to the infrastructure.</span></span> <span data-ttu-id="d0df2-160">Este nivel es el núcleo de software empresarial.</span><span class="sxs-lookup"><span data-stu-id="d0df2-160">This layer is the heart of business software.</span></span>

<span data-ttu-id="d0df2-161">El nivel de modelo de dominio es donde se expresa el negocio.</span><span class="sxs-lookup"><span data-stu-id="d0df2-161">The domain model layer is where the business is expressed.</span></span> <span data-ttu-id="d0df2-162">Al implementar un nivel de modelo de dominio de microservicio en. NET, que se acumulan se codifica como una biblioteca de clases con las entidades de dominio que capturan datos más comportamiento (métodos con una lógica).</span><span class="sxs-lookup"><span data-stu-id="d0df2-162">When you implement a microservice domain model layer in .NET, that layer is coded as a class library with the domain entities that capture data plus behavior (methods with logic).</span></span>

<span data-ttu-id="d0df2-163">Después de la [omisión de persistencia](http://deviq.com/persistence-ignorance/) y [omisión de infraestructura](https://ayende.com/blog/3137/infrastructure-ignorance) principios, este nivel deben omitir completamente los detalles de persistencia de datos.</span><span class="sxs-lookup"><span data-stu-id="d0df2-163">Following the [Persistence Ignorance](http://deviq.com/persistence-ignorance/) and the [Infrastructure Ignorance](https://ayende.com/blog/3137/infrastructure-ignorance) principles, this layer must completely ignore data persistence details.</span></span> <span data-ttu-id="d0df2-164">El nivel de infraestructura se deberían realizar estas tareas de persistencia.</span><span class="sxs-lookup"><span data-stu-id="d0df2-164">These persistence tasks should be performed by the infrastructure layer.</span></span> <span data-ttu-id="d0df2-165">Por lo tanto, este nivel no debe tener dependencias directas en la infraestructura, lo que significa que una regla de importante es que las clases de entidad del modelo de dominio deben ser [POCO](https://en.wikipedia.org/wiki/Plain_Old_CLR_Object)s.</span><span class="sxs-lookup"><span data-stu-id="d0df2-165">Therefore, this layer should not take direct dependencies on the infrastructure, which means that an important rule is that your domain model entity classes should be [POCO](https://en.wikipedia.org/wiki/Plain_Old_CLR_Object)s.</span></span>

<span data-ttu-id="d0df2-166">Las entidades de dominio no deben tener ninguna dependencia directa (por ejemplo, se deriva de una clase base) con cualquier marco de trabajo de la infraestructura de acceso de datos como Entity Framework o NHibernate.</span><span class="sxs-lookup"><span data-stu-id="d0df2-166">Domain entities should not have any direct dependency (like deriving from a base class) on any data access infrastructure framework like Entity Framework or NHibernate.</span></span> <span data-ttu-id="d0df2-167">Lo ideal es que, las entidades de dominio no deben derivarse de o implementar cualquier tipo definido en cualquier marco de infraestructura.</span><span class="sxs-lookup"><span data-stu-id="d0df2-167">Ideally, your domain entities should not derive from or implement any type defined in any infrastructure framework.</span></span>

<span data-ttu-id="d0df2-168">Marcos de trabajo ORM más modernos como Entity Framework Core permiten este enfoque, de forma que las clases de modelo de dominio no se acoplan a la infraestructura.</span><span class="sxs-lookup"><span data-stu-id="d0df2-168">Most modern ORM frameworks like Entity Framework Core allow this approach, so that your domain model classes are not coupled to the infrastructure.</span></span> <span data-ttu-id="d0df2-169">Sin embargo, con entidades POCO no siempre es posible cuando se usan ciertas bases de datos NoSQL y marcos de trabajo, como actores y colecciones confiable en Azure Service Fabric.</span><span class="sxs-lookup"><span data-stu-id="d0df2-169">However, having POCO entities is not always possible when using certain NoSQL databases and frameworks, like Actors and Reliable Collections in Azure Service Fabric.</span></span>

<span data-ttu-id="d0df2-170">Aunque es importante seguir el principio de omisión de persistencia para el modelo de dominio, no debe ignorar problemas de persistencia.</span><span class="sxs-lookup"><span data-stu-id="d0df2-170">Even when it is important to follow the Persistence Ignorance principle for you Domain model, you should not ignore persistence concerns.</span></span> <span data-ttu-id="d0df2-171">Todavía es muy importante comprender el modelo de datos físicos y cómo se asigna a un modelo de objetos de entidad.</span><span class="sxs-lookup"><span data-stu-id="d0df2-171">It is still very important to understand the physical data model and how it maps to your entity object model.</span></span> <span data-ttu-id="d0df2-172">En caso contrario, puede crear diseños imposibles.</span><span class="sxs-lookup"><span data-stu-id="d0df2-172">Otherwise you can create impossible designs.</span></span>

<span data-ttu-id="d0df2-173">Además, esto no significa que puede tomar un modelo diseñado para una base de datos relacional y directamente moverla a un NoSQL o bases de datos orientado en el documento.</span><span class="sxs-lookup"><span data-stu-id="d0df2-173">Also, this does not mean you can take a model designed for a relational database and directly move it to a NoSQL or document-oriented database.</span></span> <span data-ttu-id="d0df2-174">En algunos modelos de entidad, es posible que ajuste el modelo, pero normalmente no.</span><span class="sxs-lookup"><span data-stu-id="d0df2-174">In some entity models, the model might fit, but usually it does not.</span></span> <span data-ttu-id="d0df2-175">Todavía hay restricciones que debe cumplir el modelo de entidad, basada en la tecnología de almacenamiento y la tecnología ORM.</span><span class="sxs-lookup"><span data-stu-id="d0df2-175">There are still constraints that your entity model must adhere to, based both on the storage technology and ORM technology.</span></span>

### <a name="the-application-layer"></a><span data-ttu-id="d0df2-176">El nivel de aplicación</span><span class="sxs-lookup"><span data-stu-id="d0df2-176">The application layer</span></span>

<span data-ttu-id="d0df2-177">Mover el nivel de aplicación, que le podemos citar nuevo libro de Eric Evans [dominio controlado por diseño](http://domainlanguage.com/ddd/):</span><span class="sxs-lookup"><span data-stu-id="d0df2-177">Moving on to the application layer, we can again cite Eric Evans's book [Domain Driven Design](http://domainlanguage.com/ddd/):</span></span>

<span data-ttu-id="d0df2-178">**Capa de aplicación:** define los trabajos que el software se supone que debe para hacer y dirige los objetos de dominio expresivo para resolver problemas.</span><span class="sxs-lookup"><span data-stu-id="d0df2-178">**Application Layer:** Defines the jobs the software is supposed to do and directs the expressive domain objects to work out problems.</span></span> <span data-ttu-id="d0df2-179">Las tareas de que este nivel es responsable son significativas para la empresa o es necesario para la interacción con las capas de aplicación de otros sistemas.</span><span class="sxs-lookup"><span data-stu-id="d0df2-179">The tasks this layer is responsible for are meaningful to the business or necessary for interaction with the application layers of other systems.</span></span> <span data-ttu-id="d0df2-180">Esta capa se mantiene fina.</span><span class="sxs-lookup"><span data-stu-id="d0df2-180">This layer is kept thin.</span></span> <span data-ttu-id="d0df2-181">No contiene reglas de negocios o conocimiento, pero solo las tareas de coordenadas y los delegados funcionan para colaboraciones de objetos del dominio en el siguiente nivel hacia abajo.</span><span class="sxs-lookup"><span data-stu-id="d0df2-181">It does not contain business rules or knowledge, but only coordinates tasks and delegates work to collaborations of domain objects in the next layer down.</span></span> <span data-ttu-id="d0df2-182">No tiene estado que refleja la situación empresarial, pero puede tener el estado que refleja el progreso de una tarea para el usuario o el programa.</span><span class="sxs-lookup"><span data-stu-id="d0df2-182">It does not have state reflecting the business situation, but it can have state that reflects the progress of a task for the user or the program.</span></span>

<span data-ttu-id="d0df2-183">Capa de aplicación de microservicio en .NET normalmente se codifica como un proyecto de ASP.NET Core Web API.</span><span class="sxs-lookup"><span data-stu-id="d0df2-183">A microservice’s application layer in .NET is commonly coded as an ASP.NET Core Web API project.</span></span> <span data-ttu-id="d0df2-184">El proyecto implementa la interacción de microservicio y acceso a redes remotas, la API Web externo que se usan desde las aplicaciones de interfaz de usuario o cliente.</span><span class="sxs-lookup"><span data-stu-id="d0df2-184">The project implements the microservice’s interaction, remote network access, and the external Web APIs used from the UI or client apps.</span></span> <span data-ttu-id="d0df2-185">Incluye las consultas si utilizando un CQRS enfocar comandos aceptados por el microservicio e incluso la comunicación orientada a eventos entre microservicios (eventos de integración).</span><span class="sxs-lookup"><span data-stu-id="d0df2-185">It includes queries if using a CQRS approach, commands accepted by the microservice, and even the event-driven communication between microservices (integration events).</span></span> <span data-ttu-id="d0df2-186">La API de Web de ASP.NET Core que representa el nivel de aplicación no puede contener reglas de negocios o conocimiento del dominio (especialmente reglas de dominio para las transacciones o actualizaciones); debería pertenecer la biblioteca de clases del modelo de dominio.</span><span class="sxs-lookup"><span data-stu-id="d0df2-186">The ASP.NET Core Web API that represents the application layer must not contain business rules or domain knowledge (especially domain rules for transactions or updates); these should be owned by the domain model class library.</span></span> <span data-ttu-id="d0df2-187">La coordenada solo de aplicación capa debe tareas y no debe contener o definir cualquier estado de dominio (modelo de dominio).</span><span class="sxs-lookup"><span data-stu-id="d0df2-187">The application layer must only coordinate tasks and must not hold or define any domain state (domain model).</span></span> <span data-ttu-id="d0df2-188">Delega la ejecución de reglas de negocios para las clases de modelo de dominio por sí mismos (agregadas raíces y entidades de dominio), que finalmente actualizará los datos dentro de las entidades de dominio.</span><span class="sxs-lookup"><span data-stu-id="d0df2-188">It delegates the execution of business rules to the domain model classes themselves (aggregate roots and domain entities), which will ultimately update the data within those domain entities.</span></span>

<span data-ttu-id="d0df2-189">Básicamente, la lógica de aplicación es donde se implementan todos los casos de uso que dependen de un determinado front-end.</span><span class="sxs-lookup"><span data-stu-id="d0df2-189">Basically, the application logic is where you implement all use cases that depend on a given front end.</span></span> <span data-ttu-id="d0df2-190">Por ejemplo, la implementación relacionados con un servicio de API Web.</span><span class="sxs-lookup"><span data-stu-id="d0df2-190">For example, the implementation related to a Web API service.</span></span>

<span data-ttu-id="d0df2-191">El objetivo es que la lógica del dominio en el nivel de modelo de dominio, sus invariables, el modelo de datos y reglas de negocios relacionadas debe ser totalmente independiente de las capas de presentación y aplicación.</span><span class="sxs-lookup"><span data-stu-id="d0df2-191">The goal is that the domain logic in the domain model layer, its invariants, the data model, and related business rules must be completely independent from the presentation and application layers.</span></span> <span data-ttu-id="d0df2-192">Más de todo, el nivel de modelo de dominio no debe dependen directamente en cualquier marco de infraestructura.</span><span class="sxs-lookup"><span data-stu-id="d0df2-192">Most of all, the domain model layer must not directly depend on any infrastructure framework.</span></span>

### <a name="the-infrastructure-layer"></a><span data-ttu-id="d0df2-193">El nivel de infraestructura</span><span class="sxs-lookup"><span data-stu-id="d0df2-193">The infrastructure layer</span></span>

<span data-ttu-id="d0df2-194">El nivel de infraestructura es cómo se guardan los datos que inicialmente se mantienen en las entidades de dominio (en memoria) en las bases de datos o en otro almacén persistente.</span><span class="sxs-lookup"><span data-stu-id="d0df2-194">The infrastructure layer is how the data that is initially held in domain entities (in memory) is persisted in databases or another persistent store.</span></span> <span data-ttu-id="d0df2-195">Un ejemplo sería usar código de Entity Framework Core para implementar las clases de patrón de repositorio que usan un DBContext para conservar los datos en una base de datos relacional.</span><span class="sxs-lookup"><span data-stu-id="d0df2-195">An example is using Entity Framework Core code to implement the Repository pattern classes that use a DBContext to persist data in a relational database.</span></span>

<span data-ttu-id="d0df2-196">Con arreglo a la mencionada anteriormente [omisión de persistencia](http://deviq.com/persistence-ignorance/) y [infraestructura omisión](https://ayende.com/blog/3137/infrastructure-ignorance) principios, el nivel de infraestructura no deben "contaminar" el nivel de modelo de dominio.</span><span class="sxs-lookup"><span data-stu-id="d0df2-196">In accordance with the previously mentioned [Persistence Ignorance](http://deviq.com/persistence-ignorance/) and [Infrastructure Ignorance](https://ayende.com/blog/3137/infrastructure-ignorance) principles, the infrastructure layer must not “contaminate” the domain model layer.</span></span> <span data-ttu-id="d0df2-197">Debe mantener al independiente de clases de entidad de modelo de dominio de la infraestructura que se utiliza para conservar datos (EF o cualquier otro marco de trabajo) tomando no dependencias en marcos de trabajo.</span><span class="sxs-lookup"><span data-stu-id="d0df2-197">You must keep the domain model entity classes agnostic from the infrastructure that you use to persist data (EF or any other framework) by not taking hard dependencies on frameworks.</span></span> <span data-ttu-id="d0df2-198">La biblioteca de clases de nivel de modelo de dominio debe tener solo el código de dominio, simplemente [POCO](https://en.wikipedia.org/wiki/Plain_Old_CLR_Object) entidad las clases que implementan la esencia del software y completamente desacoplada de tecnologías de infraestructura.</span><span class="sxs-lookup"><span data-stu-id="d0df2-198">Your domain model layer class library should have only your domain code, just [POCO](https://en.wikipedia.org/wiki/Plain_Old_CLR_Object) entity classes implementing the heart of your software and completely decoupled from infrastructure technologies.</span></span>

<span data-ttu-id="d0df2-199">Por lo tanto, los proyectos o bibliotecas de clases y las capas deben en última instancia depender de la capa de modelo de dominio (biblioteca), y no al revés, tal como se muestra en la figura 9-7.</span><span class="sxs-lookup"><span data-stu-id="d0df2-199">Thus, your layers or class libraries and projects should ultimately depend on your domain model layer (library), not vice versa, as shown in Figure 9-7.</span></span>

![](./media/image8.png)

<span data-ttu-id="d0df2-200">**Figura 9-7**.</span><span class="sxs-lookup"><span data-stu-id="d0df2-200">**Figure 9-7**.</span></span> <span data-ttu-id="d0df2-201">Dependencias existentes entre capas DDD</span><span class="sxs-lookup"><span data-stu-id="d0df2-201">Dependencies between layers in DDD</span></span>

<span data-ttu-id="d0df2-202">Este diseño de la capa debe ser independiente para cada microservicio.</span><span class="sxs-lookup"><span data-stu-id="d0df2-202">This layer design should be independent for each microservice.</span></span> <span data-ttu-id="d0df2-203">Como se indicó anteriormente, puede implementar la microservicios más complejo microservicios tras patrones DDD, mientras más sencillo de implementación controlada por datos (CRUD simple en una sola capa) de una forma más sencilla.</span><span class="sxs-lookup"><span data-stu-id="d0df2-203">As noted earlier, you can implement the most complex microservices following DDD patterns, while implementing simpler data-driven microservices (simple CRUD in a single layer) in a simpler way.</span></span>

#### <a name="additional-resources"></a><span data-ttu-id="d0df2-204">Recursos adicionales</span><span class="sxs-lookup"><span data-stu-id="d0df2-204">Additional resources</span></span>

-   <span data-ttu-id="d0df2-205">**DevIQ. Principio de omisión de persistencia**
    [*http://deviq.com/persistence-ignorance/*](http://deviq.com/persistence-ignorance/)</span><span class="sxs-lookup"><span data-stu-id="d0df2-205">**DevIQ. Persistence Ignorance principle**
[*http://deviq.com/persistence-ignorance/*](http://deviq.com/persistence-ignorance/)</span></span>

-   <span data-ttu-id="d0df2-206">**Oren Eini. Omisión de infraestructura**
    [*https://ayende.com/blog/3137/infrastructure-ignorance*](https://ayende.com/blog/3137/infrastructure-ignorance)</span><span class="sxs-lookup"><span data-stu-id="d0df2-206">**Oren Eini. Infrastructure Ignorance**
[*https://ayende.com/blog/3137/infrastructure-ignorance*](https://ayende.com/blog/3137/infrastructure-ignorance)</span></span>

-   <span data-ttu-id="d0df2-207">**Ángulo López. Capas de arquitectura de diseño basado en dominio**
    [*https://ajlopez.wordpress.com/2008/09/12/layered-architecture-in-domain-driven-design/*](https://ajlopez.wordpress.com/2008/09/12/layered-architecture-in-domain-driven-design/)</span><span class="sxs-lookup"><span data-stu-id="d0df2-207">**Angel Lopez. Layered Architecture In Domain-Driven Design**
[*https://ajlopez.wordpress.com/2008/09/12/layered-architecture-in-domain-driven-design/*](https://ajlopez.wordpress.com/2008/09/12/layered-architecture-in-domain-driven-design/)</span></span>


>[!div class="step-by-step"]
<span data-ttu-id="d0df2-208">[Anterior] (cqrs-microservicio-reads.md) [siguiente] (microservicio-dominio-model.md)</span><span class="sxs-lookup"><span data-stu-id="d0df2-208">[Previous] (cqrs-microservice-reads.md) [Next] (microservice-domain-model.md)</span></span>
