---
title: Aplicar CQRS y CQS enfoques en un microservicio DDD en eShopOnContainers
description: Arquitectura de Microservicios de .NET para aplicaciones .NET en contenedores | Aplicar CQRS y CQS enfoques en un microservicio DDD en eShopOnContainers
keywords: Docker, microservicios, ASP.NET, contenedor
author: CESARDELATORRE
ms.author: wiwagn
ms.date: 05/26/2017
ms.prod: .net-core
ms.technology: dotnet-docker
ms.topic: article
ms.openlocfilehash: a2c4429a75ca47d4fbcde868b95e76bc65ea2bef
ms.sourcegitcommit: bd1ef61f4bb794b25383d3d72e71041a5ced172e
ms.translationtype: HT
ms.contentlocale: es-ES
ms.lasthandoff: 10/18/2017
---
# <a name="applying-cqrs-and-cqs-approaches-in-a-ddd-microservice-in-eshoponcontainers"></a><span data-ttu-id="72f7b-104">Aplicar CQRS y CQS enfoques en un microservicio DDD en eShopOnContainers</span><span class="sxs-lookup"><span data-stu-id="72f7b-104">Applying CQRS and CQS approaches in a DDD microservice in eShopOnContainers</span></span>

<span data-ttu-id="72f7b-105">El diseño de la ordenación microservicio en la aplicación de referencia de eShopOnContainers se basa en los principios CQRS.</span><span class="sxs-lookup"><span data-stu-id="72f7b-105">The design of the ordering microservice at the eShopOnContainers reference application is based on CQRS principles.</span></span> <span data-ttu-id="72f7b-106">Sin embargo, utiliza el enfoque más sencillo, que simplemente es separar las consultas de los comandos y el uso de la misma base de datos para ambas acciones.</span><span class="sxs-lookup"><span data-stu-id="72f7b-106">However, it uses the simplest approach, which is just separating the queries from the commands and using the same database for both actions.</span></span>

<span data-ttu-id="72f7b-107">La esencia de esos patrones y en este caso, el punto importante es que las consultas son idempotentes: independientemente de cuántas veces se consulta un sistema, el estado de dicho sistema no cambiará incluso podría utilizar un modelo de datos de "lectura" diferente que la lógica transaccional "escritura" modelo de dominio, aunque la ordenación microservicios está usando la misma base de datos.</span><span class="sxs-lookup"><span data-stu-id="72f7b-107">The essence of those patterns, and the important point here, is that queries are idempotent: no matter how many times you query a system, the state of that system will not change You could even use a different “reads” data model than the transactional logic “writes” domain model, although the ordering microservices is using the same database.</span></span> <span data-ttu-id="72f7b-108">Por lo tanto, se trata de un enfoque simplificado de CQRS.</span><span class="sxs-lookup"><span data-stu-id="72f7b-108">Hence this is a simplified CQRS approach.</span></span>

<span data-ttu-id="72f7b-109">Por otro lado, comandos, que se activan las transacciones y las actualizaciones de datos, cambian el estado del sistema.</span><span class="sxs-lookup"><span data-stu-id="72f7b-109">On the other hand, commands, which trigger transactions and data updates, change state in the system.</span></span> <span data-ttu-id="72f7b-110">Con los comandos, debe tener cuidado cuando tienen que ver con la complejidad y reglas de negocio cambiantes.</span><span class="sxs-lookup"><span data-stu-id="72f7b-110">With commands, you need to be careful when dealing with complexity and ever-changing business rules.</span></span> <span data-ttu-id="72f7b-111">Esto es donde desea aplicar técnicas DDD para tener un mejor sistema modelado.</span><span class="sxs-lookup"><span data-stu-id="72f7b-111">This is the where you want to apply DDD techniques to have a better modeled system.</span></span>

<span data-ttu-id="72f7b-112">No se deben aplicar universalmente los patrones DDD presentados en esta guía.</span><span class="sxs-lookup"><span data-stu-id="72f7b-112">The DDD patterns presented in this guide should not be applied universally.</span></span> <span data-ttu-id="72f7b-113">Presentan restricciones en el diseño.</span><span class="sxs-lookup"><span data-stu-id="72f7b-113">They introduce constraints on your design.</span></span> <span data-ttu-id="72f7b-114">Las restricciones proporcionan beneficios como mayor calidad con el tiempo, especialmente en los comandos y otro código que modifica el estado del sistema.</span><span class="sxs-lookup"><span data-stu-id="72f7b-114">Those constraints provide benefits such as higher quality over time, especially in commands and other code that modifies system state.</span></span> <span data-ttu-id="72f7b-115">Sin embargo, las restricciones agregan complejidad con menos ventajas para leer y consultar datos.</span><span class="sxs-lookup"><span data-stu-id="72f7b-115">However, those constraints add complexity with fewer benefits for reading and querying data.</span></span>

<span data-ttu-id="72f7b-116">Un patrón de este tipo es el patrón de agregado, que se examine más en secciones posteriores.</span><span class="sxs-lookup"><span data-stu-id="72f7b-116">One such pattern is the Aggregate pattern, which we examine more in later sections.</span></span> <span data-ttu-id="72f7b-117">En pocas palabras, en el patrón de agregado, tratar muchos objetos de dominio como una sola unidad como resultado de la relación en el dominio.</span><span class="sxs-lookup"><span data-stu-id="72f7b-117">Briefly, in the Aggregate pattern, you treat many domain objects as a single unit as a result of their relationship in the domain.</span></span> <span data-ttu-id="72f7b-118">Podría no siempre obtendrá ventajas de este patrón en las consultas; puede aumentar la complejidad de la lógica de la consulta.</span><span class="sxs-lookup"><span data-stu-id="72f7b-118">You might not always gain advantages from this pattern in queries; it can increase the complexity of query logic.</span></span> <span data-ttu-id="72f7b-119">Para las consultas de solo lectura, no se obtienen las ventajas de tratar varios objetos como un único agregado.</span><span class="sxs-lookup"><span data-stu-id="72f7b-119">For read-only queries, you do not get the advantages of treating multiple objects as a single Aggregate.</span></span> <span data-ttu-id="72f7b-120">Solo se obtiene la complejidad.</span><span class="sxs-lookup"><span data-stu-id="72f7b-120">You only get the complexity.</span></span>

<span data-ttu-id="72f7b-121">Como se muestra en la figura 9-2, esta guía sugiere utilizando patrones DDD sólo en el área de transaccional, actualizaciones de su microservicio (es decir, tal y como se desencadena con comandos).</span><span class="sxs-lookup"><span data-stu-id="72f7b-121">As shown in Figure 9-2, this guide suggests using DDD patterns only in the transactional/updates area of your microservice (that is, as triggered by commands).</span></span> <span data-ttu-id="72f7b-122">Las consultas pueden seguir un enfoque más simple y deben estar separadas de comandos, un enfoque de CQRS.</span><span class="sxs-lookup"><span data-stu-id="72f7b-122">Queries can follow a simpler approach and should be separated from commands, following a CQRS approach.</span></span>

<span data-ttu-id="72f7b-123">Para implementar el "lado de las consultas", puede elegir entre muchos enfoques, desde su ORM completas como EF núcleo AutoMapper proyecciones, procedimientos almacenados, vistas, vistas materializadas o un micro ORM.</span><span class="sxs-lookup"><span data-stu-id="72f7b-123">For implementing the “queries side”, you can choose between many approaches, from your full-blown ORM like EF Core, AutoMapper projections, stored procedures, views, materialized views or a micro ORM.</span></span>

<span data-ttu-id="72f7b-124">En esta guía y en eShopOnContainers (específicamente la ordenación microservicio), hemos optado por implementar consultas rectas mediante un micro ORM como [Dapper](https://github.com/StackExchange/dapper-dot-net).</span><span class="sxs-lookup"><span data-stu-id="72f7b-124">In this guide and in eShopOnContainers (specifically the ordering microservice) we chose to implement straight queries using a micro ORM like [Dapper](https://github.com/StackExchange/dapper-dot-net).</span></span> <span data-ttu-id="72f7b-125">Esto le permite implementar cualquier consulta de acuerdo con las instrucciones de SQL para obtener el mejor rendimiento, gracias a un marco claro con muy poca sobrecarga.</span><span class="sxs-lookup"><span data-stu-id="72f7b-125">This lets you implement any query based on SQL statements to get the best performance, thanks to a light framework with very little overhead.</span></span>

<span data-ttu-id="72f7b-126">Observe que cuando se usa este enfoque, las actualizaciones al modelo que afectan a cómo se conservan las entidades a una base de datos SQL también necesitan actualizaciones independientes para consultas SQL usadas por Dapper o los otros métodos (no-EF) independientes a las consultas.</span><span class="sxs-lookup"><span data-stu-id="72f7b-126">Note that when you use this approach, any updates to your model that impact how entities are persisted to a SQL database also need separate updates to SQL queries used by Dapper or any other separate (non-EF) approaches to querying.</span></span>

## <a name="cqrs-and-ddd-patterns-are-not-top-level-architectures"></a><span data-ttu-id="72f7b-127">Los modelos CQRS y DDD no son arquitecturas de nivel superior</span><span class="sxs-lookup"><span data-stu-id="72f7b-127">CQRS and DDD patterns are not top-level architectures</span></span>

<span data-ttu-id="72f7b-128">Es importante entender que CQRS y los patrones DDD mayoría (similares a las capas DDD o un modelo de dominio con agregados) no son estilos arquitectónicos, sino solo los patrones de arquitectura.</span><span class="sxs-lookup"><span data-stu-id="72f7b-128">It important to understand that CQRS and most DDD patterns (like DDD layers or a domain model with aggregates) are not architectural styles, but only architecture patterns.</span></span> <span data-ttu-id="72f7b-129">Microservicios, SOA y arquitectura orientada a eventos (EDA) son ejemplos de estilos de arquitectura.</span><span class="sxs-lookup"><span data-stu-id="72f7b-129">Microservices, SOA, and event-driven architecture (EDA) are examples of architectural styles.</span></span> <span data-ttu-id="72f7b-130">Describen un sistema de muchos componentes, por ejemplo, muchos microservicios.</span><span class="sxs-lookup"><span data-stu-id="72f7b-130">They describe a system of many components, such as many microservices.</span></span> <span data-ttu-id="72f7b-131">Patrones de CQRS y DDD describen algo dentro de un único sistema o un componente; en este caso, algo dentro de un microservicio.</span><span class="sxs-lookup"><span data-stu-id="72f7b-131">CQRS and DDD patterns describe something inside a single system or component; in this case, something inside a microservice.</span></span>

<span data-ttu-id="72f7b-132">Diferentes contextos limitado (BCs) utilizarán distintos patrones.</span><span class="sxs-lookup"><span data-stu-id="72f7b-132">Different Bounded Contexts (BCs) will employ different patterns.</span></span> <span data-ttu-id="72f7b-133">Que tienen responsabilidades diferentes, y que conduce a diferentes soluciones.</span><span class="sxs-lookup"><span data-stu-id="72f7b-133">They have different responsibilities, and that leads to different solutions.</span></span> <span data-ttu-id="72f7b-134">Merece la pena resaltar forzar el mismo patrón que provoca errores.</span><span class="sxs-lookup"><span data-stu-id="72f7b-134">It is worth emphasizing that forcing the same pattern everywhere leads to failure.</span></span> <span data-ttu-id="72f7b-135">No utilice patrones CQRS y DDD en cualquier lugar.</span><span class="sxs-lookup"><span data-stu-id="72f7b-135">Do not use CQRS and DDD patterns everywhere.</span></span> <span data-ttu-id="72f7b-136">Muchos subsistemas, BCs o microservicios son más sencillas y se pueden implementar más fácilmente mediante servicios simples de CRUD o con otro método.</span><span class="sxs-lookup"><span data-stu-id="72f7b-136">Many subsystems, BCs, or microservices are simpler and can be implemented more easily using simple CRUD services or using another approach.</span></span>

<span data-ttu-id="72f7b-137">Hay arquitectura solo una aplicación: la arquitectura de la aplicación de sistema o to-end está diseñando (por ejemplo, la arquitectura de microservicios).</span><span class="sxs-lookup"><span data-stu-id="72f7b-137">There is only one application architecture: the architecture of the system or end-to-end application you are designing (for example, the microservices architecture).</span></span> <span data-ttu-id="72f7b-138">Sin embargo, el diseño de cada contexto limitado o microservicio dentro de esa aplicación refleja su propio compensaciones y las decisiones de diseño interno en un nivel de patrones de arquitectura.</span><span class="sxs-lookup"><span data-stu-id="72f7b-138">However, the design of each Bounded Context or microservice within that application reflects its own tradeoffs and internal design decisions at an architecture patterns level.</span></span> <span data-ttu-id="72f7b-139">No intente aplicar los mismos patrones arquitectónicos como CQRS o DDD en cualquier lugar.</span><span class="sxs-lookup"><span data-stu-id="72f7b-139">Do not try to apply the same architectural patterns like CQRS or DDD everywhere.</span></span>

####  <a name="additional-resources"></a><span data-ttu-id="72f7b-140">Recursos adicionales</span><span class="sxs-lookup"><span data-stu-id="72f7b-140">Additional resources</span></span>

-   <span data-ttu-id="72f7b-141">**Martin Fowler. CQRS**
    [*https://martinfowler.com/bliki/CQRS.html*](https://martinfowler.com/bliki/CQRS.html)</span><span class="sxs-lookup"><span data-stu-id="72f7b-141">**Martin Fowler. CQRS**
[*https://martinfowler.com/bliki/CQRS.html*](https://martinfowler.com/bliki/CQRS.html)</span></span>

-   <span data-ttu-id="72f7b-142">**Greg Young. CQS vs. CQRS**
    [*http://codebetter.com/gregyoung/2009/08/13/command-query-separation/*](http://codebetter.com/gregyoung/2009/08/13/command-query-separation/)</span><span class="sxs-lookup"><span data-stu-id="72f7b-142">**Greg Young. CQS vs. CQRS**
[*http://codebetter.com/gregyoung/2009/08/13/command-query-separation/*](http://codebetter.com/gregyoung/2009/08/13/command-query-separation/)</span></span>

-   <span data-ttu-id="72f7b-143">**Greg Young. Documentos CQRS**
    [*https://cqrs.files.wordpress.com/2010/11/cqrs\_documents.pdf*](https://cqrs.files.wordpress.com/2010/11/cqrs_documents.pdf)</span><span class="sxs-lookup"><span data-stu-id="72f7b-143">**Greg Young. CQRS Documents**
[*https://cqrs.files.wordpress.com/2010/11/cqrs\_documents.pdf*](https://cqrs.files.wordpress.com/2010/11/cqrs_documents.pdf)</span></span>

-   <span data-ttu-id="72f7b-144">**Greg Young. CQRS, la tarea basado en interfaces de usuario y el origen de evento**
    [*http://codebetter.com/gregyoung/2010/02/16/cqrs-task-based-uis-event-sourcing-agh/*](http://codebetter.com/gregyoung/2010/02/16/cqrs-task-based-uis-event-sourcing-agh/)</span><span class="sxs-lookup"><span data-stu-id="72f7b-144">**Greg Young. CQRS, Task Based UIs and Event Sourcing**
[*http://codebetter.com/gregyoung/2010/02/16/cqrs-task-based-uis-event-sourcing-agh/*](http://codebetter.com/gregyoung/2010/02/16/cqrs-task-based-uis-event-sourcing-agh/)</span></span>

-   <span data-ttu-id="72f7b-145">**UDI Dahan. Se ha aclarado CQRS**
    [*http://udidahan.com/2009/12/09/clarified-cqrs/*](http://udidahan.com/2009/12/09/clarified-cqrs/)</span><span class="sxs-lookup"><span data-stu-id="72f7b-145">**Udi Dahan. Clarified CQRS**
[*http://udidahan.com/2009/12/09/clarified-cqrs/*](http://udidahan.com/2009/12/09/clarified-cqrs/)</span></span>

-   <span data-ttu-id="72f7b-146">**CQRS**
    [*http://udidahan.com/2009/12/09/clarified-cqrs/*](http://udidahan.com/2009/12/09/clarified-cqrs/)</span><span class="sxs-lookup"><span data-stu-id="72f7b-146">**CQRS**
[*http://udidahan.com/2009/12/09/clarified-cqrs/*](http://udidahan.com/2009/12/09/clarified-cqrs/)</span></span>

-   <span data-ttu-id="72f7b-147">**(ES) de origen de evento**
    [*http://codebetter.com/gregyoung/2010/02/20/why-use-event-sourcing/*](http://codebetter.com/gregyoung/2010/02/20/why-use-event-sourcing/)</span><span class="sxs-lookup"><span data-stu-id="72f7b-147">**Event-Sourcing (ES)**
[*http://codebetter.com/gregyoung/2010/02/20/why-use-event-sourcing/*](http://codebetter.com/gregyoung/2010/02/20/why-use-event-sourcing/)</span></span>


>[!div class="step-by-step"]
<span data-ttu-id="72f7b-148">[Anterior] (apply-simplified-microservice-cqrs-ddd-patterns.md) [siguiente] (cqrs-microservicio-reads.md)</span><span class="sxs-lookup"><span data-stu-id="72f7b-148">[Previous] (apply-simplified-microservice-cqrs-ddd-patterns.md) [Next] (cqrs-microservice-reads.md)</span></span>
