---
title: Diseño de una aplicación orientada a microservicios
description: Arquitectura de microservicios de .NET para aplicaciones .NET en contenedores | Diseño de una aplicación orientada a microservicios
author: CESARDELATORRE
ms.author: wiwagn
ms.date: 05/26/2017
ms.openlocfilehash: a5107e979dc2101380cf848dc574033caf750fd9
ms.sourcegitcommit: 3d5d33f384eeba41b2dff79d096f47ccc8d8f03d
ms.translationtype: HT
ms.contentlocale: es-ES
ms.lasthandoff: 05/04/2018
---
# <a name="designing-a-microservice-oriented-application"></a><span data-ttu-id="a0f22-103">Diseño de una aplicación orientada a microservicios</span><span class="sxs-lookup"><span data-stu-id="a0f22-103">Designing a microservice-oriented application</span></span>

<span data-ttu-id="a0f22-104">Esta sección se centra en desarrollar una hipotética aplicación empresarial del lado servidor.</span><span class="sxs-lookup"><span data-stu-id="a0f22-104">This section focuses on developing a hypothetical server-side enterprise application.</span></span>

## <a name="application-specifications"></a><span data-ttu-id="a0f22-105">Especificaciones de la aplicación</span><span class="sxs-lookup"><span data-stu-id="a0f22-105">Application specifications</span></span>

<span data-ttu-id="a0f22-106">La aplicación hipotética controla las solicitudes mediante la ejecución de lógica de negocios, el acceso a bases de datos y, después, la devolución de respuestas HTML, JSON o XML.</span><span class="sxs-lookup"><span data-stu-id="a0f22-106">The hypothetical application handles requests by executing business logic, accessing databases, and then returning HTML, JSON, or XML responses.</span></span> <span data-ttu-id="a0f22-107">Diremos que la aplicación debe admitir una variedad de clientes, incluidos exploradores de escritorio que ejecuten aplicaciones de página única (SPA), aplicaciones web tradicionales, aplicaciones web móviles y aplicaciones móviles nativas.</span><span class="sxs-lookup"><span data-stu-id="a0f22-107">We will say that the application must support a variety of clients, including desktop browsers running Single Page Applications (SPAs), traditional web apps, mobile web apps, and native mobile apps.</span></span> <span data-ttu-id="a0f22-108">También es posible que la aplicación exponga una API para el consumo de terceros.</span><span class="sxs-lookup"><span data-stu-id="a0f22-108">The application might also expose an API for third parties to consume.</span></span> <span data-ttu-id="a0f22-109">También debe ser capaz de integrar sus microservicios o aplicaciones externas de forma asincrónica, para que ese enfoque ayude a la resistencia de los microservicios en caso de errores parciales.</span><span class="sxs-lookup"><span data-stu-id="a0f22-109">It should also be able to integrate its microservices or external applications asynchronously, so that approach will help resiliency of the microservices in the case of partial failures.</span></span>

<span data-ttu-id="a0f22-110">La aplicación constará de estos tipos de componentes:</span><span class="sxs-lookup"><span data-stu-id="a0f22-110">The application will consist of these types of components:</span></span>

-   <span data-ttu-id="a0f22-111">Componentes de presentación.</span><span class="sxs-lookup"><span data-stu-id="a0f22-111">Presentation components.</span></span> <span data-ttu-id="a0f22-112">Son los responsables del control de la interfaz de usuario y el consumo de servicios remotos.</span><span class="sxs-lookup"><span data-stu-id="a0f22-112">These are responsible for handling the UI and consuming remote services.</span></span>

-   <span data-ttu-id="a0f22-113">Lógica de dominio o de negocios.</span><span class="sxs-lookup"><span data-stu-id="a0f22-113">Domain or business logic.</span></span> <span data-ttu-id="a0f22-114">Se trata de la lógica de dominio de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="a0f22-114">This is the application’s domain logic.</span></span>

-   <span data-ttu-id="a0f22-115">Lógica de acceso a bases de datos.</span><span class="sxs-lookup"><span data-stu-id="a0f22-115">Database access logic.</span></span> <span data-ttu-id="a0f22-116">Son los componentes de acceso a datos responsables de obtener acceso a las bases de datos (SQL o NoSQL).</span><span class="sxs-lookup"><span data-stu-id="a0f22-116">This consists of data access components responsible for accessing databases (SQL or NoSQL).</span></span>

-   <span data-ttu-id="a0f22-117">Lógica de integración de aplicaciones.</span><span class="sxs-lookup"><span data-stu-id="a0f22-117">Application integration logic.</span></span> <span data-ttu-id="a0f22-118">Incluye un canal de mensajería, basado principalmente en agentes de mensajes.</span><span class="sxs-lookup"><span data-stu-id="a0f22-118">This includes a messaging channel, mainly based on message brokers.</span></span>

<span data-ttu-id="a0f22-119">La aplicación requerirá alta escalabilidad, además de permitir que sus subsistemas verticales se escalen horizontalmente de forma autónoma, porque algunos subsistemas requerirán mayor escalabilidad que otros.</span><span class="sxs-lookup"><span data-stu-id="a0f22-119">The application will require high scalability, while allowing its vertical subsystems to scale out autonomously, because certain subsystems will require more scalability than others.</span></span>

<span data-ttu-id="a0f22-120">La aplicación debe ser capaz de implementarse en varios entornos de infraestructura (varias nubes públicas y locales) y debe ser multiplataforma, capaz de cambiar con facilidad de Linux a Windows (o viceversa).</span><span class="sxs-lookup"><span data-stu-id="a0f22-120">The application must be able to be deployed in multiple infrastructure environments (multiple public clouds and on-premises) and ideally should be cross-platform, able to move from Linux to Windows (or vice versa) easily.</span></span>

## <a name="development-team-context"></a><span data-ttu-id="a0f22-121">Contexto del equipo de desarrollo</span><span class="sxs-lookup"><span data-stu-id="a0f22-121">Development team context</span></span>

<span data-ttu-id="a0f22-122">También se supone lo siguiente sobre el proceso de desarrollo de la aplicación:</span><span class="sxs-lookup"><span data-stu-id="a0f22-122">We also assume the following about the development process for the application:</span></span>

-   <span data-ttu-id="a0f22-123">Tiene varios equipos de desarrollo centrados en diferentes áreas de negocio de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="a0f22-123">You have multiple dev teams focusing on different business areas of the application.</span></span>

-   <span data-ttu-id="a0f22-124">Los nuevos miembros del equipo deben ser productivos con rapidez y la aplicación debe ser fácil de entender y modificar.</span><span class="sxs-lookup"><span data-stu-id="a0f22-124">New team members must become productive quickly, and the application must be easy to understand and modify.</span></span>

-   <span data-ttu-id="a0f22-125">La aplicación tendrá una evolución a largo plazo y reglas de negocio cambiantes.</span><span class="sxs-lookup"><span data-stu-id="a0f22-125">The application will have a long-term evolution and ever-changing business rules.</span></span>

-   <span data-ttu-id="a0f22-126">Necesita un buen mantenimiento a largo plazo, lo que significa agilidad al implementar nuevos cambios en el futuro al tiempo que se pueden actualizar varios subsistemas con un impacto mínimo en el resto.</span><span class="sxs-lookup"><span data-stu-id="a0f22-126">You need good long-term maintainability, which means having agility when implementing new changes in the future while being able to update multiple subsystems with minimum impact on the other subsystems.</span></span>

-   <span data-ttu-id="a0f22-127">Le interesa la integración y la implementación continuas de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="a0f22-127">You want to practice continuous integration and continuous deployment of the application.</span></span>

-   <span data-ttu-id="a0f22-128">Le interesa aprovechar las ventajas de las nuevas tecnologías (plataformas, lenguajes de programación, etc.) durante la evolución de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="a0f22-128">You want to take advantage of emerging technologies (frameworks, programming languages, etc.) while evolving the application.</span></span> <span data-ttu-id="a0f22-129">No quiere realizar migraciones completas de la aplicación al cambiar a las nuevas tecnologías, ya que eso podría generar costos elevados y afectar a la capacidad de predicción y la estabilidad de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="a0f22-129">You do not want to make full migrations of the application when moving to new technologies, because that would result in high costs and impact the predictability and stability of the application.</span></span>

## <a name="choosing-an-architecture"></a><span data-ttu-id="a0f22-130">Elección de una arquitectura</span><span class="sxs-lookup"><span data-stu-id="a0f22-130">Choosing an architecture</span></span>

<span data-ttu-id="a0f22-131">¿Cuál debe ser la arquitectura de implementación de la aplicación?</span><span class="sxs-lookup"><span data-stu-id="a0f22-131">What should the application deployment architecture be?</span></span> <span data-ttu-id="a0f22-132">Las especificaciones de la aplicación, junto con el contexto de desarrollo, sugieren que se debe diseñar descomponiéndola en subsistemas autónomos en forma de microservicios de colaboración y contenedores, donde un microservicio es un contenedor.</span><span class="sxs-lookup"><span data-stu-id="a0f22-132">The specifications for the application, along with the development context, strongly suggest that you should architect the application by decomposing it into autonomous subsystems in the form of collaborating microservices and containers, where a microservice is a container.</span></span>

<span data-ttu-id="a0f22-133">Con este enfoque, cada servicio (contenedor) implementa un conjunto de funciones coherentes y estrechamente relacionadas.</span><span class="sxs-lookup"><span data-stu-id="a0f22-133">In this approach, each service (container) implements a set of cohesive and narrowly related functions.</span></span> <span data-ttu-id="a0f22-134">Por ejemplo, es posible que una aplicación conste de servicios como el de catálogo, de pedidos, de cesta de la compra, perfiles de usuario, etc.</span><span class="sxs-lookup"><span data-stu-id="a0f22-134">For example, an application might consist of services such as the catalog service, ordering service, basket service, user profile service, etc.</span></span>

<span data-ttu-id="a0f22-135">Los microservicios se comunican mediante protocolos como HTTP (REST), pero también de forma asincrónica (por ejemplo, mediante AMQP) siempre que sea posible, en especial al propagar actualizaciones con eventos de integración.</span><span class="sxs-lookup"><span data-stu-id="a0f22-135">Microservices communicate using protocols such as HTTP (REST), but also asynchronously (for example, using AMQP) whenever possible, especially when propagating updates with integration events.</span></span>

<span data-ttu-id="a0f22-136">Los microservicios se desarrollan e implementan como contenedores de forma independiente entre ellos.</span><span class="sxs-lookup"><span data-stu-id="a0f22-136">Microservices are developed and deployed as containers independently of one another.</span></span> <span data-ttu-id="a0f22-137">Esto significa que un equipo de desarrollo puede desarrollar e implementar un microservicio determinado sin afectar a otros subsistemas.</span><span class="sxs-lookup"><span data-stu-id="a0f22-137">This means that a development team can be developing and deploying a certain microservice without impacting other subsystems.</span></span>

<span data-ttu-id="a0f22-138">Cada microservicio tiene su propia base de datos, lo que permite separarlo totalmente de otros microservicios.</span><span class="sxs-lookup"><span data-stu-id="a0f22-138">Each microservice has its own database, allowing it to be fully decoupled from other microservices.</span></span> <span data-ttu-id="a0f22-139">Cuando sea necesario, la coherencia entre las bases de datos de los diferentes microservicios se logra mediante eventos de integración de nivel de aplicación (a través de un bus de eventos lógicos), como se controla en Command and Query Responsibility Segregation (CQRS).</span><span class="sxs-lookup"><span data-stu-id="a0f22-139">When necessary, consistency between databases from different microservices is achieved using application-level integration events (through a logical event bus), as handled in Command and Query Responsibility Segregation (CQRS).</span></span> <span data-ttu-id="a0f22-140">Por ese motivo, las restricciones de negocio deben adoptar la coherencia final entre los múltiples microservicios y bases de datos relacionadas.</span><span class="sxs-lookup"><span data-stu-id="a0f22-140">Because of that, the business constraints must embrace eventual consistency between the multiple microservices and related databases.</span></span>

### <a name="eshoponcontainers-a-reference-application-for-net-core-and-microservices-deployed-using-containers"></a><span data-ttu-id="a0f22-141">eShopOnContainers: una aplicación de referencia para .NET Core y microservicios implementados mediante contenedores</span><span class="sxs-lookup"><span data-stu-id="a0f22-141">eShopOnContainers: A reference application for .NET Core and microservices deployed using containers</span></span>

<span data-ttu-id="a0f22-142">Para que pueda centrarse en la arquitectura y las tecnologías en lugar de pensar en un dominio de negocio hipotético que es posible que no conozca, se ha seleccionado un dominio de negocio conocido: una aplicación de comercio electrónico simplificada (e-shop) que presenta un catálogo de productos, recibe pedidos de los clientes, comprueba el inventario y realiza otras funciones de negocio.</span><span class="sxs-lookup"><span data-stu-id="a0f22-142">So that you can focus on the architecture and technologies instead of thinking about a hypothetic business domain that you might not know, we have selected a well-known business domain—namely, a simplified e-commerce (e-shop) application that presents a catalog of products, takes orders from customers, verifies inventory, and performs other business functions.</span></span> <span data-ttu-id="a0f22-143">El código fuente basado en contenedores de esta aplicación está disponible en el repositorio de GitHub [eShopOnContainers](http://aka.ms/MicroservicesArchitecture).</span><span class="sxs-lookup"><span data-stu-id="a0f22-143">This container-based application source code is available in the [eShopOnContainers](http://aka.ms/MicroservicesArchitecture) GitHub repo.</span></span>

<span data-ttu-id="a0f22-144">La aplicación consta de varios subsistemas, incluidos varios front-end de interfaz de usuario de tienda (una aplicación web y una aplicación móvil nativa), junto con los microservicios de back-end y los contenedores para todas las operaciones necesarias del lado servidor.</span><span class="sxs-lookup"><span data-stu-id="a0f22-144">The application consists of multiple subsystems, including several store UI front ends (a Web application and a native mobile app), along with the back-end microservices and containers for all the required server-side operations.</span></span> <span data-ttu-id="a0f22-145">En la figura 8-1 se muestra la arquitectura de la aplicación de referencia.</span><span class="sxs-lookup"><span data-stu-id="a0f22-145">Figure 8-1 shows the architecture of the reference application.</span></span>

![](./media/image1.png)

<span data-ttu-id="a0f22-146">**Figura 8-1**.</span><span class="sxs-lookup"><span data-stu-id="a0f22-146">**Figure 8-1**.</span></span> <span data-ttu-id="a0f22-147">La aplicación de referencia eShopOnContainers, en la que se muestra una comunicación directa entre cliente y microservicio y el bus de eventos</span><span class="sxs-lookup"><span data-stu-id="a0f22-147">The eShopOnContainers reference application, showing a direct client-to-microservice communication and the event bus</span></span>

<span data-ttu-id="a0f22-148">**Entorno de hospedaje**.</span><span class="sxs-lookup"><span data-stu-id="a0f22-148">**Hosting environment**.</span></span> <span data-ttu-id="a0f22-149">En la figura 8-1 se pueden ver varios contenedores implementados dentro de un único host de Docker.</span><span class="sxs-lookup"><span data-stu-id="a0f22-149">In Figure 8-1, you see several containers deployed within a single Docker host.</span></span> <span data-ttu-id="a0f22-150">Ese sería el caso al implementar en un único host de Docker con el comando docker-compose up.</span><span class="sxs-lookup"><span data-stu-id="a0f22-150">That would be the case when deploying to a single Docker host with the docker-compose up command.</span></span> <span data-ttu-id="a0f22-151">Pero si se usa un clúster de orquestadores o contenedores, cada contenedor podría ejecutarse en otro host (nodo) y cualquier nodo podría ejecutar cualquier número de contenedores, como se explicó anteriormente en la sección sobre arquitectura.</span><span class="sxs-lookup"><span data-stu-id="a0f22-151">However, if you are using an orchestrator or container cluster, each container could be running in a different host (node), and any node could be running any number of containers, as we explained earlier in the architecture section.</span></span>

<span data-ttu-id="a0f22-152">**Arquitectura de comunicación**.</span><span class="sxs-lookup"><span data-stu-id="a0f22-152">**Communication architecture**.</span></span> <span data-ttu-id="a0f22-153">En la aplicación eShopOnContainers se usan dos tipos de comunicación, según el tipo de la acción funcional (consultas frente a transacciones y actualizaciones):</span><span class="sxs-lookup"><span data-stu-id="a0f22-153">The eShopOnContainers application uses two communication types, depending on the kind of the functional action (queries versus updates and transactions):</span></span>

-   <span data-ttu-id="a0f22-154">Comunicación directa de cliente a microservicio.</span><span class="sxs-lookup"><span data-stu-id="a0f22-154">Direct client-to-microservice communication.</span></span> <span data-ttu-id="a0f22-155">Se usa para las consultas y al aceptar los comandos transaccionales o de actualización desde las aplicaciones cliente.</span><span class="sxs-lookup"><span data-stu-id="a0f22-155">This is used for queries and when accepting update or transactional commands from the client apps.</span></span>

-   <span data-ttu-id="a0f22-156">Comunicación asincrónica basada en eventos.</span><span class="sxs-lookup"><span data-stu-id="a0f22-156">Asynchronous event-based communication.</span></span> <span data-ttu-id="a0f22-157">Se realiza a través de un bus de eventos para propagar las actualizaciones entre los microservicios o para la integración con aplicaciones externas.</span><span class="sxs-lookup"><span data-stu-id="a0f22-157">This occurs through an event bus to propagate updates across microservices or to integrate with external applications.</span></span> <span data-ttu-id="a0f22-158">El bus de eventos se puede implementar con cualquier tecnología de infraestructura de agente de mensajería como RabbitMQ, o bien mediante Service Bus de nivel superior como Azure Service Bus, NServiceBus, MassTransit o Brighter.</span><span class="sxs-lookup"><span data-stu-id="a0f22-158">The event bus can be implemented with any messaging-broker infrastructure technology like RabbitMQ, or using higher-level service buses like Azure Service Bus, NServiceBus, MassTransit, or Brighter.</span></span>

<span data-ttu-id="a0f22-159">La aplicación se implementa como un conjunto de microservicios en forma de contenedores.</span><span class="sxs-lookup"><span data-stu-id="a0f22-159">The application is deployed as a set of microservices in the form of containers.</span></span> <span data-ttu-id="a0f22-160">Las aplicaciones cliente se pueden comunicar con los contenedores, así como entre los microservicios.</span><span class="sxs-lookup"><span data-stu-id="a0f22-160">Client apps can communicate with those containers as well as communicate between microservices.</span></span> <span data-ttu-id="a0f22-161">Como se mencionó, en esta arquitectura inicial se usa una arquitectura de comunicación directa del cliente al microservicio, lo que significa que una aplicación cliente puede realizar solicitudes directamente a cada uno de los microservicios.</span><span class="sxs-lookup"><span data-stu-id="a0f22-161">As mentioned, this initial architecture is using a direct client-to-microservice communication architecture, which means that a client application can make requests to each of the microservices directly.</span></span> <span data-ttu-id="a0f22-162">Cada microservicio tiene un punto de conexión público, como https://servicename.applicationname.companyname.</span><span class="sxs-lookup"><span data-stu-id="a0f22-162">Each microservice has a public endpoint like https://servicename.applicationname.companyname.</span></span> <span data-ttu-id="a0f22-163">Si es necesario, cada microservicio puede usar un puerto TCP diferente.</span><span class="sxs-lookup"><span data-stu-id="a0f22-163">If required, each microservice can use a different TCP port.</span></span> <span data-ttu-id="a0f22-164">En producción, esa dirección URL se asignaría al equilibrador de carga de los microservicios, que distribuye las solicitudes entre las instancias de microservicio disponibles.</span><span class="sxs-lookup"><span data-stu-id="a0f22-164">In production, that URL would map to the microservices’ load balancer, which distributes requests across the available microservice instances.</span></span>

<span data-ttu-id="a0f22-165">**Nota importante sobre las diferencias entre una puerta de enlace de API y la comunicación directa en eShopOnContainers.**</span><span class="sxs-lookup"><span data-stu-id="a0f22-165">**Important note on API Gateway vs. Direct Communication in eShopOnContainers.**</span></span> <span data-ttu-id="a0f22-166">Como se explicó en la sección sobre arquitectura de esta guía, la arquitectura de comunicación directa del cliente al microservicio puede tener inconvenientes al diseñar una aplicación grande y compleja basada en microservicios.</span><span class="sxs-lookup"><span data-stu-id="a0f22-166">As explained in the architecture section of this guide, the direct client-to-microservice communication architecture can have drawbacks when you are building a large and complex microservice-based application.</span></span> <span data-ttu-id="a0f22-167">Pero puede ser suficiente para una aplicación pequeña, como eShopOnContainers, cuyo objetivo es centrarse en una aplicación de introducción más sencilla basada en contenedores de Docker y no queríamos crear una única puerta de enlace de API monolítica que afectara a la autonomía de desarrollo de los microservicios.</span><span class="sxs-lookup"><span data-stu-id="a0f22-167">But it can be good enough for a small application, such as in the eShopOnContainers application, where the goal is to focus on a simpler getting started Docker container-based application and we didn’t want to create a single monolithic API Gateway that can impact the microservices’ development autonomy.</span></span>

<span data-ttu-id="a0f22-168">Pero si va a diseñar una aplicación grande basada en microservicios con decenas de ellos, se recomienda encarecidamente que tenga en cuenta la posibilidad del modelo de puerta de enlace de API, como se explicó en la sección sobre arquitectura.</span><span class="sxs-lookup"><span data-stu-id="a0f22-168">But, if you are going to design a large microservice-based application with dozens of microservices, we strongly recommend that you consider the API Gateway pattern, as we explained in the architecture section.</span></span>
<span data-ttu-id="a0f22-169">Esta decisión sobre la arquitectura se podría refactorizar una vez al valorar aplicaciones para entornos de producción e interfaces creadas expresamente para clientes remotos.</span><span class="sxs-lookup"><span data-stu-id="a0f22-169">This architectural decision could be refactored once thinking about production-ready applications and specially-made facades for remote clients.</span></span> <span data-ttu-id="a0f22-170">Tener varias puertas de enlace de API personalizadas según el factor de forma de las aplicaciones cliente puede proporcionar ventajas con respecto a la agregación de datos diferentes por cada aplicación cliente y también permite ocultar microservicios internos o API a las aplicaciones cliente y autorizar en ese nivel único.</span><span class="sxs-lookup"><span data-stu-id="a0f22-170">Having multiple custom API Gateways depending on the client apps' form-factor can provide benefits in regard to different data aggregation per client app plus you can hide internal microservices or APIs to the client apps and authorize in that single tier.</span></span> 

<span data-ttu-id="a0f22-171">Pero como ya se ha mencionado, debe tener cuidado con las puertas de enlace de API grandes y monolíticas que podrían anular la autonomía de desarrollo de los microservicios.</span><span class="sxs-lookup"><span data-stu-id="a0f22-171">However, and as mentioned, beware against large and monolithic API Gateways that might kill your microservices' development autonomy.</span></span>

### <a name="data-sovereignty-per-microservice"></a><span data-ttu-id="a0f22-172">Propiedad de los datos por microservicio</span><span class="sxs-lookup"><span data-stu-id="a0f22-172">Data sovereignty per microservice</span></span>

<span data-ttu-id="a0f22-173">En la aplicación de ejemplo, cada microservicio posee su propia base de datos u origen de datos, y cada base de datos u origen de datos se implementa como otro contenedor.</span><span class="sxs-lookup"><span data-stu-id="a0f22-173">In the sample application, each microservice owns its own database or data source, and each database or data source is deployed as another container.</span></span> <span data-ttu-id="a0f22-174">Esta decisión de diseño se tomó solo para facilitar a los desarrolladores la obtención del código desde GitHub, clonarlo y abrirlo en Visual Studio o Visual Studio Code.</span><span class="sxs-lookup"><span data-stu-id="a0f22-174">This design decision was made only to make it easy for a developer to get the code from GitHub, clone it, and open it in Visual Studio or Visual Studio Code.</span></span> <span data-ttu-id="a0f22-175">O bien, como alternativa, facilita la compilación de las imágenes de Docker personalizadas mediante la CLI de .NET Core y la de Docker, y después su implementación y ejecución en un entorno de desarrollo de Docker.</span><span class="sxs-lookup"><span data-stu-id="a0f22-175">Or alternatively, it makes it easy to compile the custom Docker images using .NET Core CLI and the Docker CLI, and then deploy and run them in a Docker development environment.</span></span> <span data-ttu-id="a0f22-176">En cualquier caso, el uso de contenedores para orígenes de datos permite a los desarrolladores compilar e implementar en cuestión de minutos sin tener que aprovisionar una base de datos externa o cualquier otro origen de datos con dependencias en la infraestructura (en la nube o locales).</span><span class="sxs-lookup"><span data-stu-id="a0f22-176">Either way, using containers for data sources lets developers build and deploy in a matter of minutes without having to provision an external database or any other data source with hard dependencies on infrastructure (cloud or on-premises).</span></span>

<span data-ttu-id="a0f22-177">En un entorno de producción real, para alta disponibilidad y escalabilidad, las bases de datos deberían basarse en servidores de base de datos en la nube o locales, pero no en contenedores.</span><span class="sxs-lookup"><span data-stu-id="a0f22-177">In a real production environment, for high availability and for scalability, the databases should be based on database servers in the cloud or on-premises, but not in containers.</span></span>

<span data-ttu-id="a0f22-178">Por tanto, las unidades de implementación de los microservicios (e incluso de las bases de datos de esta aplicación) son contenedores de Docker y la aplicación de referencia es una aplicación de varios contenedores que se rige por los principios de los microservicios.</span><span class="sxs-lookup"><span data-stu-id="a0f22-178">Therefore, the units of deployment for microservices (and even for databases in this application) are Docker containers, and the reference application is a multi-container application that embraces microservices principles.</span></span>

### <a name="additional-resources"></a><span data-ttu-id="a0f22-179">Recursos adicionales</span><span class="sxs-lookup"><span data-stu-id="a0f22-179">Additional resources</span></span>

-   <span data-ttu-id="a0f22-180">**Repositorio de GitHub de eShopOnContainers. Código fuente de la aplicación de referencia**
    *https://aka.ms/eShopOnContainers/*</span><span class="sxs-lookup"><span data-stu-id="a0f22-180">**eShopOnContainers GitHub repo. Source code for the reference application**
*https://aka.ms/eShopOnContainers/*</span></span>

## <a name="benefits-of-a-microservice-based-solution"></a><span data-ttu-id="a0f22-181">Ventajas de una solución basada en microservicios</span><span class="sxs-lookup"><span data-stu-id="a0f22-181">Benefits of a microservice-based solution</span></span>

<span data-ttu-id="a0f22-182">Una solución basada en microservicios como esta tiene muchas ventajas:</span><span class="sxs-lookup"><span data-stu-id="a0f22-182">A microservice based solution like this has many benefits:</span></span>

<span data-ttu-id="a0f22-183">**Cada microservicio es relativamente pequeño, fácil de administrar y desarrollar**.</span><span class="sxs-lookup"><span data-stu-id="a0f22-183">**Each microservice is relatively small—easy to manage and evolve**.</span></span> <span data-ttu-id="a0f22-184">De manera específica:</span><span class="sxs-lookup"><span data-stu-id="a0f22-184">Specifically:</span></span>

-   <span data-ttu-id="a0f22-185">Es fácil para los desarrolladores entender y empezar a trabajar rápidamente con buena productividad.</span><span class="sxs-lookup"><span data-stu-id="a0f22-185">It is easy for a developer to understand and get started quickly with good productivity.</span></span>

-   <span data-ttu-id="a0f22-186">Los contenedores se crean con rapidez, lo que permite que los desarrolladores sean más productivos.</span><span class="sxs-lookup"><span data-stu-id="a0f22-186">Containers start fast, which makes developers more productive.</span></span>

-   <span data-ttu-id="a0f22-187">Un IDE como Visual Studio puede cargar proyectos más pequeños con rapidez, aumentando la productividad de los desarrolladores.</span><span class="sxs-lookup"><span data-stu-id="a0f22-187">An IDE like Visual Studio can load smaller projects fast, making developers productive.</span></span>

-   <span data-ttu-id="a0f22-188">Cada microservicio se puede diseñar, desarrollar e implementar independientemente de otros microservicios, lo que proporciona agilidad dado que es más fácil implementar nuevas versiones de los microservicios con frecuencia.</span><span class="sxs-lookup"><span data-stu-id="a0f22-188">Each microservice can be designed, developed, and deployed independently of other microservices, which provides agility because it is easier to deploy new versions of microservices frequently.</span></span>

<span data-ttu-id="a0f22-189">**Es posible escalar horizontalmente áreas individuales de la aplicación**.</span><span class="sxs-lookup"><span data-stu-id="a0f22-189">**It is possible to scale out individual areas of the application**.</span></span> <span data-ttu-id="a0f22-190">Por ejemplo, es posible que sea necesario escalar horizontalmente el servicio de catálogo o el de cesta de la compra, pero no el proceso de pedidos.</span><span class="sxs-lookup"><span data-stu-id="a0f22-190">For instance, the catalog service or the basket service might need to be scaled out, but not the ordering process.</span></span> <span data-ttu-id="a0f22-191">Una infraestructura de microservicios será mucho más eficaz con respecto a los recursos que se usan durante el escalado horizontal que una arquitectura monolítica.</span><span class="sxs-lookup"><span data-stu-id="a0f22-191">A microservices infrastructure will be much more efficient with regard to the resources used when scaling out than a monolithic architecture would be.</span></span>

<span data-ttu-id="a0f22-192">**El trabajo de desarrollo se puede dividir entre varios equipos**.</span><span class="sxs-lookup"><span data-stu-id="a0f22-192">**You can divide the development work between multiple teams**.</span></span> <span data-ttu-id="a0f22-193">Cada servicio puede ser propiedad de un único equipo de desarrollo.</span><span class="sxs-lookup"><span data-stu-id="a0f22-193">Each service can be owned by a single development team.</span></span> <span data-ttu-id="a0f22-194">Cada equipo puede administrar, desarrollar, implementar y escalar su servicio de forma independiente a los demás equipos.</span><span class="sxs-lookup"><span data-stu-id="a0f22-194">Each team can manage, develop, deploy, and scale their service independently of the rest of the teams.</span></span>

<span data-ttu-id="a0f22-195">**Los problemas son más aislados**.</span><span class="sxs-lookup"><span data-stu-id="a0f22-195">**Issues are more isolated**.</span></span> <span data-ttu-id="a0f22-196">Si se produce un problema en un servicio, inicialmente solo se ve afectado ese servicio (excepto cuando se usa un diseño incorrecto, con dependencias directas entre los microservicios) y los demás servicios pueden continuar con el control de las solicitudes.</span><span class="sxs-lookup"><span data-stu-id="a0f22-196">If there is an issue in one service, only that service is initially impacted (except when the wrong design is used, with direct dependencies between microservices), and other services can continue to handle requests.</span></span> <span data-ttu-id="a0f22-197">Por el contrario, un componente en mal estado en una arquitectura de implementación monolítica puede colapsar todo el sistema, especialmente si hay recursos implicados, como una fuga de memoria.</span><span class="sxs-lookup"><span data-stu-id="a0f22-197">In contrast, one malfunctioning component in a monolithic deployment architecture can bring down the entire system, especially when it involves resources, such as a memory leak.</span></span> <span data-ttu-id="a0f22-198">Además, cuando se resuelve un problema en un microservicio, se puede implementar el microservicio afectado sin afectar al resto de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="a0f22-198">Additionally, when an issue in a microservice is resolved, you can deploy just the affected microservice without impacting the rest of the application.</span></span>

<span data-ttu-id="a0f22-199">**Se pueden usar las tecnologías más recientes**.</span><span class="sxs-lookup"><span data-stu-id="a0f22-199">**You can use the latest technologies**.</span></span> <span data-ttu-id="a0f22-200">Como se puede empezar a desarrollar los servicios de forma independiente y ejecutarlos en paralelo (gracias a los contenedores y .NET Core), se pueden usar las tecnologías y plataformas más modernas de forma oportuna en lugar de quedarse atascado en una pila o marco de trabajo antiguo para toda la aplicación.</span><span class="sxs-lookup"><span data-stu-id="a0f22-200">Because you can start developing services independently and run them side by side (thanks to containers and .NET Core), you can start using the latest technologies and frameworks expediently instead of being stuck on an older stack or framework for the whole application.</span></span>

## <a name="downsides-of-a-microservice-based-solution"></a><span data-ttu-id="a0f22-201">Desventajas de una solución basada en microservicios</span><span class="sxs-lookup"><span data-stu-id="a0f22-201">Downsides of a microservice-based solution</span></span>

<span data-ttu-id="a0f22-202">Una solución basada en microservicios como esta también tiene algunas desventajas:</span><span class="sxs-lookup"><span data-stu-id="a0f22-202">A microservice based solution like this also has some drawbacks:</span></span>

<span data-ttu-id="a0f22-203">**Aplicación distribuida**.</span><span class="sxs-lookup"><span data-stu-id="a0f22-203">**Distributed application**.</span></span> <span data-ttu-id="a0f22-204">La distribución de la aplicación agrega complejidad para los desarrolladores cuando diseñen y creen los servicios.</span><span class="sxs-lookup"><span data-stu-id="a0f22-204">Distributing the application adds complexity for developers when they are designing and building the services.</span></span> <span data-ttu-id="a0f22-205">Por ejemplo, los desarrolladores deben implementar la comunicación entre servicios mediante protocolos como HTTP o AMPQ, lo que agrega complejidad para las pruebas y el control de excepciones.</span><span class="sxs-lookup"><span data-stu-id="a0f22-205">For example, developers must implement interservice communication using protocols like HTTP or AMPQ, which adds complexity for testing and exception handling.</span></span> <span data-ttu-id="a0f22-206">También agrega latencia al sistema.</span><span class="sxs-lookup"><span data-stu-id="a0f22-206">It also adds latency to the system.</span></span>

<span data-ttu-id="a0f22-207">**Complejidad de la implementación**.</span><span class="sxs-lookup"><span data-stu-id="a0f22-207">**Deployment complexity**.</span></span> <span data-ttu-id="a0f22-208">Una aplicación que tiene docenas de tipos de microservicios y que necesita alta escalabilidad (debe ser capaz de crear varias instancias por cada servicio y equilibrarlos entre varios hosts) supone un alto grado de complejidad de implementación para las operaciones de TI y administración.</span><span class="sxs-lookup"><span data-stu-id="a0f22-208">An application that has dozens of microservices types and needs high scalability (it needs to be able to create many instances per service and balance those services across many hosts) means a high degree of deployment complexity for IT operations and management.</span></span> <span data-ttu-id="a0f22-209">Si no se usa una infraestructura orientada a microservicios (por ejemplo, un orquestador y un programador), esa complejidad adicional puede requerir muchos más esfuerzos de desarrollo que la propia aplicación empresarial.</span><span class="sxs-lookup"><span data-stu-id="a0f22-209">If you are not using a microservice-oriented infrastructure (like an orchestrator and scheduler), that additional complexity can require far more development efforts than the business application itself.</span></span>

<span data-ttu-id="a0f22-210">**Transacciones atómicas**.</span><span class="sxs-lookup"><span data-stu-id="a0f22-210">**Atomic transactions**.</span></span> <span data-ttu-id="a0f22-211">Normalmente, no se pueden realizar transacciones atómicas entre varios microservicios.</span><span class="sxs-lookup"><span data-stu-id="a0f22-211">Atomic transactions between multiple microservices usually are not possible.</span></span> <span data-ttu-id="a0f22-212">Los requisitos de negocio deben adoptar la coherencia final entre varios microservicios.</span><span class="sxs-lookup"><span data-stu-id="a0f22-212">The business requirements have to embrace eventual consistency between multiple microservices.</span></span>

<span data-ttu-id="a0f22-213">**Aumento de las necesidades de recursos globales** (total de memoria, unidades y recursos de red para todos los hosts o servidores).</span><span class="sxs-lookup"><span data-stu-id="a0f22-213">**Increased global resource needs** (total memory, drives, and network resources for all the servers or hosts).</span></span> <span data-ttu-id="a0f22-214">En muchos casos, al reemplazar una aplicación monolítica con un enfoque de microservicios, la cantidad de recursos globales necesaria para la nueva aplicación basada en microservicios será mayor que las necesidades de infraestructura de la aplicación monolítica original.</span><span class="sxs-lookup"><span data-stu-id="a0f22-214">In many cases, when you replace a monolithic application with a microservices approach, the amount of global resources needed by the new microservice-based application will be larger than the infrastructure needs of the original monolithic application.</span></span> <span data-ttu-id="a0f22-215">Esto se debe a que el mayor grado de granularidad y servicios distribuidos requiere más recursos globales.</span><span class="sxs-lookup"><span data-stu-id="a0f22-215">This is because the higher degree of granularity and distributed services requires more global resources.</span></span> <span data-ttu-id="a0f22-216">Pero dado el bajo costo de los recursos en general y la ventaja de poder escalar horizontalmente solo determinadas áreas de la aplicación en comparación con los costos a largo plazo a la hora de desarrollar aplicaciones monolíticas, el aumento en el uso de recursos normalmente es una ventaja para las grandes aplicaciones a largo plazo.</span><span class="sxs-lookup"><span data-stu-id="a0f22-216">However, given the low cost of resources in general and the benefit of being able to scale out just certain areas of the application compared to long-term costs when evolving monolithic applications, the increased use of resources is usually a good tradeoff for large, long-term applications.</span></span>

<span data-ttu-id="a0f22-217">**Problemas de comunicación directa de cliente a microservicio**.</span><span class="sxs-lookup"><span data-stu-id="a0f22-217">**Issues with direct client‑to‑microservice communication**.</span></span> <span data-ttu-id="a0f22-218">Cuando la aplicación es grande, con docenas de microservicios, hay problemas y limitaciones si la aplicación requiere comunicaciones directas del cliente al microservicio.</span><span class="sxs-lookup"><span data-stu-id="a0f22-218">When the application is large, with dozens of microservices, there are challenges and limitations if the application requires direct client-to-microservice communications.</span></span> <span data-ttu-id="a0f22-219">Un problema es un error de coincidencia potencial entre las necesidades del cliente y las API expuestas por cada uno de los microservicios.</span><span class="sxs-lookup"><span data-stu-id="a0f22-219">One problem is a potential mismatch between the needs of the client and the APIs exposed by each of the microservices.</span></span> <span data-ttu-id="a0f22-220">En algunos casos, es posible que la aplicación cliente tenga que realizar varias solicitudes independientes para crear la interfaz de usuario, lo que puede resultar ineficaz a través de Internet y poco práctico a través de una red móvil.</span><span class="sxs-lookup"><span data-stu-id="a0f22-220">In certain cases, the client application might need to make many separate requests to compose the UI, which can be inefficient over the Internet and would be impractical over a mobile network.</span></span> <span data-ttu-id="a0f22-221">Por tanto, se deben minimizar las solicitudes de la aplicación cliente al sistema back-end.</span><span class="sxs-lookup"><span data-stu-id="a0f22-221">Therefore, requests from the client application to the back-end system should be minimized.</span></span>

<span data-ttu-id="a0f22-222">Otro problema con las comunicaciones directas entre el cliente y el microservicio es la posibilidad de que algunos microservicios usen protocolos que no sean aptos para la web.</span><span class="sxs-lookup"><span data-stu-id="a0f22-222">Another problem with direct client-to-microservice communications is that some microservices might be using protocols that are not Web-friendly.</span></span> <span data-ttu-id="a0f22-223">Es posible que un servicio use un protocolo binario, mientras que otro use mensajería de AMQP.</span><span class="sxs-lookup"><span data-stu-id="a0f22-223">One service might use a binary protocol, while another service might use AMQP messaging.</span></span> <span data-ttu-id="a0f22-224">Estos protocolos no son compatibles con firewall y resultan más útiles cuando se usan internamente.</span><span class="sxs-lookup"><span data-stu-id="a0f22-224">Those protocols are not firewall‑friendly and are best used internally.</span></span> <span data-ttu-id="a0f22-225">Normalmente, una aplicación debería usar protocolos como HTTP y WebSockets para la comunicación fuera del firewall.</span><span class="sxs-lookup"><span data-stu-id="a0f22-225">Usually, an application should use protocols such as HTTP and WebSockets for communication outside of the firewall.</span></span>

<span data-ttu-id="a0f22-226">Otra desventaja con este enfoque directo de cliente a servicio es que resulta difícil refactorizar los contratos para esos microservicios.</span><span class="sxs-lookup"><span data-stu-id="a0f22-226">Yet another drawback with this direct client‑to‑service approach is that it makes it difficult to refactor the contracts for those microservices.</span></span> <span data-ttu-id="a0f22-227">Con el tiempo, es posible que a los desarrolladores les interese cambiar la forma en que el sistema se divide en servicios.</span><span class="sxs-lookup"><span data-stu-id="a0f22-227">Over time developers might want to change how the system is partitioned into services.</span></span> <span data-ttu-id="a0f22-228">Por ejemplo, es posible que combinen dos servicios o dividan uno en dos o más servicios.</span><span class="sxs-lookup"><span data-stu-id="a0f22-228">For example, they might merge two services or split a service into two or more services.</span></span> <span data-ttu-id="a0f22-229">Pero si los clientes se comunican directamente con los servicios, realizar este tipo de refactorización puede interrumpir la compatibilidad con las aplicaciones cliente.</span><span class="sxs-lookup"><span data-stu-id="a0f22-229">However, if clients communicate directly with the services, performing this kind of refactoring can break compatibility with client apps.</span></span>

<span data-ttu-id="a0f22-230">Como se mencionó en la sección sobre arquitectura, al diseñar y crear una aplicación compleja basada en microservicios, podría considerar el uso de varias puertas de enlace de API específicas en lugar del enfoque más sencillo de comunicación directa entre el cliente y el microservicio.</span><span class="sxs-lookup"><span data-stu-id="a0f22-230">As mentioned in the architecture section, when designing and building a complex application based on microservices, you might consider the use of multiple fine-grained API Gateways instead of the simpler direct client‑to‑microservice communication approach.</span></span>

<span data-ttu-id="a0f22-231">**Creación de particiones de los microservicios**.</span><span class="sxs-lookup"><span data-stu-id="a0f22-231">**Partitioning the microservices**.</span></span> <span data-ttu-id="a0f22-232">Por último, independientemente del enfoque que se adopte para la arquitectura del microservicio, otro desafío consiste en decidir cómo dividir una aplicación integral en varios microservicios.</span><span class="sxs-lookup"><span data-stu-id="a0f22-232">Finally, no matter which approach you take for your microservice architecture, another challenge is deciding how to partition an end-to-end application into multiple microservices.</span></span> <span data-ttu-id="a0f22-233">Como se indicó en la sección sobre arquitectura de la guía, se pueden adoptar varias técnicas y enfoques.</span><span class="sxs-lookup"><span data-stu-id="a0f22-233">As noted in the architecture section of the guide, there are several techniques and approaches you can take.</span></span> <span data-ttu-id="a0f22-234">Básicamente, debe identificar las áreas de la aplicación que se separan del resto y que tienen un número reducido de dependencias fuertes.</span><span class="sxs-lookup"><span data-stu-id="a0f22-234">Basically, you need to identify areas of the application that are decoupled from the other areas and that have a low number of hard dependencies.</span></span> <span data-ttu-id="a0f22-235">En muchos casos, esto se alinea con la creación de particiones de los servicios por caso de uso.</span><span class="sxs-lookup"><span data-stu-id="a0f22-235">In many cases, this is aligned to partitioning services by use case.</span></span> <span data-ttu-id="a0f22-236">Por ejemplo, en la aplicación de tienda electrónica, hay un servicio de pedidos que se encarga de toda la lógica de negocios relacionada con el proceso de pedidos.</span><span class="sxs-lookup"><span data-stu-id="a0f22-236">For example, in our e-shop application, we have an ordering service that is responsible for all the business logic related to the order process.</span></span> <span data-ttu-id="a0f22-237">También hay un servicio de catálogo y otro de cesta de la compra que implementan otras funciones.</span><span class="sxs-lookup"><span data-stu-id="a0f22-237">We also have the catalog service and the basket service that implement other capabilities.</span></span> <span data-ttu-id="a0f22-238">Idealmente, cada servicio solo debería tener un conjunto reducido de responsabilidades.</span><span class="sxs-lookup"><span data-stu-id="a0f22-238">Ideally, each service should have only a small set of responsibilities.</span></span> <span data-ttu-id="a0f22-239">Esto es similar al principio de responsabilidad única (SRP) aplicado a las clases, que indica que una clase solo debe tener un motivo para cambiar.</span><span class="sxs-lookup"><span data-stu-id="a0f22-239">This is similar to the single responsibility principle (SRP) applied to classes, which states that a class should only have one reason to change.</span></span> <span data-ttu-id="a0f22-240">Pero en este caso, se trata de microservicios, por lo que el ámbito será mayor que el de una sola clase.</span><span class="sxs-lookup"><span data-stu-id="a0f22-240">But in this case, it is about microservices, so the scope will be larger than a single class.</span></span> <span data-ttu-id="a0f22-241">Sobre todo, un microservicio tiene que ser completamente autónomo, de principio a fin, incluida la responsabilidad de sus propios orígenes de datos.</span><span class="sxs-lookup"><span data-stu-id="a0f22-241">Most of all, a microservice has to be completely autonomous, end to end, including responsibility for its own data sources.</span></span>

## <a name="external-versus-internal-architecture-and-design-patterns"></a><span data-ttu-id="a0f22-242">Diferencias entre patrones de arquitectura y diseño externos e internos</span><span class="sxs-lookup"><span data-stu-id="a0f22-242">External versus internal architecture and design patterns</span></span>

<span data-ttu-id="a0f22-243">La arquitectura externa es la arquitectura de microservicio compuesta por varios servicios, siguiendo los principios descritos en la sección sobre arquitectura de esta guía.</span><span class="sxs-lookup"><span data-stu-id="a0f22-243">The external architecture is the microservice architecture composed by multiple services, following the principles described in the architecture section of this guide.</span></span> <span data-ttu-id="a0f22-244">Pero en función de la naturaleza de cada microservicio y con independencia de la arquitectura general de microservicios que elija, es habitual y a veces aconsejable tener distintas arquitecturas internas, cada una basada en patrones diferentes, para los distintos microservicios.</span><span class="sxs-lookup"><span data-stu-id="a0f22-244">However, depending on the nature of each microservice, and independently of high-level microservice architecture you choose, it is common and sometimes advisable to have different internal architectures, each based on different patterns, for different microservices.</span></span> <span data-ttu-id="a0f22-245">Los microservicios incluso pueden usar tecnologías y lenguajes de programación diferentes.</span><span class="sxs-lookup"><span data-stu-id="a0f22-245">The microservices can even use different technologies and programming languages.</span></span> <span data-ttu-id="a0f22-246">En la figura 8-2 se ilustra esta diversidad.</span><span class="sxs-lookup"><span data-stu-id="a0f22-246">Figure 8-2 illustrates this diversity.</span></span>

![](./media/image2.png)

<span data-ttu-id="a0f22-247">**Figura 8-2**.</span><span class="sxs-lookup"><span data-stu-id="a0f22-247">**Figure 8-2**.</span></span> <span data-ttu-id="a0f22-248">Diferencias entre arquitectura y diseño externos e internos</span><span class="sxs-lookup"><span data-stu-id="a0f22-248">External versus internal architecture and design</span></span>

<span data-ttu-id="a0f22-249">En el ejemplo *eShopOnContainers*, los microservicios de catálogo, cesta de la compra y perfil de usuario son simples (básicamente subsistemas de CRUD).</span><span class="sxs-lookup"><span data-stu-id="a0f22-249">For instance, in our *eShopOnContainers* sample, the catalog, basket, and user profile microservices are simple (basically, CRUD subsystems).</span></span> <span data-ttu-id="a0f22-250">Por tanto, su arquitectura y diseño internos son sencillos.</span><span class="sxs-lookup"><span data-stu-id="a0f22-250">Therefore, their internal architecture and design is straightforward.</span></span> <span data-ttu-id="a0f22-251">Pero es posible que tenga otros microservicios, como el de pedidos, que sean más complejos y representen las reglas de negocios cambiantes con un alto grado de complejidad del dominio.</span><span class="sxs-lookup"><span data-stu-id="a0f22-251">However, you might have other microservices, such as the ordering microservice, which is more complex and represents ever-changing business rules with a high degree of domain complexity.</span></span> <span data-ttu-id="a0f22-252">En estos casos, es posible que le interese implementar modelos más avanzados dentro de un microservicio determinado, como los que se definen con los enfoques de diseño controlado por dominios (DDD), como se hace en el microservicio de pedidos de *eShopOnContainers*.</span><span class="sxs-lookup"><span data-stu-id="a0f22-252">In cases like these, you might want to implement more advanced patterns within a particular microservice, like the ones defined with domain-driven design (DDD) approaches, as we are doing in the *eShopOnContainers* ordering microservice.</span></span> <span data-ttu-id="a0f22-253">(Estos patrones de DDD se describirán más adelante en la sección en la que se explica la implementación del microservicio de pedidos de *eShopOnContainers*).</span><span class="sxs-lookup"><span data-stu-id="a0f22-253">(We will review these DDD patterns in the section later that explains the implementation of the *eShopOnContainers* ordering microservice.)</span></span>

<span data-ttu-id="a0f22-254">Otra razón para usar una tecnología distinta por microservicio podría ser la naturaleza de cada microservicio.</span><span class="sxs-lookup"><span data-stu-id="a0f22-254">Another reason for a different technology per microservice might be the nature of each microservice.</span></span> <span data-ttu-id="a0f22-255">Por ejemplo, podría ser mejor usar un lenguaje de programación funcional como F\#, o incluso un lenguaje como R si los dominios de destino son de IA y aprendizaje automático, en lugar de un lenguaje de programación más orientado a objetos como C\#.</span><span class="sxs-lookup"><span data-stu-id="a0f22-255">For example, it might be better to use a functional programming language like F\#, or even a language like R if you are targeting AI and machine learning domains, instead of a more object-oriented programming language like C\#.</span></span>

<span data-ttu-id="a0f22-256">La conclusión es que cada microservicio puede tener una arquitectura interna diferente basada en patrones de diseño diferentes.</span><span class="sxs-lookup"><span data-stu-id="a0f22-256">The bottom line is that each microservice can have a different internal architecture based on different design patterns.</span></span> <span data-ttu-id="a0f22-257">Para evitar la ingeniería excesiva de los microservicios, no todos deben implementarse mediante patrones de DDD avanzados.</span><span class="sxs-lookup"><span data-stu-id="a0f22-257">Not all microservices should be implemented using advanced DDD patterns, because that would be over-engineering them.</span></span> <span data-ttu-id="a0f22-258">Del mismo modo, los microservicios complejos con lógica de negocios cambiante no deberían implementarse como componentes CRUD o el resultado sería código de baja calidad.</span><span class="sxs-lookup"><span data-stu-id="a0f22-258">Similarly, complex microservices with ever-changing business logic should not be implemented as CRUD components, or you can end up with low-quality code.</span></span>



## <a name="the-new-world-multiple-architectural-patterns-and-polyglot-microservices"></a><span data-ttu-id="a0f22-259">El nuevo mundo: varios modelos arquitectónicos y microservicios políglotas</span><span class="sxs-lookup"><span data-stu-id="a0f22-259">The new world: multiple architectural patterns and polyglot microservices</span></span>

<span data-ttu-id="a0f22-260">Los desarrolladores y arquitectos de software usan muchos modelos arquitectónicos.</span><span class="sxs-lookup"><span data-stu-id="a0f22-260">There are many architectural patterns used by software architects and developers.</span></span> <span data-ttu-id="a0f22-261">Los siguientes son algunos de ellos (se combinan estilos y modelos arquitectónicos):</span><span class="sxs-lookup"><span data-stu-id="a0f22-261">The following are a few (mixing architecture styles and architecture patterns):</span></span>

-   <span data-ttu-id="a0f22-262">CRUD simple, de un nivel y una capa.</span><span class="sxs-lookup"><span data-stu-id="a0f22-262">Simple CRUD, single-tier, single-layer.</span></span>

-   <span data-ttu-id="a0f22-263">[Tradicional de N capas](https://msdn.microsoft.com/library/ee658109.aspx#Layers).</span><span class="sxs-lookup"><span data-stu-id="a0f22-263">[Traditional N-Layered](https://msdn.microsoft.com/library/ee658109.aspx#Layers).</span></span>

-   <span data-ttu-id="a0f22-264">[Diseño controlado por dominios de N capas](https://blogs.msdn.microsoft.com/cesardelatorre/2011/07/03/published-first-alpha-version-of-domain-oriented-n-layered-architecture-v2-0/).</span><span class="sxs-lookup"><span data-stu-id="a0f22-264">[Domain-Driven Design N-layered](https://blogs.msdn.microsoft.com/cesardelatorre/2011/07/03/published-first-alpha-version-of-domain-oriented-n-layered-architecture-v2-0/).</span></span>

-   <span data-ttu-id="a0f22-265">[Arquitectura limpia](https://8thlight.com/blog/uncle-bob/2012/08/13/the-clean-architecture.html) (como se usa con [eShopOnWeb](http://aka.ms/WebAppArchitecture))</span><span class="sxs-lookup"><span data-stu-id="a0f22-265">[Clean Architecture](https://8thlight.com/blog/uncle-bob/2012/08/13/the-clean-architecture.html) (as used with [eShopOnWeb](http://aka.ms/WebAppArchitecture))</span></span>

-   <span data-ttu-id="a0f22-266">[Segregación de responsabilidades de consultas de comandos](https://martinfowler.com/bliki/CQRS.html) (CQRS).</span><span class="sxs-lookup"><span data-stu-id="a0f22-266">[Command and Query Responsibility Segregation](https://martinfowler.com/bliki/CQRS.html) (CQRS).</span></span>

-   <span data-ttu-id="a0f22-267">[Arquitectura controlada por eventos](https://en.wikipedia.org/wiki/Event-driven_architecture) (EDA).</span><span class="sxs-lookup"><span data-stu-id="a0f22-267">[Event-Driven Architecture](https://en.wikipedia.org/wiki/Event-driven_architecture) (EDA).</span></span>

<span data-ttu-id="a0f22-268">También se pueden compilar microservicios con muchas tecnologías y lenguajes, como las API web de ASP.NET Core, NancyFx, ASP.NET Core SignalR (disponible con .NET Core 2), F\#, Node.js, Python, Java, C++, GoLang y muchos más.</span><span class="sxs-lookup"><span data-stu-id="a0f22-268">You can also build microservices with many technologies and languages, such as ASP.NET Core Web APIs, NancyFx, ASP.NET Core SignalR (available with .NET Core 2), F\#, Node.js, Python, Java, C++, GoLang, and more.</span></span>

<span data-ttu-id="a0f22-269">Lo importante es que ningún modelo o estilo arquitectónico determinado, ni ninguna tecnología concreta, es adecuado para todas las situaciones.</span><span class="sxs-lookup"><span data-stu-id="a0f22-269">The important point is that no particular architecture pattern or style, nor any particular technology, is right for all situations.</span></span> <span data-ttu-id="a0f22-270">En la figura 8-3 se muestran algunos enfoques y tecnologías (aunque en ningún orden concreto) que se pueden usar en microservicios diferentes.</span><span class="sxs-lookup"><span data-stu-id="a0f22-270">Figure 8-3 shows some approaches and technologies (although not in any particular order) that could be used in different microservices.</span></span>

![](./media/image3.png)

<span data-ttu-id="a0f22-271">**Figura 8-3**.</span><span class="sxs-lookup"><span data-stu-id="a0f22-271">**Figure 8-3**.</span></span> <span data-ttu-id="a0f22-272">Modelos arquitectónicos múltiples y el mundo de los microservicios políglotas</span><span class="sxs-lookup"><span data-stu-id="a0f22-272">Multi-architectural patterns and the polyglot microservices world</span></span>

<span data-ttu-id="a0f22-273">Como se muestra en la figura 8-3, en las aplicaciones formadas por muchos microservicios (contextos delimitados en terminología del diseño controlado por dominios, o simplemente "subsistemas" como microservicios autónomos), podría implementar cada microservicio de forma diferente.</span><span class="sxs-lookup"><span data-stu-id="a0f22-273">As shown in Figure 8-3, in applications composed of many microservices (Bounded Contexts in domain-driven design terminology, or simply “subsystems” as autonomous microservices), you might implement each microservice in a different way.</span></span> <span data-ttu-id="a0f22-274">Cada uno de ellos podría tener un modelo arquitectónico diferente y usar distintos lenguajes y bases de datos según la naturaleza de la aplicación, los requisitos empresariales y las prioridades.</span><span class="sxs-lookup"><span data-stu-id="a0f22-274">Each might have a different architecture pattern and use different languages and databases depending on the application’s nature, business requirements, and priorities.</span></span> <span data-ttu-id="a0f22-275">En algunos casos, es posible que los microservicios sean similares.</span><span class="sxs-lookup"><span data-stu-id="a0f22-275">In some cases, the microservices might be similar.</span></span> <span data-ttu-id="a0f22-276">Pero eso no es lo habitual, porque el límite del contexto y los requisitos de cada subsistema suelen ser diferentes.</span><span class="sxs-lookup"><span data-stu-id="a0f22-276">But that is not usually the case, because each subsystem’s context boundary and requirements are usually different.</span></span>

<span data-ttu-id="a0f22-277">Por ejemplo, para una aplicación de mantenimiento CRUD simple, es posible que no tenga sentido diseñar e implementar patrones de DDD.</span><span class="sxs-lookup"><span data-stu-id="a0f22-277">For instance, for a simple CRUD maintenance application, it might not make sense to design and implement DDD patterns.</span></span> <span data-ttu-id="a0f22-278">Pero para el dominio o el negocio principal, es posible que tenga que aplicar patrones más avanzados para abordar la complejidad empresarial con reglas de negocio cambiantes.</span><span class="sxs-lookup"><span data-stu-id="a0f22-278">But for your core domain or core business, you might need to apply more advanced patterns to tackle business complexity with ever-changing business rules.</span></span>

<span data-ttu-id="a0f22-279">Especialmente cuando se trabaja con aplicaciones de gran tamaño compuestas por varios subsistemas, no se debe aplicar una única arquitectura de nivel superior basada en un único modelo arquitectónico.</span><span class="sxs-lookup"><span data-stu-id="a0f22-279">Especially when you deal with large applications composed by multiple sub-systems, you should not apply a single top-level architecture based on a single architecture pattern.</span></span> <span data-ttu-id="a0f22-280">Por ejemplo, no se debe aplicar CQRS como arquitectura de nivel superior para una aplicación completa, pero podría ser útil para un conjunto específico de servicios.</span><span class="sxs-lookup"><span data-stu-id="a0f22-280">For instance, CQRS should not be applied as a top-level architecture for a whole application, but might be useful for a specific set of services.</span></span>

<span data-ttu-id="a0f22-281">No hay ninguna solución mágica ni un modelo arquitectónico correcto para cada caso concreto.</span><span class="sxs-lookup"><span data-stu-id="a0f22-281">There is no silver bullet or a right architecture pattern for every given case.</span></span> <span data-ttu-id="a0f22-282">No se puede tener "un modelo arquitectónico para dominarlos a todos".</span><span class="sxs-lookup"><span data-stu-id="a0f22-282">You cannot have “one architecture pattern to rule them all.”</span></span> <span data-ttu-id="a0f22-283">Según las prioridades de cada microservicio, tendrá que elegir un enfoque diferente para cada uno, como se explica en las secciones siguientes.</span><span class="sxs-lookup"><span data-stu-id="a0f22-283">Depending on the priorities of each microservice, you must choose a different approach for each, as explained in the following sections.</span></span>


>[!div class="step-by-step"]
<span data-ttu-id="a0f22-284">[Anterior] (index.md) [Siguiente] (data-driven-crud-microservice.md)</span><span class="sxs-lookup"><span data-stu-id="a0f22-284">[Previous] (index.md) [Next] (data-driven-crud-microservice.md)</span></span>
