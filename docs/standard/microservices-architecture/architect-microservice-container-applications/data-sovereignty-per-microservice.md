---
title: "Soberanía de datos por microservicio"
description: "Arquitectura de Microservicios de .NET para aplicaciones .NET en contenedores | Soberanía de datos por microservicio"
keywords: Docker, microservicios, ASP.NET, contenedor
author: CESARDELATORRE
ms.author: wiwagn
ms.date: 05/26/2017
ms.prod: .net-core
ms.technology: dotnet-docker
ms.topic: article
ms.openlocfilehash: c51daae04215cfa6f5b5b8d2158a8ed1a8949652
ms.sourcegitcommit: c2e216692ef7576a213ae16af2377cd98d1a67fa
ms.translationtype: HT
ms.contentlocale: es-ES
ms.lasthandoff: 10/22/2017
---
# <a name="data-sovereignty-per-microservice"></a><span data-ttu-id="d4b6a-104">Soberanía de datos por microservicio</span><span class="sxs-lookup"><span data-stu-id="d4b6a-104">Data sovereignty per microservice</span></span>

<span data-ttu-id="d4b6a-105">Una regla para la arquitectura de microservicios importante es que cada microservicio debe ser propietaria de sus datos de dominio y la lógica.</span><span class="sxs-lookup"><span data-stu-id="d4b6a-105">An important rule for microservices architecture is that each microservice must own its domain data and logic.</span></span> <span data-ttu-id="d4b6a-106">Igual que una aplicación completa posee su lógica y los datos, por lo que debe ser propietario cada microservicio su lógica y los datos en un ciclo de vida autónomo, con la implementación independiente por microservicio.</span><span class="sxs-lookup"><span data-stu-id="d4b6a-106">Just as a full application owns its logic and data, so must each microservice own its logic and data under an autonomous lifecycle, with independent deployment per microservice.</span></span>

<span data-ttu-id="d4b6a-107">Esto significa que el modelo conceptual del dominio se diferenciarán entre subsistemas o microservicios.</span><span class="sxs-lookup"><span data-stu-id="d4b6a-107">This means that the conceptual model of the domain will differ between subsystems or microservices.</span></span> <span data-ttu-id="d4b6a-108">Considere la posibilidad de aplicaciones de la empresa que relación administración cliente (CRM), aplicaciones, transaccionales adquieran los subsistemas y los subsistemas de soporte al cliente cada llamada en datos y atributos de la entidad de cliente único, y donde cada uno emplea otro Contexto enlazado (BC).</span><span class="sxs-lookup"><span data-stu-id="d4b6a-108">Consider enterprise applications, where customer relationship management (CRM) applications, transactional purchase subsystems, and customer support subsystems each call on unique customer entity attributes and data, and where each employs a different Bounded Context (BC).</span></span>

<span data-ttu-id="d4b6a-109">Este principio es similar en [diseño basado en dominio (DDD)](https://en.wikipedia.org/wiki/Domain-driven_design), donde cada [contexto limitado](https://martinfowler.com/bliki/BoundedContext.html) o subsistema autónomo o servicio debe ser propietaria de su modelo de dominio (datos más lógica y comportamiento).</span><span class="sxs-lookup"><span data-stu-id="d4b6a-109">This principle is similar in [Domain-driven design (DDD)](https://en.wikipedia.org/wiki/Domain-driven_design), where each [Bounded Context](https://martinfowler.com/bliki/BoundedContext.html) or autonomous subsystem or service must own its domain model (data plus logic and behavior).</span></span> <span data-ttu-id="d4b6a-110">Cada contexto limitado de DDD se correlaciona con un negocio microservicio (uno o varios servicios).</span><span class="sxs-lookup"><span data-stu-id="d4b6a-110">Each DDD Bounded Context correlates to one business microservice (one or several services).</span></span> <span data-ttu-id="d4b6a-111">(Se expanden en este punto sobre el patrón de contexto limitado en la sección siguiente).</span><span class="sxs-lookup"><span data-stu-id="d4b6a-111">(We expand on this point about the Bounded Context pattern in the next section.)</span></span>

<span data-ttu-id="d4b6a-112">Por otro lado, el enfoque tradicional (datos monolítico) usado en muchas aplicaciones es que una sola base de datos centralizada o unas pocas bases de datos.</span><span class="sxs-lookup"><span data-stu-id="d4b6a-112">On the other hand, the traditional (monolithic data) approach used in many applications is to have a single centralized database or just a few databases.</span></span> <span data-ttu-id="d4b6a-113">Esto suele ser una base de datos SQL normalizado que se usa para toda la aplicación y todas sus subsistemas internos, tal como se muestra en la figura 4-7.</span><span class="sxs-lookup"><span data-stu-id="d4b6a-113">This is often a normalized SQL database that is used for the whole application and all its internal subsystems, as shown in Figure 4-7.</span></span>

![](./media/image7.png)

<span data-ttu-id="d4b6a-114">**Figura 4-7**.</span><span class="sxs-lookup"><span data-stu-id="d4b6a-114">**Figure 4-7**.</span></span> <span data-ttu-id="d4b6a-115">Comparación de soberanía de datos: base de datos monolítico frente a microservicios</span><span class="sxs-lookup"><span data-stu-id="d4b6a-115">Data sovereignty comparison: monolithic database versus microservices</span></span>

<span data-ttu-id="d4b6a-116">El enfoque de la base de datos centralizada inicialmente es más sencillo y parece permitir la reutilización de las entidades de diferentes subsistemas para realizar todo coherente.</span><span class="sxs-lookup"><span data-stu-id="d4b6a-116">The centralized database approach initially looks simpler and seems to enable reuse of entities in different subsystems to make everything consistent.</span></span> <span data-ttu-id="d4b6a-117">Pero la realidad es que terminará con tablas muy grandes que sirven de muchos distintos subsistemas y que incluyen atributos y las columnas que no son necesarios en la mayoría de los casos.</span><span class="sxs-lookup"><span data-stu-id="d4b6a-117">But the reality is you end up with huge tables that serve many different subsystems, and that include attributes and columns that are not needed in most cases.</span></span> <span data-ttu-id="d4b6a-118">es como intentar usar la misma asignación física para excursionismo una pista corta, realizar un viaje de automóvil de día de duración y aprendizaje geography.</span><span class="sxs-lookup"><span data-stu-id="d4b6a-118">it is like trying to use the same physical map for hiking a short trail, taking a day-long car trip, and learning geography.</span></span>

<span data-ttu-id="d4b6a-119">Una aplicación normalmente de una base de datos relacional único monolítica presenta dos ventajas importantes: [transacciones ACID](https://en.wikipedia.org/wiki/ACID) y el lenguaje SQL, ambos trabajar a través de todas las tablas y los datos relacionados con la aplicación.</span><span class="sxs-lookup"><span data-stu-id="d4b6a-119">A monolithic application with typically a single relational database has two important benefits: [ACID transactions](https://en.wikipedia.org/wiki/ACID) and the SQL language, both working across all the tables and data related to your application.</span></span> <span data-ttu-id="d4b6a-120">Este enfoque proporciona una manera de escribir una consulta que combina los datos de varias tablas con facilidad.</span><span class="sxs-lookup"><span data-stu-id="d4b6a-120">This approach provides a way to easily write a query that combines data from multiple tables.</span></span>

<span data-ttu-id="d4b6a-121">Sin embargo, el acceso a datos es mucho más compleja cuando se mueve a una arquitectura de microservicios.</span><span class="sxs-lookup"><span data-stu-id="d4b6a-121">However, data access becomes much more complex when you move to a microservices architecture.</span></span> <span data-ttu-id="d4b6a-122">Pero incluso cuando las transacciones ACID pueden o deben utilizarse dentro de un microservicio o contexto limitado, los datos que pertenecen a cada microservicio es privados para ese microservicio y solo pueden obtenerse a través de su API de microservicio.</span><span class="sxs-lookup"><span data-stu-id="d4b6a-122">But even when ACID transactions can or should be used within a microservice or Bounded Context, the data owned by each microservice is private to that microservice and can only be accessed via its microservice API.</span></span> <span data-ttu-id="d4b6a-123">Encapsula los datos, se garantiza que el microservicios están acopladas y pueden evolucionar independientemente unas de otras.</span><span class="sxs-lookup"><span data-stu-id="d4b6a-123">Encapsulating the data ensures that the microservices are loosely coupled and can evolve independently of one another.</span></span> <span data-ttu-id="d4b6a-124">Si varios servicios se obtiene acceso a los mismos datos, las actualizaciones del esquema necesitaría coordina las actualizaciones a todos los servicios.</span><span class="sxs-lookup"><span data-stu-id="d4b6a-124">If multiple services were accessing the same data, schema updates would require coordinated updates to all the services.</span></span> <span data-ttu-id="d4b6a-125">Esto interrumpiría la autonomía de ciclo de vida de microservicio.</span><span class="sxs-lookup"><span data-stu-id="d4b6a-125">This would break the microservice lifecycle autonomy.</span></span> <span data-ttu-id="d4b6a-126">Pero las estructuras de datos distribuidos significan que no se puede realizar una única transacción ACID en microservicios.</span><span class="sxs-lookup"><span data-stu-id="d4b6a-126">But distributed data structures mean that you cannot make a single ACID transaction across microservices.</span></span> <span data-ttu-id="d4b6a-127">A su vez, esto significa que debe utilizar coherencia definitiva cuando un proceso empresarial abarque varios microservicios.</span><span class="sxs-lookup"><span data-stu-id="d4b6a-127">This in turn means you must use eventual consistency when a business process spans multiple microservices.</span></span> <span data-ttu-id="d4b6a-128">Esto es mucho más difícil implementar que simple combinaciones de SQL; de forma similar, muchas otras características de base de datos relacional no están disponibles a través de varios microservicios.</span><span class="sxs-lookup"><span data-stu-id="d4b6a-128">This is much harder to implement than simple SQL joins; similarly, many other relational database features are not available across multiple microservices.</span></span>

<span data-ttu-id="d4b6a-129">Va aún más, microservicios diferentes a menudo usan distintos *tipos* de bases de datos.</span><span class="sxs-lookup"><span data-stu-id="d4b6a-129">Going even further, different microservices often use different *kinds* of databases.</span></span> <span data-ttu-id="d4b6a-130">Almacén de aplicaciones modernas y proceso diversos tipos de datos y una base de datos relacional no siempre es la mejor opción.</span><span class="sxs-lookup"><span data-stu-id="d4b6a-130">Modern applications store and process diverse kinds of data, and a relational database is not always the best choice.</span></span> <span data-ttu-id="d4b6a-131">En algunos casos de uso, una base de datos NoSQL, como documentos de Azure o MongoDB podría tener un modelo de datos más cómodo y ofrecen un mejor rendimiento y la escalabilidad de una base de datos SQL como SQL Server o base de datos de SQL Azure.</span><span class="sxs-lookup"><span data-stu-id="d4b6a-131">For some use cases, a NoSQL database such as Azure DocumentDB or MongoDB might have a more convenient data model and offer better performance and scalability than a SQL database like SQL Server or Azure SQL Database.</span></span> <span data-ttu-id="d4b6a-132">En otros casos, una base de datos relacional sigue siendo el mejor método.</span><span class="sxs-lookup"><span data-stu-id="d4b6a-132">In other cases, a relational database is still the best approach.</span></span> <span data-ttu-id="d4b6a-133">Por lo tanto, las aplicaciones basadas en microservicios suele utilizan una combinación de bases de datos SQL y NoSQL, que a veces se denomina la [polyglot persistencia](http://martinfowler.com/bliki/PolyglotPersistence.html) enfoque.</span><span class="sxs-lookup"><span data-stu-id="d4b6a-133">Therefore, microservices-based applications often use a mixture of SQL and NoSQL databases, which is sometimes called the [polyglot persistence](http://martinfowler.com/bliki/PolyglotPersistence.html) approach.</span></span>

<span data-ttu-id="d4b6a-134">Una arquitectura con particiones, polyglot persistentes para el almacenamiento de datos tiene muchas ventajas.</span><span class="sxs-lookup"><span data-stu-id="d4b6a-134">A partitioned, polyglot-persistent architecture for data storage has many benefits.</span></span> <span data-ttu-id="d4b6a-135">Estos incluyen servicios de acoplamiento flexible y un mejor rendimiento, escalabilidad, costos y facilidad de uso.</span><span class="sxs-lookup"><span data-stu-id="d4b6a-135">These include loosely coupled services and better performance, scalability, costs, and manageability.</span></span> <span data-ttu-id="d4b6a-136">Sin embargo, se pueden introducir algunos desafíos de administración de datos distribuidos, tal y como se explicará en "[identifica los límites del modelo de dominio](#identifying-domain-model-boundaries-for-each-microservice)" más adelante en este capítulo.</span><span class="sxs-lookup"><span data-stu-id="d4b6a-136">However, it can introduce some distributed data management challenges, as we will explain in “[Identifying domain-model boundaries](#identifying-domain-model-boundaries-for-each-microservice)” later in this chapter.</span></span>

## <a name="the-relationship-between-microservices-and-the-bounded-context-pattern"></a><span data-ttu-id="d4b6a-137">La relación entre microservicios y el patrón de contexto limitado</span><span class="sxs-lookup"><span data-stu-id="d4b6a-137">The relationship between microservices and the Bounded Context pattern</span></span>

<span data-ttu-id="d4b6a-138">El concepto de microservicio se deriva de la [patrón contexto limitado (BC)](http://martinfowler.com/bliki/BoundedContext.html) en [diseño basado en dominio (DDD)](https://en.wikipedia.org/wiki/Domain-driven_design).</span><span class="sxs-lookup"><span data-stu-id="d4b6a-138">The concept of microservice derives from the [Bounded Context (BC) pattern](http://martinfowler.com/bliki/BoundedContext.html) in [domain-driven design (DDD)](https://en.wikipedia.org/wiki/Domain-driven_design).</span></span> <span data-ttu-id="d4b6a-139">DDD trabaja con modelos grandes clasificándolos en varios BCs y sean explícitos sobre sus límites.</span><span class="sxs-lookup"><span data-stu-id="d4b6a-139">DDD deals with large models by dividing them into multiple BCs and being explicit about their boundaries.</span></span> <span data-ttu-id="d4b6a-140">Cada BC debe tener su propio modelo y la base de datos; del mismo modo, cada microservicio posee los datos relacionados.</span><span class="sxs-lookup"><span data-stu-id="d4b6a-140">Each BC must have its own model and database; likewise, each microservice owns its related data.</span></span> <span data-ttu-id="d4b6a-141">Además, cada BC normalmente tiene su propio [lenguaje ubicuo](http://martinfowler.com/bliki/UbiquitousLanguage.html) para la comunicación entre los desarrolladores de software y los expertos de dominio.</span><span class="sxs-lookup"><span data-stu-id="d4b6a-141">In addition, each BC usually has its own [ubiquitous language](http://martinfowler.com/bliki/UbiquitousLanguage.html) to help communication between software developers and domain experts.</span></span>

<span data-ttu-id="d4b6a-142">Dichos términos (principalmente entidades de dominio) en el lenguaje ubicuo pueden tener nombres diferentes en diferentes contextos limitado, entidades de dominio aunque diferentes comparten la misma identidad (es decir, el identificador único que se utiliza para leer la entidad de almacenamiento).</span><span class="sxs-lookup"><span data-stu-id="d4b6a-142">Those terms (mainly domain entities) in the ubiquitous language can have different names in different Bounded Contexts, even when different domain entities share the same identity (that is, the unique ID that is used to read the entity from storage).</span></span> <span data-ttu-id="d4b6a-143">Por ejemplo, en un contexto limitado de perfil de usuario, la entidad de dominio de usuario puede compartir identidad con la entidad de dominio de comprador en el contexto limitado ordenación.</span><span class="sxs-lookup"><span data-stu-id="d4b6a-143">For instance, in a user-profile Bounded Context, the User domain entity might share identity with the Buyer domain entity in the ordering Bounded Context.</span></span>

<span data-ttu-id="d4b6a-144">Un microservicio es, por tanto, al igual que un contexto limitado, pero también especifica que es un servicio distribuido.</span><span class="sxs-lookup"><span data-stu-id="d4b6a-144">A microservice is therefore like a Bounded Context, but it also specifies that it is a distributed service.</span></span> <span data-ttu-id="d4b6a-145">Se compila como un proceso independiente para cada contexto limitado y debe utilizar los protocolos distribuidos se ha indicado anteriormente, como HTTP/HTTPS, WebSockets, o [AMQP](https://en.wikipedia.org/wiki/Advanced_Message_Queuing_Protocol).</span><span class="sxs-lookup"><span data-stu-id="d4b6a-145">It is built as a separate process for each Bounded Context, and it must use the distributed protocols noted earlier, like HTTP/HTTPS, WebSockets, or [AMQP](https://en.wikipedia.org/wiki/Advanced_Message_Queuing_Protocol).</span></span> <span data-ttu-id="d4b6a-146">El patrón de contexto limitado, sin embargo, no especifica si el contexto limitado es un servicio distribuido o si es simplemente un límite lógico (por ejemplo, un subsistema genérico) dentro de una aplicación de implementación monolítico.</span><span class="sxs-lookup"><span data-stu-id="d4b6a-146">The Bounded Context pattern, however, does not specify whether the Bounded Context is a distributed service or if it is simply a logical boundary (such as a generic subsystem) within a monolithic-deployment application.</span></span>

<span data-ttu-id="d4b6a-147">Es importante resaltar que la definición de un servicio para cada contexto limitado es un buen lugar para comenzar.</span><span class="sxs-lookup"><span data-stu-id="d4b6a-147">It is important to highlight that defining a service for each Bounded Context is a good place to start.</span></span> <span data-ttu-id="d4b6a-148">Pero no es necesario restringir su diseño a él.</span><span class="sxs-lookup"><span data-stu-id="d4b6a-148">But you do not have to constrain your design to it.</span></span> <span data-ttu-id="d4b6a-149">A veces, debe diseñar un contexto limitado o business microservicio formada por varios servicios físicos.</span><span class="sxs-lookup"><span data-stu-id="d4b6a-149">Sometimes you must design a Bounded Context or business microservice composed of several physical services.</span></span> <span data-ttu-id="d4b6a-150">Pero en última instancia, ambos patrones: contexto limitado y microservicio: están estrechamente relacionados.</span><span class="sxs-lookup"><span data-stu-id="d4b6a-150">But ultimately, both patterns—Bounded Context and microservice—are closely related.</span></span>

<span data-ttu-id="d4b6a-151">DDD se beneficia de microservicios obteniendo límites reales en forma de microservicios distribuida.</span><span class="sxs-lookup"><span data-stu-id="d4b6a-151">DDD benefits from microservices by getting real boundaries in the form of distributed microservices.</span></span> <span data-ttu-id="d4b6a-152">Pero ideas como el uso no compartido el modelo entre microservicios son las que también desea en un contexto limitado.</span><span class="sxs-lookup"><span data-stu-id="d4b6a-152">But ideas like not sharing the model between microservices are what you also want in a Bounded Context.</span></span>

### <a name="additional-resources"></a><span data-ttu-id="d4b6a-153">Recursos adicionales</span><span class="sxs-lookup"><span data-stu-id="d4b6a-153">Additional resources</span></span>

-   <span data-ttu-id="d4b6a-154">**Chris Richardson. Patrón: La base de datos por cada servicio**
    [*http://microservices.io/patterns/data/database-per-service.html*](http://microservices.io/patterns/data/database-per-service.html)</span><span class="sxs-lookup"><span data-stu-id="d4b6a-154">**Chris Richardson. Pattern: Database per service**
[*http://microservices.io/patterns/data/database-per-service.html*](http://microservices.io/patterns/data/database-per-service.html)</span></span>

-   <span data-ttu-id="d4b6a-155">**Martin Fowler. BoundedContext**
    [*http://martinfowler.com/bliki/BoundedContext.html*](http://martinfowler.com/bliki/BoundedContext.html)</span><span class="sxs-lookup"><span data-stu-id="d4b6a-155">**Martin Fowler. BoundedContext**
[*http://martinfowler.com/bliki/BoundedContext.html*](http://martinfowler.com/bliki/BoundedContext.html)</span></span>

-   <span data-ttu-id="d4b6a-156">**Martin Fowler. PolyglotPersistence**
    [*http://martinfowler.com/bliki/PolyglotPersistence.html*](http://martinfowler.com/bliki/PolyglotPersistence.html)</span><span class="sxs-lookup"><span data-stu-id="d4b6a-156">**Martin Fowler. PolyglotPersistence**
[*http://martinfowler.com/bliki/PolyglotPersistence.html*](http://martinfowler.com/bliki/PolyglotPersistence.html)</span></span>

-   <span data-ttu-id="d4b6a-157">**Alberto Brandolini. Dominio estratégico controlada por diseño con la asignación de contexto**
    [*https://www.infoq.com/articles/ddd-contextmapping*](https://www.infoq.com/articles/ddd-contextmapping)</span><span class="sxs-lookup"><span data-stu-id="d4b6a-157">**Alberto Brandolini. Strategic Domain Driven Design with Context Mapping**
[*https://www.infoq.com/articles/ddd-contextmapping*](https://www.infoq.com/articles/ddd-contextmapping)</span></span>


>[!div class="step-by-step"]
<span data-ttu-id="d4b6a-158">[Anterior] (microservicios-architecture.md) [siguiente] (lógico-frente a-física-architecture.md)</span><span class="sxs-lookup"><span data-stu-id="d4b6a-158">[Previous] (microservices-architecture.md) [Next] (logical-versus-physical-architecture.md)</span></span>
