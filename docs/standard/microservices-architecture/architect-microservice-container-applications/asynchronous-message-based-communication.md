---
title: "Comunicación basada en mensajes asíncronos"
description: "Arquitectura de Microservicios de .NET para aplicaciones .NET en contenedores | Comunicación basada en mensajes asíncronos"
keywords: Docker, microservicios, ASP.NET, contenedor
author: CESARDELATORRE
ms.author: wiwagn
ms.date: 05/26/2017
ms.prod: .net-core
ms.technology: dotnet-docker
ms.topic: article
ms.openlocfilehash: df39771295d12e122edbe27e91cd899e3318e301
ms.sourcegitcommit: c2e216692ef7576a213ae16af2377cd98d1a67fa
ms.translationtype: HT
ms.contentlocale: es-ES
ms.lasthandoff: 10/22/2017
---
# <a name="asynchronous-message-based-communication"></a><span data-ttu-id="fba04-104">Comunicación basada en mensajes asíncronos</span><span class="sxs-lookup"><span data-stu-id="fba04-104">Asynchronous message-based communication</span></span>

<span data-ttu-id="fba04-105">Mensajería asincrónica y comunicación orientada a eventos son fundamentales para propagar cambios a través de varios microservicios y sus modelos de dominio relacionadas.</span><span class="sxs-lookup"><span data-stu-id="fba04-105">Asynchronous messaging and event-driven communication are critical when propagating changes across multiple microservices and their related domain models.</span></span> <span data-ttu-id="fba04-106">Como se mencionó anteriormente en la discusión microservicios y los contextos limitado (BCs), modelos (usuario, cliente, producto, cuenta, etc.) pueden tener diferentes implicaciones para microservicios diferente o BCs.</span><span class="sxs-lookup"><span data-stu-id="fba04-106">As mentioned earlier in the discussion microservices and Bounded Contexts (BCs), models (User, Customer, Product, Account, etc.) can mean different things to different microservices or BCs.</span></span> <span data-ttu-id="fba04-107">Esto significa que, cuando se producen cambios, se necesita alguna manera para conciliar los cambios a través de los diferentes modelos.</span><span class="sxs-lookup"><span data-stu-id="fba04-107">That means that when changes occur, you need some way to reconcile changes across the different models.</span></span> <span data-ttu-id="fba04-108">Una solución es coherencia definitiva y comunicación orientada a eventos en función de mensajería asíncrona.</span><span class="sxs-lookup"><span data-stu-id="fba04-108">A solution is eventual consistency and event-driven communication based on asynchronous messaging.</span></span>

<span data-ttu-id="fba04-109">Cuando se usa mensajería, los procesos se comunican mediante el intercambio de mensajes de forma asincrónica.</span><span class="sxs-lookup"><span data-stu-id="fba04-109">When using messaging, processes communicate by exchanging messages asynchronously.</span></span> <span data-ttu-id="fba04-110">Un cliente realiza un comando o una solicitud a un servicio mediante el envío de un mensaje.</span><span class="sxs-lookup"><span data-stu-id="fba04-110">A client makes a command or a request to a service by sending it a message.</span></span> <span data-ttu-id="fba04-111">Si el servicio debe responder, envía un mensaje diferente al cliente.</span><span class="sxs-lookup"><span data-stu-id="fba04-111">If the service needs to reply, it sends a different message back to the client.</span></span> <span data-ttu-id="fba04-112">Puesto que es una comunicación basada en mensajes, el cliente supone que la respuesta no se recibirán inmediatamente y que no puede haber ninguna respuesta en absoluto.</span><span class="sxs-lookup"><span data-stu-id="fba04-112">Since it is a message-based communication, the client assumes that the reply will not be received immediately, and that there might be no response at all.</span></span>

<span data-ttu-id="fba04-113">Un mensaje está compuesto por un encabezado (metadatos como la información de identificación o seguridad) y un cuerpo.</span><span class="sxs-lookup"><span data-stu-id="fba04-113">A message is composed by a header (metadata such as identification or security information) and a body.</span></span> <span data-ttu-id="fba04-114">Los mensajes se envían normalmente a través de protocolos asincrónicas como AMQP.</span><span class="sxs-lookup"><span data-stu-id="fba04-114">Messages are usually sent through asynchronous protocols like AMQP.</span></span>

<span data-ttu-id="fba04-115">La infraestructura preferida para este tipo de comunicación en la Comunidad de microservicios es un agente de mensaje ligera, que es diferente a los corredores de bolsa grandes y orchestrators utilizados en SOA.</span><span class="sxs-lookup"><span data-stu-id="fba04-115">The preferred infrastructure for this type of communication in the microservices community is a lightweight message broker, which is different than the large brokers and orchestrators used in SOA.</span></span> <span data-ttu-id="fba04-116">Un agente de mensaje ligera, de la infraestructura es normalmente "simple," actúa como un agente de mensajes, con implementaciones sencillas, como RabbitMQ o un bus de servicio escalables en la nube como Azure Service Bus.</span><span class="sxs-lookup"><span data-stu-id="fba04-116">In a lightweight message broker, the infrastructure is typically “dumb,” acting only as a message broker, with simple implementations such as RabbitMQ or a scalable service bus in the cloud like Azure Service Bus.</span></span> <span data-ttu-id="fba04-117">En este escenario, la mayoría de las ideas "inteligentes" sigue vive en los puntos de conexión que se forma de generar y consumir mensajes, es decir, en la microservicios.</span><span class="sxs-lookup"><span data-stu-id="fba04-117">In this scenario, most of the “smart” thinking still lives in the endpoints that are producing and consuming messages—that is, in the microservices.</span></span>

<span data-ttu-id="fba04-118">Otra regla que debe intentar seguir, tanto como sea posible, es que se va a usar la mensajería asincrónica solo entre los servicios internos como utilizan la comunicación sincrónica (como HTTP) solo desde las aplicaciones de cliente con los servicios front-end (puertas de enlace de API y el primer nivel de microservicios).</span><span class="sxs-lookup"><span data-stu-id="fba04-118">Another rule you should try to follow, as much as possible, is to use only asynchronous messaging between the internal services, and to use synchronous communication (such as HTTP) only from the client apps to the front-end services (API Gateways plus the first level of microservices).</span></span>

<span data-ttu-id="fba04-119">Hay dos tipos de comunicación de mensajería asincrónica: comunicación basada en mensajes de receptor único y comunicación basada en mensajes de varios receptores.</span><span class="sxs-lookup"><span data-stu-id="fba04-119">There are two kinds of asynchronous messaging communication: single receiver message-based communication, and multiple receivers message-based communication.</span></span> <span data-ttu-id="fba04-120">En las secciones siguientes se proporcionan detalles acerca de ellos.</span><span class="sxs-lookup"><span data-stu-id="fba04-120">In the following sections we provide details about them.</span></span>

## <a name="single-receiver-message-based-communication"></a><span data-ttu-id="fba04-121">Comunicación basada en mensajes de receptor único</span><span class="sxs-lookup"><span data-stu-id="fba04-121">Single-receiver message-based communication</span></span> 

<span data-ttu-id="fba04-122">Comunicación asincrónica basada en mensajes con un único receptor significa que no hay comunicación punto a punto que entrega un mensaje exactamente uno de los consumidores que está leyendo en el canal, y que el mensaje se procesa solo una vez.</span><span class="sxs-lookup"><span data-stu-id="fba04-122">Message-based asynchronous communication with a single receiver means there is point-to-point communication that delivers a message to exactly one of the consumers that is reading from the channel, and that the message is processed just once.</span></span> <span data-ttu-id="fba04-123">Sin embargo, hay situaciones especiales.</span><span class="sxs-lookup"><span data-stu-id="fba04-123">However, there are special situations.</span></span> <span data-ttu-id="fba04-124">Por ejemplo, en un sistema de nube que intenta recuperarse automáticamente de los errores, el mismo mensaje se pudo enviar varias veces.</span><span class="sxs-lookup"><span data-stu-id="fba04-124">For instance, in a cloud system that tries to automatically recover from failures, the same message could be sent multiple times.</span></span> <span data-ttu-id="fba04-125">Debido a la red u otros errores, el cliente tiene que volver a intentar el envío de mensajes y el servidor tiene que implementar una operación para ser idempotente para procesar un mensaje concreto de una sola vez.</span><span class="sxs-lookup"><span data-stu-id="fba04-125">Due to network or other failures, the client has to be able to retry sending messages, and the server has to implement an operation to be idempotent in order to process a particular message just once.</span></span>

<span data-ttu-id="fba04-126">Comunicación basada en mensajes de receptor único es especialmente idónea para enviar comandos asincrónicos de uno microservicio a otro como se muestra en la figura 4-18 que muestra este enfoque.</span><span class="sxs-lookup"><span data-stu-id="fba04-126">Single-receiver message-based communication is especially well suited for sending asynchronous commands from one microservice to another as shown in Figure 4-18 that illustrates this approach.</span></span>

<span data-ttu-id="fba04-127">Una vez que empezar a enviar la comunicación basada en mensajes (ya sea con comandos o eventos), no debe mezclar la comunicación basada en mensajes con comunicación sincrónica de HTTP.</span><span class="sxs-lookup"><span data-stu-id="fba04-127">Once you start sending message-based communication (either with commands or events), you should avoid mixing message-based communication with synchronous HTTP communication.</span></span>

![](./media/image18.PNG)

<span data-ttu-id="fba04-128">**Figura 4-18**.</span><span class="sxs-lookup"><span data-stu-id="fba04-128">**Figure 4-18**.</span></span> <span data-ttu-id="fba04-129">Un único microservicio recibe un mensaje asincrónico</span><span class="sxs-lookup"><span data-stu-id="fba04-129">A single microservice receiving an asynchronous message</span></span>

<span data-ttu-id="fba04-130">Tenga en cuenta que cuando los comandos proceden de las aplicaciones cliente, puede implementarse como comandos sincrónicos de HTTP.</span><span class="sxs-lookup"><span data-stu-id="fba04-130">Note that when the commands come from client applications, they can be implemented as HTTP synchronous commands.</span></span> <span data-ttu-id="fba04-131">Debe utilizar comandos basada en mensajes cuando necesite una mayor escalabilidad o cuando ya esté en un proceso empresarial basada en mensajes.</span><span class="sxs-lookup"><span data-stu-id="fba04-131">You should use message-based commands when you need higher scalability or when you are already in a message-based business process.</span></span>

## <a name="multiple-receivers-message-based-communication"></a><span data-ttu-id="fba04-132">Comunicación basada en mensajes de varios receptores</span><span class="sxs-lookup"><span data-stu-id="fba04-132">Multiple-receivers message-based communication</span></span> 

<span data-ttu-id="fba04-133">Como un enfoque más flexible, también puede usar un mecanismo de publicación/suscripción para que la comunicación desde el remitente estará disponible para microservicios suscriptor adicionales o para las aplicaciones externas.</span><span class="sxs-lookup"><span data-stu-id="fba04-133">As a more flexible approach, you might also want to use a publish/subscribe mechanism so that your communication from the sender will be available to additional subscriber microservices or to external applications.</span></span> <span data-ttu-id="fba04-134">Por lo tanto, le ayudará a seguir la [abrir/cerrar principio](https://en.wikipedia.org/wiki/Open/closed_principle) en el servicio de envío.</span><span class="sxs-lookup"><span data-stu-id="fba04-134">Thus, it helps you to follow the [open/closed principle](https://en.wikipedia.org/wiki/Open/closed_principle) in the sending service.</span></span> <span data-ttu-id="fba04-135">De este modo, los suscriptores adicionales pueden agregarse en el futuro sin necesidad de modificar el servicio del remitente.</span><span class="sxs-lookup"><span data-stu-id="fba04-135">That way, additional subscribers can be added in the future without the need to modify the sender service.</span></span>

<span data-ttu-id="fba04-136">Si utiliza una comunicación de publicación/suscripción, puede que esté usando una interfaz de bus de eventos a eventos de publicación para los suscriptores.</span><span class="sxs-lookup"><span data-stu-id="fba04-136">When you use a publish/subscribe communication, you might be using an event bus interface to publish events to any subscriber.</span></span>

## <a name="asynchronous-event-driven-communication"></a><span data-ttu-id="fba04-137">Comunicación asincrónica orientada a eventos</span><span class="sxs-lookup"><span data-stu-id="fba04-137">Asynchronous event-driven communication</span></span>

<span data-ttu-id="fba04-138">Cuando se utiliza la comunicación asincrónica orientada a eventos, un microservicio publica un evento cuando sucede algo dentro de su dominio y otro microservicio debe tener en cuenta que, al igual que un cambio de precio en un microservicio del catálogo de productos de integración.</span><span class="sxs-lookup"><span data-stu-id="fba04-138">When using asynchronous event-driven communication, a microservice publishes an integration event when something happens within its domain and another microservice needs to be aware of it, like a price change in a product catalog microservice.</span></span> <span data-ttu-id="fba04-139">Microservicios adicionales suscriben a los eventos para que puedan recibir de forma asincrónica.</span><span class="sxs-lookup"><span data-stu-id="fba04-139">Additional microservices subscribe to the events so they can receive them asynchronously.</span></span> <span data-ttu-id="fba04-140">Cuando esto ocurre, los receptores pueden actualizar sus propias entidades de dominio, lo que pueden producir más eventos de integración para su publicación.</span><span class="sxs-lookup"><span data-stu-id="fba04-140">When that happens, the receivers might update their own domain entities, which can cause more integration events to be published.</span></span> <span data-ttu-id="fba04-141">Este sistema de publicación/suscripción normalmente se realiza mediante una implementación de un bus de eventos.</span><span class="sxs-lookup"><span data-stu-id="fba04-141">This publish/subscribe system is usually performed by using an implementation of an event bus.</span></span> <span data-ttu-id="fba04-142">El bus de eventos pueden diseñarse como una abstracción o interfaz, pero con la API que es necesario suscribirse o cancelar la suscripción a eventos y para publicar los eventos.</span><span class="sxs-lookup"><span data-stu-id="fba04-142">The event bus can be designed as an abstraction or interface, with the API that is needed to subscribe or unsubscribe to events and to publish events.</span></span> <span data-ttu-id="fba04-143">El bus de eventos también puede tener uno o más implementaciones en función de cualquier agente entre procesos y mensajería, como una cola de mensajes o un bus de servicio que admite la comunicación asincrónica y un modelo de publicación/suscripción.</span><span class="sxs-lookup"><span data-stu-id="fba04-143">The event bus can also have one or more implementations based on any inter-process and messaging broker, like a messaging queue or service bus that supports asynchronous communication and a publish/subscribe model.</span></span>

<span data-ttu-id="fba04-144">Si un sistema utiliza coherencia definitiva controlada por eventos de integración, se recomienda que este enfoque se realizar absolutamente nada para el usuario final.</span><span class="sxs-lookup"><span data-stu-id="fba04-144">If a system uses eventual consistency driven by integration events, it is recommended that this approach be made completely clear to the end user.</span></span> <span data-ttu-id="fba04-145">El sistema no debe usar un enfoque que se asemeje a eventos de integración, como SignalR o sistemas de sondeo desde el cliente.</span><span class="sxs-lookup"><span data-stu-id="fba04-145">The system should not use an approach that mimics integration events, like SignalR or polling systems from the client.</span></span> <span data-ttu-id="fba04-146">El usuario final y el propietario de la empresa tienen explícitamente adoptar coherencia definitiva en el sistema y tenga en cuenta que, en muchos casos la empresa no tiene ningún problema con este enfoque, siempre que sea explícita.</span><span class="sxs-lookup"><span data-stu-id="fba04-146">The end user and the business owner have to explicitly embrace eventual consistency in the system and realize that in many cases the business does not have any problem with this approach, as long as it is explicit.</span></span>

<span data-ttu-id="fba04-147">Como se ha indicado anteriormente en la [desafíos y soluciones de administración de datos de distribuida](#challenges-and-solutions-for-distributed-data-management) sección, puede usar eventos de integración para implementar tareas de negocio que abarcan varios microservicios.</span><span class="sxs-lookup"><span data-stu-id="fba04-147">As noted earlier in the [Challenges and solutions for distributed data management](#challenges-and-solutions-for-distributed-data-management) section, you can use integration events to implement business tasks that span multiple microservices.</span></span> <span data-ttu-id="fba04-148">Por lo tanto, tendrá coherencia definitiva entre dichos servicios.</span><span class="sxs-lookup"><span data-stu-id="fba04-148">Thus you will have eventual consistency between those services.</span></span> <span data-ttu-id="fba04-149">Una transacción coherente se compone de una colección de acciones distribuidas.</span><span class="sxs-lookup"><span data-stu-id="fba04-149">An eventually consistent transaction is made up of a collection of distributed actions.</span></span> <span data-ttu-id="fba04-150">En cada acción, el microservicio relacionado actualiza una entidad de dominio y publica otro evento de integración que genera la siguiente acción dentro de la misma tarea to-end.</span><span class="sxs-lookup"><span data-stu-id="fba04-150">At each action, the related microservice updates a domain entity and publishes another integration event that raises the next action within the same end-to-end business task.</span></span>

<span data-ttu-id="fba04-151">Un punto importante es que puede comunicarse con varios microservicios que están suscrito el mismo evento.</span><span class="sxs-lookup"><span data-stu-id="fba04-151">An important point is that you might want to communicate to multiple microservices that are subscribed to the same event.</span></span> <span data-ttu-id="fba04-152">Para ello, puede usar la publicación/suscripción de mensajería basado en la comunicación orientada a eventos, como se muestra en la figura 4-19.</span><span class="sxs-lookup"><span data-stu-id="fba04-152">To do so, you can use publish/subscribe messaging based on event-driven communication, as shown in Figure 4-19.</span></span> <span data-ttu-id="fba04-153">Este mecanismo de publicación/suscripción no es exclusivo de la arquitectura de microservicio.</span><span class="sxs-lookup"><span data-stu-id="fba04-153">This publish/subscribe mechanism is not exclusive to the microservice architecture.</span></span> <span data-ttu-id="fba04-154">Es similar a la forma en que [limitado contextos](http://martinfowler.com/bliki/BoundedContext.html) en DDD debe comunicarse o a la forma en que se propagan las actualizaciones de la base de datos de escritura a la base de datos de lectura en el [comando y la segregación de responsabilidad de consulta (CQRS)](http://martinfowler.com/bliki/CQRS.html)patrón de arquitectura.</span><span class="sxs-lookup"><span data-stu-id="fba04-154">It is similar to the way [Bounded Contexts](http://martinfowler.com/bliki/BoundedContext.html) in DDD should communicate, or to the way you propagate updates from the write database to the read database in the [Command and Query Responsibility Segregation (CQRS)](http://martinfowler.com/bliki/CQRS.html) architecture pattern.</span></span> <span data-ttu-id="fba04-155">El objetivo es tener la coherencia entre varios orígenes de datos a través de su sistema distribuido.</span><span class="sxs-lookup"><span data-stu-id="fba04-155">The goal is to have eventual consistency between multiple data sources across your distributed system.</span></span>

![](./media/image19.png)

<span data-ttu-id="fba04-156">**Figura 4-19**.</span><span class="sxs-lookup"><span data-stu-id="fba04-156">**Figure 4-19**.</span></span> <span data-ttu-id="fba04-157">Comunicación asincrónica de mensajes controlada por eventos</span><span class="sxs-lookup"><span data-stu-id="fba04-157">Asynchronous event-driven message communication</span></span>

<span data-ttu-id="fba04-158">Su implementación determinará qué protocolo que se usará para las comunicaciones orientadas a eventos, basada en mensajes.</span><span class="sxs-lookup"><span data-stu-id="fba04-158">Your implementation will determine what protocol to use for event-driven, message-based communications.</span></span> <span data-ttu-id="fba04-159">[AMQP](https://en.wikipedia.org/wiki/Advanced_Message_Queuing_Protocol) puede ayudar a lograr una comunicación en cola confiable.</span><span class="sxs-lookup"><span data-stu-id="fba04-159">[AMQP](https://en.wikipedia.org/wiki/Advanced_Message_Queuing_Protocol) can help achieve reliable queued communication.</span></span>

<span data-ttu-id="fba04-160">Al usar un bus de eventos, puede utilizar un nivel de abstracción (por ejemplo, una interfaz de bus de eventos) basado en una implementación en las clases relacionada con código que usa la API de un agente de mensajes como [RabbitMQ](https://www.rabbitmq.com/) o un bus de servicio como [Bus de servicio de azure con temas](https://docs.microsoft.com/azure/service-bus-messaging/service-bus-dotnet-how-to-use-topics-subscriptions).</span><span class="sxs-lookup"><span data-stu-id="fba04-160">When you use an event bus, you might want to use an abstraction level (like an event bus interface) based on a related implementation in classes with code using the API from a message broker like [RabbitMQ](https://www.rabbitmq.com/) or a service bus like [Azure Service Bus with Topics](https://docs.microsoft.com/azure/service-bus-messaging/service-bus-dotnet-how-to-use-topics-subscriptions).</span></span> <span data-ttu-id="fba04-161">Como alternativa, puede usar un bus de servicio de nivel superior como NServiceBus, MassTransit o Brighter para articular el bus de eventos y sistema de publicación/suscripción.</span><span class="sxs-lookup"><span data-stu-id="fba04-161">Alternatively, you might want to use a higher-level service bus like NServiceBus, MassTransit, or Brighter to articulate your event bus and publish/subscribe system.</span></span>

## <a name="a-note-about-messaging-technologies-for-production-systems"></a><span data-ttu-id="fba04-162">Una nota sobre la mensajería de tecnologías destinadas a sistemas de producción</span><span class="sxs-lookup"><span data-stu-id="fba04-162">A note about messaging technologies for production systems</span></span>

<span data-ttu-id="fba04-163">Las tecnologías de mensajes disponibles para implementar el bus de eventos abstractos se encuentran en distintos niveles.</span><span class="sxs-lookup"><span data-stu-id="fba04-163">The messaging technologies available for implementing your abstract event bus are at different levels.</span></span> <span data-ttu-id="fba04-164">Por ejemplo, los productos como RabbitMQ (transporte de broker mensajería) y Service Bus de Azure se colocan en un nivel inferior a otros productos, como NServiceBus, MassTransit o Brighter, que puede trabajar en la parte superior RabbitMQ y Service Bus de Azure.</span><span class="sxs-lookup"><span data-stu-id="fba04-164">For instance, products like RabbitMQ (a messaging broker transport) and Azure Service Bus sit at a lower level than other products like, NServiceBus, MassTransit, or Brighter, which can work on top of RabbitMQ and Azure Service Bus.</span></span> <span data-ttu-id="fba04-165">La elección depende de cuántas características enriquecidas en el nivel de aplicación y la escalabilidad de cuadro que necesita para la aplicación.</span><span class="sxs-lookup"><span data-stu-id="fba04-165">Your choice depends on how many rich features at the application level and out-of-the-box scalability you need for your application.</span></span> <span data-ttu-id="fba04-166">Para implementar sólo un bus de eventos de prueba de concepto para su entorno de desarrollo, como lo hemos hecho en el ejemplo eShopOnContainers, una implementación sencilla en la parte superior RabbitMQ que se ejecuta en un contenedor de Docker puede ser suficiente.</span><span class="sxs-lookup"><span data-stu-id="fba04-166">For implementing just a proof-of-concept event bus for your development environment, as we have done in the eShopOnContainers sample, a simple implementation on top of RabbitMQ running on a Docker container might be enough.</span></span>

<span data-ttu-id="fba04-167">Sin embargo, para una importancia decisiva y sistemas de producción que necesitan hyper escalabilidad, es recomendable evaluar el Bus de servicio de Azure.</span><span class="sxs-lookup"><span data-stu-id="fba04-167">However, for mission-critical and production systems that need hyper-scalability, you might want to evaluate Azure Service Bus.</span></span> <span data-ttu-id="fba04-168">Las características que facilitan el desarrollo de aplicaciones distribuidas y abstracciones de alto nivel, le recomendamos que evalúe otros bus de servicio comercial y de código abierto, como NServiceBus, MassTransit y Brighter.</span><span class="sxs-lookup"><span data-stu-id="fba04-168">For high-level abstractions and features that make the development of distributed applications easier, we recommend that you evaluate other commercial and open-source service buses, such as NServiceBus, MassTransit, and Brighter.</span></span> <span data-ttu-id="fba04-169">Por supuesto, puede crear sus propias características de bus de servicio sobre tecnologías de nivel inferior como RabbitMQ y Docker.</span><span class="sxs-lookup"><span data-stu-id="fba04-169">Of course, you can build your own service-bus features on top of lower-level technologies like RabbitMQ and Docker.</span></span> <span data-ttu-id="fba04-170">Pero ese trabajo mecánica podría muy costosa para una aplicación de empresa personalizados.</span><span class="sxs-lookup"><span data-stu-id="fba04-170">But that plumbing work might cost too much for a custom enterprise application.</span></span>

## <a name="resiliently-publishing-to-the-event-bus"></a><span data-ttu-id="fba04-171">Publicación de forma resistente en el bus de eventos</span><span class="sxs-lookup"><span data-stu-id="fba04-171">Resiliently publishing to the event bus</span></span>

<span data-ttu-id="fba04-172">Un desafío al implementar una arquitectura orientada a eventos a través de varios microservicios se muestra cómo actualizar de manera automática el estado en el microservicio original al publicar de forma resistente sus eventos relacionados con la integración en el bus de eventos, en función de algún modo de transacciones.</span><span class="sxs-lookup"><span data-stu-id="fba04-172">A challenge when implementing an event-driven architecture across multiple microservices is how to atomically update state in the original microservice while resiliently publishing its related integration event into the event bus, somehow based on transactions.</span></span> <span data-ttu-id="fba04-173">Éstas son algunas maneras para lograr esto, aunque podría haber enfoques adicionales también.</span><span class="sxs-lookup"><span data-stu-id="fba04-173">The following are a few ways to accomplish this, although there could be additional approaches as well.</span></span>

-   <span data-ttu-id="fba04-174">Uso de una cola transaccional (basado en DTC) como MSMQ.</span><span class="sxs-lookup"><span data-stu-id="fba04-174">Using a transactional (DTC-based) queue like MSMQ.</span></span> <span data-ttu-id="fba04-175">(Sin embargo, esto es un método heredado).</span><span class="sxs-lookup"><span data-stu-id="fba04-175">(However, this is a legacy approach.)</span></span>

-   <span data-ttu-id="fba04-176">Usar [minería de datos del registro de transacciones](http://www.scoop.it/t/sql-server-transaction-log-mining).</span><span class="sxs-lookup"><span data-stu-id="fba04-176">Using [transaction log mining](http://www.scoop.it/t/sql-server-transaction-log-mining).</span></span>

-   <span data-ttu-id="fba04-177">Usar completa [origen de evento](https://msdn.microsoft.com/en-us/library/dn589792.aspx) patrón.</span><span class="sxs-lookup"><span data-stu-id="fba04-177">Using full [Event Sourcing](https://msdn.microsoft.com/en-us/library/dn589792.aspx) pattern.</span></span>

-   <span data-ttu-id="fba04-178">Mediante el [patrón de bandeja de salida](http://gistlabs.com/2014/05/the-outbox/): una tabla de base de datos transaccional como una cola de mensajes que será la base para un componente de creador de eventos que se cree el evento y publicarlo.</span><span class="sxs-lookup"><span data-stu-id="fba04-178">Using the [Outbox pattern](http://gistlabs.com/2014/05/the-outbox/): a transactional database table as a message queue that will be the base for an event-creator component that would create the event and publish it.</span></span>

<span data-ttu-id="fba04-179">Temas adicionales para tener en cuenta al utilizar la comunicación asincrónica son idempotencia de mensaje y la desduplicación de mensaje.</span><span class="sxs-lookup"><span data-stu-id="fba04-179">Additional topics to consider when using asynchronous communication are message idempotence and message deduplication.</span></span> <span data-ttu-id="fba04-180">En estos temas se tratan en la sección [implementar la comunicación entre microservicios (eventos de integración) basada en eventos](#implementing_event_based_comms_microserv) más adelante en esta guía.</span><span class="sxs-lookup"><span data-stu-id="fba04-180">These topics are covered in the section [Implementing event-based communication between microservices (integration events)](#implementing_event_based_comms_microserv) later in this guide.</span></span>

## <a name="additional-resources"></a><span data-ttu-id="fba04-181">Recursos adicionales</span><span class="sxs-lookup"><span data-stu-id="fba04-181">Additional resources</span></span>

-   <span data-ttu-id="fba04-182">**Evento controlado por mensajería**
    [*http://soapatterns.org/design\_patrones/evento\_controlada por\_de mensajería*](http://soapatterns.org/design_patterns/event_driven_messaging)</span><span class="sxs-lookup"><span data-stu-id="fba04-182">**Event Driven Messaging**
[*http://soapatterns.org/design\_patterns/event\_driven\_messaging*](http://soapatterns.org/design_patterns/event_driven_messaging)</span></span>

-   <span data-ttu-id="fba04-183">**Canal de publicación/suscripción**
    [*http://www.enterpriseintegrationpatterns.com/patterns/messaging/PublishSubscribeChannel.html*](http://www.enterpriseintegrationpatterns.com/patterns/messaging/PublishSubscribeChannel.html)</span><span class="sxs-lookup"><span data-stu-id="fba04-183">**Publish/Subscribe Channel**
[*http://www.enterpriseintegrationpatterns.com/patterns/messaging/PublishSubscribeChannel.html*](http://www.enterpriseintegrationpatterns.com/patterns/messaging/PublishSubscribeChannel.html)</span></span>

-   <span data-ttu-id="fba04-184">**UDI Dahan. Se ha aclarado CQRS**
    [*http://udidahan.com/2009/12/09/clarified-cqrs/*](http://udidahan.com/2009/12/09/clarified-cqrs/)</span><span class="sxs-lookup"><span data-stu-id="fba04-184">**Udi Dahan. Clarified CQRS**
[*http://udidahan.com/2009/12/09/clarified-cqrs/*](http://udidahan.com/2009/12/09/clarified-cqrs/)</span></span>

-   <span data-ttu-id="fba04-185">**Comando y consultar la segregación de responsabilidad (CQRS)**
    [*https://docs.microsoft.com/azure/architecture/patterns/cqrs*](https://docs.microsoft.com/azure/architecture/patterns/cqrs)</span><span class="sxs-lookup"><span data-stu-id="fba04-185">**Command and Query Responsibility Segregation (CQRS)**
[*https://docs.microsoft.com/azure/architecture/patterns/cqrs*](https://docs.microsoft.com/azure/architecture/patterns/cqrs)</span></span>

-   <span data-ttu-id="fba04-186">**Comunicación entre limitado contextos**
    [*https://msdn.microsoft.com/library/jj591572.aspx*](https://msdn.microsoft.com/library/jj591572.aspx)</span><span class="sxs-lookup"><span data-stu-id="fba04-186">**Communicating Between Bounded Contexts**
[*https://msdn.microsoft.com/library/jj591572.aspx*](https://msdn.microsoft.com/library/jj591572.aspx)</span></span>

-   <span data-ttu-id="fba04-187">**Coherencia definitiva**
    [*https://en.wikipedia.org/wiki/Eventual\_coherencia*](https://en.wikipedia.org/wiki/Eventual_consistency)</span><span class="sxs-lookup"><span data-stu-id="fba04-187">**Eventual consistency**
[*https://en.wikipedia.org/wiki/Eventual\_consistency*](https://en.wikipedia.org/wiki/Eventual_consistency)</span></span>

-   <span data-ttu-id="fba04-188">**Jimmy Bogard. Refactorización hacia resistencia: Evaluación de acoplamiento**
    [*https://jimmybogard.com/refactoring-towards-resilience-evaluating-coupling/*](https://jimmybogard.com/refactoring-towards-resilience-evaluating-coupling/)</span><span class="sxs-lookup"><span data-stu-id="fba04-188">**Jimmy Bogard. Refactoring Towards Resilience: Evaluating Coupling**
[*https://jimmybogard.com/refactoring-towards-resilience-evaluating-coupling/*](https://jimmybogard.com/refactoring-towards-resilience-evaluating-coupling/)</span></span>


>[!div class="step-by-step"]
<span data-ttu-id="fba04-189">[Anterior] (comunicación-en-microservicio-architecture.md) [siguiente] (mantener de microservicio-apis.md)</span><span class="sxs-lookup"><span data-stu-id="fba04-189">[Previous] (communication-in-microservice-architecture.md) [Next] (maintain-microservice-apis.md)</span></span>
