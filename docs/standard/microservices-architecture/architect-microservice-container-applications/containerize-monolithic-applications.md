---
title: Incluir en un contenedor aplicaciones monolíticas
description: Arquitectura de microservicios de .NET para aplicaciones .NET en contenedor | Incluir en un contenedor aplicaciones monolíticas
author: CESARDELATORRE
ms.author: wiwagn
ms.date: 05/26/2017
ms.openlocfilehash: 4e5b7a8202a0af26c8d61e315c3aa8f592ed45d9
ms.sourcegitcommit: 979597cd8055534b63d2c6ee8322938a27d0c87b
ms.translationtype: HT
ms.contentlocale: es-ES
ms.lasthandoff: 06/29/2018
ms.locfileid: "37105928"
---
# <a name="containerizing-monolithic-applications"></a><span data-ttu-id="f8e96-103">Incluir en un contenedor aplicaciones monolíticas</span><span class="sxs-lookup"><span data-stu-id="f8e96-103">Containerizing monolithic applications</span></span>

<span data-ttu-id="f8e96-104">Puede compilar una aplicación o un servicio web único, implementado de forma monolítica, e implementarlo como un contenedor.</span><span class="sxs-lookup"><span data-stu-id="f8e96-104">You might want to build a single, monolithically deployed web application or service and deploy it as a container.</span></span> <span data-ttu-id="f8e96-105">La propia aplicación podría no ser internamente monolítica, sino estructurada en forma de varias bibliotecas, componentes o incluso capas (nivel de aplicación, capa de dominio, capa de acceso a datos, etc.).</span><span class="sxs-lookup"><span data-stu-id="f8e96-105">The application itself might not be internally monolithic, but structured as several libraries, components, or even layers (application layer, domain layer, data-access layer, etc.).</span></span> <span data-ttu-id="f8e96-106">Sin embargo, externamente, es un contenedor único, un proceso único, una aplicación web única o un servicio único.</span><span class="sxs-lookup"><span data-stu-id="f8e96-106">Externally, however, it is a single container—a single process, a single web application, or a single service.</span></span>

<span data-ttu-id="f8e96-107">Para administrar este modelo, debe implementar un único contenedor para representar la aplicación.</span><span class="sxs-lookup"><span data-stu-id="f8e96-107">To manage this model, you deploy a single container to represent the application.</span></span> <span data-ttu-id="f8e96-108">Para escalar verticalmente, solo tiene que agregar más copias con un equilibrador de carga delante.</span><span class="sxs-lookup"><span data-stu-id="f8e96-108">To scale up, you just add more copies with a load balancer in front.</span></span> <span data-ttu-id="f8e96-109">La simplicidad proviene de administrar una única implementación en un solo contenedor o máquina virtual.</span><span class="sxs-lookup"><span data-stu-id="f8e96-109">The simplicity comes from managing a single deployment in a single container or VM.</span></span>

![](./media/image1.png)

<span data-ttu-id="f8e96-110">**Figura 4-1**.</span><span class="sxs-lookup"><span data-stu-id="f8e96-110">**Figure 4-1**.</span></span> <span data-ttu-id="f8e96-111">Ejemplo de la arquitectura de una aplicación monolítica en contenedores</span><span class="sxs-lookup"><span data-stu-id="f8e96-111">Example of the architecture of a containerized monolithic application</span></span>

<span data-ttu-id="f8e96-112">Puede incluir varios componentes, bibliotecas o capas internas en cada contenedor, como se muestra en la figura 4-1.</span><span class="sxs-lookup"><span data-stu-id="f8e96-112">You can include multiple components, libraries, or internal layers in each container, as illustrated in Figure 4-1.</span></span> <span data-ttu-id="f8e96-113">Sin embargo, este patrón monolítico puede entrar en conflicto con el principio de contenedor "un contenedor realiza una acción y lo hace en un proceso", pero podría ser correcto en algunos casos.</span><span class="sxs-lookup"><span data-stu-id="f8e96-113">However, this monolithic pattern might conflict with the container principle “a container does one thing, and does it in one process”, but might be ok for some cases.</span></span>

<span data-ttu-id="f8e96-114">El inconveniente de este enfoque se vuelve evidente si la aplicación aumenta y debe escalarse.</span><span class="sxs-lookup"><span data-stu-id="f8e96-114">The downside of this approach becomes evident if the application grows, requiring it to scale.</span></span> <span data-ttu-id="f8e96-115">Si puede escalar toda la aplicación, no es realmente un problema.</span><span class="sxs-lookup"><span data-stu-id="f8e96-115">If the entire application can scale, it is not really a problem.</span></span> <span data-ttu-id="f8e96-116">Sin embargo, en la mayoría de los casos, solo unos pocos elementos de la aplicación son los puntos de obstrucción que deben escalarse, mientras que otros componentes se usan menos.</span><span class="sxs-lookup"><span data-stu-id="f8e96-116">However, in most cases, just a few parts of the application are the choke points that requiring scaling, while other components are used less.</span></span>

<span data-ttu-id="f8e96-117">Por ejemplo, en una aplicación típica de comercio electrónico, es probable que deba escalar el subsistema de información del producto, dado que muchos más clientes examinan los productos en lugar de comprarlos.</span><span class="sxs-lookup"><span data-stu-id="f8e96-117">For example, in a typical e-commerce application, you likely need to scale the product information subsystem, because many more customers browse products than purchase them.</span></span> <span data-ttu-id="f8e96-118">Más clientes usan la cesta en lugar de usar la canalización de pago.</span><span class="sxs-lookup"><span data-stu-id="f8e96-118">More customers use their basket than use the payment pipeline.</span></span> <span data-ttu-id="f8e96-119">Menos clientes publican comentarios o consultan su historial de compras.</span><span class="sxs-lookup"><span data-stu-id="f8e96-119">Fewer customers add comments or view their purchase history.</span></span> <span data-ttu-id="f8e96-120">Y es posible que solo un grupo reducido de empleados deba administrar el contenido y las campañas de marketing.</span><span class="sxs-lookup"><span data-stu-id="f8e96-120">And you might have only a handful of employees, that need to manage the content and marketing campaigns.</span></span> <span data-ttu-id="f8e96-121">Si escala el diseño monolítico, todo el código para estas distintas tareas se implementa varias veces y se escala al mismo nivel.</span><span class="sxs-lookup"><span data-stu-id="f8e96-121">If you scale the monolithic design, all the code for these different tasks is deployed multiple times and scaled at the same grade.</span></span>

<span data-ttu-id="f8e96-122">Hay varias formas de escalar una aplicación: duplicación horizontal, división de diferentes áreas de la aplicación y partición conceptos o datos empresariales similares.</span><span class="sxs-lookup"><span data-stu-id="f8e96-122">There are multiple ways to scale an application—horizontal duplication, splitting different areas of the application, and partitioning similar business concepts or data.</span></span> <span data-ttu-id="f8e96-123">Pero, además del problema de escalar todos los componentes, para introducir cambios en un único componente se debe volver a probar por completo toda la aplicación e implementar por completo todas las instancias.</span><span class="sxs-lookup"><span data-stu-id="f8e96-123">But, in addition to the problem of scaling all components, changes to a single component require complete retesting of the entire application, and a complete redeployment of all the instances.</span></span>

<span data-ttu-id="f8e96-124">Sin embargo, el enfoque monolítico es común, porque el desarrollo de la aplicación es inicialmente más fácil que en el caso de los enfoques de microservicios.</span><span class="sxs-lookup"><span data-stu-id="f8e96-124">However, the monolithic approach is common, because the development of the application is initially easier than for microservices approaches.</span></span> <span data-ttu-id="f8e96-125">Por tanto, muchas organizaciones desarrollan con este enfoque arquitectónico.</span><span class="sxs-lookup"><span data-stu-id="f8e96-125">Thus, many organizations develop using this architectural approach.</span></span> <span data-ttu-id="f8e96-126">Mientras que algunas organizaciones han tenido resultados suficientemente buenos, otras solo llegan a los límites.</span><span class="sxs-lookup"><span data-stu-id="f8e96-126">While some organizations have had good enough results, others are hitting limits.</span></span> <span data-ttu-id="f8e96-127">Muchas organizaciones diseñaron sus aplicaciones mediante este modelo ya que, años atrás, crear arquitecturas orientadas a servicios (SOA) con infraestructura y herramientas resultaba demasiado difícil y no vieron la necesidad, hasta que la aplicación creció.</span><span class="sxs-lookup"><span data-stu-id="f8e96-127">Many organizations designed their applications using this model because tools and infrastructure made it too difficult to build service oriented architectures (SOA) years ago, and they did not see the need—until the application grew.</span></span>

<span data-ttu-id="f8e96-128">Desde una perspectiva de la infraestructura, cada servidor puede ejecutar muchas aplicaciones dentro del mismo host y tener una proporción aceptable de eficacia en el uso de recursos, como se muestra en la figura 4-2.</span><span class="sxs-lookup"><span data-stu-id="f8e96-128">From an infrastructure perspective, each server can run many applications within the same host and have an acceptable ratio of efficiency in resources usage, as shown in Figure 4-2.</span></span>

![](./media/image2.png)

<span data-ttu-id="f8e96-129">**Figura 4-2**.</span><span class="sxs-lookup"><span data-stu-id="f8e96-129">**Figure 4-2**.</span></span> <span data-ttu-id="f8e96-130">Enfoque monolítico: el host ejecuta varias aplicaciones, cada aplicación se ejecuta como un contenedor</span><span class="sxs-lookup"><span data-stu-id="f8e96-130">Monolithic approach: Host running multiple apps, each app running as a container</span></span>

<span data-ttu-id="f8e96-131">Las aplicaciones monolíticas en Microsoft Azure se pueden implementar con máquinas virtuales dedicadas para cada instancia.</span><span class="sxs-lookup"><span data-stu-id="f8e96-131">Monolithic applications in Microsoft Azure can be deployed using dedicated VMs for each instance.</span></span> <span data-ttu-id="f8e96-132">Además, con [Azure VM Scale Sets](https://docs.microsoft.com/azure/virtual-machine-scale-sets/), puede escalar fácilmente las máquinas virtuales.</span><span class="sxs-lookup"><span data-stu-id="f8e96-132">Additionally, using [Azure VM Scale Sets](https://docs.microsoft.com/azure/virtual-machine-scale-sets/), you can easily scale the VMs.</span></span> <span data-ttu-id="f8e96-133">[Azure App Service](https://azure.microsoft.com/services/app-service/) también puede ejecutar aplicaciones monolíticas y escalar fácilmente instancias sin necesidad de administrar las máquinas virtuales.</span><span class="sxs-lookup"><span data-stu-id="f8e96-133">[Azure App Service](https://azure.microsoft.com/services/app-service/) can also run monolithic applications and easily scale instances without requiring you to manage the VMs.</span></span> <span data-ttu-id="f8e96-134">Además, desde 2016, Azure App Services puede ejecutar instancias únicas de contenedores de Docker, lo que simplifica la implementación.</span><span class="sxs-lookup"><span data-stu-id="f8e96-134">Since 2016, Azure App Services can run single instances of Docker containers as well, simplifying deployment.</span></span>

<span data-ttu-id="f8e96-135">Como un entorno de control de calidad o un entorno de producción limitado, puede implementar varias máquinas virtuales de host de Docker y equilibrarlas con el equilibrador de Azure, tal como se muestra en la figura 4-3.</span><span class="sxs-lookup"><span data-stu-id="f8e96-135">As a QA environment or a limited production environment, you can deploy multiple Docker host VMs and balance them using the Azure balancer, as shown in Figure 4-3.</span></span> <span data-ttu-id="f8e96-136">Esto le permite administrar el escalado con un enfoque más general, porque toda la aplicación reside dentro de un único contenedor.</span><span class="sxs-lookup"><span data-stu-id="f8e96-136">This lets you manage scaling with a coarse-grain approach, because the whole application lives within a single container.</span></span>

![](./media/image3.png)

<span data-ttu-id="f8e96-137">**Figura 4-3**.</span><span class="sxs-lookup"><span data-stu-id="f8e96-137">**Figure 4-3**.</span></span> <span data-ttu-id="f8e96-138">Ejemplo de varios hosts que escalan verticalmente una sola aplicación de contenedor</span><span class="sxs-lookup"><span data-stu-id="f8e96-138">Example of multiple hosts scaling up a single container application</span></span>

<span data-ttu-id="f8e96-139">La implementación en los distintos hosts puede administrarse con técnicas de implementación tradicionales.</span><span class="sxs-lookup"><span data-stu-id="f8e96-139">Deployment to the various hosts can be managed with traditional deployment techniques.</span></span> <span data-ttu-id="f8e96-140">Los hosts de Docker pueden administrarse con comandos como `docker run` o `docker-compose` ejecutados manualmente o a través de automatización como las canalizaciones de entrega continua (CD).</span><span class="sxs-lookup"><span data-stu-id="f8e96-140">Docker hosts can be managed with commands like `docker run` or `docker-compose` performed manually, or through automation such as continuous delivery (CD) pipelines.</span></span>

## <a name="deploying-a-monolithic-application-as-a-container"></a><span data-ttu-id="f8e96-141">Implementar una aplicación monolítica como un contenedor</span><span class="sxs-lookup"><span data-stu-id="f8e96-141">Deploying a monolithic application as a container</span></span>

<span data-ttu-id="f8e96-142">Usar contenedores para administrar las implementaciones de aplicaciones monolíticas tiene una serie de ventajas.</span><span class="sxs-lookup"><span data-stu-id="f8e96-142">There are benefits to using containers to manage monolithic application deployments.</span></span> <span data-ttu-id="f8e96-143">Escalar las instancias de contenedor es mucho más rápido y fácil que implementar máquinas virtuales adicionales.</span><span class="sxs-lookup"><span data-stu-id="f8e96-143">Scaling container instances is far faster and easier than deploying additional VMs.</span></span> <span data-ttu-id="f8e96-144">Incluso si usa VM Scale Sets, las máquinas virtuales tardan tiempo en iniciarse.</span><span class="sxs-lookup"><span data-stu-id="f8e96-144">Even if you use VM Scale Sets, VMs take time to start.</span></span> <span data-ttu-id="f8e96-145">Cuando se implementa como instancias de aplicaciones tradicionales en lugar de contenedores, la configuración de la aplicación se administra como parte de la máquina virtual, lo que no es ideal.</span><span class="sxs-lookup"><span data-stu-id="f8e96-145">When deployed as traditional application instances instead of containers, the configuration of the application is managed as part of the VM, which is not ideal.</span></span>

<span data-ttu-id="f8e96-146">Implementar las actualizaciones como imágenes de Docker es mucho más rápido y eficaz en la red.</span><span class="sxs-lookup"><span data-stu-id="f8e96-146">Deploying updates as Docker images is far faster and network efficient.</span></span> <span data-ttu-id="f8e96-147">Normalmente, las imágenes de Docker se inician en segundos, lo que acelera los lanzamientos.</span><span class="sxs-lookup"><span data-stu-id="f8e96-147">Docker images typically start in seconds, which speeds rollouts.</span></span> <span data-ttu-id="f8e96-148">Anular una instancia de la imagen de Docker es tan fácil como emitir un comando `docker stop` y, normalmente, se completa en menos de un segundo.</span><span class="sxs-lookup"><span data-stu-id="f8e96-148">Tearing down a Docker image instance is as easy as issuing a `docker stop` command, and typically completes in less than a second.</span></span>

<span data-ttu-id="f8e96-149">Dado que los contenedores son inmutables por diseño, nunca debe preocuparse por máquinas virtuales dañadas.</span><span class="sxs-lookup"><span data-stu-id="f8e96-149">Because containers are immutable by design, you never need to worry about corrupted VMs.</span></span> <span data-ttu-id="f8e96-150">En cambio, los scripts de actualización para una máquina virtual podrían olvidar tener en cuenta algún archivo o configuración concreto que se haya quedado en el disco.</span><span class="sxs-lookup"><span data-stu-id="f8e96-150">In contrast, update scripts for a VM might forget to account for some specific configuration or file left on disk.</span></span>

<span data-ttu-id="f8e96-151">Si bien las aplicaciones monolíticas pueden beneficiarse de Docker, estamos examinando estos beneficios muy por encima.</span><span class="sxs-lookup"><span data-stu-id="f8e96-151">While monolithic applications can benefit from Docker, we are touching only on the benefits.</span></span> <span data-ttu-id="f8e96-152">Las ventajas adicionales de administrar contenedores proceden de implementar con orquestadores de contenedor, que administran las distintas instancias y el ciclo de vida de cada instancia del contenedor.</span><span class="sxs-lookup"><span data-stu-id="f8e96-152">Additional benefits of managing containers come from deploying with container orchestrators, which manage the various instances and lifecycle of each container instance.</span></span> <span data-ttu-id="f8e96-153">Separar la aplicación monolítica en subsistemas que se pueden escalar, desarrollar e implementar de forma individual es el punto de entrada al reino de los microservicios.</span><span class="sxs-lookup"><span data-stu-id="f8e96-153">Breaking up the monolithic application into subsystems that can be scaled, developed, and deployed individually is your entry point into the realm of microservices.</span></span>

## <a name="publishing-a-single-container-based-application-to-azure-app-service"></a><span data-ttu-id="f8e96-154">Publicar una aplicación basada en un solo contenedor en Azure App Service</span><span class="sxs-lookup"><span data-stu-id="f8e96-154">Publishing a single-container-based application to Azure App Service</span></span>

<span data-ttu-id="f8e96-155">Tanto si quiere obtener la validación de un contenedor implementado en Azure o cuando una aplicación es simplemente una aplicación de un solo contenedor, Azure App Service proporciona una excelente manera de proporcionar servicios escalables basados en un solo contenedor.</span><span class="sxs-lookup"><span data-stu-id="f8e96-155">Whether you want to get validation of a container deployed to Azure or when an application is simply a single-container application, Azure App Service provides a great way to provide scalable single-container-based services.</span></span> <span data-ttu-id="f8e96-156">Usar Azure App Service es sencillo.</span><span class="sxs-lookup"><span data-stu-id="f8e96-156">Using Azure App Service is simple.</span></span> <span data-ttu-id="f8e96-157">Proporciona una integración excelente con Git para que resulte sencillo tomar el código, crearlo en Visual Studio e implementarlo directamente en Azure.</span><span class="sxs-lookup"><span data-stu-id="f8e96-157">It provides great integration with Git to make it easy to take your code, build it in Visual Studio, and deploy it directly to Azure.</span></span>

![](./media/image4.png)

<span data-ttu-id="f8e96-158">**Figura 4-4**.</span><span class="sxs-lookup"><span data-stu-id="f8e96-158">**Figure 4-4**.</span></span> <span data-ttu-id="f8e96-159">Publicar una aplicación de contenedor único en Azure App Service desde Visual Studio</span><span class="sxs-lookup"><span data-stu-id="f8e96-159">Publishing a single-container application to Azure App Service from Visual Studio</span></span>

<span data-ttu-id="f8e96-160">Sin Docker, si necesitaba otras capacidades, marcos o dependencias que no fueran compatibles con Azure App Service, tenía que esperar a que el equipo de Azure actualizara esas dependencias en App Service.</span><span class="sxs-lookup"><span data-stu-id="f8e96-160">Without Docker, if you needed other capabilities, frameworks, or dependencies that are not supported in Azure App Service, you had to wait until the Azure team updated those dependencies in App Service.</span></span> <span data-ttu-id="f8e96-161">O tenía que cambiar a otros servicios como Azure Service Fabric, Azure Cloud Services o incluso máquinas virtuales, en que tenía más control y podía instalar un componente o un marco necesario para la aplicación.</span><span class="sxs-lookup"><span data-stu-id="f8e96-161">Or you had to switch to other services like Azure Service Fabric, Azure Cloud Services, or even VMs, where you had further control and you could install a required component or framework for your application.</span></span>

<span data-ttu-id="f8e96-162">La compatibilidad con contenedores de Visual Studio 2017 le ofrece la capacidad de incluir todo lo que quiera en el entorno de aplicación, tal como se muestra en la figura 4-4.</span><span class="sxs-lookup"><span data-stu-id="f8e96-162">Container support in Visual Studio 2017 gives you the ability to include whatever you want in your application environment, as shown in Figure 4-4.</span></span> <span data-ttu-id="f8e96-163">Puesto que la está ejecutando en un contenedor, si agrega una dependencia a la aplicación, puede incluir la dependencia en Dockerfile o la imagen de Docker.</span><span class="sxs-lookup"><span data-stu-id="f8e96-163">Since you are running it in a container, if you add a dependency to your application, you can include the dependency in your Dockerfile or Docker image.</span></span>

<span data-ttu-id="f8e96-164">Como también se muestra en la figura 4-4, el flujo de publicación inserta una imagen a través de un registro de contenedor.</span><span class="sxs-lookup"><span data-stu-id="f8e96-164">As also shown in Figure 4-4, the publish flow pushes an image through a container registry.</span></span> <span data-ttu-id="f8e96-165">Puede ser Azure Container Registry (un registro cercano a las implementaciones en Azure y protegido por las cuentas y los grupos de Azure Active Directory) o cualquier otro registro de Docker, como Docker Hub o un registro local.</span><span class="sxs-lookup"><span data-stu-id="f8e96-165">This can be the Azure Container Registry (a registry close to your deployments in Azure and secured by Azure Active Directory groups and accounts), or any other Docker registry, like Docker Hub or an on-premises registry.</span></span>


>[!div class="step-by-step"]
<span data-ttu-id="f8e96-166">[Anterior](index.md)
[Siguiente](docker-application-state-data.md)</span><span class="sxs-lookup"><span data-stu-id="f8e96-166">[Previous](index.md)
[Next](docker-application-state-data.md)</span></span>
