---
title: "Desafíos y soluciones de administración de datos distribuidos"
description: "Arquitectura de Microservicios de .NET para aplicaciones .NET en contenedores | Desafíos y soluciones de administración de datos distribuidos"
keywords: Docker, microservicios, ASP.NET, contenedor
author: CESARDELATORRE
ms.author: wiwagn
ms.date: 05/26/2017
ms.prod: .net-core
ms.technology: dotnet-docker
ms.topic: article
ms.openlocfilehash: f961475b40c74bf448cff1aeae04ae4866360e52
ms.sourcegitcommit: c2e216692ef7576a213ae16af2377cd98d1a67fa
ms.translationtype: HT
ms.contentlocale: es-ES
ms.lasthandoff: 10/22/2017
---
# <a name="challenges-and-solutions-for-distributed-data-management"></a><span data-ttu-id="e19da-104">Desafíos y soluciones de administración de datos distribuidos</span><span class="sxs-lookup"><span data-stu-id="e19da-104">Challenges and solutions for distributed data management</span></span>

## <a name="challenge-1-how-to-define-the-boundaries-of-each-microservice"></a><span data-ttu-id="e19da-105">Desafío \#1: cómo definir los límites de cada microservicio</span><span class="sxs-lookup"><span data-stu-id="e19da-105">Challenge \#1: How to define the boundaries of each microservice</span></span>

<span data-ttu-id="e19da-106">Definir los límites de microservicio es probablemente el primer desafío que cualquiera encuentra.</span><span class="sxs-lookup"><span data-stu-id="e19da-106">Defining microservice boundaries is probably the first challenge anyone encounters.</span></span> <span data-ttu-id="e19da-107">Cada microservicio debe ser una parte de la aplicación y cada microservicio debe ser autónomo con todas las ventajas y los desafíos a los que transmite.</span><span class="sxs-lookup"><span data-stu-id="e19da-107">Each microservice has to be a piece of your application and each microservice should be autonomous with all the benefits and challenges that it conveys.</span></span> <span data-ttu-id="e19da-108">Pero, ¿cómo se identifica estos límites?</span><span class="sxs-lookup"><span data-stu-id="e19da-108">But how do you identify those boundaries?</span></span>

<span data-ttu-id="e19da-109">En primer lugar, debe centrarse en los modelos de dominio lógica y los datos relacionados de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="e19da-109">First, you need to focus on the application’s logical domain models and related data.</span></span> <span data-ttu-id="e19da-110">Debe intentar identificar desacopladas islas de datos y contextos diferentes dentro de la misma aplicación.</span><span class="sxs-lookup"><span data-stu-id="e19da-110">You must try to identify decoupled islands of data and different contexts within the same application.</span></span> <span data-ttu-id="e19da-111">Cada contexto podría tener un idioma empresarial diferente (términos empresariales diferentes).</span><span class="sxs-lookup"><span data-stu-id="e19da-111">Each context could have a different business language (different business terms).</span></span> <span data-ttu-id="e19da-112">Los contextos deben definirse y administran de forma independiente.</span><span class="sxs-lookup"><span data-stu-id="e19da-112">The contexts should be defined and managed independently.</span></span> <span data-ttu-id="e19da-113">Los términos y las entidades utilizadas en estos contextos diferentes podrían parecer similar, pero podría descubrir que en un contexto determinado, un concepto de negocio con uno se usa para un propósito diferente en otro contexto y podría ser necesario un nombre diferente.</span><span class="sxs-lookup"><span data-stu-id="e19da-113">The terms and entities used in those different contexts might sound similar, but you might discover that in a particular context, a business concept with one is used for a different purpose in another context, and might even have a different name.</span></span> <span data-ttu-id="e19da-114">Por ejemplo, un usuario puede hacer referencia como un usuario en el contexto de identidad o la pertenencia a, como un cliente en un contexto CRM, como un comprador en un contexto de ordenación y así sucesivamente.</span><span class="sxs-lookup"><span data-stu-id="e19da-114">For instance, a user can be referred as a user in the identity or membership context, as a customer in a CRM context, as a buyer in an ordering context, and so forth.</span></span>

<span data-ttu-id="e19da-115">La manera de identificar los límites entre varios contextos de aplicación con un dominio diferente para cada contexto es exactamente cómo puede identificar los límites de cada microservicio de negocios y sus relacionados modelo de dominio y los datos.</span><span class="sxs-lookup"><span data-stu-id="e19da-115">The way you identify boundaries between multiple application contexts with a different domain for each context is exactly how you can identify the boundaries for each business microservice and its related domain model and data.</span></span> <span data-ttu-id="e19da-116">Siempre intenta minimizar el acoplamiento entre esas microservicios.</span><span class="sxs-lookup"><span data-stu-id="e19da-116">You always attempt to minimize the coupling between those microservices.</span></span> <span data-ttu-id="e19da-117">Esta guía se explica con más detalle acerca de este diseño de modelos de identificación y el dominio en la sección [identifica los límites del modelo de dominio para cada microservicio](#identifying-domain-model-boundaries-for-each-microservice) más tarde.</span><span class="sxs-lookup"><span data-stu-id="e19da-117">This guide goes into more detail about this identification and domain model design in the section [Identifying domain-model boundaries for each microservice](#identifying-domain-model-boundaries-for-each-microservice) later.</span></span>

## <a name="challenge-2-how-to-create-queries-that-retrieve-data-from-several-microservices"></a><span data-ttu-id="e19da-118">Desafío \#2: cómo crear consultas que recuperan datos de varios microservicios</span><span class="sxs-lookup"><span data-stu-id="e19da-118">Challenge \#2: How to create queries that retrieve data from several microservices</span></span>

<span data-ttu-id="e19da-119">Un segundo problema es cómo implementar las consultas que recuperan datos de varios microservicios, evitando la comunicación locuaz a la microservicios desde aplicaciones cliente remoto.</span><span class="sxs-lookup"><span data-stu-id="e19da-119">A second challenge is how to implement queries that retrieve data from several microservices, while avoiding chatty communication to the microservices from remote client apps.</span></span> <span data-ttu-id="e19da-120">Un ejemplo podría ser una sola pantalla desde una aplicación móvil que necesita para mostrar información de usuario que pertenece a la cesta de la compra, catálogo y microservicios de identidad de usuario.</span><span class="sxs-lookup"><span data-stu-id="e19da-120">An example could be a single screen from a mobile app that needs to show user information that is owned by the basket, catalog, and user identity microservices.</span></span> <span data-ttu-id="e19da-121">Otro ejemplo sería un informe complejo que implica muchas tablas ubicadas en varios microservicios.</span><span class="sxs-lookup"><span data-stu-id="e19da-121">Another example would be a complex report involving many tables located in multiple microservices.</span></span> <span data-ttu-id="e19da-122">La solución adecuada depende de la complejidad de las consultas.</span><span class="sxs-lookup"><span data-stu-id="e19da-122">The right solution depends on the complexity of the queries.</span></span> <span data-ttu-id="e19da-123">Pero en cualquier caso, necesitará una manera de agregar información si desea mejorar la eficacia de las comunicaciones del sistema.</span><span class="sxs-lookup"><span data-stu-id="e19da-123">But in any case, you will need a way to aggregate information if you want to improve the efficiency in the communications of your system.</span></span> <span data-ttu-id="e19da-124">Las soluciones más comunes son las siguientes:</span><span class="sxs-lookup"><span data-stu-id="e19da-124">The most popular solutions are the following.</span></span>

<span data-ttu-id="e19da-125">**Puerta de enlace de API**.</span><span class="sxs-lookup"><span data-stu-id="e19da-125">**API Gateway**.</span></span> <span data-ttu-id="e19da-126">Para la agregación de datos simple de varios microservicios que poseen diferentes bases de datos, el enfoque recomendado es un microservicio de agregación que se conoce como una puerta de enlace de API.</span><span class="sxs-lookup"><span data-stu-id="e19da-126">For simple data aggregation from multiple microservices that own different databases, the recommended approach is an aggregation microservice referred to as an API Gateway.</span></span> <span data-ttu-id="e19da-127">Sin embargo, debe tener cuidado acerca de cómo implementar este patrón, ya que puede ser un punto de retracción en el sistema y puede infringir el principio de autonomía de microservicio.</span><span class="sxs-lookup"><span data-stu-id="e19da-127">However, you need to be careful about implementing this pattern, because it can be a choke point in your system, and it can violate the principle of microservice autonomy.</span></span> <span data-ttu-id="e19da-128">Para mitigar esta posibilidad, puede tener varios precisa API puertas de enlace de cada uno centrándose en un área de negocio del sistema o vertical "intervalo".</span><span class="sxs-lookup"><span data-stu-id="e19da-128">To mitigate this possibility, you can have multiple fined-grained API Gateways each one focusing on a vertical “slice” or business area of the system.</span></span> <span data-ttu-id="e19da-129">El patrón de puerta de enlace de API se explica con más detalle en la sección en utilizar una puerta de enlace de API más adelante.</span><span class="sxs-lookup"><span data-stu-id="e19da-129">The API Gateway pattern is explained in more detail in the section in the Using an API Gateway later.</span></span>

<span data-ttu-id="e19da-130">**CQRS con tablas de consulta/lectura**.</span><span class="sxs-lookup"><span data-stu-id="e19da-130">**CQRS with query/reads tables**.</span></span> <span data-ttu-id="e19da-131">Otra solución de agregación de datos de varios microservicios es el [patrón de vista materializa](https://docs.microsoft.com/azure/architecture/patterns/materialized-view).</span><span class="sxs-lookup"><span data-stu-id="e19da-131">Another solution for aggregating data from multiple microservices is the [Materialized View pattern](https://docs.microsoft.com/azure/architecture/patterns/materialized-view).</span></span> <span data-ttu-id="e19da-132">En este enfoque, generar, de antemano (preparar los datos sin normalizar antes de producen las consultas reales), una tabla de solo lectura con los datos que pertenecen a varios microservicios.</span><span class="sxs-lookup"><span data-stu-id="e19da-132">In this approach, you generate, in advance (prepare denormalized data before the actual queries happen), a read-only table with the data that is owned by multiple microservices.</span></span> <span data-ttu-id="e19da-133">La tabla tiene un formato que se adapte a las necesidades de la aplicación cliente.</span><span class="sxs-lookup"><span data-stu-id="e19da-133">The table has a format suited to the client app’s needs.</span></span>

<span data-ttu-id="e19da-134">Tenga en cuenta algo parecido a la pantalla para una aplicación móvil.</span><span class="sxs-lookup"><span data-stu-id="e19da-134">Consider something like the screen for a mobile app.</span></span> <span data-ttu-id="e19da-135">Si tiene una sola base de datos, puede reunir los datos de esa pantalla mediante una consulta SQL que realiza una combinación compleja que implica varias tablas.</span><span class="sxs-lookup"><span data-stu-id="e19da-135">If you have a single database, you might pull together the data for that screen using a SQL query that performs a complex join involving multiple tables.</span></span> <span data-ttu-id="e19da-136">Sin embargo, si tiene varias bases de datos, y cada base de datos pertenece a un microservicio diferentes, no se puede consultar las bases de datos y crear una combinación SQL.</span><span class="sxs-lookup"><span data-stu-id="e19da-136">However, when you have multiple databases, and each database is owned by a different microservice, you cannot query those databases and create a SQL join.</span></span> <span data-ttu-id="e19da-137">La consulta compleja se convierte en un desafío.</span><span class="sxs-lookup"><span data-stu-id="e19da-137">Your complex query becomes a challenge.</span></span> <span data-ttu-id="e19da-138">Puede resolver el requisito de uso de un enfoque CQRS: crear una tabla sin normalizar en otra base de datos que se usa solo para las consultas.</span><span class="sxs-lookup"><span data-stu-id="e19da-138">You can address the requirement using a CQRS approach—you create a denormalized table in a different database that is used just for queries.</span></span> <span data-ttu-id="e19da-139">La tabla puede ser diseñada específicamente para los datos que necesita para la consulta compleja, con una relación uno a uno entre los campos que son necesarias para la pantalla de la aplicación y las columnas de la tabla de consulta.</span><span class="sxs-lookup"><span data-stu-id="e19da-139">The table can be designed specifically for the data you need for the complex query, with a one-to-one relationship between fields needed by your application’s screen and the columns in the query table.</span></span> <span data-ttu-id="e19da-140">También pueden utilizarse con fines informativos.</span><span class="sxs-lookup"><span data-stu-id="e19da-140">It could also serve for reporting purposes.</span></span>

<span data-ttu-id="e19da-141">Este enfoque no solo soluciona el problema original (cómo realizar consultas y combinación a través de microservicios); también aumenta el rendimiento considerablemente cuando se comparan con una combinación compleja, puesto que ya tiene los datos que necesita la aplicación en la tabla de consulta.</span><span class="sxs-lookup"><span data-stu-id="e19da-141">This approach not only solves the original problem (how to query and join across microservices); it also improves performance considerably when compared with a complex join, because you already have the data that the application needs in the query table.</span></span> <span data-ttu-id="e19da-142">Por supuesto, usando el comando y la segregación de responsabilidad de consulta (CQRS) con tablas de consulta/lectura significa el trabajo de desarrollo adicional y debe adoptar la coherencia final.</span><span class="sxs-lookup"><span data-stu-id="e19da-142">Of course, using Command and Query Responsibility Segregation (CQRS) with query/reads tables means additional development work, and you will need to embrace eventual consistency.</span></span> <span data-ttu-id="e19da-143">No obstante, los requisitos de rendimiento y alta escalabilidad en [escenarios de colaboración](http://udidahan.com/2011/10/02/why-you-should-be-using-cqrs-almost-everywhere/) (o escenarios competitivos, según el punto de vista) es donde se apliquen CQRS con varias bases de datos.</span><span class="sxs-lookup"><span data-stu-id="e19da-143">Nonetheless, requirements on performance and high scalability in [collaborative scenarios](http://udidahan.com/2011/10/02/why-you-should-be-using-cqrs-almost-everywhere/) (or competitive scenarios, depending on the point of view) is where you should apply CQRS with multiple databases.</span></span>

<span data-ttu-id="e19da-144">**"Datos inactivos" en las bases de datos centrales**.</span><span class="sxs-lookup"><span data-stu-id="e19da-144">**“Cold data” in central databases**.</span></span> <span data-ttu-id="e19da-145">Para informes complejos y las consultas que no necesite datos en tiempo real, un enfoque común consiste en exportar los "datos activos" (datos transaccionales de la microservicios) como "datos inactivos" en grandes bases de datos que se utilizan sólo para informes.</span><span class="sxs-lookup"><span data-stu-id="e19da-145">For complex reports and queries that might not require real-time data, a common approach is to export your “hot data” (transactional data from the microservices) as “cold data” into large databases that are used only for reporting.</span></span> <span data-ttu-id="e19da-146">Dicho sistema de base de datos central puede ser un sistema basado en grandes cantidades de datos, como Hadoop, un almacén de datos como en función de almacenamiento de datos de SQL Azure, o incluso una sola base de datos SQL usan solo para informes (si el tamaño no supondrá un problema).</span><span class="sxs-lookup"><span data-stu-id="e19da-146">That central database system can be a Big Data-based system, like Hadoop, a data warehouse like one based on Azure SQL Data Warehouse, or even a single SQL database used just for reports (if size will not be an issue).</span></span>

<span data-ttu-id="e19da-147">Tenga en cuenta que esta base de datos centralizada lo se utiliza sólo para consultas e informes que no necesitan datos en tiempo real.</span><span class="sxs-lookup"><span data-stu-id="e19da-147">Keep in mind that this centralized database would be used only for queries and reports that do not need real-time data.</span></span> <span data-ttu-id="e19da-148">Las actualizaciones y las transacciones, como el origen de verdad, original deben estar en los datos de microservicios.</span><span class="sxs-lookup"><span data-stu-id="e19da-148">The original updates and transactions, as your source of truth, have to be in your microservices data.</span></span> <span data-ttu-id="e19da-149">La forma en que se sincroniza datos sería mediante el uso de comunicación orientada a eventos (que se describe en las secciones siguientes) o mediante otras herramientas de importación y exportación de infraestructura de base de datos.</span><span class="sxs-lookup"><span data-stu-id="e19da-149">The way you would synchronize data would be either by using event-driven communication (covered in the next sections) or by using other database infrastructure import/export tools.</span></span> <span data-ttu-id="e19da-150">Si se utiliza la comunicación orientada a eventos, ese proceso de integración sería similar a la manera de que propagar datos como se describió anteriormente para las tablas de consulta CQRS.</span><span class="sxs-lookup"><span data-stu-id="e19da-150">If you use event-driven communication, that integration process would be similar to the way you propagate data as described earlier for CQRS query tables.</span></span>

<span data-ttu-id="e19da-151">Sin embargo, si el diseño de aplicaciones implica agregar constantemente información procedente de varios microservicios para consultas complejas, podría ser un síntoma de un diseño incorrecto: debe ser como aislado como sea posible desde otros microservicios un microservicio.</span><span class="sxs-lookup"><span data-stu-id="e19da-151">However, if your application design involves constantly aggregating information from multiple microservices for complex queries, it might be a symptom of a bad design—a microservice should be as isolated as possible from other microservices.</span></span> <span data-ttu-id="e19da-152">(Esto excluye los informes o análisis que siempre debe usar bases de datos centrales de datos de frío). Tener a menudo este problema podría ser un motivo para fusionar mediante combinación microservicios.</span><span class="sxs-lookup"><span data-stu-id="e19da-152">(This excludes reports/analytics that always should use cold-data central databases.) Having this problem often might be a reason to merge microservices.</span></span> <span data-ttu-id="e19da-153">Debe equilibrar la autonomía de la evolución y la implementación de cada microservicio con dependencias seguras, la cohesión y agregación de datos.</span><span class="sxs-lookup"><span data-stu-id="e19da-153">You need to balance the autonomy of evolution and deployment of each microservice with strong dependencies, cohesion, and data aggregation.</span></span>

## <a name="challenge-3-how-to-achieve-consistency-across-multiple-microservices"></a><span data-ttu-id="e19da-154">Desafío \#3: cómo lograr coherencia a través de varios microservicios</span><span class="sxs-lookup"><span data-stu-id="e19da-154">Challenge \#3: How to achieve consistency across multiple microservices</span></span>

<span data-ttu-id="e19da-155">Como se mencionó anteriormente, los datos que pertenecen a cada microservicio es privados para ese microservicio y sólo se pueden acceder mediante la API de microservicio.</span><span class="sxs-lookup"><span data-stu-id="e19da-155">As stated previously, the data owned by each microservice is private to that microservice and can only be accessed using its microservice API.</span></span> <span data-ttu-id="e19da-156">Por lo tanto, un desafío presentado es cómo implementar procesos empresariales de extremo a extremo manteniendo la coherencia entre varias microservicios.</span><span class="sxs-lookup"><span data-stu-id="e19da-156">Therefore, a challenge presented is how to implement end-to-end business processes while keeping consistency across multiple microservices.</span></span>

<span data-ttu-id="e19da-157">Para analizar este problema, echemos un vistazo a un ejemplo de la [eShopOnContainers hacen referencia a aplicación](http://aka.ms/eshoponcontainers).</span><span class="sxs-lookup"><span data-stu-id="e19da-157">To analyze this problem, let’s look at an example from the [eShopOnContainers reference application](http://aka.ms/eshoponcontainers).</span></span> <span data-ttu-id="e19da-158">El catálogo microservicio mantiene información acerca de todos los productos, incluido su nivel estándar.</span><span class="sxs-lookup"><span data-stu-id="e19da-158">The Catalog microservice maintains information about all the products, including their stock level.</span></span> <span data-ttu-id="e19da-159">El orden de microservicio administra los pedidos y debe comprobar que un nuevo pedido no supera las existencias de producto del catálogo disponibles.</span><span class="sxs-lookup"><span data-stu-id="e19da-159">The Ordering microservice manages orders and must verify that a new order does not exceed the available catalog product stock.</span></span> <span data-ttu-id="e19da-160">(O el escenario puede implicar la lógica que controla los productos del pedido pendiente). En una versión monolítica hipotética de esta aplicación, el subsistema de ordenación simplemente podría utilizar una transacción ACID para comprobar las existencias disponibles, crear el orden de la tabla Orders y actualizar las existencias disponibles en la tabla Products.</span><span class="sxs-lookup"><span data-stu-id="e19da-160">(Or the scenario might involve logic that handles backordered products.) In a hypothetical monolithic version of this application, the ordering subsystem could simply use an ACID transaction to check the available stock, create the order in the Orders table, and update the available stock in the Products table.</span></span>

<span data-ttu-id="e19da-161">Sin embargo, en una aplicación de microservicios-según las tablas Order y producto pertenecen a sus respectivos microservicios.</span><span class="sxs-lookup"><span data-stu-id="e19da-161">However, in a microservices- based application, the Order and Product tables are owned by their respective microservices.</span></span> <span data-ttu-id="e19da-162">Ningún microservicio nunca debe incluir las bases de datos que pertenecen a otro microservicio en sus propias transacciones o consultas, tal como se muestra en la figura 4-9.</span><span class="sxs-lookup"><span data-stu-id="e19da-162">No microservice should ever include databases owned by another microservice in its own transactions or queries, as shown in Figure 4-9.</span></span>

![](./media/image9.PNG)

<span data-ttu-id="e19da-163">**Figura 4-9**.</span><span class="sxs-lookup"><span data-stu-id="e19da-163">**Figure 4-9**.</span></span> <span data-ttu-id="e19da-164">Un microservicio no puede acceder directamente a una tabla en otra microservicio</span><span class="sxs-lookup"><span data-stu-id="e19da-164">A microservice cannot directly access a table in another microservice</span></span>

<span data-ttu-id="e19da-165">El orden de microservicio no debe actualizar la tabla de productos directamente, porque es propiedad de la tabla Products la microservicio de catálogo.</span><span class="sxs-lookup"><span data-stu-id="e19da-165">The Ordering microservice should not update the Products table directly, because the Products table is owned by the Catalog microservice.</span></span> <span data-ttu-id="e19da-166">Para realizar una actualización en el catálogo de microservicio, el orden de microservicio siempre debe usar comunicación asincrónica como eventos de integración (mensaje y comunicación basada en eventos).</span><span class="sxs-lookup"><span data-stu-id="e19da-166">To make an update to the Catalog microservice, the Ordering microservice should only ever use asynchronous communication such as integration events (message and event-based communication).</span></span> <span data-ttu-id="e19da-167">Se trata cómo la [eShopOnContainers](http://aka.ms/eshoponcontainers) referencia aplicación lleva a cabo este tipo de actualización.</span><span class="sxs-lookup"><span data-stu-id="e19da-167">This is how the [eShopOnContainers](http://aka.ms/eshoponcontainers) reference application performs this type of update.</span></span>

<span data-ttu-id="e19da-168">Como se indica por la [teorema CAP](https://en.wikipedia.org/wiki/CAP_theorem), debe elegir entre la disponibilidad y homogeneidad ACID.</span><span class="sxs-lookup"><span data-stu-id="e19da-168">As stated by the [CAP theorem](https://en.wikipedia.org/wiki/CAP_theorem), you need to choose between availability and ACID strong consistency.</span></span> <span data-ttu-id="e19da-169">La mayoría de los escenarios basados en microservicio exigen elevada disponibilidad y escalabilidad en lugar de homogeneidad.</span><span class="sxs-lookup"><span data-stu-id="e19da-169">Most microservice-based scenarios demand availability and high scalability as opposed to strong consistency.</span></span> <span data-ttu-id="e19da-170">Aplicaciones de misión crítica deben permanezca activo y se está ejecutando y los desarrolladores pueden solucionar homogeneidad mediante el uso de técnicas para trabajar con coherencia eventual o débil.</span><span class="sxs-lookup"><span data-stu-id="e19da-170">Mission-critical applications must remain up and running, and developers can work around strong consistency by using techniques for working with weak or eventual consistency.</span></span> <span data-ttu-id="e19da-171">Este es el enfoque tomado por la mayoría de las arquitecturas basadas en microservicio.</span><span class="sxs-lookup"><span data-stu-id="e19da-171">This is the approach taken by most microservice-based architectures.</span></span>

<span data-ttu-id="e19da-172">Además, estilo ACID o transacciones de confirmación en dos fases no están frente a principios de microservicios; bases de datos NoSQL mayoría (por ejemplo, base de datos de Azure Cosmos, MongoDB, etc.) no son compatibles con las transacciones de confirmación en dos fases.</span><span class="sxs-lookup"><span data-stu-id="e19da-172">Moreover, ACID-style or two-phase commit transactions are not just against microservices principles; most NoSQL databases (like Azure Cosmos DB, MongoDB, etc.) do not support two-phase commit transactions.</span></span> <span data-ttu-id="e19da-173">Sin embargo, mantener los datos de coherencia entre los servicios y las bases de datos es esencial.</span><span class="sxs-lookup"><span data-stu-id="e19da-173">However, maintaining data consistency across services and databases is essential.</span></span> <span data-ttu-id="e19da-174">Este desafío también está relacionado con la pregunta sobre cómo se propagan los cambios a través de varios microservicios cuando determinados datos deben ser redundante, por ejemplo, cuando necesite tener nombre o la descripción en el catálogo de microservicio y la cesta de compra del producto microservicio.</span><span class="sxs-lookup"><span data-stu-id="e19da-174">This challenge is also related to the question of how to propagate changes across multiple microservices when certain data needs to be redundant—for example, when you need to have the product’s name or description in the Catalog microservice and the Basket microservice.</span></span>

<span data-ttu-id="e19da-175">Una buena solución para este problema consiste en usar coherencia definitiva entre microservicios articulado a través de comunicación controlado por eventos y un sistema de publicación y suscripción.</span><span class="sxs-lookup"><span data-stu-id="e19da-175">A good solution for this problem is to use eventual consistency between microservices articulated through event-driven communication and a publish-and-subscribe system.</span></span> <span data-ttu-id="e19da-176">En estos temas se tratan en la sección [comunicación asincrónica orientada a eventos](#async_event_driven_communication) más adelante en esta guía.</span><span class="sxs-lookup"><span data-stu-id="e19da-176">These topics are covered in the section [Asynchronous event-driven communication](#async_event_driven_communication) later in this guide.</span></span>

## <a name="challenge-4-how-to-design-communication-across-microservice-boundaries"></a><span data-ttu-id="e19da-177">Desafío \#4: cómo diseñar la comunicación a través de límites de microservicio</span><span class="sxs-lookup"><span data-stu-id="e19da-177">Challenge \#4: How to design communication across microservice boundaries</span></span>

<span data-ttu-id="e19da-178">Comunicarse a través de microservicio límites es un verdadero reto.</span><span class="sxs-lookup"><span data-stu-id="e19da-178">Communicating across microservice boundaries is a real challenge.</span></span> <span data-ttu-id="e19da-179">En este contexto, la comunicación no hace referencia a qué protocolo debe usar (HTTP y REST, AMQP, mensajería y así sucesivamente).</span><span class="sxs-lookup"><span data-stu-id="e19da-179">In this context, communication does not refer to what protocol you should use (HTTP and REST, AMQP, messaging, and so on).</span></span> <span data-ttu-id="e19da-180">En su lugar, abordan el estilo de comunicación que se debe usar y especialmente cómo acoplamiento su microservicios deben ser.</span><span class="sxs-lookup"><span data-stu-id="e19da-180">Instead, it addresses what communication style you should use, and especially how coupled your microservices should be.</span></span> <span data-ttu-id="e19da-181">Según el nivel de acoplamiento, cuando se produce el error, el impacto de ese error en el sistema varían considerablemente.</span><span class="sxs-lookup"><span data-stu-id="e19da-181">Depending on the level of coupling, when failure occurs, the impact of that failure on your system will vary significantly.</span></span>

<span data-ttu-id="e19da-182">En un sistema distribuido como una aplicación basada en microservicios, con tantos artefactos desplazarse y con servicios distribuidos en varios servidores o hosts, componentes se producir un error.</span><span class="sxs-lookup"><span data-stu-id="e19da-182">In a distributed system like a microservices-based application, with so many artifacts moving around and with distributed services across many servers or hosts, components will eventually fail.</span></span> <span data-ttu-id="e19da-183">Se producen un error parcial e interrupciones incluso mayores, por lo que necesita diseñar su microservicios así como la comunicación entre ellos teniendo en cuenta los riesgos comunes en este tipo de sistemas distribuidos.</span><span class="sxs-lookup"><span data-stu-id="e19da-183">Partial failure and even larger outages will occur, so you need to design your microservices and the communication across them taking into account the risks common in this type of distributed system.</span></span>

<span data-ttu-id="e19da-184">Un enfoque popular consiste en implementar HTTP (REST)-según microservicios, debido a su simplicidad.</span><span class="sxs-lookup"><span data-stu-id="e19da-184">A popular approach is to implement HTTP (REST)- based microservices, due to their simplicity.</span></span> <span data-ttu-id="e19da-185">Un enfoque basado en HTTP es absolutamente aceptable; aquí el problema está relacionado con cómo se usan.</span><span class="sxs-lookup"><span data-stu-id="e19da-185">An HTTP-based approach is perfectly acceptable; the issue here is related to how you use it.</span></span> <span data-ttu-id="e19da-186">Si utiliza solicitudes y respuestas HTTP para interactuar con su microservicios desde aplicaciones cliente o desde las puertas de enlace de API, que es correcto.</span><span class="sxs-lookup"><span data-stu-id="e19da-186">If you use HTTP requests and responses just to interact with your microservices from client applications or from API Gateways, that is fine.</span></span> <span data-ttu-id="e19da-187">Pero si crea cadenas largas de las llamadas sincrónicas de HTTP a través de microservicios, comunicarse a través de sus límites como si fueron de la microservicios objetos en una aplicación monolítico, se ejecutará la aplicación finalmente problemas.</span><span class="sxs-lookup"><span data-stu-id="e19da-187">But if you create long chains of synchronous HTTP calls across microservices, communicating across their boundaries as if the microservices were objects in a monolithic application, your application will eventually run into problems.</span></span>

<span data-ttu-id="e19da-188">Por ejemplo, imagine que la aplicación cliente realiza una llamada de API de HTTP para un microservicio individual como el orden de microservicio.</span><span class="sxs-lookup"><span data-stu-id="e19da-188">For instance, imagine that your client application makes an HTTP API call to an individual microservice like the Ordering microservice.</span></span> <span data-ttu-id="e19da-189">Si el orden de microservicio a su vez llama adicional del ciclo de microservicios usando HTTP en la misma solicitud/respuesta, está creando una cadena de llamadas HTTP.</span><span class="sxs-lookup"><span data-stu-id="e19da-189">If the Ordering microservice in turn calls additional microservices using HTTP within the same request/response cycle, you are creating a chain of HTTP calls.</span></span> <span data-ttu-id="e19da-190">Podría parecer razonable inicialmente.</span><span class="sxs-lookup"><span data-stu-id="e19da-190">It might sound reasonable initially.</span></span> <span data-ttu-id="e19da-191">Sin embargo, hay consideraciones importantes que tener en cuenta al bajan esta ruta de acceso:</span><span class="sxs-lookup"><span data-stu-id="e19da-191">However, there are important points to consider when going down this path:</span></span>

-   <span data-ttu-id="e19da-192">Rendimiento de bloqueo y baja.</span><span class="sxs-lookup"><span data-stu-id="e19da-192">Blocking and low performance.</span></span> <span data-ttu-id="e19da-193">Debido a la naturaleza sincrónica de HTTP, la solicitud original no obtendrá una respuesta hasta que finalicen todas las llamadas HTTP internas.</span><span class="sxs-lookup"><span data-stu-id="e19da-193">Due to the synchronous nature of HTTP, the original request will not get a response until all the internal HTTP calls are finished.</span></span> <span data-ttu-id="e19da-194">Imagine si el número de estas llamadas aumenta considerablemente y se bloquea al mismo tiempo uno intermedio HTTP llama a un microservicio.</span><span class="sxs-lookup"><span data-stu-id="e19da-194">Imagine if the number of these calls increases significantly and at the same time one of the intermediate HTTP calls to a microservice is blocked.</span></span> <span data-ttu-id="e19da-195">El resultado es que se ve afectado el rendimiento y la escalabilidad global se verán afectada exponencialmente como aumento de las solicitudes HTTP adicional.</span><span class="sxs-lookup"><span data-stu-id="e19da-195">The result is that performance is impacted, and the overall scalability will be exponentially affected as additional HTTP requests increase.</span></span>

-   <span data-ttu-id="e19da-196">Acoplar microservicios con HTTP.</span><span class="sxs-lookup"><span data-stu-id="e19da-196">Coupling microservices with HTTP.</span></span> <span data-ttu-id="e19da-197">Business microservicios no deben acoplarse con otras microservicios de negocios.</span><span class="sxs-lookup"><span data-stu-id="e19da-197">Business microservices should not be coupled with other business microservices.</span></span> <span data-ttu-id="e19da-198">Idealmente, debe no "saben" sobre la existencia de otros microservicios.</span><span class="sxs-lookup"><span data-stu-id="e19da-198">Ideally, they should not “know” about the existence of other microservices.</span></span> <span data-ttu-id="e19da-199">Si la aplicación se basa en microservicios como en el ejemplo de acoplamiento, para lograr la autonomía por microservicio será casi imposible.</span><span class="sxs-lookup"><span data-stu-id="e19da-199">If your application relies on coupling microservices as in the example, achieving autonomy per microservice will be almost impossible.</span></span>

-   <span data-ttu-id="e19da-200">Error en cualquier un microservicio.</span><span class="sxs-lookup"><span data-stu-id="e19da-200">Failure in any one microservice.</span></span> <span data-ttu-id="e19da-201">Si implementa una cadena de microservicios vinculadas mediante llamadas HTTP, si se produce un error en cualquiera de los microservicios (y finalmente se producirá un error) en toda la cadena de microservicios se producirá un error.</span><span class="sxs-lookup"><span data-stu-id="e19da-201">If you implemented a chain of microservices linked by HTTP calls, when any of the microservices fails (and eventually they will fail) the whole chain of microservices will fail.</span></span> <span data-ttu-id="e19da-202">Un sistema basado en microservicio se debe diseñar para continuar trabajando, así como posibles durante errores parciales.</span><span class="sxs-lookup"><span data-stu-id="e19da-202">A microservice-based system should be designed to continue to work as well as possible during partial failures.</span></span> <span data-ttu-id="e19da-203">Incluso si decide implementar lógica de cliente que usa los reintentos con retroceso exponencial o mecanismos de disyuntor, las cadenas de llamadas más complejo HTTP son, cuanto más compleja es implementar una estrategia de error basada en HTTP.</span><span class="sxs-lookup"><span data-stu-id="e19da-203">Even if you implement client logic that uses retries with exponential backoff or circuit breaker mechanisms, the more complex the HTTP call chains are, the more complex it is implement a failure strategy based on HTTP.</span></span>

<span data-ttu-id="e19da-204">De hecho, si sus microservicios internos se comunican mediante la creación de cadenas de solicitudes HTTP como se describe, se puede argumentar que tiene una aplicación monolítica, pero una basada en HTTP entre los procesos en lugar de mecanismos de comunicación intraprocess.</span><span class="sxs-lookup"><span data-stu-id="e19da-204">In fact, if your internal microservices are communicating by creating chains of HTTP requests as described, it could be argued that you have a monolithic application, but one based on HTTP between processes instead of intraprocess communication mechanisms.</span></span>

<span data-ttu-id="e19da-205">Por lo tanto, para exigir la autonomía de microservicio y tener una mejor resistencia, debería minimizar el uso de cadenas de comunicación de solicitud/respuesta entre microservicios.</span><span class="sxs-lookup"><span data-stu-id="e19da-205">Therefore, in order to enforce microservice autonomy and have better resiliency, you should minimize the use of chains of request/response communication across microservices.</span></span> <span data-ttu-id="e19da-206">Se recomienda usar interacción asincrónica solo para la comunicación entre redes de microservicio, ya sea mediante el uso de comunicación asincrónica basado en eventos y mensajes, o mediante sondeo HTTP independientemente del ciclo de solicitud/respuesta HTTP original.</span><span class="sxs-lookup"><span data-stu-id="e19da-206">It is recommended that you use only asynchronous interaction for inter-microservice communication, either by using asynchronous message- and event-based communication, or by using HTTP polling independently of the original HTTP request/response cycle.</span></span>

<span data-ttu-id="e19da-207">El uso de comunicación asincrónica se explica con más detalle más adelante en esta guía en las secciones [microservicio asincrónica integración aplica la autonomía de microservicio](#asynchronous-microservice-integration-enforce-microservices-autonomy) y [asincrónico comunicación basada en mensajes](#asynchronous-message-based-communication).</span><span class="sxs-lookup"><span data-stu-id="e19da-207">The use of asynchronous communication is explained with additional details later in this guide in the sections [Asynchronous microservice integration enforces microservice’s autonomy](#asynchronous-microservice-integration-enforce-microservices-autonomy) and [Asynchronous message-based communication](#asynchronous-message-based-communication).</span></span>

## <a name="additional-resources"></a><span data-ttu-id="e19da-208">Recursos adicionales</span><span class="sxs-lookup"><span data-stu-id="e19da-208">Additional resources</span></span>

-   <span data-ttu-id="e19da-209">**Teorema de CAP**
    [*https://en.wikipedia.org/wiki/CAP\_teorema*](https://en.wikipedia.org/wiki/CAP_theorem)</span><span class="sxs-lookup"><span data-stu-id="e19da-209">**CAP theorem**
[*https://en.wikipedia.org/wiki/CAP\_theorem*](https://en.wikipedia.org/wiki/CAP_theorem)</span></span>

-   <span data-ttu-id="e19da-210">**Coherencia definitiva**
    [*https://en.wikipedia.org/wiki/Eventual\_coherencia*](https://en.wikipedia.org/wiki/Eventual_consistency)</span><span class="sxs-lookup"><span data-stu-id="e19da-210">**Eventual consistency**
[*https://en.wikipedia.org/wiki/Eventual\_consistency*](https://en.wikipedia.org/wiki/Eventual_consistency)</span></span>

-   <span data-ttu-id="e19da-211">**Manual de coherencia de datos**
    [*https://msdn.microsoft.com/library/dn589800.aspx*](https://msdn.microsoft.com/library/dn589800.aspx)</span><span class="sxs-lookup"><span data-stu-id="e19da-211">**Data Consistency Primer**
[*https://msdn.microsoft.com/library/dn589800.aspx*](https://msdn.microsoft.com/library/dn589800.aspx)</span></span>

-   <span data-ttu-id="e19da-212">**Martin Fowler. CQRS (comando y segregación de responsabilidad de consulta)**
    [*http://martinfowler.com/bliki/CQRS.html*](http://martinfowler.com/bliki/CQRS.html)</span><span class="sxs-lookup"><span data-stu-id="e19da-212">**Martin Fowler. CQRS (Command and Query Responsibility Segregation)**
[*http://martinfowler.com/bliki/CQRS.html*](http://martinfowler.com/bliki/CQRS.html)</span></span>

-   <span data-ttu-id="e19da-213">**Materializar la vista**
    [*https://docs.microsoft.com/azure/architecture/patterns/materialized-view*](https://docs.microsoft.com/azure/architecture/patterns/materialized-view)</span><span class="sxs-lookup"><span data-stu-id="e19da-213">**Materialized View**
[*https://docs.microsoft.com/azure/architecture/patterns/materialized-view*](https://docs.microsoft.com/azure/architecture/patterns/materialized-view)</span></span>

-   <span data-ttu-id="e19da-214">**Charles fila. Vs ACID. BASE: Shifting pH de procesamiento de transacciones de base de datos**
    [*http://www.dataversity.net/acid-vs-base-the-shifting-ph-of-database-transaction-processing/*](http://www.dataversity.net/acid-vs-base-the-shifting-ph-of-database-transaction-processing/)</span><span class="sxs-lookup"><span data-stu-id="e19da-214">**Charles Row. ACID vs. BASE: The Shifting pH of Database Transaction Processing**
[*http://www.dataversity.net/acid-vs-base-the-shifting-ph-of-database-transaction-processing/*](http://www.dataversity.net/acid-vs-base-the-shifting-ph-of-database-transaction-processing/)</span></span>

-   <span data-ttu-id="e19da-215">**Transacciones de compensación**
    [*https://docs.microsoft.com/azure/architecture/patterns/compensating-transaction*](https://docs.microsoft.com/azure/architecture/patterns/compensating-transaction)</span><span class="sxs-lookup"><span data-stu-id="e19da-215">**Compensating Transaction**
[*https://docs.microsoft.com/azure/architecture/patterns/compensating-transaction*](https://docs.microsoft.com/azure/architecture/patterns/compensating-transaction)</span></span>

-   <span data-ttu-id="e19da-216">**UDI Dahan. Composición orientadas a servicios**
    [*http://udidahan.com/2014/07/30/service-oriented-composition-with-video/*](http://udidahan.com/2014/07/30/service-oriented-composition-with-video/)</span><span class="sxs-lookup"><span data-stu-id="e19da-216">**Udi Dahan. Service Oriented Composition**
[*http://udidahan.com/2014/07/30/service-oriented-composition-with-video/*](http://udidahan.com/2014/07/30/service-oriented-composition-with-video/)</span></span>


>[!div class="step-by-step"]
<span data-ttu-id="e19da-217">[Anterior] (lógico-frente a-física-architecture.md) [siguiente] (identificar-microservicio-dominio-modelo-boundaries.md)</span><span class="sxs-lookup"><span data-stu-id="e19da-217">[Previous] (logical-versus-physical-architecture.md) [Next] (identify-microservice-domain-model-boundaries.md)</span></span>
