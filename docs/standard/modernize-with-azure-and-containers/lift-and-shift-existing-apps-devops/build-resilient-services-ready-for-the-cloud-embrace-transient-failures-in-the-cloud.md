---
title: Crear servicios resistentes listos para la nube. Adoptar errores transitorios en la nube
description: Arquitectura de Microservicios de .NET para aplicaciones .NET en contenedores | Crear servicios resistentes listos para la nube. Adoptar errores transitorios en la nube
author: CESARDELATORRE
ms.author: wiwagn
ms.date: 10/26/2017
ms.openlocfilehash: 9c21ae37ad2e4fc318eb4b206069db7662bfc5d7
ms.sourcegitcommit: 4f3fef493080a43e70e951223894768d36ce430a
ms.translationtype: HT
ms.contentlocale: es-ES
ms.lasthandoff: 11/21/2017
---
# <a name="build-resilient-services-ready-for-the-cloud-embrace-transient-failures-in-the-cloud"></a><span data-ttu-id="bbd39-105">Crear servicios resistentes listos para la nube: adoptar errores transitorios en la nube</span><span class="sxs-lookup"><span data-stu-id="bbd39-105">Build resilient services ready for the cloud: Embrace transient failures in the cloud</span></span> 

<span data-ttu-id="bbd39-106">La resistencia es la capacidad de recuperarse de errores y seguir funcionando.</span><span class="sxs-lookup"><span data-stu-id="bbd39-106">Resiliency is the ability to recover from failures and continue to function.</span></span> <span data-ttu-id="bbd39-107">Resistencia no es cuestión de evitar errores, pero acepta el hecho de que se producirán errores y, a continuación, responder a ellas de forma que se evita perder el tiempo de inactividad o datos.</span><span class="sxs-lookup"><span data-stu-id="bbd39-107">Resiliency is not about avoiding failures, but accepting the fact that failures will occur, and then responding to them in a way that avoids downtime or data loss.</span></span> <span data-ttu-id="bbd39-108">El objetivo de la resistencia consiste en que la aplicación vuelva a un estado totalmente operativo después de un error.</span><span class="sxs-lookup"><span data-stu-id="bbd39-108">The goal of resiliency is to return the application to a fully functioning state after a failure.</span></span>

<span data-ttu-id="bbd39-109">La aplicación está lista para la nube cuando, como mínimo, implementa un modelo basado en software de resistencia, en lugar de un modelo basado en hardware.</span><span class="sxs-lookup"><span data-stu-id="bbd39-109">Your application is ready for the cloud when, at a minimum, it implements a software-based model of resiliency, rather than a hardware-based model.</span></span> <span data-ttu-id="bbd39-110">La aplicación en la nube debe adoptar los errores parciales que por supuesto, se producirán.</span><span class="sxs-lookup"><span data-stu-id="bbd39-110">Your cloud application must embrace the partial failures that will certainly occur.</span></span> <span data-ttu-id="bbd39-111">Debe diseñar o parcialmente refactorizar la aplicación si desea conseguir resistencia a errores parciales esperados.</span><span class="sxs-lookup"><span data-stu-id="bbd39-111">You need to design or partially refactor your application if you want to achieve resiliency to expected partial failures.</span></span> <span data-ttu-id="bbd39-112">Se deben diseñar para hacer frente a errores parciales, como las interrupciones de red transitorios y nodos o de bloqueo en la nube.</span><span class="sxs-lookup"><span data-stu-id="bbd39-112">It should be designed to cope with partial failures, like transient network outages and nodes, or VMs crashing in the cloud.</span></span> <span data-ttu-id="bbd39-113">Incluso los contenedores que se mueven a otro nodo en un clúster de orchestrator pueden provocar errores cortos intermitentes dentro de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="bbd39-113">Even containers being moved to a different node within an orchestrator cluster can cause intermittent short failures within the application.</span></span>

## <a name="handling-partial-failure"></a><span data-ttu-id="bbd39-114">Control de errores parciales</span><span class="sxs-lookup"><span data-stu-id="bbd39-114">Handling partial failure</span></span>

<span data-ttu-id="bbd39-115">En una aplicación basada en la nube, hay un riesgo de error parcial omnipresente.</span><span class="sxs-lookup"><span data-stu-id="bbd39-115">In a cloud-based application, there's an ever-present risk of partial failure.</span></span> <span data-ttu-id="bbd39-116">Por ejemplo, podría producirse un error en una instancia de un sitio Web único o un contenedor o podría ser no está disponible o no responde durante poco tiempo.</span><span class="sxs-lookup"><span data-stu-id="bbd39-116">For instance, a single website instance or a container might fail, or it might be unavailable or unresponsive for a short time.</span></span> <span data-ttu-id="bbd39-117">O bien, puede bloquearse una única máquina virtual o servidor.</span><span class="sxs-lookup"><span data-stu-id="bbd39-117">Or, a single VM or server might crash.</span></span>

<span data-ttu-id="bbd39-118">Dado que los clientes y servicios son procesos independientes, es posible que un servicio no pueda responder de manera oportuna a solicitud del cliente.</span><span class="sxs-lookup"><span data-stu-id="bbd39-118">Because clients and services are separate processes, a service might not be able to respond in a timely manner to a client's request.</span></span> <span data-ttu-id="bbd39-119">El servicio podría estar sobrecargado y muy lentamente responder a las solicitudes, o puede que simplemente no sea accesible durante un breve tiempo debido a problemas de red.</span><span class="sxs-lookup"><span data-stu-id="bbd39-119">The service might be overloaded and respond extremely slowly to requests, or it might simply not be accessible for a short time because of network issues.</span></span>

<span data-ttu-id="bbd39-120">Por ejemplo, imagine una aplicación de .NET monolítica que tiene acceso a una base de datos en la base de datos de SQL Azure.</span><span class="sxs-lookup"><span data-stu-id="bbd39-120">For example, consider a monolithic .NET application that accesses a database in Azure SQL Database.</span></span> <span data-ttu-id="bbd39-121">Si la base de datos de SQL Azure o cualquier otro servicio de terceros no responde durante un breve tiempo (una base de datos de SQL Azure se pueden mover a un servidor o de otro nodo y dejar de responder durante unos segundos), cuando el usuario intenta realizar ninguna acción, la aplicación puede bloquearse y mostrar w una excepción en el mismo momento.</span><span class="sxs-lookup"><span data-stu-id="bbd39-121">If the Azure SQL database or any other third-party service is unresponsive for a brief time (an Azure SQL database might be moved to a different node or server, and be unresponsive for a few seconds), when the user tries to do any action, the application might crash and show an exception at the very same moment.</span></span>

<span data-ttu-id="bbd39-122">Una situación similar puede producirse en una aplicación que consuma servicios HTTP.</span><span class="sxs-lookup"><span data-stu-id="bbd39-122">A similar scenario might occur in an app that consumes HTTP services.</span></span> <span data-ttu-id="bbd39-123">La red o el propio servicio no estén disponible en la nube durante un error transitorio, corto.</span><span class="sxs-lookup"><span data-stu-id="bbd39-123">The network or the service itself might not be available in the cloud during a short, transient failure.</span></span>

<span data-ttu-id="bbd39-124">Una aplicación resistente como se muestra en la figura 4-9 debe implementar técnicas como "reintentos con retroceso exponencial" para dar una oportunidad para controlar errores transitorios en recursos de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="bbd39-124">A resilient application like the one shown in Figure 4-9 should implement techniques like "retries with exponential backoff" to give the application an opportunity to handle transient failures in resources.</span></span> <span data-ttu-id="bbd39-125">También debe utilizar "los disyuntores" en sus aplicaciones.</span><span class="sxs-lookup"><span data-stu-id="bbd39-125">You also should use "circuit breakers" in your applications.</span></span> <span data-ttu-id="bbd39-126">Un disyuntor detiene una aplicación intente tener acceso a un recurso cuando es realmente un error de larga duración.</span><span class="sxs-lookup"><span data-stu-id="bbd39-126">A circuit breaker stops an application from trying to access a resource when it's actually a long-term failure.</span></span> <span data-ttu-id="bbd39-127">Mediante el uso de un disyuntor, la aplicación evita provocar una denegación de servicio a sí mismo.</span><span class="sxs-lookup"><span data-stu-id="bbd39-127">By using a circuit breaker, the application avoids provoking a denial of service to itself.</span></span>

![Errores parciales controladas reintentos con retroceso exponencial](./media/image9.png)

> <span data-ttu-id="bbd39-129">**Figura 4-9.**</span><span class="sxs-lookup"><span data-stu-id="bbd39-129">**Figure 4-9.**</span></span> <span data-ttu-id="bbd39-130">Errores parciales controladas reintentos con retroceso exponencial</span><span class="sxs-lookup"><span data-stu-id="bbd39-130">Partial failures handled by retries with exponential backoff</span></span>

<span data-ttu-id="bbd39-131">Puede utilizar estas técnicas en recursos HTTP y en los recursos de base de datos.</span><span class="sxs-lookup"><span data-stu-id="bbd39-131">You can use these techniques both in HTTP resources and in database resources.</span></span> <span data-ttu-id="bbd39-132">En la figura 4-9, la aplicación se basa en una arquitectura de 3 niveles, por lo que necesita estas técnicas en el nivel de servicios (HTTP) y en el nivel de capa de datos (TCP).</span><span class="sxs-lookup"><span data-stu-id="bbd39-132">In Figure 4-9, the application is based on a 3-tier architecture, so you need these techniques at the services level (HTTP) and at the data tier level (TCP).</span></span> <span data-ttu-id="bbd39-133">En una aplicación monolítica que usa una capa de aplicación único además de la base de datos (no hay servicios adicionales o microservicios), control de errores transitorios en el nivel de conexión de base de datos puede ser suficiente.</span><span class="sxs-lookup"><span data-stu-id="bbd39-133">In a monolithic application that uses only a single app tier in addition to the database (no additional services or microservices), handling transient failures at the database connection level might be enough.</span></span> <span data-ttu-id="bbd39-134">En ese caso, se requiere normalmente solo una configuración específica de la conexión de base de datos.</span><span class="sxs-lookup"><span data-stu-id="bbd39-134">In that scenario, usually just a particular configuration of the database connection is required.</span></span>

<span data-ttu-id="bbd39-135">Al implementar las comunicaciones resistentes que tienen acceso a la base de datos, según la versión de .NET que usa, puede ser muy sencilla (por ejemplo, [con Entity Framework 6 o posterior](https://msdn.microsoft.com/library/dn456835(v=vs.113).aspx), es simplemente una cuestión de configurar la conexión de base de datos).</span><span class="sxs-lookup"><span data-stu-id="bbd39-135">When implementing resilient communications that access the database, depending on the version of .NET you are using, it can be very straightforward (for example, [with Entity Framework 6 or later](https://msdn.microsoft.com/library/dn456835(v=vs.113).aspx), it's just a matter of configuring the database connection).</span></span> <span data-ttu-id="bbd39-136">O bien, tendrá que utilizar bibliotecas adicionales como la [Transient Fault Handling Application Block](https://msdn.microsoft.com/library/hh680934(v=pandp.50).aspx) (para versiones anteriores de. NET), o incluso implementar su propia biblioteca.</span><span class="sxs-lookup"><span data-stu-id="bbd39-136">Or, you might need to use additional libraries like the [Transient Fault Handling Application Block](https://msdn.microsoft.com/library/hh680934(v=pandp.50).aspx) (for earlier versions of .NET), or even implement your own library.</span></span>

<span data-ttu-id="bbd39-137">Al implementar los reintentos HTTP y los disyuntores, la recomendación para .NET es usar el [Polly](https://github.com/App-vNext/Polly) biblioteca, que tiene como destino .NET 4.0, .NET 4.5 y .NET 1.1 estándar, que incluye compatibilidad con .NET Core.</span><span class="sxs-lookup"><span data-stu-id="bbd39-137">When implementing HTTP retries and circuit breakers, the recommendation for .NET is to use the [Polly](https://github.com/App-vNext/Polly) library, which targets .NET 4.0, .NET 4.5, and .NET Standard 1.1, which includes .NET Core support.</span></span>

<span data-ttu-id="bbd39-138">Para obtener información sobre cómo implementar estrategias para controlar los errores parciales en la nube, consulte las siguientes referencias.</span><span class="sxs-lookup"><span data-stu-id="bbd39-138">To learn how to implement strategies for handling partial failures in the cloud, see the following references.</span></span>

### <a name="additional-resources"></a><span data-ttu-id="bbd39-139">Recursos adicionales</span><span class="sxs-lookup"><span data-stu-id="bbd39-139">Additional resources</span></span>

-   <span data-ttu-id="bbd39-140">**Implementación de la comunicación resistente para controlar los errores parciales**</span><span class="sxs-lookup"><span data-stu-id="bbd39-140">**Implementing resilient communication to handle partial failure**</span></span>

    [<span data-ttu-id="bbd39-141">https://docs.Microsoft.com/dotnet/Standard/microservices-Architecture/Implement-Resilient-Applications/Partial-Failure-Strategies</span><span class="sxs-lookup"><span data-stu-id="bbd39-141">https://docs.microsoft.com/dotnet/standard/microservices-architecture/implement-resilient-applications/partial-failure-strategies</span></span>](https://docs.microsoft.com/dotnet/standard/microservices-architecture/implement-resilient-applications/partial-failure-strategies)

-   <span data-ttu-id="bbd39-142">**Entity Framework conexión resistencia lógica de reintento y (versión 6 y versiones posterior)**</span><span class="sxs-lookup"><span data-stu-id="bbd39-142">**Entity Framework connection resiliency and retry logic (version 6 and later)**</span></span>

    <span data-ttu-id="bbd39-143">[https://msdn.Microsoft.com/en-us/library/dn456835 (v=vs.113).aspx](https://msdn.microsoft.com/en-us/library/dn456835(v=vs.113).aspx)</span><span class="sxs-lookup"><span data-stu-id="bbd39-143">[https://msdn.microsoft.com/en-us/library/dn456835(v=vs.113).aspx](https://msdn.microsoft.com/en-us/library/dn456835(v=vs.113).aspx)</span></span>

-   <span data-ttu-id="bbd39-144">**El bloque de aplicaciones de control de errores transitorios**</span><span class="sxs-lookup"><span data-stu-id="bbd39-144">**The Transient Fault Handling Application Block**</span></span>

<!-- -->

-   <span data-ttu-id="bbd39-145">[https://msdn.Microsoft.com/en-us/library/hh680934 (v=pandp.50).aspx](https://msdn.microsoft.com/en-us/library/hh680934(v=pandp.50).aspx)</span><span class="sxs-lookup"><span data-stu-id="bbd39-145">[https://msdn.microsoft.com/en-us/library/hh680934(v=pandp.50).aspx](https://msdn.microsoft.com/en-us/library/hh680934(v=pandp.50).aspx)</span></span>

-   <span data-ttu-id="bbd39-146">**Biblioteca de Polly para la comunicación HTTP resistente**</span><span class="sxs-lookup"><span data-stu-id="bbd39-146">**Polly library for resilient HTTP communication**</span></span>

    <span data-ttu-id="bbd39-147">https://github.com/app-vNext/Polly</span><span class="sxs-lookup"><span data-stu-id="bbd39-147">https://github.com/App-vNext/Polly</span></span>

>[!div class="step-by-step"]
<span data-ttu-id="bbd39-148">[Anterior](when-to-deploy-windows-containers-to-azure-container-service-kubernetes.md)
[Siguiente](modernize-your-apps-with-monitoring-and-telemetry.md)</span><span class="sxs-lookup"><span data-stu-id="bbd39-148">[Previous](when-to-deploy-windows-containers-to-azure-container-service-kubernetes.md)
[Next](modernize-your-apps-with-monitoring-and-telemetry.md)</span></span>
