---
title: "Tutorial: Implementar un componente que admita el modelo asincrónico basado en eventos"
ms.custom: 
ms.date: 03/30/2017
ms.prod: .net
ms.reviewer: 
ms.suite: 
ms.technology: dotnet-standard
ms.tgt_pltfrm: 
ms.topic: article
dev_langs:
- csharp
- vb
helpviewer_keywords:
- Event-based Asynchronous Pattern
- ProgressChangedEventArgs class
- BackgroundWorker component
- events [.NET Framework], asynchronous
- Asynchronous Pattern
- AsyncOperationManager class
- threading [.NET Framework], asynchronous features
- components [.NET Framework], asynchronous
- AsyncOperation class
- threading [Windows Forms], asynchronous features
- AsyncCompletedEventArgs class
ms.assetid: 61f676b5-936f-40f6-83ce-f22805ec9c2f
caps.latest.revision: "21"
author: dotnet-bot
ms.author: dotnetcontent
manager: wpickett
ms.openlocfilehash: 150e4b27cc149774895574ddd196de5f9bc2acd8
ms.sourcegitcommit: 4f3fef493080a43e70e951223894768d36ce430a
ms.translationtype: HT
ms.contentlocale: es-ES
ms.lasthandoff: 11/21/2017
---
# <a name="walkthrough-implementing-a-component-that-supports-the-event-based-asynchronous-pattern"></a><span data-ttu-id="8c01e-102">Tutorial: Implementar un componente que admita el modelo asincrónico basado en eventos</span><span class="sxs-lookup"><span data-stu-id="8c01e-102">Walkthrough: Implementing a Component That Supports the Event-based Asynchronous Pattern</span></span>
<span data-ttu-id="8c01e-103">Si está escribiendo una clase con algunas operaciones que puedan incurrir en retrasos notables, considere la posibilidad de darle funcionalidad asincrónica implementando la [introducción de patrón asincrónico basado en eventos](../../../docs/standard/asynchronous-programming-patterns/event-based-asynchronous-pattern-overview.md).</span><span class="sxs-lookup"><span data-stu-id="8c01e-103">If you are writing a class with some operations that may incur noticeable delays, consider giving it asynchronous functionality by implementing the [Event-based Asynchronous Pattern Overview](../../../docs/standard/asynchronous-programming-patterns/event-based-asynchronous-pattern-overview.md).</span></span>  
  
 <span data-ttu-id="8c01e-104">Este tutorial muestra cómo crear un componente que implementa el modelo asincrónico basado en eventos.</span><span class="sxs-lookup"><span data-stu-id="8c01e-104">This walkthrough illustrates how to create a component that implements the Event-based Asynchronous Pattern.</span></span> <span data-ttu-id="8c01e-105">Se implementa utilizando las clases auxiliares de la <xref:System.ComponentModel?displayProperty=nameWithType> espacio de nombres, lo que garantiza que el componente funciona correctamente bajo cualquier modelo de aplicación, incluidos [!INCLUDE[vstecasp](../../../includes/vstecasp-md.md)], aplicaciones de formularios Windows Forms y aplicaciones de consola.</span><span class="sxs-lookup"><span data-stu-id="8c01e-105">It is implemented using helper classes from the <xref:System.ComponentModel?displayProperty=nameWithType> namespace, which ensures that the component works correctly under any application model, including [!INCLUDE[vstecasp](../../../includes/vstecasp-md.md)], Console applications and Windows Forms applications.</span></span> <span data-ttu-id="8c01e-106">Este componente es también puede diseñar con una <xref:System.Windows.Forms.PropertyGrid> control y sus propios diseñadores personalizados.</span><span class="sxs-lookup"><span data-stu-id="8c01e-106">This component is also designable with a <xref:System.Windows.Forms.PropertyGrid> control and your own custom designers.</span></span>  
  
 <span data-ttu-id="8c01e-107">Cuando haya terminado, tendrá una aplicación que calcula los números primos de forma asincrónica.</span><span class="sxs-lookup"><span data-stu-id="8c01e-107">When you are through, you will have an application that computes prime numbers asynchronously.</span></span> <span data-ttu-id="8c01e-108">La aplicación tendrá un subproceso de interfaz (UI) de usuario principal y un subproceso para cada cálculo de números primos.</span><span class="sxs-lookup"><span data-stu-id="8c01e-108">Your application will have a main user interface (UI) thread and a thread for each prime number calculation.</span></span> <span data-ttu-id="8c01e-109">Aunque comprobar si es un gran número primo puede tardar bastante tiempo, el subproceso de interfaz de usuario principal no se interrumpirá por este retraso y el formulario seguirá receptivo durante los cálculos.</span><span class="sxs-lookup"><span data-stu-id="8c01e-109">Although testing whether a large number is prime can take a noticeable amount of time, the main UI thread will not be interrupted by this delay, and the form will be responsive during the calculations.</span></span> <span data-ttu-id="8c01e-110">Podrá ejecutar como muchos cálculos como desee simultáneamente y de forma selectiva Cancelar cálculos pendientes.</span><span class="sxs-lookup"><span data-stu-id="8c01e-110">You will be able to run as many calculations as you like concurrently and selectively cancel pending calculations.</span></span>  
  
 <span data-ttu-id="8c01e-111">Las tareas ilustradas en este tutorial incluyen:</span><span class="sxs-lookup"><span data-stu-id="8c01e-111">Tasks illustrated in this walkthrough include:</span></span>  
  
-   <span data-ttu-id="8c01e-112">Crear el componente</span><span class="sxs-lookup"><span data-stu-id="8c01e-112">Creating the Component</span></span>  
  
-   <span data-ttu-id="8c01e-113">Definir delegados y eventos asincrónicos públicos</span><span class="sxs-lookup"><span data-stu-id="8c01e-113">Defining Public Asynchronous Events and Delegates</span></span>  
  
-   <span data-ttu-id="8c01e-114">Definir delegados privados</span><span class="sxs-lookup"><span data-stu-id="8c01e-114">Defining Private Delegates</span></span>  
  
-   <span data-ttu-id="8c01e-115">Implementar eventos públicos</span><span class="sxs-lookup"><span data-stu-id="8c01e-115">Implementing Public Events</span></span>  
  
-   <span data-ttu-id="8c01e-116">Implementar el método de finalización</span><span class="sxs-lookup"><span data-stu-id="8c01e-116">Implementing the Completion Method</span></span>  
  
-   <span data-ttu-id="8c01e-117">Implementar los métodos de trabajo</span><span class="sxs-lookup"><span data-stu-id="8c01e-117">Implementing the Worker Methods</span></span>  
  
-   <span data-ttu-id="8c01e-118">Implementar métodos de inicio y cancelar</span><span class="sxs-lookup"><span data-stu-id="8c01e-118">Implementing Start and Cancel Methods</span></span>  
  
 <span data-ttu-id="8c01e-119">Para copiar el código de este tema como una sola lista, vea [Cómo: implementar un componente que admita el modelo asincrónico basado en eventos](../../../docs/standard/asynchronous-programming-patterns/component-that-supports-the-event-based-asynchronous-pattern.md).</span><span class="sxs-lookup"><span data-stu-id="8c01e-119">To copy the code in this topic as a single listing, see [How to: Implement a Component That Supports the Event-based Asynchronous Pattern](../../../docs/standard/asynchronous-programming-patterns/component-that-supports-the-event-based-asynchronous-pattern.md).</span></span>  
  
## <a name="creating-the-component"></a><span data-ttu-id="8c01e-120">Crear el componente</span><span class="sxs-lookup"><span data-stu-id="8c01e-120">Creating the Component</span></span>  
 <span data-ttu-id="8c01e-121">El primer paso es crear el componente que implementará el modelo asincrónico basado en eventos.</span><span class="sxs-lookup"><span data-stu-id="8c01e-121">The first step is to create the component that will implement the Event-based Asynchronous Pattern.</span></span>  
  
#### <a name="to-create-the-component"></a><span data-ttu-id="8c01e-122">Para crear el componente</span><span class="sxs-lookup"><span data-stu-id="8c01e-122">To create the component</span></span>  
  
-   <span data-ttu-id="8c01e-123">Cree una clase denominada `PrimeNumberCalculator` que hereda de <xref:System.ComponentModel.Component>.</span><span class="sxs-lookup"><span data-stu-id="8c01e-123">Create a class called `PrimeNumberCalculator` that inherits from <xref:System.ComponentModel.Component>.</span></span>  
  
## <a name="defining-public-asynchronous-events-and-delegates"></a><span data-ttu-id="8c01e-124">Definir delegados y eventos asincrónicos públicos</span><span class="sxs-lookup"><span data-stu-id="8c01e-124">Defining Public Asynchronous Events and Delegates</span></span>  
 <span data-ttu-id="8c01e-125">El componente se comunica con los clientes mediante eventos.</span><span class="sxs-lookup"><span data-stu-id="8c01e-125">Your component communicates to clients using events.</span></span> <span data-ttu-id="8c01e-126">El *MethodName* `Completed` alertas de eventos a los clientes la finalización de una tarea asincrónica y el *MethodName* `ProgressChanged` eventos informa a los clientes del progreso de una tarea asincrónica.</span><span class="sxs-lookup"><span data-stu-id="8c01e-126">The *MethodName*`Completed` event alerts clients to the completion of an asynchronous task, and the *MethodName*`ProgressChanged` event informs clients of the progress of an asynchronous task.</span></span>  
  
#### <a name="to-define-asynchronous-events-for-clients-of-your-component"></a><span data-ttu-id="8c01e-127">Para definir eventos asincrónicos para los clientes de su componente:</span><span class="sxs-lookup"><span data-stu-id="8c01e-127">To define asynchronous events for clients of your component:</span></span>  
  
1.  <span data-ttu-id="8c01e-128">Importar la <xref:System.Threading?displayProperty=nameWithType> y <xref:System.Collections.Specialized?displayProperty=nameWithType> los espacios de nombres en la parte superior del archivo.</span><span class="sxs-lookup"><span data-stu-id="8c01e-128">Import the <xref:System.Threading?displayProperty=nameWithType> and <xref:System.Collections.Specialized?displayProperty=nameWithType> namespaces at the top of your file.</span></span>  
  
     [!code-csharp[System.ComponentModel.AsyncOperationManager#11](../../../samples/snippets/csharp/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/CS/primenumbercalculatormain.cs#11)]
     [!code-vb[System.ComponentModel.AsyncOperationManager#11](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/VB/primenumbercalculatormain.vb#11)]  
  
2.  <span data-ttu-id="8c01e-129">Antes de la `PrimeNumberCalculator` definición, de la clase declarar delegados para los eventos de progreso y la finalización.</span><span class="sxs-lookup"><span data-stu-id="8c01e-129">Before the `PrimeNumberCalculator` class definition, declare delegates for progress and completion events.</span></span>  
  
     [!code-csharp[System.ComponentModel.AsyncOperationManager#7](../../../samples/snippets/csharp/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/CS/primenumbercalculatormain.cs#7)]
     [!code-vb[System.ComponentModel.AsyncOperationManager#7](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/VB/primenumbercalculatormain.vb#7)]  
  
3.  <span data-ttu-id="8c01e-130">En el `PrimeNumberCalculator` definición de clase, declare los eventos para los informes de progreso y la finalización a los clientes.</span><span class="sxs-lookup"><span data-stu-id="8c01e-130">In the `PrimeNumberCalculator` class definition, declare events for reporting progress and completion to clients.</span></span>  
  
     [!code-csharp[System.ComponentModel.AsyncOperationManager#8](../../../samples/snippets/csharp/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/CS/primenumbercalculatormain.cs#8)]
     [!code-vb[System.ComponentModel.AsyncOperationManager#8](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/VB/primenumbercalculatormain.vb#8)]  
  
4.  <span data-ttu-id="8c01e-131">Después de la `PrimeNumberCalculator` definición de clase, derive la `CalculatePrimeCompletedEventArgs` clase para informar del resultado de cada cálculo al controlador de eventos del cliente la `CalculatePrimeCompleted`.event.</span><span class="sxs-lookup"><span data-stu-id="8c01e-131">After the `PrimeNumberCalculator` class definition, derive the `CalculatePrimeCompletedEventArgs` class for reporting the outcome of each calculation to the client's event handler for the `CalculatePrimeCompleted`.event.</span></span> <span data-ttu-id="8c01e-132">Además el `AsyncCompletedEventArgs` propiedades, esta clase permite al cliente determinar qué numero se ha comprobado, si es primo y cuál es el primer divisor si no es principal.</span><span class="sxs-lookup"><span data-stu-id="8c01e-132">In addition to the `AsyncCompletedEventArgs` properties, this class enables the client to determine what number was tested, whether it is prime, and what the first divisor is if it is not prime.</span></span>  
  
     [!code-csharp[System.ComponentModel.AsyncOperationManager#6](../../../samples/snippets/csharp/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/CS/primenumbercalculatormain.cs#6)]
     [!code-vb[System.ComponentModel.AsyncOperationManager#6](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/VB/primenumbercalculatormain.vb#6)]  
  
## <a name="checkpoint"></a><span data-ttu-id="8c01e-133">Punto de control</span><span class="sxs-lookup"><span data-stu-id="8c01e-133">Checkpoint</span></span>  
 <span data-ttu-id="8c01e-134">En este momento, puede compilar el componente.</span><span class="sxs-lookup"><span data-stu-id="8c01e-134">At this point, you can build the component.</span></span>  
  
#### <a name="to-test-your-component"></a><span data-ttu-id="8c01e-135">Para probar el componente</span><span class="sxs-lookup"><span data-stu-id="8c01e-135">To test your component</span></span>  
  
-   <span data-ttu-id="8c01e-136">Compilar el componente.</span><span class="sxs-lookup"><span data-stu-id="8c01e-136">Compile the component.</span></span>  
  
     <span data-ttu-id="8c01e-137">Recibirá dos advertencias del compilador:</span><span class="sxs-lookup"><span data-stu-id="8c01e-137">You will receive two compiler warnings:</span></span>  
  
    ```  
    warning CS0067: The event 'AsynchronousPatternExample.PrimeNumberCalculator.ProgressChanged' is never used  
    warning CS0067: The event 'AsynchronousPatternExample.PrimeNumberCalculator.CalculatePrimeCompleted' is never used  
    ```  
  
     <span data-ttu-id="8c01e-138">Estas advertencias se borrará en la sección siguiente.</span><span class="sxs-lookup"><span data-stu-id="8c01e-138">These warnings will be cleared in the next section.</span></span>  
  
## <a name="defining-private-delegates"></a><span data-ttu-id="8c01e-139">Definir delegados privados</span><span class="sxs-lookup"><span data-stu-id="8c01e-139">Defining Private Delegates</span></span>  
 <span data-ttu-id="8c01e-140">Los aspectos asincrónicos de las `PrimeNumberCalculator` componentes se implementan internamente con un delegado especial conocido como un <xref:System.Threading.SendOrPostCallback>.</span><span class="sxs-lookup"><span data-stu-id="8c01e-140">The asynchronous aspects of the `PrimeNumberCalculator` component are implemented internally with a special delegate known as a <xref:System.Threading.SendOrPostCallback>.</span></span> <span data-ttu-id="8c01e-141">A <xref:System.Threading.SendOrPostCallback> representa un método de devolución de llamada que se ejecuta en un <xref:System.Threading.ThreadPool> subproceso.</span><span class="sxs-lookup"><span data-stu-id="8c01e-141">A <xref:System.Threading.SendOrPostCallback> represents a callback method that executes on a <xref:System.Threading.ThreadPool> thread.</span></span> <span data-ttu-id="8c01e-142">El método de devolución de llamada debe tener una firma que toma un único parámetro de tipo <xref:System.Object>, lo que significa que tendrá que pasar información de estado entre los delegados de una clase contenedora.</span><span class="sxs-lookup"><span data-stu-id="8c01e-142">The callback method must have a signature that takes a single parameter of type <xref:System.Object>, which means you will need to pass state among delegates in a wrapper class.</span></span> <span data-ttu-id="8c01e-143">Para obtener más información, consulta <xref:System.Threading.SendOrPostCallback>.</span><span class="sxs-lookup"><span data-stu-id="8c01e-143">For more information, see <xref:System.Threading.SendOrPostCallback>.</span></span>  
  
#### <a name="to-implement-your-components-internal-asynchronous-behavior"></a><span data-ttu-id="8c01e-144">Para implementar un comportamiento asincrónico interno de su componente:</span><span class="sxs-lookup"><span data-stu-id="8c01e-144">To implement your component's internal asynchronous behavior:</span></span>  
  
1.  <span data-ttu-id="8c01e-145">Declarar y crear el <xref:System.Threading.SendOrPostCallback> delega en el `PrimeNumberCalculator` clase.</span><span class="sxs-lookup"><span data-stu-id="8c01e-145">Declare and create the <xref:System.Threading.SendOrPostCallback> delegates in the `PrimeNumberCalculator` class.</span></span> <span data-ttu-id="8c01e-146">Crear el <xref:System.Threading.SendOrPostCallback> llaman a objetos en un método de utilidad `InitializeDelegates`.</span><span class="sxs-lookup"><span data-stu-id="8c01e-146">Create the <xref:System.Threading.SendOrPostCallback> objects in a utility method called `InitializeDelegates`.</span></span>  
  
     <span data-ttu-id="8c01e-147">Necesitará dos delegados: uno para notificar el progreso al cliente y otro para informar sobre la finalización al cliente.</span><span class="sxs-lookup"><span data-stu-id="8c01e-147">You will need two delegates: one for reporting progress to the client, and one for reporting completion to the client.</span></span>  
  
     [!code-csharp[System.ComponentModel.AsyncOperationManager#9](../../../samples/snippets/csharp/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/CS/primenumbercalculatormain.cs#9)]
     [!code-vb[System.ComponentModel.AsyncOperationManager#9](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/VB/primenumbercalculatormain.vb#9)]  
    [!code-csharp[System.ComponentModel.AsyncOperationManager#20](../../../samples/snippets/csharp/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/CS/primenumbercalculatormain.cs#20)]
    [!code-vb[System.ComponentModel.AsyncOperationManager#20](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/VB/primenumbercalculatormain.vb#20)]  
  
2.  <span data-ttu-id="8c01e-148">Llame a la `InitializeDelegates` método en el constructor del componente.</span><span class="sxs-lookup"><span data-stu-id="8c01e-148">Call the `InitializeDelegates` method in your component's constructor.</span></span>  
  
     [!code-csharp[System.ComponentModel.AsyncOperationManager#21](../../../samples/snippets/csharp/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/CS/primenumbercalculatormain.cs#21)]
     [!code-vb[System.ComponentModel.AsyncOperationManager#21](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/VB/primenumbercalculatormain.vb#21)]  
  
3.  <span data-ttu-id="8c01e-149">Declarar un delegado en el `PrimeNumberCalculator` clase que administra el trabajo real para realizarse de forma asincrónica.</span><span class="sxs-lookup"><span data-stu-id="8c01e-149">Declare a delegate in the `PrimeNumberCalculator` class that handles the actual work to be done asynchronously.</span></span> <span data-ttu-id="8c01e-150">Este delegado ajusta el método de trabajo que comprueba si un número es primo.</span><span class="sxs-lookup"><span data-stu-id="8c01e-150">This delegate wraps the worker method that tests whether a number is prime.</span></span> <span data-ttu-id="8c01e-151">El delegado toma un <xref:System.ComponentModel.AsyncOperation> parámetro, que se usará para realizar el seguimiento de la duración de la operación asincrónica.</span><span class="sxs-lookup"><span data-stu-id="8c01e-151">The delegate takes an <xref:System.ComponentModel.AsyncOperation> parameter, which will be used to track the lifetime of the asynchronous operation.</span></span>  
  
     [!code-csharp[System.ComponentModel.AsyncOperationManager#22](../../../samples/snippets/csharp/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/CS/primenumbercalculatormain.cs#22)]
     [!code-vb[System.ComponentModel.AsyncOperationManager#22](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/VB/primenumbercalculatormain.vb#22)]  
  
4.  <span data-ttu-id="8c01e-152">Crear una colección para administrar la duración de las operaciones asincrónicas pendientes.</span><span class="sxs-lookup"><span data-stu-id="8c01e-152">Create a collection for managing lifetimes of pending asynchronous operations.</span></span> <span data-ttu-id="8c01e-153">El cliente necesita una manera para realizar un seguimiento de las operaciones que se ejecuta y completa, y este seguimiento se debe exigir al cliente pasar un token único o un identificador de tarea, cuando el cliente realiza la llamada al método asincrónico.</span><span class="sxs-lookup"><span data-stu-id="8c01e-153">The client needs a way to track operations as they are executed and completed, and this tracking is done by requiring the client to pass a unique token, or task ID, when the client makes the call to the asynchronous method.</span></span> <span data-ttu-id="8c01e-154">El `PrimeNumberCalculator` componente debe mantener un seguimiento de cada llamada asociando el identificador de tarea a su invocación correspondiente.</span><span class="sxs-lookup"><span data-stu-id="8c01e-154">The `PrimeNumberCalculator` component must keep track of each call by associating the task ID with its corresponding invocation.</span></span> <span data-ttu-id="8c01e-155">Si el cliente pasa un identificador de tarea que no es único, el `PrimeNumberCalculator` componente debe generar una excepción.</span><span class="sxs-lookup"><span data-stu-id="8c01e-155">If the client passes a task ID that is not unique, the `PrimeNumberCalculator` component must raise an exception.</span></span>  
  
     <span data-ttu-id="8c01e-156">El `PrimeNumberCalculator` componente realiza un seguimiento de Id. de tarea mediante el uso de una clase de colección especial denominada una <xref:System.Collections.Specialized.HybridDictionary>.</span><span class="sxs-lookup"><span data-stu-id="8c01e-156">The `PrimeNumberCalculator` component keeps track of task ID by using a special collection class called a <xref:System.Collections.Specialized.HybridDictionary>.</span></span> <span data-ttu-id="8c01e-157">En la definición de clase, cree un <xref:System.Collections.Specialized.HybridDictionary> denominado `userTokenToLifetime`.</span><span class="sxs-lookup"><span data-stu-id="8c01e-157">In the class definition, create a <xref:System.Collections.Specialized.HybridDictionary> called `userTokenToLifetime`.</span></span>  
  
     [!code-csharp[System.ComponentModel.AsyncOperationManager#23](../../../samples/snippets/csharp/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/CS/primenumbercalculatormain.cs#23)]
     [!code-vb[System.ComponentModel.AsyncOperationManager#23](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/VB/primenumbercalculatormain.vb#23)]  
  
## <a name="implementing-public-events"></a><span data-ttu-id="8c01e-158">Implementar eventos públicos</span><span class="sxs-lookup"><span data-stu-id="8c01e-158">Implementing Public Events</span></span>  
 <span data-ttu-id="8c01e-159">Componentes que implementan el modelo asincrónico basado en eventos se comunican con los clientes mediante eventos.</span><span class="sxs-lookup"><span data-stu-id="8c01e-159">Components that implement the Event-based Asynchronous Pattern communicate to clients using events.</span></span> <span data-ttu-id="8c01e-160">Estos eventos se invocan en el subproceso adecuado con la Ayuda de la <xref:System.ComponentModel.AsyncOperation> clase.</span><span class="sxs-lookup"><span data-stu-id="8c01e-160">These events are invoked on the proper thread with the help of the <xref:System.ComponentModel.AsyncOperation> class.</span></span>  
  
#### <a name="to-raise-events-to-your-components-clients"></a><span data-ttu-id="8c01e-161">Para generar los eventos en los clientes de su componente:</span><span class="sxs-lookup"><span data-stu-id="8c01e-161">To raise events to your component's clients:</span></span>  
  
1.  <span data-ttu-id="8c01e-162">Implementar eventos públicos para informar a los clientes.</span><span class="sxs-lookup"><span data-stu-id="8c01e-162">Implement public events for reporting to clients.</span></span> <span data-ttu-id="8c01e-163">Necesitará un evento para los informes de progreso y otro para informar de la finalización.</span><span class="sxs-lookup"><span data-stu-id="8c01e-163">You will need an event for reporting progress and one for reporting completion.</span></span>  
  
     [!code-csharp[System.ComponentModel.AsyncOperationManager#24](../../../samples/snippets/csharp/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/CS/primenumbercalculatormain.cs#24)]
     [!code-vb[System.ComponentModel.AsyncOperationManager#24](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/VB/primenumbercalculatormain.vb#24)]  
  
## <a name="implementing-the-completion-method"></a><span data-ttu-id="8c01e-164">Implementar el método de finalización</span><span class="sxs-lookup"><span data-stu-id="8c01e-164">Implementing the Completion Method</span></span>  
 <span data-ttu-id="8c01e-165">El delegado de finalización es el método que invocará el comportamiento asincrónico de subprocesamiento libre subyacente cuando finaliza la operación asincrónica de éxito, error o cancelación.</span><span class="sxs-lookup"><span data-stu-id="8c01e-165">The completion delegate is the method that the underlying, free-threaded asynchronous behavior will invoke when the asynchronous operation ends by successful completion, error, or cancellation.</span></span> <span data-ttu-id="8c01e-166">Esta invocación se produce en un subproceso arbitrario.</span><span class="sxs-lookup"><span data-stu-id="8c01e-166">This invocation happens on an arbitrary thread.</span></span>  
  
 <span data-ttu-id="8c01e-167">Este método es donde se quita el Id. de tarea del cliente de la colección interna de símbolos (tokens) de cliente único.</span><span class="sxs-lookup"><span data-stu-id="8c01e-167">This method is where the client's task ID is removed from the internal collection of unique client tokens.</span></span> <span data-ttu-id="8c01e-168">Este método también finaliza la duración de una operación asincrónica determinada llamando a la <xref:System.ComponentModel.AsyncOperation.PostOperationCompleted%2A> método en la correspondiente <xref:System.ComponentModel.AsyncOperation>.</span><span class="sxs-lookup"><span data-stu-id="8c01e-168">This method also ends the lifetime of a particular asynchronous operation by calling the <xref:System.ComponentModel.AsyncOperation.PostOperationCompleted%2A> method on the corresponding <xref:System.ComponentModel.AsyncOperation>.</span></span> <span data-ttu-id="8c01e-169">Esta llamada provoca el evento de finalización en el subproceso que es adecuado para el modelo de aplicación.</span><span class="sxs-lookup"><span data-stu-id="8c01e-169">This call raises the completion event on the thread that is appropriate for the application model.</span></span> <span data-ttu-id="8c01e-170">Después de la <xref:System.ComponentModel.AsyncOperation.PostOperationCompleted%2A> método se llama, esta instancia de <xref:System.ComponentModel.AsyncOperation> ya no se puede utilizar, y todos los intentos subsiguientes para usarlo, producen una excepción.</span><span class="sxs-lookup"><span data-stu-id="8c01e-170">After the <xref:System.ComponentModel.AsyncOperation.PostOperationCompleted%2A> method is called, this instance of <xref:System.ComponentModel.AsyncOperation> can no longer be used, and any subsequent attempts to use it will throw an exception.</span></span>  
  
 <span data-ttu-id="8c01e-171">El `CompletionMethod` firma debe contener todos los estados necesarios para describir el resultado de la operación asincrónica.</span><span class="sxs-lookup"><span data-stu-id="8c01e-171">The `CompletionMethod` signature must hold all state necessary to describe the outcome of the asynchronous operation.</span></span> <span data-ttu-id="8c01e-172">Contiene información de estado para el número que se ha probado por esta operación asincrónica concreta, si el número es primo y el valor de su primer divisor si no es un número primo.</span><span class="sxs-lookup"><span data-stu-id="8c01e-172">It holds state for the number that was tested by this particular asynchronous operation, whether the number is prime, and the value of its first divisor if it is not a prime number.</span></span> <span data-ttu-id="8c01e-173">También contiene información de estado que describe cualquier excepción que se ha producido, y el <xref:System.ComponentModel.AsyncOperation> correspondiente a esta tarea concreta.</span><span class="sxs-lookup"><span data-stu-id="8c01e-173">It also holds state describing any exception that occurred, and the <xref:System.ComponentModel.AsyncOperation> corresponding to this particular task.</span></span>  
  
#### <a name="to-complete-an-asynchronous-operation"></a><span data-ttu-id="8c01e-174">Para completar una operación asincrónica:</span><span class="sxs-lookup"><span data-stu-id="8c01e-174">To complete an asynchronous operation:</span></span>  
  
-   <span data-ttu-id="8c01e-175">Implemente el método de finalización.</span><span class="sxs-lookup"><span data-stu-id="8c01e-175">Implement the completion method.</span></span> <span data-ttu-id="8c01e-176">Toma seis parámetros, que usa para rellenar un `CalculatePrimeCompletedEventArgs` que se devuelve al cliente a través del cliente `CalculatePrimeCompletedEventHandler`.</span><span class="sxs-lookup"><span data-stu-id="8c01e-176">It takes six parameters, which it uses to populate a `CalculatePrimeCompletedEventArgs` that is returned to the client through the client's `CalculatePrimeCompletedEventHandler`.</span></span> <span data-ttu-id="8c01e-177">Quita el token de Id. de tarea del cliente de la colección interna y termina la duración de la operación asincrónica con una llamada a <xref:System.ComponentModel.AsyncOperation.PostOperationCompleted%2A>.</span><span class="sxs-lookup"><span data-stu-id="8c01e-177">It removes the client's task ID token from the internal collection, and it ends the asynchronous operation's lifetime with a call to <xref:System.ComponentModel.AsyncOperation.PostOperationCompleted%2A>.</span></span> <span data-ttu-id="8c01e-178">El <xref:System.ComponentModel.AsyncOperation> calcula las referencias de la llamada al subproceso o contexto que sea adecuado para el modelo de aplicación.</span><span class="sxs-lookup"><span data-stu-id="8c01e-178">The <xref:System.ComponentModel.AsyncOperation> marshals the call to the thread or context that is appropriate for the application model.</span></span>  
  
     [!code-csharp[System.ComponentModel.AsyncOperationManager#26](../../../samples/snippets/csharp/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/CS/primenumbercalculatormain.cs#26)]
     [!code-vb[System.ComponentModel.AsyncOperationManager#26](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/VB/primenumbercalculatormain.vb#26)]  
  
## <a name="checkpoint"></a><span data-ttu-id="8c01e-179">Punto de control</span><span class="sxs-lookup"><span data-stu-id="8c01e-179">Checkpoint</span></span>  
 <span data-ttu-id="8c01e-180">En este momento, puede compilar el componente.</span><span class="sxs-lookup"><span data-stu-id="8c01e-180">At this point, you can build the component.</span></span>  
  
#### <a name="to-test-your-component"></a><span data-ttu-id="8c01e-181">Para probar el componente</span><span class="sxs-lookup"><span data-stu-id="8c01e-181">To test your component</span></span>  
  
-   <span data-ttu-id="8c01e-182">Compilar el componente.</span><span class="sxs-lookup"><span data-stu-id="8c01e-182">Compile the component.</span></span>  
  
     <span data-ttu-id="8c01e-183">Recibirá una advertencia del compilador:</span><span class="sxs-lookup"><span data-stu-id="8c01e-183">You will receive one compiler warning:</span></span>  
  
    ```  
    warning CS0169: The private field 'AsynchronousPatternExample.PrimeNumberCalculator.workerDelegate' is never used  
    ```  
  
     <span data-ttu-id="8c01e-184">Esta advertencia se resolverá en la sección siguiente.</span><span class="sxs-lookup"><span data-stu-id="8c01e-184">This warning will be resolved in the next section.</span></span>  
  
## <a name="implementing-the-worker-methods"></a><span data-ttu-id="8c01e-185">Implementar los métodos de trabajo</span><span class="sxs-lookup"><span data-stu-id="8c01e-185">Implementing the Worker Methods</span></span>  
 <span data-ttu-id="8c01e-186">Hasta ahora, ha implementado el código asincrónico admitido para el `PrimeNumberCalculator` componente.</span><span class="sxs-lookup"><span data-stu-id="8c01e-186">So far, you have implemented the supporting asynchronous code for the `PrimeNumberCalculator` component.</span></span> <span data-ttu-id="8c01e-187">Ahora puede implementar el código que realiza el trabajo real.</span><span class="sxs-lookup"><span data-stu-id="8c01e-187">Now you can implement the code that does the actual work.</span></span> <span data-ttu-id="8c01e-188">Implementará tres métodos: `CalculateWorker`, `BuildPrimeNumberList`, y `IsPrime`.</span><span class="sxs-lookup"><span data-stu-id="8c01e-188">You will implement three methods: `CalculateWorker`, `BuildPrimeNumberList`, and `IsPrime`.</span></span> <span data-ttu-id="8c01e-189">Juntos, `BuildPrimeNumberList` y `IsPrime` constituyen un algoritmo muy conocido denominado criba de Eratóstenes, que determina si un número es primo buscando todos los números primos hasta la raíz cuadrada del número de pruebas.</span><span class="sxs-lookup"><span data-stu-id="8c01e-189">Together, `BuildPrimeNumberList` and `IsPrime` comprise a well-known algorithm called the Sieve of Eratosthenes, which determines if a number is prime by finding all the prime numbers up to the square root of the test number.</span></span> <span data-ttu-id="8c01e-190">Si no se encuentran ningún divisores por ese punto, el número de pruebas es primo.</span><span class="sxs-lookup"><span data-stu-id="8c01e-190">If no divisors are found by that point, the test number is prime.</span></span>  
  
 <span data-ttu-id="8c01e-191">Si este componente se hubiera escrito para obtener la máxima eficacia, ¿recuerde que todos los números primos detectados por distintas invocaciones de los números de prueba diferentes.</span><span class="sxs-lookup"><span data-stu-id="8c01e-191">If this component were written for maximum efficiency, it would remember all the prime numbers discovered by various invocations for different test numbers.</span></span> <span data-ttu-id="8c01e-192">También buscaría divisores triviales como 2, 3 y 5.</span><span class="sxs-lookup"><span data-stu-id="8c01e-192">It would also check for trivial divisors like 2, 3, and 5.</span></span> <span data-ttu-id="8c01e-193">El propósito de este ejemplo es demostrar operaciones prolongadas cómo se puede ejecutar de forma asincrónica, sin embargo, por lo que estas optimizaciones se dejan como un ejercicio para usted.</span><span class="sxs-lookup"><span data-stu-id="8c01e-193">The intent of this example is to demonstrate how time-consuming operations can be executed asynchronously, however, so these optimizations are left as an exercise for you.</span></span>  
  
 <span data-ttu-id="8c01e-194">El `CalculateWorker` método se ajusta en un delegado y se invoca de forma asincrónica con una llamada a `BeginInvoke`.</span><span class="sxs-lookup"><span data-stu-id="8c01e-194">The `CalculateWorker` method is wrapped in a delegate and is invoked asynchronously with a call to `BeginInvoke`.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="8c01e-195">Informes de progreso se implementan en el `BuildPrimeNumberList` método.</span><span class="sxs-lookup"><span data-stu-id="8c01e-195">Progress reporting is implemented in the `BuildPrimeNumberList` method.</span></span> <span data-ttu-id="8c01e-196">En equipos rápidos, `ProgressChanged` se pueden producir eventos en una sucesión rápida.</span><span class="sxs-lookup"><span data-stu-id="8c01e-196">On fast computers, `ProgressChanged` events can be raised in rapid succession.</span></span> <span data-ttu-id="8c01e-197">El subproceso de cliente, en el que se producen estos eventos, debe ser capaz de controlar esta situación.</span><span class="sxs-lookup"><span data-stu-id="8c01e-197">The client thread, on which these events are raised, must be able to handle this situation.</span></span> <span data-ttu-id="8c01e-198">Código de la interfaz de usuario puede estar congestiona con mensajes y no se puede mantener el ritmo, lo que produce hanging comportamiento.</span><span class="sxs-lookup"><span data-stu-id="8c01e-198">User interface code may be flooded with messages and unable to keep up, resulting in hanging behavior.</span></span> <span data-ttu-id="8c01e-199">Para una interfaz de usuario de ejemplo que controla esta situación, vea [Cómo: implementar un cliente del modelo asincrónico basado en eventos](../../../docs/standard/asynchronous-programming-patterns/how-to-implement-a-client-of-the-event-based-asynchronous-pattern.md).</span><span class="sxs-lookup"><span data-stu-id="8c01e-199">For an example user interface that handles this situation, see [How to: Implement a Client of the Event-based Asynchronous Pattern](../../../docs/standard/asynchronous-programming-patterns/how-to-implement-a-client-of-the-event-based-asynchronous-pattern.md).</span></span>  
  
#### <a name="to-execute-the-prime-number-calculation-asynchronously"></a><span data-ttu-id="8c01e-200">Para ejecutar de forma asincrónica el cálculo de números primos:</span><span class="sxs-lookup"><span data-stu-id="8c01e-200">To execute the prime number calculation asynchronously:</span></span>  
  
1.  <span data-ttu-id="8c01e-201">Implemente el `TaskCanceled` método de utilidad.</span><span class="sxs-lookup"><span data-stu-id="8c01e-201">Implement the `TaskCanceled` utility method.</span></span> <span data-ttu-id="8c01e-202">Esto comprueba la colección de duración de tarea para el identificador de tarea determinado y devuelve `true` si no se encuentra el Id. de tarea.</span><span class="sxs-lookup"><span data-stu-id="8c01e-202">This checks the task lifetime collection for the given task ID, and returns `true` if the task ID is not found.</span></span>  
  
     [!code-csharp[System.ComponentModel.AsyncOperationManager#32](../../../samples/snippets/csharp/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/CS/primenumbercalculatormain.cs#32)]
     [!code-vb[System.ComponentModel.AsyncOperationManager#32](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/VB/primenumbercalculatormain.vb#32)]  
  
2.  <span data-ttu-id="8c01e-203">Implemente el método `CalculateWorker`.</span><span class="sxs-lookup"><span data-stu-id="8c01e-203">Implement the `CalculateWorker` method.</span></span> <span data-ttu-id="8c01e-204">Toma dos parámetros: un número para probar y un <xref:System.ComponentModel.AsyncOperation>.</span><span class="sxs-lookup"><span data-stu-id="8c01e-204">It takes two parameters: a number to test, and an <xref:System.ComponentModel.AsyncOperation>.</span></span>  
  
     [!code-csharp[System.ComponentModel.AsyncOperationManager#27](../../../samples/snippets/csharp/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/CS/primenumbercalculatormain.cs#27)]
     [!code-vb[System.ComponentModel.AsyncOperationManager#27](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/VB/primenumbercalculatormain.vb#27)]  
  
3.  <span data-ttu-id="8c01e-205">Implemente `BuildPrimeNumberList`.</span><span class="sxs-lookup"><span data-stu-id="8c01e-205">Implement `BuildPrimeNumberList`.</span></span> <span data-ttu-id="8c01e-206">Toma dos parámetros: el número que se va a probar y un <xref:System.ComponentModel.AsyncOperation>.</span><span class="sxs-lookup"><span data-stu-id="8c01e-206">It takes two parameters: the number to test, and an <xref:System.ComponentModel.AsyncOperation>.</span></span> <span data-ttu-id="8c01e-207">Utiliza el <xref:System.ComponentModel.AsyncOperation> para informar del progreso y resultados incrementales.</span><span class="sxs-lookup"><span data-stu-id="8c01e-207">It uses the <xref:System.ComponentModel.AsyncOperation> to report progress and incremental results.</span></span> <span data-ttu-id="8c01e-208">Esto garantiza que se llama a los controladores de eventos del cliente en el subproceso o contexto apropiado para el modelo de aplicación.</span><span class="sxs-lookup"><span data-stu-id="8c01e-208">This assures that the client's event handlers are called on the proper thread or context for the application model.</span></span> <span data-ttu-id="8c01e-209">Cuando `BuildPrimeNumberList` encuentra un número primo, informa de éste como resultado incremental al controlador de eventos del cliente la `ProgressChanged` eventos.</span><span class="sxs-lookup"><span data-stu-id="8c01e-209">When `BuildPrimeNumberList` finds a prime number, it reports this as an incremental result to the client's event handler for the `ProgressChanged` event.</span></span> <span data-ttu-id="8c01e-210">Esto requiere una clase derivada de <xref:System.ComponentModel.ProgressChangedEventArgs>, llamado `CalculatePrimeProgressChangedEventArgs`, que tiene una propiedad agregada denominada `LatestPrimeNumber`.</span><span class="sxs-lookup"><span data-stu-id="8c01e-210">This requires a class derived from <xref:System.ComponentModel.ProgressChangedEventArgs>, called `CalculatePrimeProgressChangedEventArgs`, which has one added property called `LatestPrimeNumber`.</span></span>  
  
     <span data-ttu-id="8c01e-211">El `BuildPrimeNumberList` método llama periódicamente la `TaskCanceled` método y se cierra si el método devuelve `true`.</span><span class="sxs-lookup"><span data-stu-id="8c01e-211">The `BuildPrimeNumberList` method also periodically calls the `TaskCanceled` method and exits if the method returns `true`.</span></span>  
  
     [!code-csharp[System.ComponentModel.AsyncOperationManager#5](../../../samples/snippets/csharp/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/CS/primenumbercalculatormain.cs#5)]
     [!code-vb[System.ComponentModel.AsyncOperationManager#5](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/VB/primenumbercalculatormain.vb#5)]  
  
4.  <span data-ttu-id="8c01e-212">Implemente `IsPrime`.</span><span class="sxs-lookup"><span data-stu-id="8c01e-212">Implement `IsPrime`.</span></span> <span data-ttu-id="8c01e-213">Acepta tres parámetros: una lista de números primos conocidos, el número que se va a probar y un parámetro de salida para el primer divisor encontrado.</span><span class="sxs-lookup"><span data-stu-id="8c01e-213">It takes three parameters: a list of known prime numbers, the number to test, and an output parameter for the first divisor found.</span></span> <span data-ttu-id="8c01e-214">Dada la lista de números primos, determina si el número de pruebas es primo.</span><span class="sxs-lookup"><span data-stu-id="8c01e-214">Given the list of prime numbers, it determines if the test number is prime.</span></span>  
  
     [!code-csharp[System.ComponentModel.AsyncOperationManager#28](../../../samples/snippets/csharp/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/CS/primenumbercalculatormain.cs#28)]
     [!code-vb[System.ComponentModel.AsyncOperationManager#28](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/VB/primenumbercalculatormain.vb#28)]  
  
5.  <span data-ttu-id="8c01e-215">Derivar `CalculatePrimeProgressChangedEventArgs` de <xref:System.ComponentModel.ProgressChangedEventArgs>.</span><span class="sxs-lookup"><span data-stu-id="8c01e-215">Derive `CalculatePrimeProgressChangedEventArgs` from <xref:System.ComponentModel.ProgressChangedEventArgs>.</span></span> <span data-ttu-id="8c01e-216">Esta clase es necesaria para informar de los resultados incrementales al controlador de eventos del cliente la `ProgressChanged` eventos.</span><span class="sxs-lookup"><span data-stu-id="8c01e-216">This class is necessary for reporting incremental results to the client's event handler for the `ProgressChanged` event.</span></span> <span data-ttu-id="8c01e-217">Tiene una propiedad adicional denominada `LatestPrimeNumber`.</span><span class="sxs-lookup"><span data-stu-id="8c01e-217">It has one added property called `LatestPrimeNumber`.</span></span>  
  
     [!code-csharp[System.ComponentModel.AsyncOperationManager#29](../../../samples/snippets/csharp/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/CS/primenumbercalculatormain.cs#29)]
     [!code-vb[System.ComponentModel.AsyncOperationManager#29](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/VB/primenumbercalculatormain.vb#29)]  
  
## <a name="checkpoint"></a><span data-ttu-id="8c01e-218">Punto de control</span><span class="sxs-lookup"><span data-stu-id="8c01e-218">Checkpoint</span></span>  
 <span data-ttu-id="8c01e-219">En este momento, puede compilar el componente.</span><span class="sxs-lookup"><span data-stu-id="8c01e-219">At this point, you can build the component.</span></span>  
  
#### <a name="to-test-your-component"></a><span data-ttu-id="8c01e-220">Para probar el componente</span><span class="sxs-lookup"><span data-stu-id="8c01e-220">To test your component</span></span>  
  
-   <span data-ttu-id="8c01e-221">Compilar el componente.</span><span class="sxs-lookup"><span data-stu-id="8c01e-221">Compile the component.</span></span>  
  
     <span data-ttu-id="8c01e-222">Todo lo que queda por escribir es los métodos para iniciar y cancelar operaciones asincrónicas, `CalculatePrimeAsync` y `CancelAsync`.</span><span class="sxs-lookup"><span data-stu-id="8c01e-222">All that remains to be written are the methods to start and cancel asynchronous operations, `CalculatePrimeAsync` and `CancelAsync`.</span></span>  
  
## <a name="implementing-the-start-and-cancel-methods"></a><span data-ttu-id="8c01e-223">Implementar los métodos de cancelación y de inicio</span><span class="sxs-lookup"><span data-stu-id="8c01e-223">Implementing the Start and Cancel Methods</span></span>  
 <span data-ttu-id="8c01e-224">Inicie el método de trabajo en su propio subproceso llamando a `BeginInvoke` en el delegado que lo contiene.</span><span class="sxs-lookup"><span data-stu-id="8c01e-224">You start the worker method on its own thread by calling `BeginInvoke` on the delegate that wraps it.</span></span> <span data-ttu-id="8c01e-225">Para administrar la duración de una operación asincrónica determinada, llame a la <xref:System.ComponentModel.AsyncOperationManager.CreateOperation%2A> método en la <xref:System.ComponentModel.AsyncOperationManager> clase auxiliar.</span><span class="sxs-lookup"><span data-stu-id="8c01e-225">To manage the lifetime of a particular asynchronous operation, you call the <xref:System.ComponentModel.AsyncOperationManager.CreateOperation%2A> method on the <xref:System.ComponentModel.AsyncOperationManager> helper class.</span></span> <span data-ttu-id="8c01e-226">Esto devuelve un <xref:System.ComponentModel.AsyncOperation>, que calcula las referencias de llamadas en los controladores de eventos del cliente para el subproceso o contexto apropiado.</span><span class="sxs-lookup"><span data-stu-id="8c01e-226">This returns an <xref:System.ComponentModel.AsyncOperation>, which marshals calls on the client's event handlers to the proper thread or context.</span></span>  
  
 <span data-ttu-id="8c01e-227">Cancelar una operación pendiente determinada llamando <xref:System.ComponentModel.AsyncOperation.PostOperationCompleted%2A> en su correspondiente <xref:System.ComponentModel.AsyncOperation>.</span><span class="sxs-lookup"><span data-stu-id="8c01e-227">You cancel a particular pending operation by calling <xref:System.ComponentModel.AsyncOperation.PostOperationCompleted%2A> on its corresponding <xref:System.ComponentModel.AsyncOperation>.</span></span> <span data-ttu-id="8c01e-228">Esto finaliza esa operación y las subsiguientes llamadas a su <xref:System.ComponentModel.AsyncOperation> se iniciará una excepción.</span><span class="sxs-lookup"><span data-stu-id="8c01e-228">This ends that operation, and any subsequent calls to its <xref:System.ComponentModel.AsyncOperation> will throw an exception.</span></span>  
  
#### <a name="to-implement-start-and-cancel-functionality"></a><span data-ttu-id="8c01e-229">Para implementar el inicio y cancelar la funcionalidad:</span><span class="sxs-lookup"><span data-stu-id="8c01e-229">To implement Start and Cancel functionality:</span></span>  
  
1.  <span data-ttu-id="8c01e-230">Implemente el método `CalculatePrimeAsync`.</span><span class="sxs-lookup"><span data-stu-id="8c01e-230">Implement the `CalculatePrimeAsync` method.</span></span> <span data-ttu-id="8c01e-231">Asegúrese de que el token proporcionado por el cliente (Id. de tarea) es único con respecto a todos los tokens que representan actualmente las tareas pendientes.</span><span class="sxs-lookup"><span data-stu-id="8c01e-231">Make sure the client-supplied token (task ID) is unique with respect to all the tokens representing currently pending tasks.</span></span> <span data-ttu-id="8c01e-232">Si el cliente pasa en un token no es único, `CalculatePrimeAsync` produce una excepción.</span><span class="sxs-lookup"><span data-stu-id="8c01e-232">If the client passes in a non-unique token, `CalculatePrimeAsync` raises an exception.</span></span> <span data-ttu-id="8c01e-233">En caso contrario, el token se agrega a la colección de Id. de tarea.</span><span class="sxs-lookup"><span data-stu-id="8c01e-233">Otherwise, the token is added to the task ID collection.</span></span>  
  
     [!code-csharp[System.ComponentModel.AsyncOperationManager#3](../../../samples/snippets/csharp/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/CS/primenumbercalculatormain.cs#3)]
     [!code-vb[System.ComponentModel.AsyncOperationManager#3](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/VB/primenumbercalculatormain.vb#3)]  
  
2.  <span data-ttu-id="8c01e-234">Implemente el método `CancelAsync`.</span><span class="sxs-lookup"><span data-stu-id="8c01e-234">Implement the `CancelAsync` method.</span></span> <span data-ttu-id="8c01e-235">Si el `taskId` parámetro existe en la colección de token, se quita.</span><span class="sxs-lookup"><span data-stu-id="8c01e-235">If the `taskId` parameter exists in the token collection, it is removed.</span></span> <span data-ttu-id="8c01e-236">Esto evita que la tarea cancelada que no haya iniciado de ejecución.</span><span class="sxs-lookup"><span data-stu-id="8c01e-236">This prevents canceled tasks that have not started from running.</span></span> <span data-ttu-id="8c01e-237">Si la tarea se está ejecutando, el `BuildPrimeNumberList` método finaliza cuando detecta que el identificador de tarea se ha quitado de la colección de duración.</span><span class="sxs-lookup"><span data-stu-id="8c01e-237">If the task is running, the `BuildPrimeNumberList` method exits when it detects that the task ID has been removed from the lifetime collection.</span></span>  
  
     [!code-csharp[System.ComponentModel.AsyncOperationManager#4](../../../samples/snippets/csharp/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/CS/primenumbercalculatormain.cs#4)]
     [!code-vb[System.ComponentModel.AsyncOperationManager#4](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/VB/primenumbercalculatormain.vb#4)]  
  
## <a name="checkpoint"></a><span data-ttu-id="8c01e-238">Punto de control</span><span class="sxs-lookup"><span data-stu-id="8c01e-238">Checkpoint</span></span>  
 <span data-ttu-id="8c01e-239">En este momento, puede compilar el componente.</span><span class="sxs-lookup"><span data-stu-id="8c01e-239">At this point, you can build the component.</span></span>  
  
#### <a name="to-test-your-component"></a><span data-ttu-id="8c01e-240">Para probar el componente</span><span class="sxs-lookup"><span data-stu-id="8c01e-240">To test your component</span></span>  
  
-   <span data-ttu-id="8c01e-241">Compilar el componente.</span><span class="sxs-lookup"><span data-stu-id="8c01e-241">Compile the component.</span></span>  
  
 <span data-ttu-id="8c01e-242">El `PrimeNumberCalculator` componente ya está completo y listo para usarse.</span><span class="sxs-lookup"><span data-stu-id="8c01e-242">The `PrimeNumberCalculator` component is now complete and ready to use.</span></span>  
  
 <span data-ttu-id="8c01e-243">Para un cliente de ejemplo que usa el `PrimeNumberCalculator` componente, vea [Cómo: implementar un cliente del modelo asincrónico basado en eventos](../../../docs/standard/asynchronous-programming-patterns/how-to-implement-a-client-of-the-event-based-asynchronous-pattern.md).</span><span class="sxs-lookup"><span data-stu-id="8c01e-243">For an example client that uses the `PrimeNumberCalculator` component, see [How to: Implement a Client of the Event-based Asynchronous Pattern](../../../docs/standard/asynchronous-programming-patterns/how-to-implement-a-client-of-the-event-based-asynchronous-pattern.md).</span></span>  
  
## <a name="next-steps"></a><span data-ttu-id="8c01e-244">Pasos siguientes</span><span class="sxs-lookup"><span data-stu-id="8c01e-244">Next Steps</span></span>  
 <span data-ttu-id="8c01e-245">Puede rellenar este ejemplo escribiendo `CalculatePrime`, el equivalente sincrónico de `CalculatePrimeAsync` método.</span><span class="sxs-lookup"><span data-stu-id="8c01e-245">You can fill out this example by writing `CalculatePrime`, the synchronous equivalent of `CalculatePrimeAsync` method.</span></span> <span data-ttu-id="8c01e-246">Esto hará que el `PrimeNumberCalculator` componente totalmente compatible con el modelo asincrónico basado en eventos.</span><span class="sxs-lookup"><span data-stu-id="8c01e-246">This will make the `PrimeNumberCalculator` component fully compliant with the Event-based Asynchronous Pattern.</span></span>  
  
 <span data-ttu-id="8c01e-247">Puede mejorar este ejemplo, pero se mantiene la lista de todos los números primos detectados por distintas invocaciones de los números de prueba diferentes.</span><span class="sxs-lookup"><span data-stu-id="8c01e-247">You can improve this example by retaining the list of all the prime numbers discovered by various invocations for different test numbers.</span></span> <span data-ttu-id="8c01e-248">Con este enfoque, cada tarea se beneficiará del trabajo realizado por tareas anteriores.</span><span class="sxs-lookup"><span data-stu-id="8c01e-248">Using this approach, each task will benefit from the work done by previous tasks.</span></span> <span data-ttu-id="8c01e-249">Tenga cuidado proteger esta lista con `lock` regiones, por lo que se serializa el acceso a la lista en subprocesos diferentes.</span><span class="sxs-lookup"><span data-stu-id="8c01e-249">Be careful to protect this list with `lock` regions, so access to the list by different threads is serialized.</span></span>  
  
 <span data-ttu-id="8c01e-250">También puede mejorar este ejemplo probando divisores triviales, como 2, 3 y 5.</span><span class="sxs-lookup"><span data-stu-id="8c01e-250">You can also improve this example by testing for trivial divisors, like 2, 3, and 5.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="8c01e-251">Vea también</span><span class="sxs-lookup"><span data-stu-id="8c01e-251">See Also</span></span>  
 [<span data-ttu-id="8c01e-252">Ejecutar una operación en segundo plano</span><span class="sxs-lookup"><span data-stu-id="8c01e-252">How to: Run an Operation in the Background</span></span>](../../../docs/framework/winforms/controls/how-to-run-an-operation-in-the-background.md)  
 <span data-ttu-id="8c01e-253">[Event-based Asynchronous Pattern Overview](../../../docs/standard/asynchronous-programming-patterns/event-based-asynchronous-pattern-overview.md) (Información general sobre el modelo asincrónico basado en eventos)</span><span class="sxs-lookup"><span data-stu-id="8c01e-253">[Event-based Asynchronous Pattern Overview](../../../docs/standard/asynchronous-programming-patterns/event-based-asynchronous-pattern-overview.md)</span></span>  
 [<span data-ttu-id="8c01e-254">NO está en la compilación: Multithreading en Visual Basic</span><span class="sxs-lookup"><span data-stu-id="8c01e-254">NOT IN BUILD: Multithreading in Visual Basic</span></span>](http://msdn.microsoft.com/en-us/c731a50c-09c1-4468-9646-54c86b75d269)  
 [<span data-ttu-id="8c01e-255">Implementar un componente que admita el modelo asincrónico basado en eventos</span><span class="sxs-lookup"><span data-stu-id="8c01e-255">How to: Implement a Component That Supports the Event-based Asynchronous Pattern</span></span>](../../../docs/standard/asynchronous-programming-patterns/component-that-supports-the-event-based-asynchronous-pattern.md)  
 [<span data-ttu-id="8c01e-256">Programación multiproceso con el modelo asincrónico basado en eventos</span><span class="sxs-lookup"><span data-stu-id="8c01e-256">Multithreaded Programming with the Event-based Asynchronous Pattern</span></span>](../../../docs/standard/asynchronous-programming-patterns/multithreaded-programming-with-the-event-based-asynchronous-pattern.md)
