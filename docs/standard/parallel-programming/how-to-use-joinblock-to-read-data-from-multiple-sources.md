---
title: "Cómo: Usar JoinBlock para leer datos de diferentes orígenes"
ms.custom: 
ms.date: 03/30/2017
ms.prod: .net
ms.reviewer: 
ms.suite: 
ms.technology: dotnet-standard
ms.tgt_pltfrm: 
ms.topic: article
dev_langs:
- csharp
- vb
helpviewer_keywords:
- Task Parallel Library, dataflows
- TPL dataflow library, joining blocks in
- dataflow blocks, joining in TPL
ms.assetid: e9c1ada4-ac57-4704-87cb-2f5117f8151d
caps.latest.revision: "7"
author: rpetrusha
ms.author: ronpet
manager: wpickett
ms.openlocfilehash: 41445e4874b94809840ecf9ebda6f27ccc955c9b
ms.sourcegitcommit: bd1ef61f4bb794b25383d3d72e71041a5ced172e
ms.translationtype: HT
ms.contentlocale: es-ES
ms.lasthandoff: 10/18/2017
---
# <a name="how-to-use-joinblock-to-read-data-from-multiple-sources"></a><span data-ttu-id="44830-102">Cómo: Usar JoinBlock para leer datos de diferentes orígenes</span><span class="sxs-lookup"><span data-stu-id="44830-102">How to: Use JoinBlock to Read Data From Multiple Sources</span></span>
<span data-ttu-id="44830-103">Este documento explica cómo utilizar el <xref:System.Threading.Tasks.Dataflow.JoinBlock%602> clase para realizar una operación cuando los datos están disponibles en varios orígenes.</span><span class="sxs-lookup"><span data-stu-id="44830-103">This document explains how to use the <xref:System.Threading.Tasks.Dataflow.JoinBlock%602> class to perform an operation when data is available from multiple sources.</span></span> <span data-ttu-id="44830-104">También se muestra cómo utilizar el modo no expansivo para permitir que varios bloques de combinación puedan compartir un origen de datos más eficazmente.</span><span class="sxs-lookup"><span data-stu-id="44830-104">It also demonstrates how to use non-greedy mode to enable multiple join blocks to share a data source more efficiently.</span></span>  
  
> [!TIP]
>  <span data-ttu-id="44830-105">La biblioteca de flujos de datos TPL (espacio de nombres <xref:System.Threading.Tasks.Dataflow?displayProperty=nameWithType>) no se distribuye con [!INCLUDE[net_v45](../../../includes/net-v45-md.md)].</span><span class="sxs-lookup"><span data-stu-id="44830-105">The TPL Dataflow Library (<xref:System.Threading.Tasks.Dataflow?displayProperty=nameWithType> namespace) is not distributed with the [!INCLUDE[net_v45](../../../includes/net-v45-md.md)].</span></span> <span data-ttu-id="44830-106">Para instalar el <xref:System.Threading.Tasks.Dataflow> espacio de nombres, abra el proyecto en [!INCLUDE[vs_dev11_long](../../../includes/vs-dev11-long-md.md)], elija **administrar paquetes de NuGet** en el menú proyecto y busque en línea el `Microsoft.Tpl.Dataflow` paquete.</span><span class="sxs-lookup"><span data-stu-id="44830-106">To install the <xref:System.Threading.Tasks.Dataflow> namespace, open your project in [!INCLUDE[vs_dev11_long](../../../includes/vs-dev11-long-md.md)], choose **Manage NuGet Packages** from the Project menu, and search online for the `Microsoft.Tpl.Dataflow` package.</span></span>  
  
## <a name="example"></a><span data-ttu-id="44830-107">Ejemplo</span><span class="sxs-lookup"><span data-stu-id="44830-107">Example</span></span>  
 <span data-ttu-id="44830-108">El siguiente ejemplo define tres tipos de recursos, `NetworkResource`, `FileResource`, y `MemoryResource`y realiza las operaciones cuando los recursos estén disponibles.</span><span class="sxs-lookup"><span data-stu-id="44830-108">The following example defines three resource types, `NetworkResource`, `FileResource`, and `MemoryResource`, and performs operations when resources become available.</span></span> <span data-ttu-id="44830-109">Este ejemplo se necesita una `NetworkResource` y `MemoryResource` par con el fin de realizar la primera operación y un `FileResource` y `MemoryResource` par con el fin de realizar la segunda operación.</span><span class="sxs-lookup"><span data-stu-id="44830-109">This example requires a `NetworkResource` and `MemoryResource` pair in order to perform the first operation and a `FileResource` and `MemoryResource` pair in order to perform the second operation.</span></span> <span data-ttu-id="44830-110">Para habilitar estas operaciones que se produzca cuando todos los recursos necesarios están disponibles, este ejemplo se utiliza la <xref:System.Threading.Tasks.Dataflow.JoinBlock%602> clase.</span><span class="sxs-lookup"><span data-stu-id="44830-110">To enable these operations to occur when all required resources are available, this example uses the <xref:System.Threading.Tasks.Dataflow.JoinBlock%602> class.</span></span> <span data-ttu-id="44830-111">Cuando un <xref:System.Threading.Tasks.Dataflow.JoinBlock%602> objeto recibe los datos de todos los orígenes, propaga esos datos a su destino, que en este ejemplo es un <xref:System.Threading.Tasks.Dataflow.ActionBlock%601> objeto.</span><span class="sxs-lookup"><span data-stu-id="44830-111">When a <xref:System.Threading.Tasks.Dataflow.JoinBlock%602> object receives data from all sources, it propagates that data to its target, which in this example is an <xref:System.Threading.Tasks.Dataflow.ActionBlock%601> object.</span></span> <span data-ttu-id="44830-112">Ambos <xref:System.Threading.Tasks.Dataflow.JoinBlock%602> leen objetos de un grupo compartido de `MemoryResource` objetos.</span><span class="sxs-lookup"><span data-stu-id="44830-112">Both <xref:System.Threading.Tasks.Dataflow.JoinBlock%602> objects read from a shared pool of `MemoryResource` objects.</span></span>  
  
 [!code-csharp[TPLDataflow_NonGreedyJoin#1](../../../samples/snippets/csharp/VS_Snippets_Misc/tpldataflow_nongreedyjoin/cs/nongreedyjoin.cs#1)]
 [!code-vb[TPLDataflow_NonGreedyJoin#1](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpldataflow_nongreedyjoin/vb/nongreedyjoin.vb#1)]  
  
 <span data-ttu-id="44830-113">Para habilitar el uso eficaz del grupo compartido de `MemoryResource` objetos, este ejemplo se especifica un <xref:System.Threading.Tasks.Dataflow.GroupingDataflowBlockOptions> objeto que tiene el <xref:System.Threading.Tasks.Dataflow.GroupingDataflowBlockOptions.Greedy%2A> propiedad establecida en `False` crear <xref:System.Threading.Tasks.Dataflow.JoinBlock%602> objetos que actúan en modo no expansivo.</span><span class="sxs-lookup"><span data-stu-id="44830-113">To enable efficient use of the shared pool of `MemoryResource` objects, this example specifies a <xref:System.Threading.Tasks.Dataflow.GroupingDataflowBlockOptions> object that has the <xref:System.Threading.Tasks.Dataflow.GroupingDataflowBlockOptions.Greedy%2A> property set to `False` to create <xref:System.Threading.Tasks.Dataflow.JoinBlock%602> objects that act in non-greedy mode.</span></span> <span data-ttu-id="44830-114">Un bloque de combinación no expansiva pospone todos los mensajes entrantes hasta que uno esté disponible de cada origen.</span><span class="sxs-lookup"><span data-stu-id="44830-114">A non-greedy join block postpones all incoming messages until one is available from each source.</span></span> <span data-ttu-id="44830-115">Si cualquiera de los mensajes pospuestos ya aceptada por otro bloque, el bloque de combinación reinicia el proceso.</span><span class="sxs-lookup"><span data-stu-id="44830-115">If any of the postponed messages were accepted by another block, the join block restarts the process.</span></span> <span data-ttu-id="44830-116">El modo no expansivo permite bloques de combinación que comparten uno o más bloques de origen progresar mientras esperan los otros bloques de datos.</span><span class="sxs-lookup"><span data-stu-id="44830-116">Non-greedy mode enables join blocks that share one or more source blocks to make forward progress as the other blocks wait for data.</span></span> <span data-ttu-id="44830-117">En este ejemplo, si un `MemoryResource` objeto se agrega a la `memoryResources` del grupo, la combinación de primer bloque para recibir su segundo origen de datos puede progresar.</span><span class="sxs-lookup"><span data-stu-id="44830-117">In this example, if a `MemoryResource` object is added to the `memoryResources` pool, the first join block to receive its second data source can make forward progress.</span></span> <span data-ttu-id="44830-118">Si este ejemplo se fuera a usar el modo expansivo, que es el valor predeterminado, un bloque de combinación pueden tardar la `MemoryResource` objeto y espere a que el segundo recurso esté disponible.</span><span class="sxs-lookup"><span data-stu-id="44830-118">If this example were to use greedy mode, which is the default, one join block might take the `MemoryResource` object and wait for the second resource to become available.</span></span> <span data-ttu-id="44830-119">Sin embargo, si el otro bloque de combinación tiene su segundo origen de datos disponible, no puede progresar porque la `MemoryResource` objeto ha sido tomado por otro bloque de combinación.</span><span class="sxs-lookup"><span data-stu-id="44830-119">However, if the other join block has its second data source available, it cannot make forward progress because the `MemoryResource` object has been taken by the other join block.</span></span>  
  
## <a name="compiling-the-code"></a><span data-ttu-id="44830-120">Compilar el código</span><span class="sxs-lookup"><span data-stu-id="44830-120">Compiling the Code</span></span>  
 <span data-ttu-id="44830-121">Copie el código de ejemplo y péguelo en un proyecto de Visual Studio o en un archivo denominado `DataflowNonGreedyJoin.cs` (`DataflowNonGreedyJoin.vb` para [!INCLUDE[vbprvb](../../../includes/vbprvb-md.md)]) y, a continuación, ejecute el siguiente comando en una ventana del símbolo del sistema de Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="44830-121">Copy the example code and paste it in a Visual Studio project, or paste it in a file that is named `DataflowNonGreedyJoin.cs` (`DataflowNonGreedyJoin.vb` for [!INCLUDE[vbprvb](../../../includes/vbprvb-md.md)]), and then run the following command in a Visual Studio Command Prompt window.</span></span>  
  
 [!INCLUDE[csprcs](../../../includes/csprcs-md.md)]  
  
 <span data-ttu-id="44830-122">**csc.exe /r:System.Threading.Tasks.Dataflow.dll DataflowNonGreedyJoin.cs**</span><span class="sxs-lookup"><span data-stu-id="44830-122">**csc.exe /r:System.Threading.Tasks.Dataflow.dll DataflowNonGreedyJoin.cs**</span></span>  
  
 [!INCLUDE[vbprvb](../../../includes/vbprvb-md.md)]  
  
 <span data-ttu-id="44830-123">**vbc.exe /r:System.Threading.Tasks.Dataflow.dll DataflowNonGreedyJoin.vb**</span><span class="sxs-lookup"><span data-stu-id="44830-123">**vbc.exe /r:System.Threading.Tasks.Dataflow.dll DataflowNonGreedyJoin.vb**</span></span>  
  
## <a name="robust-programming"></a><span data-ttu-id="44830-124">Programación sólida</span><span class="sxs-lookup"><span data-stu-id="44830-124">Robust Programming</span></span>  
 <span data-ttu-id="44830-125">El uso de las uniones no expansivas también puede ayudar a evitar el interbloqueo en la aplicación.</span><span class="sxs-lookup"><span data-stu-id="44830-125">The use of non-greedy joins can also help you prevent deadlock in your application.</span></span> <span data-ttu-id="44830-126">En una aplicación de software, *interbloqueo* se produce cuando dos o más procesos mantienen un recurso y esperan mutuamente a que otro proceso libere algún otro recurso.</span><span class="sxs-lookup"><span data-stu-id="44830-126">In a software application, *deadlock* occurs when two or more processes each hold a resource and mutually wait for another process to release some other resource.</span></span> <span data-ttu-id="44830-127">Considere la posibilidad de una aplicación que define dos <xref:System.Threading.Tasks.Dataflow.JoinBlock%602> objetos.</span><span class="sxs-lookup"><span data-stu-id="44830-127">Consider an application that defines two <xref:System.Threading.Tasks.Dataflow.JoinBlock%602> objects.</span></span> <span data-ttu-id="44830-128">Ambos objetos leen datos de dos bloques de código fuente compartido.</span><span class="sxs-lookup"><span data-stu-id="44830-128">Both objects each read data from two shared source blocks.</span></span> <span data-ttu-id="44830-129">En modo expansivo, si se lee un bloque de combinación del primer origen y el segundo bloque de combinación se lee desde el origen de la segundo, la aplicación podría generar un interbloqueo porque ambos bloques de combinación esperan mutuamente a que la otra transacción libere sus recursos.</span><span class="sxs-lookup"><span data-stu-id="44830-129">In greedy mode, if one join block reads from the first source and the second join block reads from the second source, the application might deadlock because both join blocks mutually wait for the other to release its resource.</span></span> <span data-ttu-id="44830-130">En el modo no expansivo, cada bloque de combinación se elimina las lecturas de sus orígenes sólo cuando todos los datos están disponibles y, por lo tanto, el riesgo de interbloqueo.</span><span class="sxs-lookup"><span data-stu-id="44830-130">In non-greedy mode, each join block reads from its sources only when all data is available, and therefore, the risk of deadlock is eliminated.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="44830-131">Vea también</span><span class="sxs-lookup"><span data-stu-id="44830-131">See Also</span></span>  
 [<span data-ttu-id="44830-132">Flujo de datos</span><span class="sxs-lookup"><span data-stu-id="44830-132">Dataflow</span></span>](../../../docs/standard/parallel-programming/dataflow-task-parallel-library.md)
