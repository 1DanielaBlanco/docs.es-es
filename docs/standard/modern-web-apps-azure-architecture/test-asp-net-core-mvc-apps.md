---
title: Probar aplicaciones MVC de ASP.NET Core
description: "Diseñar aplicaciones Web modernas con ASP.NET Core y Azure | Probar aplicaciones MVC de ASP.NET Core"
author: ardalis
ms.author: wiwagn
ms.date: 10/08/2017
ms.prod: .net-core
ms.technology: dotnet-docker
ms.workload:
- dotnet
- dotnetcore
ms.openlocfilehash: d23d0accc33fb8335dff602d6e1d6c8689972906
ms.sourcegitcommit: e7f04439d78909229506b56935a1105a4149ff3d
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 12/23/2017
---
# <a name="test-aspnet-core-mvc-apps"></a><span data-ttu-id="0dbc2-103">Probar aplicaciones MVC de ASP.NET Core</span><span class="sxs-lookup"><span data-stu-id="0dbc2-103">Test ASP.NET Core MVC Apps</span></span>

> <span data-ttu-id="0dbc2-104">_"Si no le gusta el producto de pruebas unitarias, más probable es que los clientes no desean probarlo, ya sea."_</span><span class="sxs-lookup"><span data-stu-id="0dbc2-104">_"If you don't like unit testing your product, most likely your customers won't like to test it, either."_</span></span>
> <span data-ttu-id="0dbc2-105">_ - Anónimo:</span><span class="sxs-lookup"><span data-stu-id="0dbc2-105">_- Anonymous-</span></span>

## <a name="summary"></a><span data-ttu-id="0dbc2-106">Resumen</span><span class="sxs-lookup"><span data-stu-id="0dbc2-106">Summary</span></span>

<span data-ttu-id="0dbc2-107">Software de cualquier complejidad puede producir errores inesperados en respuesta a los cambios en.</span><span class="sxs-lookup"><span data-stu-id="0dbc2-107">Software of any complexity can fail in unexpected ways in response to changes.</span></span> <span data-ttu-id="0dbc2-108">Por lo tanto, es necesario para todas las aplicaciones más triviales (o menos críticas) realizar pruebas después de realizar cambios.</span><span class="sxs-lookup"><span data-stu-id="0dbc2-108">Thus, testing after making changes is required for all but the most trivial (or least critical) applications.</span></span> <span data-ttu-id="0dbc2-109">Son la más lenta, manera menos confiable y más costosa pruebas manuales para probar software.</span><span class="sxs-lookup"><span data-stu-id="0dbc2-109">Manual testing is the slowest, least reliable, most expensive way to test software.</span></span> <span data-ttu-id="0dbc2-110">Desgraciadamente, si las aplicaciones no están diseñadas para ser pueden someterse a prueba, puede ser el único medio disponible.</span><span class="sxs-lookup"><span data-stu-id="0dbc2-110">Unfortunately, if applications are not designed to be testable, it can be the only means available.</span></span> <span data-ttu-id="0dbc2-111">Las aplicaciones escritas siguiente los principios arquitectónicos dispuestos en el capítulo X deben ser pueden someterse a prueba de unidad y las aplicaciones de ASP.NET Core admiten integración automatizada y también las pruebas funcionales.</span><span class="sxs-lookup"><span data-stu-id="0dbc2-111">Applications written following the architectural principles laid out in chapter X should be unit testable, and ASP.NET Core applications support automated integration and functional testing as well.</span></span>

## <a name="kinds-of-automated-tests"></a><span data-ttu-id="0dbc2-112">Tipos de pruebas automatizadas</span><span class="sxs-lookup"><span data-stu-id="0dbc2-112">Kinds of Automated Tests</span></span>

<span data-ttu-id="0dbc2-113">Hay muchos tipos de pruebas automatizadas para las aplicaciones de software.</span><span class="sxs-lookup"><span data-stu-id="0dbc2-113">There are many kinds of automated tests for software applications.</span></span> <span data-ttu-id="0dbc2-114">La forma más sencilla, prueba de nivel más bajo es la prueba unitaria.</span><span class="sxs-lookup"><span data-stu-id="0dbc2-114">The simplest, lowest level test is the unit test.</span></span> <span data-ttu-id="0dbc2-115">En un nivel ligeramente superior hay pruebas de integración y pruebas funcionales.</span><span class="sxs-lookup"><span data-stu-id="0dbc2-115">At a slightly higher level there are integration tests and functional tests.</span></span> <span data-ttu-id="0dbc2-116">Otros tipos de pruebas, como pruebas de interfaz de usuario, las pruebas de carga, las pruebas de esfuerzo y pruebas de humo, quedan fuera del ámbito de este documento.</span><span class="sxs-lookup"><span data-stu-id="0dbc2-116">Other kinds of tests, like UI tests, load tests, stress tests, and smoke tests, are beyond the scope of this document.</span></span>

### <a name="unit-tests"></a><span data-ttu-id="0dbc2-117">Pruebas unitarias</span><span class="sxs-lookup"><span data-stu-id="0dbc2-117">Unit Tests</span></span>

<span data-ttu-id="0dbc2-118">Una prueba unitaria prueba un único elemento de la lógica de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="0dbc2-118">A unit test tests a single part of your application's logic.</span></span> <span data-ttu-id="0dbc2-119">Uno puede describir aún más haciendo una lista de algunas de las cosas que no se encuentra.</span><span class="sxs-lookup"><span data-stu-id="0dbc2-119">One can further describe it by listing some of the things that it isn't.</span></span> <span data-ttu-id="0dbc2-120">Una prueba unitaria no probar cómo su código funciona con dependencias o infraestructura – comprueba qué integración es para.</span><span class="sxs-lookup"><span data-stu-id="0dbc2-120">A unit test doesn't test how your code works with dependencies or infrastructure – that's what integration tests are for.</span></span> <span data-ttu-id="0dbc2-121">Una prueba unitaria no prueba el código se escribe en el marco de trabajo, debe asumir que funciona o, si te parece no, registre un error y codificar una solución alternativa.</span><span class="sxs-lookup"><span data-stu-id="0dbc2-121">A unit test doesn't test the framework your code is written on – you should assume it works or, if you find it doesn't, file a bug and code a workaround.</span></span> <span data-ttu-id="0dbc2-122">Una prueba unitaria se ejecuta completamente en la memoria y en proceso.</span><span class="sxs-lookup"><span data-stu-id="0dbc2-122">A unit test runs completely in memory and in process.</span></span> <span data-ttu-id="0dbc2-123">No se comunican con el sistema de archivos, la red o una base de datos.</span><span class="sxs-lookup"><span data-stu-id="0dbc2-123">It doesn't communicate with the file system, the network, or a database.</span></span> <span data-ttu-id="0dbc2-124">Pruebas unitarias solo deben probar el código.</span><span class="sxs-lookup"><span data-stu-id="0dbc2-124">Unit tests should only test your code.</span></span>

<span data-ttu-id="0dbc2-125">Pruebas unitarias, en virtud del hecho de que se prueba únicamente una sola unidad del código, no tiene dependencias externas, deben ejecutar muy rápidamente.</span><span class="sxs-lookup"><span data-stu-id="0dbc2-125">Unit tests, by virtue of the fact that they test only a single unit of your code, with no external dependencies, should execute extremely quickly.</span></span> <span data-ttu-id="0dbc2-126">Por lo tanto, debe ser capaz de ejecutar conjuntos de pruebas de cientos de pruebas unitarias en unos segundos.</span><span class="sxs-lookup"><span data-stu-id="0dbc2-126">Thus, you should be able to run test suites of hundreds of unit tests in a few seconds.</span></span> <span data-ttu-id="0dbc2-127">Ejecutar con frecuencia, lo ideal es que antes de cada inserción a un repositorio de control de código fuente compartido y, por supuesto, con cada compilación automatizada en el servidor de compilación.</span><span class="sxs-lookup"><span data-stu-id="0dbc2-127">Run them frequently, ideally before every push to a shared source control repository, and certainly with every automated build on your build server.</span></span>

### <a name="integration-tests"></a><span data-ttu-id="0dbc2-128">Pruebas de integración</span><span class="sxs-lookup"><span data-stu-id="0dbc2-128">Integration Tests</span></span>

<span data-ttu-id="0dbc2-129">Aunque es una buena idea para encapsular el código que interactúa con la infraestructura, como los sistemas de archivos y bases de datos, seguirá disponiendo de parte de ese código y, probablemente deseará probarlo.</span><span class="sxs-lookup"><span data-stu-id="0dbc2-129">Although it's a good idea to encapsulate your code that interacts with infrastructure like databases and file systems, you will still have some of that code, and you will probably want to test it.</span></span> <span data-ttu-id="0dbc2-130">Además, debe comprobar que las capas de su código interactúan según lo esperado cuando se resolverán completamente las dependencias de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="0dbc2-130">Additionally, you should verify that your code's layers interact as you expect when your application's dependencies are fully resolved.</span></span> <span data-ttu-id="0dbc2-131">Se trata de la responsabilidad de pruebas de integración.</span><span class="sxs-lookup"><span data-stu-id="0dbc2-131">This is the responsibility of integration tests.</span></span> <span data-ttu-id="0dbc2-132">Pruebas de integración tienden a ser más lento y más difíciles de configurar que las pruebas unitarias, porque a menudo dependen de infraestructura y dependencias externas.</span><span class="sxs-lookup"><span data-stu-id="0dbc2-132">Integration tests tend to be slower and more difficult to set up than unit tests, because they often depend on external dependencies and infrastructure.</span></span> <span data-ttu-id="0dbc2-133">Por lo tanto, debe evitar, lo que podría ser pruebas con pruebas unitarias en las pruebas de integración de pruebas.</span><span class="sxs-lookup"><span data-stu-id="0dbc2-133">Thus, you should avoid testing things that could be tests with unit tests in integration tests.</span></span> <span data-ttu-id="0dbc2-134">Si un escenario determinado se puede probar con una prueba unitaria, debe probar con una prueba unitaria.</span><span class="sxs-lookup"><span data-stu-id="0dbc2-134">If you can test a given scenario with a unit test, you should test it with a unit test.</span></span> <span data-ttu-id="0dbc2-135">Si no es posible, considere la posibilidad de usar una prueba de integración.</span><span class="sxs-lookup"><span data-stu-id="0dbc2-135">If you can't, then consider using an integration test.</span></span>

<span data-ttu-id="0dbc2-136">Pruebas de integración a menudo tendrá el programa de instalación más compleja y procedimientos de destrucción de pruebas unitarias.</span><span class="sxs-lookup"><span data-stu-id="0dbc2-136">Integration tests will often have more complex setup and teardown procedures than unit tests.</span></span> <span data-ttu-id="0dbc2-137">Por ejemplo, una prueba de integración que va en una base de datos real será necesario un modo para devolver la base de datos a un estado conocido antes de cada serie de pruebas.</span><span class="sxs-lookup"><span data-stu-id="0dbc2-137">For example, an integration test that goes against an actual database will need a way to return the database to a known state before each test run.</span></span> <span data-ttu-id="0dbc2-138">Cuando se agregan nuevas pruebas y el esquema de base de datos de producción evoluciona, estas secuencias de comandos tienden a aumentar de tamaño y la complejidad de la prueba.</span><span class="sxs-lookup"><span data-stu-id="0dbc2-138">As new tests are added and the production database schema evolves, these test scripts will tend to grow in size and complexity.</span></span> <span data-ttu-id="0dbc2-139">En muchos sistemas de gran tamaño, no resulta práctico ejecutar completas conjuntos de pruebas de integración en las estaciones de trabajo de desarrollador antes de proteger los cambios en el control de código fuente compartido.</span><span class="sxs-lookup"><span data-stu-id="0dbc2-139">In many large systems, it is impractical to run full suites of integration tests on developer workstations before checking in changes to shared source control.</span></span> <span data-ttu-id="0dbc2-140">En estos casos, se pueden ejecutar pruebas de integración en un servidor de compilación.</span><span class="sxs-lookup"><span data-stu-id="0dbc2-140">In these cases, integration tests may be run on a build server.</span></span>

<span data-ttu-id="0dbc2-141">La clase de implementación LocalFileImageService implementa la lógica para buscar y devolver los bytes de un archivo de imagen de una carpeta concreta con un identificador dada:</span><span class="sxs-lookup"><span data-stu-id="0dbc2-141">The LocalFileImageService implementation class implements the logic for fetching and returning the bytes of an image file from a particular folder given an id:</span></span>

```cs
public class LocalFileImageService : IImageService
{
    private readonly IHostingEnvironment _env;
    public LocalFileImageService(IHostingEnvironment env)
    {
        _env = env;
    }
    public byte[] GetImageBytesById(int id)
    {
        try
        {
            var contentRoot = _env.ContentRootPath + "//Pics";
            var path = Path.Combine(contentRoot, id + ".png");
            return File.ReadAllBytes(path);
```

### <a name="functional-tests"></a><span data-ttu-id="0dbc2-142">Pruebas funcionales</span><span class="sxs-lookup"><span data-stu-id="0dbc2-142">Functional Tests</span></span>

<span data-ttu-id="0dbc2-143">Pruebas de integración se escriben desde la perspectiva del desarrollador, para comprobar que algunos componentes del sistema funcionen correctamente entre sí.</span><span class="sxs-lookup"><span data-stu-id="0dbc2-143">Integration tests are written from the perspective of the developer, to verify that some components of the system work correctly together.</span></span> <span data-ttu-id="0dbc2-144">Pruebas funcionales se escriben desde la perspectiva del usuario y comprobar la exactitud del sistema en función de sus requisitos.</span><span class="sxs-lookup"><span data-stu-id="0dbc2-144">Functional tests are written from the perspective of the user, and verify the correctness of the system based on its requirements.</span></span> <span data-ttu-id="0dbc2-145">El extracto siguiente ofrece una analogía útil para saber cómo pensar acerca de las pruebas funcionales, en comparación con pruebas unitarias:</span><span class="sxs-lookup"><span data-stu-id="0dbc2-145">The following excerpt offers a useful analogy for how to think about functional tests, compared to unit tests:</span></span>

> <span data-ttu-id="0dbc2-146">"Muchas veces el desarrollo de un sistema es asemejarse a la generación de una casa.</span><span class="sxs-lookup"><span data-stu-id="0dbc2-146">"Many times the development of a system is likened to the building of a house.</span></span> <span data-ttu-id="0dbc2-147">Mientras esta analogía no es bastante correcta, podemos ampliarlo para explicar la diferencia entre unitarias y pruebas funcionales.</span><span class="sxs-lookup"><span data-stu-id="0dbc2-147">While this analogy isn't quite correct, we can extend it for the purposes of understanding the difference between unit and functional tests.</span></span> <span data-ttu-id="0dbc2-148">Pruebas unitarias están análogo a un inspector de creación visitar el sitio de la construcción de una casa.</span><span class="sxs-lookup"><span data-stu-id="0dbc2-148">Unit testing is analogous to a building inspector visiting a house's construction site.</span></span> <span data-ttu-id="0dbc2-149">Se ha centrado en los distintos sistemas internos de la casa, la base, tramas, eléctrica, conexión y así sucesivamente.</span><span class="sxs-lookup"><span data-stu-id="0dbc2-149">He is focused on the various internal systems of the house, the foundation, framing, electrical, plumbing, and so on.</span></span> <span data-ttu-id="0dbc2-150">Asegura de (pruebas) que las partes de la casa funcionará correctamente y responder de manera segura, es decir, el código de creación.</span><span class="sxs-lookup"><span data-stu-id="0dbc2-150">He ensures (tests) that the parts of the house will work correctly and safely, that is, meet the building code.</span></span> <span data-ttu-id="0dbc2-151">Pruebas funcionales en este escenario son análogas a los propietarios de casas visitar este mismo sitio de construcción.</span><span class="sxs-lookup"><span data-stu-id="0dbc2-151">Functional tests in this scenario are analogous to the homeowner visiting this same construction site.</span></span> <span data-ttu-id="0dbc2-152">Da por supuesto que los sistemas internos se comportarán de forma adecuada, que el inspector de creación está realizando su tarea.</span><span class="sxs-lookup"><span data-stu-id="0dbc2-152">He assumes that the internal systems will behave appropriately, that the building inspector is performing his task.</span></span> <span data-ttu-id="0dbc2-153">Los propietarios de casas se centra en ¿qué se va a viven en casa de este.</span><span class="sxs-lookup"><span data-stu-id="0dbc2-153">The homeowner is focused on what it will be like to live in this house.</span></span> <span data-ttu-id="0dbc2-154">Se ocupa del aspecto de la casa, son las distintas salas un tamaño cómodo y la casa ajustarse a las necesidades de la familia, son las ventanas en una zona adecuada para detectar el sol por la mañana.</span><span class="sxs-lookup"><span data-stu-id="0dbc2-154">He is concerned with how the house looks, are the various rooms a comfortable size, does the house fit the family's needs, are the windows in a good spot to catch the morning sun.</span></span> <span data-ttu-id="0dbc2-155">Los propietarios de casas está realizando pruebas funcionales de la casa.</span><span class="sxs-lookup"><span data-stu-id="0dbc2-155">The homeowner is performing functional tests on the house.</span></span> <span data-ttu-id="0dbc2-156">Tiene la perspectiva del usuario.</span><span class="sxs-lookup"><span data-stu-id="0dbc2-156">He has the user's perspective.</span></span> <span data-ttu-id="0dbc2-157">El inspector de creación está realizando pruebas unitarias en la casa.</span><span class="sxs-lookup"><span data-stu-id="0dbc2-157">The building inspector is performing unit tests on the house.</span></span> <span data-ttu-id="0dbc2-158">Tiene perspectiva del generador".</span><span class="sxs-lookup"><span data-stu-id="0dbc2-158">He has the builder's perspective."</span></span>

<span data-ttu-id="0dbc2-159">Origen: [pruebas frente a funcionales pruebas unitarias](http://www.softwaretestingtricks.com/2007/01/unit-testing-versus-functional-tests.html)</span><span class="sxs-lookup"><span data-stu-id="0dbc2-159">Source: [Unit Testing versus Functional Tests](http://www.softwaretestingtricks.com/2007/01/unit-testing-versus-functional-tests.html)</span></span>

<span data-ttu-id="0dbc2-160">Soy aficionado de decir "que los desarrolladores, se producirá un error de dos maneras: ampliaremos lo incorrecto, o se cree nada incorrecto."</span><span class="sxs-lookup"><span data-stu-id="0dbc2-160">I'm fond of saying "As developers, we fail in two ways: we build the thing wrong, or we build the wrong thing."</span></span> <span data-ttu-id="0dbc2-161">Aseguran de pruebas unitarias que está generando la derecha cosa; pruebas funcionales aseguran de que está creando lo correcto.</span><span class="sxs-lookup"><span data-stu-id="0dbc2-161">Unit tests ensure you are building the thing right; functional tests ensure you are building the right thing.</span></span>

<span data-ttu-id="0dbc2-162">Puesto que las pruebas funcionales funcionan en el nivel de sistema, pueden requerir cierto grado de automatización de la interfaz de usuario.</span><span class="sxs-lookup"><span data-stu-id="0dbc2-162">Since functional tests operate at the system level, they may require some degree of UI automation.</span></span> <span data-ttu-id="0dbc2-163">Al igual que las pruebas de integración, suelen funcionar con algún tipo de infraestructura de pruebas también.</span><span class="sxs-lookup"><span data-stu-id="0dbc2-163">Like integration tests, they usually work with some kind of test infrastructure as well.</span></span> <span data-ttu-id="0dbc2-164">Esto hace que sean más lento y más complicado que las pruebas unitarias y la integración.</span><span class="sxs-lookup"><span data-stu-id="0dbc2-164">This makes them slower and more brittle than unit and integration tests.</span></span> <span data-ttu-id="0dbc2-165">Debe tener solo pruebas funcionales tantos como necesite para estar seguro que el sistema se comporta tal y como se espera que los usuarios.</span><span class="sxs-lookup"><span data-stu-id="0dbc2-165">You should have only as many functional tests as you need to be confident the system is behaving as users expect.</span></span>

### <a name="testing-pyramid"></a><span data-ttu-id="0dbc2-166">Pruebas piramidal</span><span class="sxs-lookup"><span data-stu-id="0dbc2-166">Testing Pyramid</span></span>

<span data-ttu-id="0dbc2-167">Martin Fowler escribió acerca de la pirámide prueba, se muestra un ejemplo de los cuales en la figura 9-1.</span><span class="sxs-lookup"><span data-stu-id="0dbc2-167">Martin Fowler wrote about the testing pyramid, an example of which is shown in Figure 9-1.</span></span>

![](./media/image9-1.png)

<span data-ttu-id="0dbc2-168">Figura 9-1 pruebas piramidal</span><span class="sxs-lookup"><span data-stu-id="0dbc2-168">Figure 9-1 Testing Pyramid</span></span>

<span data-ttu-id="0dbc2-169">Los diferentes niveles de la pirámide y sus tamaños relativos, representan distintos tipos de pruebas y cuántas debe escribir para la aplicación.</span><span class="sxs-lookup"><span data-stu-id="0dbc2-169">The different layers of the pyramid, and their relative sizes, represent different kinds of tests and how many you should write for your application.</span></span> <span data-ttu-id="0dbc2-170">Como puede ver, la recomendación es tiene una gran cantidad de pruebas unitarias, compatible con una capa más pequeña de pruebas de integración, con un nivel incluso más pequeño de pruebas funcionales.</span><span class="sxs-lookup"><span data-stu-id="0dbc2-170">As you can see, the recommendation is to have a large base of unit tests, supported by a smaller layer of integration tests, with an even smaller layer of functional tests.</span></span> <span data-ttu-id="0dbc2-171">Cada capa lo ideal es que sólo debería haber pruebas que no se puede realizar de manera adecuada en un nivel inferior.</span><span class="sxs-lookup"><span data-stu-id="0dbc2-171">Each layer should ideally only have tests in it that cannot be performed adequately at a lower layer.</span></span> <span data-ttu-id="0dbc2-172">Tenga presente la pirámide prueba al tratar de decidir qué tipo de prueba necesita para un escenario determinado.</span><span class="sxs-lookup"><span data-stu-id="0dbc2-172">Keep the testing pyramid in mind when you are trying to decide which kind of test you need for a particular scenario.</span></span>

### <a name="what-to-test"></a><span data-ttu-id="0dbc2-173">Qué se va a probar</span><span class="sxs-lookup"><span data-stu-id="0dbc2-173">What to Test</span></span>

<span data-ttu-id="0dbc2-174">Un problema común para los desarrolladores sin experiencia con la escritura de las pruebas automatizadas viene a continuación con lo que se debe probar.</span><span class="sxs-lookup"><span data-stu-id="0dbc2-174">A common problem for developers who are inexperienced with writing automated tests is coming up with what to test.</span></span> <span data-ttu-id="0dbc2-175">Es un buen punto de partida probar la lógica condicional.</span><span class="sxs-lookup"><span data-stu-id="0dbc2-175">A good starting point is to test conditional logic.</span></span> <span data-ttu-id="0dbc2-176">En cualquier lugar tiene un método con un comportamiento que los cambios se basan en una instrucción condicional (if-else, cambiar, etc.), debe poder dar al menos un par de pruebas que confirman que el comportamiento correcto para ciertas condiciones.</span><span class="sxs-lookup"><span data-stu-id="0dbc2-176">Anywhere you have a method with behavior that changes based on a conditional statement (if-else, switch, etc.), you should be able to come up at least a couple of tests that confirm the correct behavior for certain conditions.</span></span> <span data-ttu-id="0dbc2-177">Si el código tiene condiciones de error, es conveniente escribir al menos una prueba para la "ruta feliz" a través del código (con ningún error) y al menos una prueba para la "ruta sad" (con errores o resultados poco frecuente) para confirmar que la aplicación se comporta según lo previsto en el caso de errores.</span><span class="sxs-lookup"><span data-stu-id="0dbc2-177">If your code has error conditions, it's good to write at least one test for the "happy path" through the code (with no errors), and at least one test for the "sad path" (with errors or atypical results) to confirm your application behaves as expected in the face of errors.</span></span> <span data-ttu-id="0dbc2-178">Por último, pruebe a centrarse en pruebas, lo que puede producir un error, en lugar de centrarse en las métricas como cobertura de código.</span><span class="sxs-lookup"><span data-stu-id="0dbc2-178">Finally, try to focus on testing things that can fail, rather than focusing on metrics like code coverage.</span></span> <span data-ttu-id="0dbc2-179">Cobertura de código más es mejor que menor, por lo general.</span><span class="sxs-lookup"><span data-stu-id="0dbc2-179">More code coverage is better than less, generally.</span></span> <span data-ttu-id="0dbc2-180">Sin embargo, escribir unas pruebas más de un método muy compleja y críticos para la empresa suele ser un mejor uso de la hora de escribir pruebas para propiedades automáticas mejorar métrica de cobertura de código de prueba.</span><span class="sxs-lookup"><span data-stu-id="0dbc2-180">However, writing a few more tests of a very complex and business-critical method is usually a better use of time than writing tests for auto-properties just to improve test code coverage metrics.</span></span>

## <a name="organizing-test-projects"></a><span data-ttu-id="0dbc2-181">Organizar los proyectos de prueba</span><span class="sxs-lookup"><span data-stu-id="0dbc2-181">Organizing Test Projects</span></span>

<span data-ttu-id="0dbc2-182">Sin embargo, funciona mejor para usted, se pueden organizar proyectos de prueba.</span><span class="sxs-lookup"><span data-stu-id="0dbc2-182">Test projects can be organized however works best for you.</span></span> <span data-ttu-id="0dbc2-183">Es una buena idea separe las pruebas por tipo (pruebas unitarias, pruebas de integración) y por lo que va a probar (proyecto por espacio de nombres).</span><span class="sxs-lookup"><span data-stu-id="0dbc2-183">It's a good idea to separate tests by type (unit test, integration test) and by what they are testing (by project, by namespace).</span></span> <span data-ttu-id="0dbc2-184">Si esta separación consta de carpetas dentro de un proyecto de prueba único o varios proyectos de prueba, es una decisión de diseño.</span><span class="sxs-lookup"><span data-stu-id="0dbc2-184">Whether this separation consists of folders within a single test project, or multiple test projects, is a design decision.</span></span> <span data-ttu-id="0dbc2-185">Un proyecto es más sencillo, pero para los proyectos grandes con muchas pruebas, o con el fin de ejecutar más fácilmente diferentes conjuntos de pruebas, puede tener varios proyectos de prueba diferentes.</span><span class="sxs-lookup"><span data-stu-id="0dbc2-185">One project is simplest, but for large projects with many tests, or in order to more easily run different sets of tests, you might want to have several different test projects.</span></span> <span data-ttu-id="0dbc2-186">Muchos equipos de organizan los proyectos de prueba basados en el proyecto está probando, que para las aplicaciones con más de unos pocos proyectos puede provocar un gran número de proyectos de prueba, sobre todo si todavía descomponen estos según qué tipo de pruebas que están en cada proyecto.</span><span class="sxs-lookup"><span data-stu-id="0dbc2-186">Many teams organize test projects based on the project they are testing, which for applications with more than a few projects can result in a large number of test projects, especially if you still break these down according to what kind of tests are in each project.</span></span> <span data-ttu-id="0dbc2-187">Un enfoque de compromiso consiste en disponer de un proyecto por tipo de prueba, por aplicación, con carpetas dentro de los proyectos de prueba para indicar el proyecto (y la clase) que se está probando.</span><span class="sxs-lookup"><span data-stu-id="0dbc2-187">A compromise approach is to have one project per kind of test, per application, with folders inside the test projects to indicate the project (and class) being tested.</span></span>

<span data-ttu-id="0dbc2-188">Un enfoque común es organizar los proyectos de aplicación en una carpeta de 'src' y los proyectos de prueba de la aplicación en una carpeta paralelo 'prueba'.</span><span class="sxs-lookup"><span data-stu-id="0dbc2-188">A common approach is to organize the application projects under a ‘src' folder, and the application's test projects under a parallel ‘tests' folder.</span></span> <span data-ttu-id="0dbc2-189">Puede crear carpetas coincidente de la solución en Visual Studio, si se encuentra esta organización útil.</span><span class="sxs-lookup"><span data-stu-id="0dbc2-189">You can create matching solution folders in Visual Studio, if you find this organization useful.</span></span>

![](./media/image9-2.png)

<span data-ttu-id="0dbc2-190">Organización de prueba de la figura 9-2 en la solución</span><span class="sxs-lookup"><span data-stu-id="0dbc2-190">Figure 9-2 Test organization in your solution</span></span>

<span data-ttu-id="0dbc2-191">Puede usar cualquier marco de pruebas que prefiera.</span><span class="sxs-lookup"><span data-stu-id="0dbc2-191">You can use whichever test framework you prefer.</span></span> <span data-ttu-id="0dbc2-192">El marco de trabajo de xUnit funciona bien y es lo que todas las pruebas de EF y de núcleo de ASP.NET se escriben.</span><span class="sxs-lookup"><span data-stu-id="0dbc2-192">The xUnit framework works well and is what all of the ASP.NET Core and EF Core tests are written in.</span></span> <span data-ttu-id="0dbc2-193">Puede agregar un proyecto de prueba de xUnit en Visual Studio con la plantilla que se muestra en la figura 9-3 o de la CLI mediante dotnet nueva xunit.</span><span class="sxs-lookup"><span data-stu-id="0dbc2-193">You can add an xUnit test project in Visual Studio using the template shown in Figure 9-3, or from the CLI using dotnet new xunit.</span></span>

![](./media/image9-3.png)

<span data-ttu-id="0dbc2-194">Figura 9-3 Agregar un proyecto de prueba de xUnit en Visual Studio</span><span class="sxs-lookup"><span data-stu-id="0dbc2-194">Figure 9-3 Add an xUnit Test Project in Visual Studio</span></span>

### <a name="test-naming"></a><span data-ttu-id="0dbc2-195">Nomenclatura de prueba</span><span class="sxs-lookup"><span data-stu-id="0dbc2-195">Test Naming</span></span>

<span data-ttu-id="0dbc2-196">Debe asignar el nombre de las pruebas de forma coherente, con un nombre que indique lo que hace cada prueba.</span><span class="sxs-lookup"><span data-stu-id="0dbc2-196">You should name your tests in a consistent fashion, with names that indicate what each test does.</span></span> <span data-ttu-id="0dbc2-197">Un enfoque que tengo desde muy buenos resultados con consiste en las clases de prueba de nombre según la clase y el método que se están probando.</span><span class="sxs-lookup"><span data-stu-id="0dbc2-197">One approach I've had great success with is to name test classes according to the class and method they are testing.</span></span> <span data-ttu-id="0dbc2-198">Esto provoca en muchas clases de prueba pequeñas, pero deja muy claro lo que es responsable de cada prueba.</span><span class="sxs-lookup"><span data-stu-id="0dbc2-198">This results in many small test classes, but it makes it extremely clear what each test is responsible for.</span></span> <span data-ttu-id="0dbc2-199">Con el nombre de clase de prueba configurado para identificar la clase y el método se va a probar, el nombre del método de prueba puede utilizarse para especificar el comportamiento que se está probando.</span><span class="sxs-lookup"><span data-stu-id="0dbc2-199">With the test class name set up to identify the class and method to be tested, the test method name can be used to specify the behavior being tested.</span></span> <span data-ttu-id="0dbc2-200">Esto debe incluir el comportamiento esperado y entradas ni suposiciones que deben producir este comportamiento.</span><span class="sxs-lookup"><span data-stu-id="0dbc2-200">This should include the expected behavior and any inputs or assumptions that should yield this behavior.</span></span> <span data-ttu-id="0dbc2-201">Algunos ejemplos de nombres de prueba:</span><span class="sxs-lookup"><span data-stu-id="0dbc2-201">Some example test names:</span></span>

-   <span data-ttu-id="0dbc2-202">CatalogControllerGetImage.CallsImageServiceWithId</span><span class="sxs-lookup"><span data-stu-id="0dbc2-202">CatalogControllerGetImage.CallsImageServiceWithId</span></span>

-   <span data-ttu-id="0dbc2-203">CatalogControllerGetImage.LogsWarningGivenImageMissingException</span><span class="sxs-lookup"><span data-stu-id="0dbc2-203">CatalogControllerGetImage.LogsWarningGivenImageMissingException</span></span>

-   <span data-ttu-id="0dbc2-204">CatalogControllerGetImage.ReturnsFileResultWithBytesGivenSuccess</span><span class="sxs-lookup"><span data-stu-id="0dbc2-204">CatalogControllerGetImage.ReturnsFileResultWithBytesGivenSuccess</span></span>

-   <span data-ttu-id="0dbc2-205">CatalogControllerGetImage.ReturnsNotFoundResultGivenImageMissingException</span><span class="sxs-lookup"><span data-stu-id="0dbc2-205">CatalogControllerGetImage.ReturnsNotFoundResultGivenImageMissingException</span></span>

<span data-ttu-id="0dbc2-206">Una variación de este enfoque finaliza cada nombre de clase de prueba con "Debería" y modifica ligeramente el tiempo:</span><span class="sxs-lookup"><span data-stu-id="0dbc2-206">A variation of this approach ends each test class name with "Should" and modifies the tense slightly:</span></span>

-   <span data-ttu-id="0dbc2-207">CatalogControllerGetImage**Should**.**Call**ImageServiceWithId</span><span class="sxs-lookup"><span data-stu-id="0dbc2-207">CatalogControllerGetImage**Should**.**Call**ImageServiceWithId</span></span>

-   <span data-ttu-id="0dbc2-208">CatalogControllerGetImage**debe**. **Registro**WarningGivenImageMissingException</span><span class="sxs-lookup"><span data-stu-id="0dbc2-208">CatalogControllerGetImage**Should**.**Log**WarningGivenImageMissingException</span></span>

<span data-ttu-id="0dbc2-209">Algunos equipos encuentran el segundo método de nomenclatura más claro, aunque un poco más detallado.</span><span class="sxs-lookup"><span data-stu-id="0dbc2-209">Some teams find the second naming approach clearer, though slightly more verbose.</span></span> <span data-ttu-id="0dbc2-210">En cualquier caso, pruebe a utilizar una convención de nomenclatura que proporciona una visión general de comportamiento de la prueba, para que cuando se produce un error en una o varias pruebas, es obvio desde sus nombres que se han producido un error en los casos.</span><span class="sxs-lookup"><span data-stu-id="0dbc2-210">In any case, try to use a naming convention that provides insight into test behavior, so that when one or more tests fail, it's obvious from their names what cases have failed.</span></span> <span data-ttu-id="0dbc2-211">Evitar nombres pruebas vagamente, como ControllerTests.Test1, tal y como no se ofrece ningún valor cuando se ven en los resultados de pruebas.</span><span class="sxs-lookup"><span data-stu-id="0dbc2-211">Avoid naming you tests vaguely, such as ControllerTests.Test1, as these offer no value when you see them in test results.</span></span>

<span data-ttu-id="0dbc2-212">Si sigue una convención de nomenclatura que se muestra arriba genera muchas clases de prueba pequeñas, es una buena idea para organizar mejor las pruebas mediante las carpetas y los espacios de nombres.</span><span class="sxs-lookup"><span data-stu-id="0dbc2-212">If you follow a naming convention like the one above that produces many small test classes, it's a good idea to further organize your tests using folders and namespaces.</span></span> <span data-ttu-id="0dbc2-213">Figura 9-4 muestra un enfoque para organizar las pruebas en la carpeta en varios proyectos de prueba.</span><span class="sxs-lookup"><span data-stu-id="0dbc2-213">Figure 9-4 shows one approach to organizing tests by folder within several test projects.</span></span>

![](./media/image9-4.png)

<span data-ttu-id="0dbc2-214">**Figura 9-4.**</span><span class="sxs-lookup"><span data-stu-id="0dbc2-214">**Figure 9-4.**</span></span> <span data-ttu-id="0dbc2-215">Organizar las clases de prueba por carpeta en función de la clase que se está probando.</span><span class="sxs-lookup"><span data-stu-id="0dbc2-215">Organizing test classes by folder based on class being tested.</span></span>

<span data-ttu-id="0dbc2-216">Por supuesto, si una clase de aplicación determinada tiene muchos métodos que se está probados (y, por tanto, muchas clases de prueba), que tiene sentido para colocarlos en una carpeta correspondiente a la clase de aplicación.</span><span class="sxs-lookup"><span data-stu-id="0dbc2-216">Of course, if a particular application class has many methods being tested (and thus many test classes), it may make sense to place these in a folder corresponding to the application class.</span></span> <span data-ttu-id="0dbc2-217">Esta organización es similar a cómo puede organizar los archivos en carpetas en otra parte.</span><span class="sxs-lookup"><span data-stu-id="0dbc2-217">This organization is no different than how you might organize files into folders elsewhere.</span></span> <span data-ttu-id="0dbc2-218">Si tiene más de tres o cuatro archivos en una carpeta que contiene muchos otros archivos relacionados, a menudo resulta útil moverlas a su propia subcarpeta.</span><span class="sxs-lookup"><span data-stu-id="0dbc2-218">If you have more than three or four related files in a folder containing many other files, it's often helpful to move them into their own subfolder.</span></span>

## <a name="unit-testing-aspnet-core-apps"></a><span data-ttu-id="0dbc2-219">Probar aplicaciones de ASP.NET Core la unidad</span><span class="sxs-lookup"><span data-stu-id="0dbc2-219">Unit Testing ASP.NET Core Apps</span></span>

<span data-ttu-id="0dbc2-220">En una aplicación de ASP.NET Core bien diseñada, la mayor parte de la complejidad y la lógica de negocios se encapsulará en entidades de negocio y una variedad de servicios.</span><span class="sxs-lookup"><span data-stu-id="0dbc2-220">In a well-designed ASP.NET Core application, most of the complexity and business logic will be encapsulated in business entities and a variety of services.</span></span> <span data-ttu-id="0dbc2-221">La propia aplicación de MVC de ASP.NET Core con sus controladores, filtros, viewmodels y vistas, es necesario muy pocas pruebas unitarias.</span><span class="sxs-lookup"><span data-stu-id="0dbc2-221">The ASP.NET Core MVC app itself, with its controllers, filters, viewmodels, and views, should require very few unit tests.</span></span> <span data-ttu-id="0dbc2-222">Gran parte de la funcionalidad de una acción determinada se encuentra fuera del propio método de acción.</span><span class="sxs-lookup"><span data-stu-id="0dbc2-222">Much of the functionality of a given action lies outside the action method itself.</span></span> <span data-ttu-id="0dbc2-223">Comprobar si el enrutamiento funciona correctamente o el control de errores global, no puede realizarse de forma eficaz con una prueba unitaria.</span><span class="sxs-lookup"><span data-stu-id="0dbc2-223">Testing whether routing works correctly, or global error handling, cannot be done effectively with a unit test.</span></span> <span data-ttu-id="0dbc2-224">Del mismo modo, los filtros, incluida la autenticación y validación de modelo y los filtros de autorización, no se puede pasar la prueba unitaria.</span><span class="sxs-lookup"><span data-stu-id="0dbc2-224">Likewise, any filters, including model validation and authentication and authorization filters, cannot be unit tested.</span></span> <span data-ttu-id="0dbc2-225">Sin estos orígenes de comportamiento, la mayoría de los métodos de acción deben ser trivial pequeños, delegar la mayor parte de su trabajo a los servicios que puede probar de forma independiente del controlador que los usa.</span><span class="sxs-lookup"><span data-stu-id="0dbc2-225">Without these sources of behavior, most action methods should be trivially small, delegating the bulk of their work to services that can be tested independent of the controller that uses them.</span></span>

<span data-ttu-id="0dbc2-226">A veces debe refactorizar el código en el pedido a la prueba unitaria.</span><span class="sxs-lookup"><span data-stu-id="0dbc2-226">Sometimes you'll need to refactor your code in order to unit test it.</span></span> <span data-ttu-id="0dbc2-227">Con frecuencia, esto implica identificar abstracciones y mediante la inserción de dependencia para tener acceso a la abstracción en el código que desea probar, en lugar de codificar directamente en la infraestructura.</span><span class="sxs-lookup"><span data-stu-id="0dbc2-227">Frequently this involves identifying abstractions and using dependency injection to access the abstraction in the code you'd like to test, rather than coding directly against infrastructure.</span></span> <span data-ttu-id="0dbc2-228">Por ejemplo, considere la posibilidad de este método de acción simple para mostrar imágenes:</span><span class="sxs-lookup"><span data-stu-id="0dbc2-228">For example, consider this simple action method for displaying images:</span></span>

```cs
[HttpGet("[controller]/pic/{id}")]
public IActionResult GetImage(int id)
{
    var contentRoot = _env.ContentRootPath + "//Pics";
    var path = Path.Combine(contentRoot, id + ".png");
    Byte[] b = System.IO.File.ReadAllBytes(path);
    return File(b, "image/png");
}
```

<span data-ttu-id="0dbc2-229">Este método de prueba unitaria se hace difícil su dependencia directa en System.IO.File, que utiliza para leer desde el sistema de archivos.</span><span class="sxs-lookup"><span data-stu-id="0dbc2-229">Unit testing this method is made difficult by its direct dependency on System.IO.File, which it uses to read from the file system.</span></span> <span data-ttu-id="0dbc2-230">Puede probar este comportamiento para asegurarse de que funciona como esperaba, pero si lo hace, con los archivos reales es una prueba de integración.</span><span class="sxs-lookup"><span data-stu-id="0dbc2-230">You can test this behavior to ensure it works as expected, but doing so with real files is an integration test.</span></span> <span data-ttu-id="0dbc2-231">Cabe mencionar no puede probar la ruta de este método: verá cómo hacerlo con una prueba funcional en breve.</span><span class="sxs-lookup"><span data-stu-id="0dbc2-231">It's worth noting you can't test this method's route – you'll see how to do this with a functional test shortly.</span></span>

<span data-ttu-id="0dbc2-232">¿Si no prueba unitaria el comportamiento del sistema de archivos directamente y no se puede probar la ruta, lo está probar?</span><span class="sxs-lookup"><span data-stu-id="0dbc2-232">If you can't unit test the file system behavior directly, and you can't test the route, what is there to test?</span></span> <span data-ttu-id="0dbc2-233">Bueno, después de refactorización para que sea posible pruebas unitarias, puede detectar varios casos de prueba y un comportamiento que faltan, como control de errores.</span><span class="sxs-lookup"><span data-stu-id="0dbc2-233">Well, after refactoring to make unit testing possible, you may discover some test cases and missing behavior, such as error handling.</span></span> <span data-ttu-id="0dbc2-234">¿Qué hace el método cuando no se encuentra un archivo?</span><span class="sxs-lookup"><span data-stu-id="0dbc2-234">What does the method do when a file isn't found?</span></span> <span data-ttu-id="0dbc2-235">¿Qué debe hacer?</span><span class="sxs-lookup"><span data-stu-id="0dbc2-235">What should it do?</span></span> <span data-ttu-id="0dbc2-236">En este ejemplo, el método refactorizado tiene el siguiente aspecto:</span><span class="sxs-lookup"><span data-stu-id="0dbc2-236">In this example, the refactored method looks like this:</span></span>

```cs
[HttpGet("[controller]/pic/{id}")\]
public IActionResult GetImage(int id)
{
    byte[] imageBytes;
    try
    {
        imageBytes = _imageService.GetImageBytesById(id);
    }
    catch (CatalogImageMissingException ex)
    {
        _logger.LogWarning($"No image found for id: {id}");
        return NotFound();
    }
    return File(imageBytes, "image/png");
}
```

<span data-ttu-id="0dbc2-237">El \_registrador y \_imageService se insertan como dependencias.</span><span class="sxs-lookup"><span data-stu-id="0dbc2-237">The \_logger and \_imageService are both injected as dependencies.</span></span> <span data-ttu-id="0dbc2-238">Ahora puede probar que el mismo identificador que se pasa al método de acción se pasa a la \_imageService, y que los bytes resultantes se devuelven como parte de la FileResult.</span><span class="sxs-lookup"><span data-stu-id="0dbc2-238">Now you can test that the same id that is passed to the action method is passed to the \_imageService, and that the resulting bytes are returned as part of the FileResult.</span></span> <span data-ttu-id="0dbc2-239">También puede probar que se está realizando el registro de errores como se esperaba y que se devuelve un resultado de NotFound si la imagen no se encuentra, suponiendo que se trata de comportamiento de la aplicación importante (es decir, no solo código temporal al desarrollador agregado para diagnosticar un problema).</span><span class="sxs-lookup"><span data-stu-id="0dbc2-239">You can also test that error logging is happening as expected, and that a NotFound result is returned if the image is missing, assuming this is important application behavior (that is, not just temporary code the developer added to diagnose an issue).</span></span> <span data-ttu-id="0dbc2-240">La lógica real del archivo se ha trasladado a un servicio de implementación independiente y se ha ampliado para devolver una excepción específica de la aplicación en el caso de un archivo que falta.</span><span class="sxs-lookup"><span data-stu-id="0dbc2-240">The actual file logic has moved into a separate implementation service, and has been augmented to return an application-specific exception for the case of a missing file.</span></span> <span data-ttu-id="0dbc2-241">Puede probar esta implementación de forma independiente, con una prueba de integración.</span><span class="sxs-lookup"><span data-stu-id="0dbc2-241">You can test this implementation independently, using an integration test.</span></span>

## <a name="integration-testing-aspnet-core-apps"></a><span data-ttu-id="0dbc2-242">Probar la integración aplicaciones de ASP.NET Core</span><span class="sxs-lookup"><span data-stu-id="0dbc2-242">Integration Testing ASP.NET Core Apps</span></span>

```cs
    }
        catch (FileNotFoundException ex)
        {
            throw new CatalogImageMissingException(ex);
        }
    }
}
```

<span data-ttu-id="0dbc2-243">Este servicio usa IHostingEnvironment, al igual que el CatalogController código hacía antes de se ha refactorizado en un servicio independiente.</span><span class="sxs-lookup"><span data-stu-id="0dbc2-243">This service uses the IHostingEnvironment, just as the CatalogController code did before it was refactored into a separate service.</span></span> <span data-ttu-id="0dbc2-244">Ya que el único código en el controlador que usa IHostingEnvironment, esa dependencia se quitó del constructor del CatalogController.</span><span class="sxs-lookup"><span data-stu-id="0dbc2-244">Since this was the only code in the controller that used IHostingEnvironment, that dependency was removed from CatalogController's constructor.</span></span>

<span data-ttu-id="0dbc2-245">Para comprobar que este servicio funciona correctamente, debe crear un archivo de imagen de prueba conocida y compruebe que el servicio devuelve que tiene una entrada específica.</span><span class="sxs-lookup"><span data-stu-id="0dbc2-245">To test that this service works correctly, you need to create a known test image file and verify that the service returns it given a specific input.</span></span> <span data-ttu-id="0dbc2-246">También debe tener cuidado para que no utilice objetos ficticios en el comportamiento que desea probar (en este caso, leer desde el sistema de archivos).</span><span class="sxs-lookup"><span data-stu-id="0dbc2-246">You should take care not to use mock objects on the behavior you actually want to test (in this case, reading from the file system).</span></span> <span data-ttu-id="0dbc2-247">Sin embargo, objetos ficticios pueden resultarle útiles para configurar las pruebas de integración.</span><span class="sxs-lookup"><span data-stu-id="0dbc2-247">However, mock objects may still be useful to set up integration tests.</span></span> <span data-ttu-id="0dbc2-248">En este caso, puede simular IHostingEnvironment para que su ContentRootPath apunta a la carpeta que se va a utilizar para la imagen de prueba.</span><span class="sxs-lookup"><span data-stu-id="0dbc2-248">In this case, you can mock IHostingEnvironment so that its ContentRootPath points to the folder you're going to use for your test image.</span></span> <span data-ttu-id="0dbc2-249">La clase de prueba de integración de trabajo completo se muestra aquí:</span><span class="sxs-lookup"><span data-stu-id="0dbc2-249">The complete working integration test class is shown here:</span></span>

```cs
public class LocalFileImageServiceGetImageBytesById
{
    private byte[] _testBytes = new byte[] { 0x01, 0x02, 0x03 };
    private readonly Mock<IHostingEnvironment> _mockEnvironment = new Mock<IHostingEnvironment>();
    private int _testImageId = 123;
    private string _testFileName = "123.png";
    public LocalFileImageServiceGetImageBytesById()
    {
        // create folder if necessary
        Directory.CreateDirectory(Path.Combine(GetFileDirectory(), "Pics"));
        string filePath = GetFilePath(_testFileName);
        System.IO.File.WriteAllBytes(filePath, _testBytes);
        _mockEnvironment.SetupGet<string>(m => m.ContentRootPath).Returns(GetFileDirectory());
    }
    private string GetFilePath(string fileName)
    {
        return Path.Combine(GetFileDirectory(), "Pics", fileName);
        }
            private string GetFileDirectory()
        {
            var location = System.Reflection.Assembly.GetEntryAssembly().Location;
            return Path.GetDirectoryName(location);
        }

        [Fact]
        public void ReturnsFileContentResultGivenValidId()
        {
            var fileService = new LocalFileImageService(_mockEnvironment.Object);
            var result = fileService.GetImageBytesById(_testImageId);
            Assert.Equal(_testBytes, result);
        }
    }
```

> [!NOTE]
> <span data-ttu-id="0dbc2-250">que la propia prueba es muy sencilla: la mayor parte del código es necesaria para crear la infraestructura de prueba (en este caso, un archivo real que se leen del disco) y configurar el sistema.</span><span class="sxs-lookup"><span data-stu-id="0dbc2-250">that the test itself is very simple – the bulk of the code is necessary to configure the system and create the testing infrastructure (in this case, an actual file to be read from disk).</span></span> <span data-ttu-id="0dbc2-251">Esto es normal para las pruebas de integración, que a menudo requieren un trabajo el programa de instalación más complejo que las pruebas unitarias.</span><span class="sxs-lookup"><span data-stu-id="0dbc2-251">This is typical for integration tests, which often require more complex setup work than unit tests.</span></span>

## <a name="functional-testing-aspnet-core-apps"></a><span data-ttu-id="0dbc2-252">Aplicaciones de ASP.NET Core pruebas funcionales</span><span class="sxs-lookup"><span data-stu-id="0dbc2-252">Functional Testing ASP.NET Core Apps</span></span>

<span data-ttu-id="0dbc2-253">Para las aplicaciones de ASP.NET Core, la clase TestServer realiza pruebas funcionales bastante fáciles de crear.</span><span class="sxs-lookup"><span data-stu-id="0dbc2-253">For ASP.NET Core applications, the TestServer class makes functional tests fairly easy to write.</span></span> <span data-ttu-id="0dbc2-254">Configurar un TestServer mediante un WebHostBuilder, tal como se hace normalmente para la aplicación.</span><span class="sxs-lookup"><span data-stu-id="0dbc2-254">You configure a TestServer using a WebHostBuilder, just as you normally do for your application.</span></span> <span data-ttu-id="0dbc2-255">Este WebHostBuilder debe configurarse como host de la aplicación real, pero puede modificar los aspectos del mismo que simplificar las pruebas.</span><span class="sxs-lookup"><span data-stu-id="0dbc2-255">This WebHostBuilder should be configured just like your application's real host, but you can modify any aspects of it that make testing easier.</span></span> <span data-ttu-id="0dbc2-256">La mayoría de los casos, se podrá volver a usar el mismo TestServer para muchos de los casos de prueba, por lo que puede encapsular en un método reutilizable (por ejemplo, en una clase base):</span><span class="sxs-lookup"><span data-stu-id="0dbc2-256">Most of the time, you'll reuse the same TestServer for many test cases, so you can encapsulate it in a reusable method (perhaps in a base class):</span></span>

```cs
public abstract class BaseWebTest
{
    protected readonly HttpClient _client;
    protected string _contentRoot;

    public BaseWebTest()
    {
        _client = GetClient();
    }
    
    protected HttpClient GetClient()
    {
        var startupAssembly = typeof(Startup).GetTypeInfo().Assembly;
        _contentRoot = GetProjectPath("src", startupAssembly);
        var builder = new WebHostBuilder()
        .UseContentRoot(_contentRoot)
        .UseStartup&lt;Startup&gt;();
        var server = new TestServer(builder);
        var client = server.CreateClient();
        return client;
    }
}
```

<span data-ttu-id="0dbc2-257">GetProjectPath (método) simplemente devuelve la ruta de acceso física al proyecto web (solución de ejemplo de descarga).</span><span class="sxs-lookup"><span data-stu-id="0dbc2-257">The GetProjectPath method simply returns the physical path to the web project (download sample solution).</span></span> <span data-ttu-id="0dbc2-258">El WebHostBuilder en este caso simplemente especifica donde es la raíz del contenido de la aplicación web y hace referencia a la misma clase de inicio que usa la aplicación web real.</span><span class="sxs-lookup"><span data-stu-id="0dbc2-258">The WebHostBuilder in this case simply specifies where the content root for the web application is, and references the same Startup class the real web application uses.</span></span> <span data-ttu-id="0dbc2-259">Para trabajar con la TestServer, se utilice el tipo de System.Net.HttpClient estándar para realizar solicitudes a él.</span><span class="sxs-lookup"><span data-stu-id="0dbc2-259">To work with the TestServer, you use the standard System.Net.HttpClient type to make requests to it.</span></span> <span data-ttu-id="0dbc2-260">TestServer expone un método CreateClient útil que proporciona a un cliente preconfigurado que está listo para realizar solicitudes a la aplicación se ejecuta en el TestServer.</span><span class="sxs-lookup"><span data-stu-id="0dbc2-260">TestServer exposes a helpful CreateClient method that provides a pre-configured client that is ready to make requests to the application running on the TestServer.</span></span> <span data-ttu-id="0dbc2-261">Utilice este cliente (establecido en el modo protegido \_miembro de cliente en la base de prueba anterior) al escribir las pruebas funcionales de la aplicación de ASP.NET Core:</span><span class="sxs-lookup"><span data-stu-id="0dbc2-261">You use this client (set to the protected \_client member on the base test above) when writing functional tests for your ASP.NET Core application:</span></span>

```cs
public class CatalogControllerGetImage : BaseWebTest
{
    [Fact]
    public async Task ReturnsFileContentResultGivenValidId()
    {
        var testFilePath = Path.Combine(_contentRoot, "pics//1.png");
        var expectedFileBytes = File.ReadAllBytes(testFilePath);
        var response = await _client.GetAsync("/catalog/pic/1");
        response.EnsureSuccessStatusCode();
        var streamResponse = await response.Content.ReadAsStreamAsync();
        byte[] byteResult;
        using (var ms = new MemoryStream())
        {
            streamResponse.CopyTo(ms);
            byteResult = ms.ToArray();
        }
        Assert.Equal(expectedFileBytes, byteResult);
    }
}
```

<span data-ttu-id="0dbc2-262">Esta prueba funcional ejercita la pila completa de la aplicación de MVC de ASP.NET Core, incluidos todos los middleware, filtros, enlazadores, etc., que pueden estar en su lugar.</span><span class="sxs-lookup"><span data-stu-id="0dbc2-262">This functional test exercises the full ASP.NET Core MVC application stack, including all middleware, filters, binders, etc. that may be in place.</span></span> <span data-ttu-id="0dbc2-263">Comprueba que un dada ruta ("/ catálogo/pic/1") devuelve la matriz de bytes esperado para un archivo en una ubicación conocida.</span><span class="sxs-lookup"><span data-stu-id="0dbc2-263">It verifies that a given route ("/catalog/pic/1") returns the expected byte array for a file in a known location.</span></span> <span data-ttu-id="0dbc2-264">Sin configurar un servidor web reales y así evita gran parte de la fragilidad que servidor para realizar pruebas puede experimentar (por ejemplo, problemas con la configuración de firewall) usando una web real.</span><span class="sxs-lookup"><span data-stu-id="0dbc2-264">It does so without setting up a real web server, and so avoids much of the brittleness that using a real web server for testing can experience (for example, problems with firewall settings).</span></span> <span data-ttu-id="0dbc2-265">Pruebas funcionales que se ejecutan en TestServer son normalmente más lentas que la integración y pruebas unitarias, pero son mucho más rápidas que las pruebas que ejecutan a través de la red para un servidor de prueba web.</span><span class="sxs-lookup"><span data-stu-id="0dbc2-265">Functional tests that run against TestServer are usually slower than integration and unit tests, but are much faster than tests that would run over the network to a test web server.</span></span>

>[!div class="step-by-step"]
<span data-ttu-id="0dbc2-266">[Previous] (work-with-data-in-asp-net-core-apps.md) [Next] (development-process-for-azure.md)</span><span class="sxs-lookup"><span data-stu-id="0dbc2-266">[Previous] (work-with-data-in-asp-net-core-apps.md) [Next] (development-process-for-azure.md)</span></span>
