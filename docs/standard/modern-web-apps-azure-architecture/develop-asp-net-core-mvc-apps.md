---
title: Desarrollo de aplicaciones MVC de ASP.NET Core
description: "Diseñar aplicaciones Web modernas con ASP.NET Core y Azure | desarrollar aplicaciones de MVC de ASP.NET Core"
author: ardalis
ms.author: wiwagn
ms.date: 10/07/2017
ms.prod: .net-core
ms.technology: dotnet-docker
ms.workload:
- dotnet
- dotnetcore
ms.openlocfilehash: c10bf66dd37f0d99c038db7f95999d84986152fa
ms.sourcegitcommit: e7f04439d78909229506b56935a1105a4149ff3d
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 12/23/2017
---
# <a name="develop-aspnet-core-mvc-apps"></a><span data-ttu-id="642c9-103">Desarrollar aplicaciones MVC de ASP.NET Core</span><span class="sxs-lookup"><span data-stu-id="642c9-103">Develop ASP.NET Core MVC Apps</span></span>

> <span data-ttu-id="642c9-104">"No es importante hacerlo bien la primera vez.</span><span class="sxs-lookup"><span data-stu-id="642c9-104">"It's not important to get it right the first time.</span></span> <span data-ttu-id="642c9-105">Es sumamente importante hacerlo bien la última vez."</span><span class="sxs-lookup"><span data-stu-id="642c9-105">It's vitally important to get it right the last time."</span></span>  
> <span data-ttu-id="642c9-106">_-Captura de Andrew y David Thomas_</span><span class="sxs-lookup"><span data-stu-id="642c9-106">_- Andrew Hunt and David Thomas_</span></span>

## <a name="summary"></a><span data-ttu-id="642c9-107">Resumen</span><span class="sxs-lookup"><span data-stu-id="642c9-107">Summary</span></span>

<span data-ttu-id="642c9-108">ASP.NET Core es un marco multiplataforma de código abierto para la creación de aplicaciones web modernas optimizada para la nube.</span><span class="sxs-lookup"><span data-stu-id="642c9-108">ASP.NET Core is a cross-platform, open-source framework for building modern cloud-optimized web applications.</span></span> <span data-ttu-id="642c9-109">Aplicaciones de ASP.NET Core son sencillos y modular, con la compatibilidad integrada para la inyección de dependencia, habilitación de mayor capacidad de prueba y el mantenimiento.</span><span class="sxs-lookup"><span data-stu-id="642c9-109">ASP.NET Core apps are lightweight and modular, with built-in support for dependency injection, enabling in greater testability and maintainability.</span></span> <span data-ttu-id="642c9-110">Combinar con MVC, que admite la creación de las API de web moderna además de las aplicaciones basadas en vistas, ASP.NET Core es un marco eficaz con el que se va a generar aplicaciones web empresariales.</span><span class="sxs-lookup"><span data-stu-id="642c9-110">Combined with MVC, which supports building modern web APIs in addition to view-based apps, ASP.NET Core is a powerful framework with which to build enterprise web applications.</span></span>

## <a name="mapping-requests-to-responses"></a><span data-ttu-id="642c9-111">Solicitudes de asignación a las respuestas</span><span class="sxs-lookup"><span data-stu-id="642c9-111">Mapping Requests to Responses</span></span>

<span data-ttu-id="642c9-112">En esencia, las aplicaciones ASP.NET Core asignan las solicitudes entrantes a las respuestas salientes.</span><span class="sxs-lookup"><span data-stu-id="642c9-112">At its heart, ASP.NET Core apps map incoming requests to outgoing responses.</span></span> <span data-ttu-id="642c9-113">En un nivel bajo, esto se realiza con middleware y sencilla aplicaciones de ASP.NET Core y microservicios pueden constar únicamente de middleware personalizado.</span><span class="sxs-lookup"><span data-stu-id="642c9-113">At a low level, this is done with middleware, and simple ASP.NET Core apps and microservices may be comprised solely of custom middleware.</span></span> <span data-ttu-id="642c9-114">Cuando se usa el núcleo de ASP.NET MVC, puede trabajar en un mayor nivel, pensar en términos de *rutas*, *controladores*, y *acciones*.</span><span class="sxs-lookup"><span data-stu-id="642c9-114">When using ASP.NET Core MVC, you can work at a somewhat higher level, thinking in terms of *routes*, *controllers*, and *actions*.</span></span> <span data-ttu-id="642c9-115">Cada solicitud entrante se compara con la tabla de enrutamiento de la aplicación y, si se encuentra una ruta coincidente, se llama al método de acción asociada (pertenecientes a un controlador) para controlar la solicitud.</span><span class="sxs-lookup"><span data-stu-id="642c9-115">Each incoming request is compared with the application's routing table, and if a matching route is found, the associated action method (belonging to a controller) is called to handle the request.</span></span> <span data-ttu-id="642c9-116">Si no se encuentra ninguna ruta que coincida, se llama a un controlador de errores (en este caso, devolver un resultado NotFound).</span><span class="sxs-lookup"><span data-stu-id="642c9-116">If no matching route is found, an error handler (in this case, returning a NotFound result) is called.</span></span>

<span data-ttu-id="642c9-117">Pueden utilizar aplicaciones MVC de ASP.NET Core rutas convencionales, las rutas de atributo o ambos.</span><span class="sxs-lookup"><span data-stu-id="642c9-117">ASP.NET Core MVC apps can use conventional routes, attribute routes, or both.</span></span> <span data-ttu-id="642c9-118">Rutas convencionales se definen en el código, especificación de enrutamiento *convenciones* con una sintaxis similar en el ejemplo siguiente:</span><span class="sxs-lookup"><span data-stu-id="642c9-118">Conventional routes are defined in code, specifying routing *conventions* using syntax like in the example below:</span></span>

```csharp
app.UseMvc(routes =>;
{
    routes.MapRoute("default","{controller=Home}/{action=Index}/{id?}");
});
```

<span data-ttu-id="642c9-119">En este ejemplo, una ruta con el nombre "default" se agregó a la tabla de enrutamiento.</span><span class="sxs-lookup"><span data-stu-id="642c9-119">In this example, a route named "default" has been added to the routing table.</span></span> <span data-ttu-id="642c9-120">Define una plantilla de ruta con marcadores de posición para *controlador*, *acción*, y *identificador*. Los marcadores de posición de acción y controlador tienen el valor predeterminado especificado ("Hogar" y "Index", respectivamente), y el marcador de posición del identificador es opcional (en virtud de un "?" aplicado).</span><span class="sxs-lookup"><span data-stu-id="642c9-120">It defines a route template with placeholders for *controller*, *action*, and *id*. The controller and action placeholders have default specified ("Home" and "Index", respectively), and the id placeholder is optional (by virtue of a "?" applied to it).</span></span> <span data-ttu-id="642c9-121">La convención definidos aquí Estados que debe corresponder a la primera parte de una solicitud para el nombre del controlador, la segunda parte a la acción y, a continuación, si es necesario un tercer elemento representa un parámetro de identificador.</span><span class="sxs-lookup"><span data-stu-id="642c9-121">The convention defined here states that the first part of a request should correspond to the name of the controller, the second part to the action, and then if necessary a third part will represent an id parameter.</span></span> <span data-ttu-id="642c9-122">Rutas convencionales normalmente se definen en un solo lugar para la aplicación, como en el método de configuración de la clase de inicio.</span><span class="sxs-lookup"><span data-stu-id="642c9-122">Conventional routes are typically defined in one place for the application, such as in the Configure method in the Startup class.</span></span>

<span data-ttu-id="642c9-123">Rutas de atributo se aplica directamente a los controladores y acciones, en lugar de especificar globalmente.</span><span class="sxs-lookup"><span data-stu-id="642c9-123">Attribute routes are applied to controllers and actions directly, rather than specified globally.</span></span> <span data-ttu-id="642c9-124">Esto tiene la ventaja de que mucho más sencillo detectar si está pensando en un método concreto, pero significa que la información de enrutamiento no se guarda en una posición en la aplicación.</span><span class="sxs-lookup"><span data-stu-id="642c9-124">This has the advantage of making them much more discoverable when you're looking at a particular method, but does mean that routing information is not kept in one place in the application.</span></span> <span data-ttu-id="642c9-125">Con las rutas de atributo, se puede fácilmente especificar varias rutas para una acción determinada, así como combinar rutas entre controladores y acciones.</span><span class="sxs-lookup"><span data-stu-id="642c9-125">With attribute routes, you can easily specify multiple routes for a given action, as well as combine routes between controllers and actions.</span></span> <span data-ttu-id="642c9-126">Por ejemplo:</span><span class="sxs-lookup"><span data-stu-id="642c9-126">For example:</span></span>

```csharp
[Route("Home")]
public class HomeController : Controller
{
    [Route("")] // Combines to define the route template "Home"
    [Route("Index")] // Combines to define route template "Home/Index"
    [Route("/")] // Does not combine, defines the route template ""
    public IActionResult Index() {}
```

<span data-ttu-id="642c9-127">Se pueden especificar las rutas en [HttpGet] y separan los atributos similares, evitando la necesidad de agregar [ruta\] atributos.</span><span class="sxs-lookup"><span data-stu-id="642c9-127">Routes can be specified on [HttpGet] and similar attributes, avoiding the need to add separate [Route\] attributes.</span></span> <span data-ttu-id="642c9-128">Rutas de atributo también pueden usar tokens para reducir la necesidad de repetir los nombres de acción o controlador, tal y como se muestra a continuación:</span><span class="sxs-lookup"><span data-stu-id="642c9-128">Attribute routes can also use tokens to reduce the need to repeat controller or action names, as shown below:</span></span>

```csharp
[Route("[controller\]")]
public class ProductsController : Controller
{
    [Route("")] // Matches 'Products'
    [Route("Index")] // Matches 'Products/Index'
    public IActionResult Index()
}
```

<span data-ttu-id="642c9-129">Una vez que una determinada solicitud se ha asociado a una ruta, pero antes de la acción se denomina método, llevará a cabo MVC de ASP.NET Core [enlace de modelo](https://docs.microsoft.com/aspnet/core/mvc/models/model-binding) y [validación de modelos](https://docs.microsoft.com/aspnet/core/mvc/models/validation) en la solicitud.</span><span class="sxs-lookup"><span data-stu-id="642c9-129">Once a given request has been matched to a route, but before the action method is called, ASP.NET Core MVC will perform [model binding](https://docs.microsoft.com/aspnet/core/mvc/models/model-binding) and [model validation](https://docs.microsoft.com/aspnet/core/mvc/models/validation) on the request.</span></span> <span data-ttu-id="642c9-130">Enlace de modelos es responsable de convertir los datos entrantes de HTTP en los tipos de .NET especificados como parámetros del método de acción que se llame a.</span><span class="sxs-lookup"><span data-stu-id="642c9-130">Model binding is responsible for converting incoming HTTP data into the .NET types specified as parameters of the action method to be called.</span></span> <span data-ttu-id="642c9-131">Por ejemplo, si el método de acción espera un parámetro de identificador de tipo int, el enlace de modelos intentará proporciona este parámetro de un valor que se proporciona como parte de la solicitud.</span><span class="sxs-lookup"><span data-stu-id="642c9-131">For example, if the action method expects an int id parameter, model binding will attempt to provide this parameter from a value provided as part of the request.</span></span> <span data-ttu-id="642c9-132">Para ello, el enlace de modelos busca valores en un formulario expuesto, los valores en la misma ruta y los valores de cadena de consulta.</span><span class="sxs-lookup"><span data-stu-id="642c9-132">To do so, model binding looks for values in a posted form, values in the route itself, and query string values.</span></span> <span data-ttu-id="642c9-133">Suponiendo que se encuentra un valor de identificador, se convertirá en un entero antes de que se pasa en el método de acción.</span><span class="sxs-lookup"><span data-stu-id="642c9-133">Assuming an id value is found, it will be converted to an integer before being passed into the action method.</span></span>

<span data-ttu-id="642c9-134">Después de enlazar el modelo, pero antes de llamar al método de acción, se produce la validación del modelo.</span><span class="sxs-lookup"><span data-stu-id="642c9-134">After binding the model but before calling the action method, model validation occurs.</span></span> <span data-ttu-id="642c9-135">Validación del modelo usa atributos opcionales en el tipo de modelo y puede ayudar a garantizar que el objeto de modelo proporcionado cumple determinados requisitos de datos.</span><span class="sxs-lookup"><span data-stu-id="642c9-135">Model validation uses optional attributes on the model type, and can help ensure that the provided model object conforms to certain data requirements.</span></span> <span data-ttu-id="642c9-136">Ciertos valores se pueden especificar como necesario, o que estén limitadas a una longitud o un intervalo numérico determinados, etcetera. Si se especifican los atributos de validación, pero el modelo no cumple sus requisitos, la propiedad ModelState.IsValid será false y el conjunto de reglas de validación con errores estará disponible para enviar al cliente que realiza la solicitud.</span><span class="sxs-lookup"><span data-stu-id="642c9-136">Certain values may be specified as required, or limited to a certain length or numeric range, etc. If validation attributes are specified but the model does not conform to their requirements, the property ModelState.IsValid will be false, and the set of failing validation rules will be available to send to the client making the request.</span></span>

<span data-ttu-id="642c9-137">Si usas la validación del modelo, debe ser siempre comprueba que el modelo es válido antes de realizar los comandos de modificación de estado, para asegurarse de que la aplicación no está dañada por datos no válidos.</span><span class="sxs-lookup"><span data-stu-id="642c9-137">If you are using model validation, you should be sure to always check that the model is valid before performing any state-altering commands, to ensure your app is not corrupted by invalid data.</span></span> <span data-ttu-id="642c9-138">Puede usar un [filtro](https://docs.microsoft.com/aspnet/core/mvc/controllers/filters) para evitar la necesidad de agregar código para esto en cada acción.</span><span class="sxs-lookup"><span data-stu-id="642c9-138">You can use a [filter](https://docs.microsoft.com/aspnet/core/mvc/controllers/filters) to avoid the need to add code for this in every action.</span></span> <span data-ttu-id="642c9-139">Filtros MVC de ASP.NET Core proporcionan una manera de interceptar los grupos de solicitudes, para que se pueden aplicar directivas comunes y preocupaciones transversales según un destino.</span><span class="sxs-lookup"><span data-stu-id="642c9-139">ASP.NET Core MVC filters offer a way of intercepting groups of requests, so that common policies and cross-cutting concerns can be applied on a targeted basis.</span></span> <span data-ttu-id="642c9-140">Los filtros pueden aplicarse a las acciones individuales, controladores de todo o de forma global para una aplicación.</span><span class="sxs-lookup"><span data-stu-id="642c9-140">Filters can be applied to individual actions, whole controllers, or globally for an application.</span></span>

<span data-ttu-id="642c9-141">Para las API web, ASP.NET Core MVC admite [ *negociación de contenido*](https://docs.microsoft.com/aspnet/core/mvc/models/formatting), lo que permite las solicitudes especificar cómo se deben aplicar el formato de las respuestas.</span><span class="sxs-lookup"><span data-stu-id="642c9-141">For web APIs, ASP.NET Core MVC supports [*content negotiation*](https://docs.microsoft.com/aspnet/core/mvc/models/formatting), allowing requests to specify how responses should be formatted.</span></span> <span data-ttu-id="642c9-142">En función de los encabezados proporcionados en la solicitud, acciones devolver datos dará formato a la respuesta en XML, JSON o en otro formato compatible.</span><span class="sxs-lookup"><span data-stu-id="642c9-142">Based on headers provided in the request, actions returning data will format the response in XML, JSON, or another supported format.</span></span> <span data-ttu-id="642c9-143">Esta característica permite a la misma API ser usada por varios clientes con requisitos de formato de datos diferentes.</span><span class="sxs-lookup"><span data-stu-id="642c9-143">This feature enables the same API to be used by multiple clients with different data format requirements.</span></span>

> ### <a name="references--mapping-requests-to-responses"></a><span data-ttu-id="642c9-144">Referencias: asignar solicitudes a respuestas</span><span class="sxs-lookup"><span data-stu-id="642c9-144">References – Mapping Requests to Responses</span></span>
> - <span data-ttu-id="642c9-145">**El enrutamiento a las acciones de controlador**
> <https://docs.microsoft.com/aspnet/core/mvc/controllers/routing></span><span class="sxs-lookup"><span data-stu-id="642c9-145">**Routing to Controller Actions**
<https://docs.microsoft.com/aspnet/core/mvc/controllers/routing></span></span>
> - <span data-ttu-id="642c9-146">**Model Binding** https://docs.microsoft.com/aspnet/core/mvc/models/model-binding</span><span class="sxs-lookup"><span data-stu-id="642c9-146">**Model Binding** https://docs.microsoft.com/aspnet/core/mvc/models/model-binding</span></span>
> - <span data-ttu-id="642c9-147">**Model Validation**
> <https://docs.microsoft.com/aspnet/core/mvc/models/validation></span><span class="sxs-lookup"><span data-stu-id="642c9-147">**Model Validation**
<https://docs.microsoft.com/aspnet/core/mvc/models/validation></span></span>
> - <span data-ttu-id="642c9-148">**Filters** https://docs.microsoft.com/aspnet/core/mvc/controllers/filters</span><span class="sxs-lookup"><span data-stu-id="642c9-148">**Filters** https://docs.microsoft.com/aspnet/core/mvc/controllers/filters</span></span>

## <a name="working-with-dependencies"></a><span data-ttu-id="642c9-149">Trabajar con dependencias</span><span class="sxs-lookup"><span data-stu-id="642c9-149">Working with Dependencies</span></span>

<span data-ttu-id="642c9-150">ASP.NET Core tiene compatibilidad integrada para e internamente hace uso de una técnica conocida como [inyección de dependencia](https://docs.microsoft.com/aspnet/core/fundamentals/dependency-injection).</span><span class="sxs-lookup"><span data-stu-id="642c9-150">ASP.NET Core has built-in support for and internally makes use of a technique known as [dependency injection](https://docs.microsoft.com/aspnet/core/fundamentals/dependency-injection).</span></span> <span data-ttu-id="642c9-151">Inserción de dependencias es una técnica que habilita el acoplamiento flexible entre las distintas partes de una aplicación.</span><span class="sxs-lookup"><span data-stu-id="642c9-151">Dependency injection is a technique that enabled loose coupling between different parts of an application.</span></span> <span data-ttu-id="642c9-152">Un acoplamiento más flexible es deseable, porque es más fácil aislar las partes de la aplicación, lo que permite probar o reemplazo.</span><span class="sxs-lookup"><span data-stu-id="642c9-152">Looser coupling is desirable because it makes it easier to isolate parts of the application, allowing for testing or replacement.</span></span> <span data-ttu-id="642c9-153">También resulta menos probable que un cambio en una parte de la aplicación tendrá un impacto inesperado en otro lugar de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="642c9-153">It also makes it less likely that a change in one part of the application will have an unexpected impact somewhere else in the application.</span></span> <span data-ttu-id="642c9-154">Inyección de dependencia se basa en el principio de la inversión de dependencia y, a menudo es clave para lograr el principio abierto o cerrado.</span><span class="sxs-lookup"><span data-stu-id="642c9-154">Dependency injection is based on the dependency inversion principle, and is often key to achieving the open/closed principle.</span></span> <span data-ttu-id="642c9-155">Al evaluar el funcionamiento de la aplicación con sus dependencias, tenga cuidado de no la [estáticos adhesivos para sus](http://deviq.com/static-cling/) código olor y recordar la aforismo "[es una novedad adherencia](http://ardalis.com/new-is-glue)."</span><span class="sxs-lookup"><span data-stu-id="642c9-155">When evaluating how your application works with its dependencies, beware of the [static cling](http://deviq.com/static-cling/) code smell, and remember the aphorism "[new is glue](http://ardalis.com/new-is-glue)."</span></span>

<span data-ttu-id="642c9-156">Estáticos adhesivos para sus se produce cuando las clases de realizan llamadas a métodos estáticos o tener acceso a propiedades estáticas, que tiene efectos secundarios o dependencias en la infraestructura.</span><span class="sxs-lookup"><span data-stu-id="642c9-156">Static cling occurs when your classes make calls to static methods, or access static properties, which have side effects or dependencies on infrastructure.</span></span> <span data-ttu-id="642c9-157">Por ejemplo, si tiene un método que llama a un método estático, que a su vez se escribe en una base de datos, el método está asociado estrechamente con la base de datos.</span><span class="sxs-lookup"><span data-stu-id="642c9-157">For example, if you have a method that calls a static method, which in turn writes to a database, your method is tightly coupled to the database.</span></span> <span data-ttu-id="642c9-158">Todo lo que interrumpe esa llamada de la base de datos interrumpirá el método.</span><span class="sxs-lookup"><span data-stu-id="642c9-158">Anything that breaks that database call will break your method.</span></span> <span data-ttu-id="642c9-159">Estos métodos de prueba es muy difícil, ya que dichas pruebas exigir comerciales bibliotecas simulación para simular las llamadas estáticas o solo se pueden probar con una base de datos de prueba en su lugar.</span><span class="sxs-lookup"><span data-stu-id="642c9-159">Testing such methods is notoriously difficult, since such tests either require commercial mocking libraries to mock the static calls, or can only be tested with a test database in place.</span></span> <span data-ttu-id="642c9-160">Llamadas estáticas que no tienen ninguna dependencia de infraestructura, sobre todo aquellas que son completamente independientes, son válidas llamar y no tienen ningún impacto en el acoplamiento o capacidad de prueba (más allá de acoplamiento código a la propia llamada estática).</span><span class="sxs-lookup"><span data-stu-id="642c9-160">Static calls that don't have any dependence on infrastructure, especially those that are completely stateless, are fine to call and have no impact on coupling or testability (beyond coupling code to the static call itself).</span></span>

<span data-ttu-id="642c9-161">Muchos desarrolladores comprender los riesgos de estáticos adhesivos para sus y estado global, pero se sigue estrechamente su código para implementaciones específicas a través de la creación directa de instancias.</span><span class="sxs-lookup"><span data-stu-id="642c9-161">Many developers understand the risks of static cling and global state, but will still tightly couple their code to specific implementations through direct instantiation.</span></span> <span data-ttu-id="642c9-162">"Nueva es adherencia" está pensado para ser un aviso de este acoplamiento y no un condemnation general del uso de la palabra clave new.</span><span class="sxs-lookup"><span data-stu-id="642c9-162">"New is glue" is meant to be a reminder of this coupling, and not a general condemnation of the use of the new keyword.</span></span> <span data-ttu-id="642c9-163">Al igual que con las llamadas de método estático, nuevas instancias de tipos que normalmente no tienen ninguna dependencia externa no estrechamente acoplar código a detalles de implementación o dificultar la prueba.</span><span class="sxs-lookup"><span data-stu-id="642c9-163">Just as with static method calls, new instances of types that have no external dependencies typically do not tightly couple code to implementation details or make testing more difficult.</span></span> <span data-ttu-id="642c9-164">Pero cada vez que se crea una instancia de una clase, tomar solo un breve momento a tener en cuenta si tiene sentido codificar esa instancia específica en esa ubicación concreta, o si sería un mejor diseño para solicitar dicha instancia como una dependencia.</span><span class="sxs-lookup"><span data-stu-id="642c9-164">But each time a class is instantiated, take just a brief moment to consider whether it makes sense to hard-code that specific instance in that particular location, or if it would be a better design to request that instance as a dependency.</span></span>

### <a name="declare-your-dependencies"></a><span data-ttu-id="642c9-165">Declarar las dependencias</span><span class="sxs-lookup"><span data-stu-id="642c9-165">Declare Your Dependencies</span></span>

<span data-ttu-id="642c9-166">Núcleo de ASP.NET se basa en tener métodos y clases declaran sus dependencias, cómo solicitarlos como argumentos.</span><span class="sxs-lookup"><span data-stu-id="642c9-166">ASP.NET Core is built around having methods and classes declare their dependencies, requesting them as arguments.</span></span> <span data-ttu-id="642c9-167">Las aplicaciones de ASP.NET normalmente se configuran en una clase de inicio, que a su vez está configurado para admitir la inserción de dependencias en varios puntos.</span><span class="sxs-lookup"><span data-stu-id="642c9-167">ASP.NET applications are typically set up in a Startup class, which itself is configured to support dependency injection at several points.</span></span> <span data-ttu-id="642c9-168">Si la clase de inicio tiene un constructor, pueden solicitar las dependencias a través del constructor, de este modo:</span><span class="sxs-lookup"><span data-stu-id="642c9-168">If your Startup class has a constructor, it can request dependencies through the constructor, like so:</span></span>

```csharp
public class Startup
{
    public Startup(IHostingEnvironment env)
    {
        var builder = new ConfigurationBuilder()
        .SetBasePath(env.ContentRootPath)
        .AddJsonFile("appsettings.json", optional: false, reloadOnChange: true)
        .AddJsonFile(\$"appsettings.{env.EnvironmentName}.json", optional: true);
    }
}
```

<span data-ttu-id="642c9-169">La clase de inicio es interesante de que no hay ningún requisito de tipo explícito para él.</span><span class="sxs-lookup"><span data-stu-id="642c9-169">The Startup class is interesting in that there are no explicit type requirements for it.</span></span> <span data-ttu-id="642c9-170">No hereda de una clase base de inicio especial ni lo implemente cualquier interfaz determinada.</span><span class="sxs-lookup"><span data-stu-id="642c9-170">It doesn't inherit from a special Startup base class, nor does it implement any particular interface.</span></span> <span data-ttu-id="642c9-171">Puede darle un constructor, o no, y puede especificar tantos parámetros en el constructor como desee.</span><span class="sxs-lookup"><span data-stu-id="642c9-171">You can give it a constructor, or not, and you can specify as many parameters on the constructor as you want.</span></span> <span data-ttu-id="642c9-172">Cuando el host de web que ha configurado para la aplicación se inicia, llamará a la clase de inicio que se ha indicado que usar y usará la inserción de dependencias para rellenar las dependencias que requiere la clase de inicio.</span><span class="sxs-lookup"><span data-stu-id="642c9-172">When the web host you've configured for your application starts, it will call the Startup class you've told it to use, and will use dependency injection to populate any dependencies the Startup class requires.</span></span> <span data-ttu-id="642c9-173">Por supuesto, si se solicitan los parámetros que no están configurados en el contenedor de servicios utilizado por ASP.NET Core, obtendrá una excepción, pero siempre que se respete las dependencias del contenedor conoce, puede solicitar que desee.</span><span class="sxs-lookup"><span data-stu-id="642c9-173">Of course, if you request parameters that aren't configured in the services container used by ASP.NET Core, you'll get an exception, but as long as you stick to dependencies the container knows about, you can request anything you want.</span></span>

<span data-ttu-id="642c9-174">Inyección de dependencia se integra en las aplicaciones de ASP.NET Core desde el principio, cuando se crea la instancia de inicio.</span><span class="sxs-lookup"><span data-stu-id="642c9-174">Dependency injection is built into your ASP.NET Core apps right from the start, when you create the Startup instance.</span></span> <span data-ttu-id="642c9-175">No detenga no existe para la clase de inicio.</span><span class="sxs-lookup"><span data-stu-id="642c9-175">It doesn't stop there for the Startup class.</span></span> <span data-ttu-id="642c9-176">También puede solicitar las dependencias en el método Configure:</span><span class="sxs-lookup"><span data-stu-id="642c9-176">You can also request dependencies in the Configure method:</span></span>

```csharp
public void Configure(IApplicationBuilder app,
    IHostingEnvironment env,
    ILoggerFactory loggerFactory)
{

}
```

<span data-ttu-id="642c9-177">El método ConfigureServices es la excepción a este comportamiento; debe tomar un solo parámetro de tipo IServiceCollection.</span><span class="sxs-lookup"><span data-stu-id="642c9-177">The ConfigureServices method is the exception to this behavior; it must take just one parameter of type IServiceCollection.</span></span> <span data-ttu-id="642c9-178">Admite la inyección de dependencia, ya que por un lado es responsable de agregar objetos al contenedor de servicios, y en el otro tiene acceso a todos los servicios actualmente configurados a través del parámetro IServiceCollection realmente no es necesario.</span><span class="sxs-lookup"><span data-stu-id="642c9-178">It doesn't really need to support dependency injection, since on the one hand it is responsible for adding objects to the services container, and on the other it has access to all currently configured services via the IServiceCollection parameter.</span></span> <span data-ttu-id="642c9-179">Por lo tanto, puede trabajar con dependencias definidas en la colección de servicios de ASP.NET Core en todas las partes de la clase de inicio, ya sea solicitando el servicio como un parámetro necesario o cuando se trabaja con el IServiceCollection en ConfigureServices.</span><span class="sxs-lookup"><span data-stu-id="642c9-179">Thus, you can work with dependencies defined in the ASP.NET Core services collection in every part of the Startup class, either by requesting the needed service as a parameter or by working with the IServiceCollection in ConfigureServices.</span></span>

> [!NOTE]
> <span data-ttu-id="642c9-180">Si necesita asegurarse determinados servicios estén disponibles para la clase de inicio, puede configurarlos mediante WebHostBuilder y el método ConfigureServices.</span><span class="sxs-lookup"><span data-stu-id="642c9-180">If you need to ensure certain services are available to your Startup class, you can configure them using WebHostBuilder and its ConfigureServices method.</span></span>

<span data-ttu-id="642c9-181">La clase de inicio es un modelo de cómo estructurar otras partes de la aplicación ASP.NET Core, controladores de middleware de filtros para sus propios servicios.</span><span class="sxs-lookup"><span data-stu-id="642c9-181">The Startup class is a model for how you should structure other parts of your ASP.NET Core application, from Controllers to Middleware to Filters to your own Services.</span></span> <span data-ttu-id="642c9-182">En cada caso, debe seguir la [principio de dependencias explícitas](http://deviq.com/explicit-dependencies-principle/), solicitar las dependencias en lugar de directamente cómo crearlos y aprovechamiento de inserción de dependencias en toda la aplicación.</span><span class="sxs-lookup"><span data-stu-id="642c9-182">In each case, you should follow the [Explicit Dependencies Principle](http://deviq.com/explicit-dependencies-principle/), requesting your dependencies rather than directly creating them, and leveraging dependency injection throughout your application.</span></span> <span data-ttu-id="642c9-183">Tenga cuidado de dónde y cómo se directamente crear instancias de implementaciones, especialmente los servicios y los objetos que funcionan con la infraestructura o tengan efectos secundarios.</span><span class="sxs-lookup"><span data-stu-id="642c9-183">Be careful of where and how you directly instantiate implementations, especially services and objects that work with infrastructure or have side effects.</span></span> <span data-ttu-id="642c9-184">Prefiere trabajar con abstracciones definidas en el núcleo de la aplicación y se pasa como argumentos al codificar referencias a tipos de implementación específica.</span><span class="sxs-lookup"><span data-stu-id="642c9-184">Prefer working with abstractions defined in your application core and passed in as arguments to hardcoding references to specific implementation types.</span></span>

## <a name="structuring-the-application"></a><span data-ttu-id="642c9-185">Estructurar la aplicación</span><span class="sxs-lookup"><span data-stu-id="642c9-185">Structuring the Application</span></span>

<span data-ttu-id="642c9-186">Aplicaciones monolíticas suelen tengan un único punto de entrada.</span><span class="sxs-lookup"><span data-stu-id="642c9-186">Monolithic applications typically have a single entry point.</span></span> <span data-ttu-id="642c9-187">En el caso de una aplicación web de ASP.NET Core, el punto de entrada será el proyecto web de ASP.NET Core.</span><span class="sxs-lookup"><span data-stu-id="642c9-187">In the case of an ASP.NET Core web application, the entry point will be the ASP.NET Core web project.</span></span> <span data-ttu-id="642c9-188">Sin embargo, eso no significa que la solución debe constar de simplemente un solo proyecto.</span><span class="sxs-lookup"><span data-stu-id="642c9-188">However, that doesn't mean the solution should consist of just a single project.</span></span> <span data-ttu-id="642c9-189">Resulta útil dividir la aplicación en diferentes capas para seguir la separación de intereses.</span><span class="sxs-lookup"><span data-stu-id="642c9-189">It's useful to break up the application into different layers in order to follow separation of concerns.</span></span> <span data-ttu-id="642c9-190">Una vez que se divide en capas, resulta útil ir más allá de las carpetas para separar los proyectos, que pueden ayudarle a conseguir una mejor encapsulación.</span><span class="sxs-lookup"><span data-stu-id="642c9-190">Once broken up into layers, it's helpful to go beyond folders to separate projects, which can help achieve better encapsulation.</span></span> <span data-ttu-id="642c9-191">El mejor método para lograr estos objetivos con una aplicación de ASP.NET Core es una variación de la arquitectura de limpieza se describe en el capítulo 5.</span><span class="sxs-lookup"><span data-stu-id="642c9-191">The best approach to achieve these goals with an ASP.NET Core application is a variation of the Clean Architecture discussed in chapter 5.</span></span> <span data-ttu-id="642c9-192">Después de este enfoque, solución de la aplicación estará compuesta por bibliotecas independientes para la interfaz de usuario, la infraestructura y ApplicationCore.</span><span class="sxs-lookup"><span data-stu-id="642c9-192">Following this approach, the application's solution will be comprised of separate libraries for the UI, Infrastructure, and ApplicationCore.</span></span>

<span data-ttu-id="642c9-193">Además de estos proyectos, proyectos de prueba independiente también se incluyen (pruebas se describen en el capítulo 9).</span><span class="sxs-lookup"><span data-stu-id="642c9-193">In addition to these projects, separate test projects are included as well (Testing is discussed in Chapter 9).</span></span>

<span data-ttu-id="642c9-194">Modelo de objetos e interfaces de la aplicación deben colocarse en el proyecto ApplicationCore.</span><span class="sxs-lookup"><span data-stu-id="642c9-194">The application's object model and interfaces should be placed in the ApplicationCore project.</span></span> <span data-ttu-id="642c9-195">Este proyecto tendrá el menor número de dependencias como sea posible, y los otros proyectos de la solución hará referencia a él.</span><span class="sxs-lookup"><span data-stu-id="642c9-195">This project will have as few dependencies as possible, and the other projects in the solution will reference it.</span></span> <span data-ttu-id="642c9-196">Las entidades empresariales que deban conservarse se definen en el proyecto ApplicationCore, como son servicios que no dependen directamente de infraestructura.</span><span class="sxs-lookup"><span data-stu-id="642c9-196">Business entities that need to be persisted are defined in the ApplicationCore project, as are services that do not directly depend on infrastructure.</span></span>

<span data-ttu-id="642c9-197">Detalles de implementación, por ejemplo, cómo se realiza la persistencia o cómo se pueden enviar notificaciones a un usuario, se mantienen en el proyecto de infraestructura.</span><span class="sxs-lookup"><span data-stu-id="642c9-197">Implementation details, such as how persistence is performed or how notifications might be sent to a user, are kept in the Infrastructure project.</span></span> <span data-ttu-id="642c9-198">Este proyecto hará referencia a paquetes específico de la implementación como Entity Framework Core, pero no debe exponer los detalles acerca de estas implementaciones fuera del proyecto.</span><span class="sxs-lookup"><span data-stu-id="642c9-198">This project will reference implementation-specific packages such as Entity Framework Core, but should not expose details about these implementations outside of the project.</span></span> <span data-ttu-id="642c9-199">Servicios de infraestructura y los repositorios deben implementar las interfaces que se definen en el proyecto ApplicationCore, y sus implementaciones de persistencia están responsables de recuperar y almacenar las entidades definidas en ApplicationCore.</span><span class="sxs-lookup"><span data-stu-id="642c9-199">Infrastructure services and repositories should implement interfaces that are defined in the ApplicationCore project, and its persistence implementations are responsible for retrieving and storing entities defined in ApplicationCore.</span></span>

<span data-ttu-id="642c9-200">El propio proyecto de ASP.NET Core es responsable de cualquier problema de nivel de interfaz de usuario, pero no debe incluir los detalles de infraestructura o de lógica empresarial.</span><span class="sxs-lookup"><span data-stu-id="642c9-200">The ASP.NET Core project itself is responsible for any UI level concerns, but should not include business logic or infrastructure details.</span></span> <span data-ttu-id="642c9-201">De hecho, idealmente no debería incluso tienen una dependencia en el proyecto de infraestructura, que le ayudará a garantizar que ninguna dependencia entre los dos proyectos se introdujo por accidente.</span><span class="sxs-lookup"><span data-stu-id="642c9-201">In fact, ideally it shouldn't even have a dependency on the Infrastructure project, which will help ensure no dependency between the two projects is introduced accidentally.</span></span> <span data-ttu-id="642c9-202">Esto puede lograrse mediante un contenedor de DI de terceros como StructureMap, que le permite definir reglas de DI en clases de registro en cada proyecto.</span><span class="sxs-lookup"><span data-stu-id="642c9-202">This can be achieved using a third-party DI container like StructureMap, which allows you to define DI rules in Registry classes in each project.</span></span>

<span data-ttu-id="642c9-203">Otro enfoque para desacoplar la aplicación de detalles de implementación es que el microservicios de llamada de aplicación, que quizás se implementan en los contenedores de Docker individuales.</span><span class="sxs-lookup"><span data-stu-id="642c9-203">Another approach to decoupling the application from implementation details is to have the application call microservices, perhaps deployed in individual Docker containers.</span></span> <span data-ttu-id="642c9-204">Esto proporciona incluso mayor separación de problemas y el desacoplamiento que aprovechan DI entre dos proyectos, pero tiene una complejidad adicional.</span><span class="sxs-lookup"><span data-stu-id="642c9-204">This provides even greater separation of concerns and decoupling than leveraging DI between two projects, but has additional complexity.</span></span>

### <a name="feature-organization"></a><span data-ttu-id="642c9-205">Organización de característica</span><span class="sxs-lookup"><span data-stu-id="642c9-205">Feature Organization</span></span>

<span data-ttu-id="642c9-206">De forma predeterminada, las aplicaciones de ASP.NET Core organizan su estructura de carpetas para que incluya controladores y vistas y con frecuencia ViewModels.</span><span class="sxs-lookup"><span data-stu-id="642c9-206">By default, ASP.NET Core applications organize their folder structure to include Controllers and Views, and frequently ViewModels.</span></span> <span data-ttu-id="642c9-207">Código de cliente para admitir estas estructuras de servidor normalmente se almacena por separado en la carpeta wwwroot.</span><span class="sxs-lookup"><span data-stu-id="642c9-207">Client-side code to support these server-side structures is typically stored separately in the wwwroot folder.</span></span> <span data-ttu-id="642c9-208">Sin embargo, las aplicaciones grandes pueden surgir problemas con esta organización, puesto que funciona en cualquier característica determinada a menudo requiere saltar entre estas carpetas.</span><span class="sxs-lookup"><span data-stu-id="642c9-208">However, large applications may encounter problems with this organization, since working on any given feature often requires jumping between these folders.</span></span> <span data-ttu-id="642c9-209">De esta forma obtiene cada vez más difícil a medida que aumenta el número de archivos y subcarpetas en cada carpeta, lo que da lugar a una gran cantidad de desplazarse a través del explorador de soluciones.</span><span class="sxs-lookup"><span data-stu-id="642c9-209">This gets more and more difficult as the number of files and subfolders in each folder grows, resulting in a great deal of scrolling through Solution Explorer.</span></span> <span data-ttu-id="642c9-210">Una solución a este problema consiste en organizar el código de aplicación por *característica* en lugar de por tipo de archivo.</span><span class="sxs-lookup"><span data-stu-id="642c9-210">One solution to this problem is to organize application code by *feature* instead of by file type.</span></span> <span data-ttu-id="642c9-211">Este estilo profesional se conoce normalmente como carpetas de características o intervalos de característica (Vea también: [segmentos verticales](http://deviq.com/vertical-slices/)).</span><span class="sxs-lookup"><span data-stu-id="642c9-211">This organizational style is typically referred to as feature folders or feature slices (see also: [Vertical Slices](http://deviq.com/vertical-slices/)).</span></span>

<span data-ttu-id="642c9-212">Núcleo de ASP.NET MVC admite áreas para este propósito.</span><span class="sxs-lookup"><span data-stu-id="642c9-212">ASP.NET Core MVC supports Areas for this purpose.</span></span> <span data-ttu-id="642c9-213">Uso de áreas, puede crear un conjunto independiente de controladores y vistas carpetas (así como los modelos asociados) en cada carpeta de área.</span><span class="sxs-lookup"><span data-stu-id="642c9-213">Using areas, you can create separate sets of Controllers and Views folders (as well as any associated models) in each Area folder.</span></span> <span data-ttu-id="642c9-214">Figura 7-1 muestra una estructura de carpetas de ejemplo, el uso de áreas.</span><span class="sxs-lookup"><span data-stu-id="642c9-214">Figure 7-1 shows an example folder structure, using Areas.</span></span>

![](./media/image7-1.png)

<span data-ttu-id="642c9-215">Organización de área de ejemplo de la figura 7-1</span><span class="sxs-lookup"><span data-stu-id="642c9-215">Figure 7-1 Sample Area Organization</span></span>

<span data-ttu-id="642c9-216">Al utilizar áreas, debe utilizar atributos para decorar los controladores con el nombre del área a la que pertenecen:</span><span class="sxs-lookup"><span data-stu-id="642c9-216">When using Areas, you must use attributes to decorate your controllers with the name of the area to which they belong:</span></span>

```csharp
[Area("Catalog")]
public class HomeController
{}
```

<span data-ttu-id="642c9-217">También debe agregar compatibilidad de área para sus rutas:</span><span class="sxs-lookup"><span data-stu-id="642c9-217">You also need to add area support to your routes:</span></span>

```csharp
app.UseMvc(routes =>
{
    // Areas support
    routes.MapRoute(
    name: "areaRoute",
    template: "{area:exists}/{controller=Home}/{action=Index}/{id?}");
    routes.MapRoute(
    name: "default",
    template: "{controller=Home}/{action=Index}/{id?}");
});
```

<span data-ttu-id="642c9-218">Además de la compatibilidad integrada para las áreas, también puede utilizar su propia estructura de carpetas y convenciones en lugar de atributos y las rutas personalizadas.</span><span class="sxs-lookup"><span data-stu-id="642c9-218">In addition to the built-in support for Areas, you can also use your own folder structure, and conventions in place of attributes and custom routes.</span></span> <span data-ttu-id="642c9-219">Esto le permitiría tener carpetas de características que no incluyen carpetas independientes para las vistas, controladores, etc., manteniendo la jerarquía más plana y facilitando la tarea ver que todos los archivos en un único lugar para cada característica relacionados.</span><span class="sxs-lookup"><span data-stu-id="642c9-219">This would allow you to have feature folders that didn't include separate folders for Views, Controllers, etc., keeping the hierarchy flatter and making it easier to see all related files in a single place for each feature.</span></span>

<span data-ttu-id="642c9-220">ASP.NET Core usa tipos integrados convención para controlar su comportamiento.</span><span class="sxs-lookup"><span data-stu-id="642c9-220">ASP.NET Core uses built-in convention types to control its behavior.</span></span> <span data-ttu-id="642c9-221">Puede modificar o reemplazar estas convenciones.</span><span class="sxs-lookup"><span data-stu-id="642c9-221">You can modify or replace these conventions.</span></span> <span data-ttu-id="642c9-222">Por ejemplo, puede crear una convención que obtendrá automáticamente el nombre de característica para un controlador determinado en función de su espacio de nombres (que normalmente se correlaciona con la carpeta en la que se encuentra el controlador):</span><span class="sxs-lookup"><span data-stu-id="642c9-222">For example, you can create a convention that will automatically get the feature name for a given controller based on its namespace (which typically correlates to the folder in which the controller is located):</span></span>

```csharp
FeatureConvention : IControllerModelConvention
{
    public void Apply(ControllerModel controller)
    {
        controller.Properties.Add("feature",
        GetFeatureName(controller.ControllerType));
    }

    private string GetFeatureName(TypeInfo controllerType)
    {
        string[] tokens = controllerType.FullName.Split('.');
        if (!tokens.Any(t => t == "Features")) return "";
        string featureName = tokens
        .SkipWhile(t => !t.Equals("features",
        StringComparison.CurrentCultureIgnoreCase))
        .Skip(1)
        .Take(1)
        .FirstOrDefault();
        return featureName;
    }
}
```

<span data-ttu-id="642c9-223">A continuación, especifique esta convención como una opción al agregar compatibilidad para MVC a la aplicación en ConfigureServices:</span><span class="sxs-lookup"><span data-stu-id="642c9-223">You then specify this convention as an option when you add support for MVC to your application in ConfigureServices:</span></span>

```csharp
services.AddMvc(o => o.Conventions.Add(new FeatureConvention()));
```

<span data-ttu-id="642c9-224">Núcleo de ASP.NET MVC también usa una convención localizar vistas.</span><span class="sxs-lookup"><span data-stu-id="642c9-224">ASP.NET Core MVC also uses a convention to locate views.</span></span> <span data-ttu-id="642c9-225">Puede reemplazarlo con una convención personalizada para que las vistas se ubicará en las carpetas de característica (mediante el nombre de la característica proporcionado por el FeatureConvention, anteriormente).</span><span class="sxs-lookup"><span data-stu-id="642c9-225">You can override it with a custom convention so that views will be located in your feature folders (using the feature name provided by the FeatureConvention, above).</span></span> <span data-ttu-id="642c9-226">Puede obtener más información sobre este enfoque y descargar un ejemplo funcional desde el artículo de MSDN, [segmentos de la característica de MVC de ASP.NET Core](https://msdn.microsoft.com/magazine/mt763233.aspx).</span><span class="sxs-lookup"><span data-stu-id="642c9-226">You can learn more about this approach and download a working sample from the MSDN article, [Feature Slices for ASP.NET Core MVC](https://msdn.microsoft.com/magazine/mt763233.aspx).</span></span>

### <a name="cross-cutting-concerns"></a><span data-ttu-id="642c9-227">Cuestiones transversales</span><span class="sxs-lookup"><span data-stu-id="642c9-227">Cross-Cutting Concerns</span></span>

<span data-ttu-id="642c9-228">Medida que desarrolle aplicaciones, resulta cada vez más importante separe preocupaciones transversales para eliminar la duplicación y mantener su coherencia.</span><span class="sxs-lookup"><span data-stu-id="642c9-228">As applications grow, it becomes increasingly important to factor out cross-cutting concerns to eliminate duplication and maintain consistency.</span></span> <span data-ttu-id="642c9-229">Algunos ejemplos de preocupaciones transversales en aplicaciones de ASP.NET Core son autenticación, las reglas de validación del modelo, el almacenamiento en caché de salida y control de errores, aunque hay muchas otras.</span><span class="sxs-lookup"><span data-stu-id="642c9-229">Some examples of cross-cutting concerns in ASP.NET Core applications are authentication, model validation rules, output caching, and error handling, though there are many others.</span></span> <span data-ttu-id="642c9-230">Núcleo de ASP.NET MVC [filtros](https://docs.microsoft.com/aspnet/core/mvc/controllers/filters) permite ejecutar código antes o después de algunos pasos de la canalización de procesamiento de la solicitud.</span><span class="sxs-lookup"><span data-stu-id="642c9-230">ASP.NET Core MVC [filters](https://docs.microsoft.com/aspnet/core/mvc/controllers/filters) allow you to run code before or after certain steps in the request processing pipeline.</span></span> <span data-ttu-id="642c9-231">Por ejemplo, un filtro puede ejecutarse antes y después enlace del modelo, antes y después de una acción, o antes y después de resultado de la acción.</span><span class="sxs-lookup"><span data-stu-id="642c9-231">For instance, a filter can run before and after model binding, before and after an action, or before and after an action's result.</span></span> <span data-ttu-id="642c9-232">También puede utilizar un filtro de autorización para controlar el acceso al resto de la canalización.</span><span class="sxs-lookup"><span data-stu-id="642c9-232">You can also use an authorization filter to control access to the rest of the pipeline.</span></span> <span data-ttu-id="642c9-233">Las figuras 7-2 se muestra cómo solicitar flujos de ejecución a través de filtros, si ha configurado.</span><span class="sxs-lookup"><span data-stu-id="642c9-233">Figures 7-2 shows how request execution flows through filters, if configured.</span></span>

![La solicitud se procesa a través de las fases Filtros de autorización, Filtros de recursos, Enlace de modelos, Filtros de acciones, Ejecución de acciones/Conversión del resultado de acción, Filtros de excepción, Filtros de resultados y Ejecución del resultado.](./media/image7-2.png)

<span data-ttu-id="642c9-236">Ejecución de la solicitud de la figura 7-2 a través de los filtros y la canalización de solicitud.</span><span class="sxs-lookup"><span data-stu-id="642c9-236">Figure 7-2 Request execution through filters and request pipeline.</span></span>

<span data-ttu-id="642c9-237">Normalmente, los filtros se implementan como atributos, para que pueda aplicar controladores o acciones.</span><span class="sxs-lookup"><span data-stu-id="642c9-237">Filters are usually implemented as attributes, so you can apply them controllers or actions.</span></span> <span data-ttu-id="642c9-238">Cuando se agrega de esta forma, los filtros especificados en la invalidación de nivel de acción o se basan en filtros especificados en el nivel de controlador, que a su vez invalidar filtros globales.</span><span class="sxs-lookup"><span data-stu-id="642c9-238">When added in this fashion, filters specified at the action level override or build upon filters specified at the controller level, which themselves override global filters.</span></span> <span data-ttu-id="642c9-239">Por ejemplo, el \[ruta\] atributo se puede usar para crear rutas entre controladores y acciones.</span><span class="sxs-lookup"><span data-stu-id="642c9-239">For example, the \[Route\] attribute can be used to build up routes between controllers and actions.</span></span> <span data-ttu-id="642c9-240">Del mismo modo, autorización se puede configurar en el nivel de controlador y, a continuación, se reemplaza por acciones individuales, como se muestra en el ejemplo siguiente:</span><span class="sxs-lookup"><span data-stu-id="642c9-240">Likewise, authorization can be configured at the controller level, and then overridden by individual actions, as the following sample demonstrates:</span></span>

```csharp
[Authorize]
public class AccountController : Controller

{
    [AllowAnonymous]
    public async Task<IActionResult> Login() {}
    public async Task<IActionResult> ForgotPassword() {}
}
```

<span data-ttu-id="642c9-241">El primer método, inicio de sesión, utiliza el filtro de AllowAnonymous (atributo) para invalidar el filtro de autorización establecido en el nivel de controlador.</span><span class="sxs-lookup"><span data-stu-id="642c9-241">The first method, Login, uses the AllowAnonymous filter (attribute) to override the Authorize filter set at the controller level.</span></span> <span data-ttu-id="642c9-242">La acción de contraseña olvidada (y cualquier otra acción en la clase que no tiene un atributo AllowAnonymous) requerirá una solicitud autenticada.</span><span class="sxs-lookup"><span data-stu-id="642c9-242">The ForgotPassword action (and any other action in the class that doesn't have an AllowAnonymous attribute) will require an authenticated request.</span></span>

<span data-ttu-id="642c9-243">Filtros pueden usarse para eliminar la duplicación en forma de control directivas para las API de errores comunes.</span><span class="sxs-lookup"><span data-stu-id="642c9-243">Filters can be used to eliminate duplication in the form of common error handling policies for APIs.</span></span> <span data-ttu-id="642c9-244">Por ejemplo, una directiva de API típica es devolver una respuesta NotFound a las solicitudes que hacen referencia a las claves que no existen y una respuesta BadRequest si se produce un error de validación del modelo.</span><span class="sxs-lookup"><span data-stu-id="642c9-244">For example, a typical API policy is to return a NotFound response to requests referencing keys that do not exist, and a BadRequest response if model validation fails.</span></span> <span data-ttu-id="642c9-245">El ejemplo siguiente muestra estas dos directivas en acción:</span><span class="sxs-lookup"><span data-stu-id="642c9-245">The following example demonstrates these two policies in action:</span></span>

```csharp
[HttpPut("{id}")]
public async Task<IActionResult> Put(int id, [FromBody]Author author)
{
    if ((await _authorRepository.ListAsync()).All(a => a.Id != id))
    {
        return NotFound(id);
    }
    if (!ModelState.IsValid)
    {
        return BadRequest(ModelState);
    }
    author.Id = id;
    await _authorRepository.UpdateAsync(author);
    return Ok();
}
```

<span data-ttu-id="642c9-246">No se permiten los métodos de acción a llenarse con condicional código similar al siguiente.</span><span class="sxs-lookup"><span data-stu-id="642c9-246">Don't allow your action methods to become cluttered with conditional code like this.</span></span> <span data-ttu-id="642c9-247">En su lugar, extraer las directivas en los filtros que se pueden aplicar según sea necesario.</span><span class="sxs-lookup"><span data-stu-id="642c9-247">Instead, pull the policies into filters that can be applied on an as-needed basis.</span></span> <span data-ttu-id="642c9-248">En este ejemplo, la comprobación de validación del modelo, lo que puede ocurrir siempre que se envía un comando a la API, puede reemplazarse por el atributo siguiente:</span><span class="sxs-lookup"><span data-stu-id="642c9-248">In this example, the model validation check, which should occur any time a command is sent to the API, can be replaced by the following attribute:</span></span>

```csharp
public class ValidateModelAttribute : ActionFilterAttribute
{
    public override void OnActionExecuting(ActionExecutingContext context)
    {
        if (!context.ModelState.IsValid)
        {
            context.Result = new BadRequestObjectResult(context.ModelState);
        }
    }
}
```

<span data-ttu-id="642c9-249">Del mismo modo, puede utilizar un filtro para comprobar si un registro existe y devolver un error 404 antes de ejecuta la acción, lo que elimina la necesidad de realizar estas comprobaciones en la acción.</span><span class="sxs-lookup"><span data-stu-id="642c9-249">Likewise, a filter can be used to check if a record exists and return a 404 before the action is executed, eliminating the need to perform these checks in the action.</span></span> <span data-ttu-id="642c9-250">Una vez que ha extraído las convenciones comunes y organizan la solución para separar la lógica de negocio y código de infraestructura de la interfaz de usuario, los métodos de acción de MVC deben ser sumamente ligero:</span><span class="sxs-lookup"><span data-stu-id="642c9-250">Once you've pulled out common conventions and organized your solution to separate infrastructure code and business logic from your UI, your MVC action methods should be extremely thin:</span></span>

```csharp
// PUT api/authors/2/5
[HttpPut("{id}")]
[ValidateAuthorExists]
public async Task<IActionResult> Put(int id, [FromBody]Author author)
{
    await _authorRepository.UpdateAsync(author);
    return Ok();
}
```

<span data-ttu-id="642c9-251">Puede leer más sobre la implementación de filtros y descargar un ejemplo funcional desde el artículo de MSDN, [Real World ASP.NET Core MVC filtros](https://msdn.microsoft.com/magazine/mt767699.aspx).</span><span class="sxs-lookup"><span data-stu-id="642c9-251">You can read more about implementing filters and download a working sample from the MSDN article, [Real World ASP.NET Core MVC Filters](https://msdn.microsoft.com/magazine/mt767699.aspx).</span></span>

> ### <a name="references--structuring-applications"></a><span data-ttu-id="642c9-252">Referencias: estructura de aplicaciones</span><span class="sxs-lookup"><span data-stu-id="642c9-252">References – Structuring Applications</span></span>
> - <span data-ttu-id="642c9-253">**Áreas**</span><span class="sxs-lookup"><span data-stu-id="642c9-253">**Areas**</span></span>  
> <span data-ttu-id="642c9-254"><https://docs.microsoft.com/aspnet/core/mvc/controllers/areas></span><span class="sxs-lookup"><span data-stu-id="642c9-254"><https://docs.microsoft.com/aspnet/core/mvc/controllers/areas></span></span>
> - <span data-ttu-id="642c9-255">**MSDN: sectores de características principales de ASP.NET MVC**
>  <https://msdn.microsoft.com/magazine/mt763233.aspx></span><span class="sxs-lookup"><span data-stu-id="642c9-255">**MSDN – Feature Slices for ASP.NET Core MVC**
<https://msdn.microsoft.com/magazine/mt763233.aspx></span></span>
> - <span data-ttu-id="642c9-256">**Filtros**</span><span class="sxs-lookup"><span data-stu-id="642c9-256">**Filters**</span></span>  
> <span data-ttu-id="642c9-257"><https://docs.microsoft.com/aspnet/core/mvc/controllers/filters></span><span class="sxs-lookup"><span data-stu-id="642c9-257"><https://docs.microsoft.com/aspnet/core/mvc/controllers/filters></span></span>
> - <span data-ttu-id="642c9-258">**MSDN: filtros MVC de ASP.NET Core mundo Real**</span><span class="sxs-lookup"><span data-stu-id="642c9-258">**MSDN – Real World ASP.NET Core MVC Filters**</span></span>  
> <span data-ttu-id="642c9-259"><https://msdn.microsoft.com/magazine/mt767699.aspx></span><span class="sxs-lookup"><span data-stu-id="642c9-259"><https://msdn.microsoft.com/magazine/mt767699.aspx></span></span>

## <a name="security"></a><span data-ttu-id="642c9-260">Seguridad</span><span class="sxs-lookup"><span data-stu-id="642c9-260">Security</span></span>

<span data-ttu-id="642c9-261">Proteger aplicaciones web es un tema grande, con muchas consideraciones.</span><span class="sxs-lookup"><span data-stu-id="642c9-261">Securing web applications is a large topic, with many considerations.</span></span> <span data-ttu-id="642c9-262">En su nivel más básico, seguridad, hay que asegurarse de que saber quién es procedentes de una solicitud determinada y, a continuación, asegurarse de que dicha solicitud solo tiene acceso a los recursos que debería.</span><span class="sxs-lookup"><span data-stu-id="642c9-262">At its most basic level, security involves ensuring you know who a given request is coming from, and then ensuring that that request only has access to resources it should.</span></span> <span data-ttu-id="642c9-263">La autenticación es el proceso de comparación de las credenciales proporcionadas con una solicitud a los de un almacén de datos de confianza, para ver si la solicitud se debe tratar como procedente de una entidad conocida.</span><span class="sxs-lookup"><span data-stu-id="642c9-263">Authentication is the process of comparing credentials provided with a request to those in a trusted data store, to see if the request should be treated as coming from a known entity.</span></span> <span data-ttu-id="642c9-264">La autorización es el proceso de restringir el acceso a determinados recursos en función de la identidad del usuario.</span><span class="sxs-lookup"><span data-stu-id="642c9-264">Authorization is the process of restricting access to certain resources based on user identity.</span></span> <span data-ttu-id="642c9-265">Un problema de seguridad de terceros protege las solicitudes contra el espionaje por terceros, para el que debe al menos [Asegúrese de que la aplicación usa SSL](https://docs.microsoft.com/aspnet/core/security/enforcing-ssl).</span><span class="sxs-lookup"><span data-stu-id="642c9-265">A third security concern is protecting requests from eavesdropping by third parties, for which you should at least [ensure that SSL is used by your application](https://docs.microsoft.com/aspnet/core/security/enforcing-ssl).</span></span>

### <a name="authentication"></a><span data-ttu-id="642c9-266">Autenticación</span><span class="sxs-lookup"><span data-stu-id="642c9-266">Authentication</span></span>

<span data-ttu-id="642c9-267">Identidad de ASP.NET Core es un sistema de pertenencia que puede utilizar para admitir la funcionalidad de inicio de sesión para la aplicación.</span><span class="sxs-lookup"><span data-stu-id="642c9-267">ASP.NET Core Identity is a membership system you can use to support login functionality for your application.</span></span> <span data-ttu-id="642c9-268">Tiene compatibilidad con cuentas de usuario locales, así como compatibilidad con proveedores de inicio de sesión externo desde proveedores como Microsoft Account, Twitter, Facebook, Google y mucho más.</span><span class="sxs-lookup"><span data-stu-id="642c9-268">It has support for local user accounts as well as external login provider support from providers like Microsoft Account, Twitter, Facebook, Google, and more.</span></span> <span data-ttu-id="642c9-269">Además de ASP.NET Core Identity, la aplicación puede utilizar la autenticación de windows o un proveedor de identidades de terceros, como [Identity Server](https://github.com/IdentityServer/IdentityServer4).</span><span class="sxs-lookup"><span data-stu-id="642c9-269">In addition to ASP.NET Core Identity, your application can use windows authentication, or a third-party identity provider like [Identity Server](https://github.com/IdentityServer/IdentityServer4).</span></span>

<span data-ttu-id="642c9-270">Identidad de ASP.NET Core se incluye en las nuevas plantillas de proyecto si se selecciona la opción de cuentas de usuario individuales.</span><span class="sxs-lookup"><span data-stu-id="642c9-270">ASP.NET Core Identity is included in new project templates if the Individual User Accounts option is selected.</span></span> <span data-ttu-id="642c9-271">Esta plantilla incluye compatibilidad para el registro, inicio de sesión, los inicios de sesión externos, el olvido de contraseñas y una funcionalidad adicional.</span><span class="sxs-lookup"><span data-stu-id="642c9-271">This template includes support for registration, login, external logins, forgotten passwords, and additional functionality.</span></span>

![](./media/image7-3.png)

<span data-ttu-id="642c9-272">Figura 7-3 seleccionar cuentas de usuario individuales dispongan de identidad preconfigurado.</span><span class="sxs-lookup"><span data-stu-id="642c9-272">Figure 7-3 Select Individual User Accounts to have Identity preconfigured.</span></span>

<span data-ttu-id="642c9-273">Compatibilidad con identidad se configura en Inicio, tanto en ConfigureServices y configurar:</span><span class="sxs-lookup"><span data-stu-id="642c9-273">Identity support is configured in Startup, both in ConfigureServices and Configure:</span></span>

```csharp
public void ConfigureServices(IServiceCollection services)
{
    // Add framework services.
    services.AddDbContext<ApplicationDbContext>(options =>
    options.UseSqlServer(Configuration.GetConnectionString("DefaultConnection")));
    services.AddIdentity<ApplicationUser, IdentityRole>()
    .AddEntityFrameworkStores<ApplicationDbContext>()
    .AddDefaultTokenProviders();
    services.AddMvc();
}

public void Configure(IApplicationBuilder app)
{
    app.UseStaticFiles();
    app.UseIdentity();
    app.UseMvc(routes =>
    {
        routes.MapRoute(
        name: "default",
        template: "{controller=Home}/{action=Index}/{id?}");
    });
}
```

<span data-ttu-id="642c9-274">Es importante que UseIdentity aparecen antes de UseMvc en el método Configure.</span><span class="sxs-lookup"><span data-stu-id="642c9-274">It's important that UseIdentity appear before UseMvc in the Configure method.</span></span> <span data-ttu-id="642c9-275">Al configurar la identidad en ConfigureServices, observará una llamada a AddDefaultTokenProviders.</span><span class="sxs-lookup"><span data-stu-id="642c9-275">When configuring Identity in ConfigureServices, you'll notice a call to AddDefaultTokenProviders.</span></span> <span data-ttu-id="642c9-276">Esto no tiene nada que ver con tokens que pueden utilizarse para proteger las comunicaciones web, pero en su lugar, hace referencia a los proveedores que crean solicitudes que se pueden enviar a los usuarios a través de SMS o correo electrónico puedan confirmar su identidad.</span><span class="sxs-lookup"><span data-stu-id="642c9-276">This has nothing to do with tokens that may be used to secure web communications, but instead refers to providers that create prompts that can be sent to users via SMS or email in order for them to confirm their identity.</span></span>

<span data-ttu-id="642c9-277">Puede obtener más información acerca de [configuración de autenticación en dos fases](https://docs.microsoft.com/aspnet/core/security/authentication/2fa) y [habilitar proveedores de inicio de sesión externo](https://docs.microsoft.com/aspnet/core/security/authentication/social/) de los documentos de ASP.NET Core oficiales.</span><span class="sxs-lookup"><span data-stu-id="642c9-277">You can learn more about [configuring two-factor authentication](https://docs.microsoft.com/aspnet/core/security/authentication/2fa) and [enabling external login providers](https://docs.microsoft.com/aspnet/core/security/authentication/social/) from the official ASP.NET Core docs.</span></span>

### <a name="authorization"></a><span data-ttu-id="642c9-278">Autorización</span><span class="sxs-lookup"><span data-stu-id="642c9-278">Authorization</span></span>

<span data-ttu-id="642c9-279">La forma más sencilla de autorización implica restringir el acceso a los usuarios anónimos.</span><span class="sxs-lookup"><span data-stu-id="642c9-279">The simplest form of authorization involves restricting access to anonymous users.</span></span> <span data-ttu-id="642c9-280">Esto puede lograrse mediante la aplicación simplemente la \[Authorize\] atributo a ciertos controladores o acciones.</span><span class="sxs-lookup"><span data-stu-id="642c9-280">This can be achieved by simply applying the \[Authorize\] attribute to certain controllers or actions.</span></span> <span data-ttu-id="642c9-281">Si se usan funciones, se puede ampliar aún más el atributo para restringir el acceso a los usuarios que pertenecen a determinados roles, tal como se muestra:</span><span class="sxs-lookup"><span data-stu-id="642c9-281">If roles are being used, the attribute can be further extended to restrict access to users who belong to certain roles, as shown:</span></span>

```csharp
[Authorize(Roles = "HRManager,Finance")]
public class SalaryController : Controller
{

}
```

<span data-ttu-id="642c9-282">En este caso, los usuarios que pertenecen a los roles HRManager o finanzas (o ambos) pueda tener acceso a la SalaryController.</span><span class="sxs-lookup"><span data-stu-id="642c9-282">In this case, users belonging to either the HRManager or Finance roles (or both) would have access to the SalaryController.</span></span> <span data-ttu-id="642c9-283">Para requerir que un usuario pertenece a varios roles (no solo uno de varios), puede aplicar el atributo varias veces, especificar un rol necesario cada vez.</span><span class="sxs-lookup"><span data-stu-id="642c9-283">To require that a user belong to multiple roles (not just one of several), you can apply the attribute multiple times, specifying a required role each time.</span></span>

<span data-ttu-id="642c9-284">Especifican ciertos conjuntos de funciones como cadenas en muchas diferentes controladores y acciones pueden dar lugar a repetición no deseado.</span><span class="sxs-lookup"><span data-stu-id="642c9-284">Specifying certain sets of roles as strings in many different controllers and actions can lead to undesirable repetition.</span></span> <span data-ttu-id="642c9-285">Puede configurar directivas de autorización, que encapsula las reglas de autorización, y, a continuación, especificar la directiva en lugar de los roles individuales al aplicar el \[Authorize\] atributo:</span><span class="sxs-lookup"><span data-stu-id="642c9-285">You can configure authorization policies, which encapsulate authorization rules, and then specify the policy instead of individual roles when applying the \[Authorize\] attribute:</span></span>

```csharp
[Authorize(Policy = "CanViewPrivateReport")]
public IActionResult ExecutiveSalaryReport()
{
    return View();
}
```

<span data-ttu-id="642c9-286">Con las directivas de esta manera, puede separar los tipos de acciones que se está restringidos de las reglas que se aplican a él o roles específicos.</span><span class="sxs-lookup"><span data-stu-id="642c9-286">Using policies in this way, you can separate the kinds of actions being restricted from the specific roles or rules that apply to it.</span></span> <span data-ttu-id="642c9-287">Más adelante, si crea un nuevo rol que necesita tener acceso a determinados recursos, puede simplemente actualizar una directiva, en lugar de actualizar cada lista de roles en cada \[Authorize\] atributo.</span><span class="sxs-lookup"><span data-stu-id="642c9-287">Later, if you create a new role that needs to have access to certain resources, you can just update a policy, rather than updating every list of roles on every \[Authorize\] attribute.</span></span>

#### <a name="claims"></a><span data-ttu-id="642c9-288">Notificaciones</span><span class="sxs-lookup"><span data-stu-id="642c9-288">Claims</span></span>

<span data-ttu-id="642c9-289">Las notificaciones son pares nombre-valor que representan las propiedades de un usuario autenticado.</span><span class="sxs-lookup"><span data-stu-id="642c9-289">Claims are name value pairs that represent properties of an authenticated user.</span></span> <span data-ttu-id="642c9-290">Por ejemplo, podría almacenar el número de empleado de los usuarios como una notificación.</span><span class="sxs-lookup"><span data-stu-id="642c9-290">For example, you might store users' employee number as a claim.</span></span> <span data-ttu-id="642c9-291">Notificaciones, a continuación, pueden utilizarse como parte de las directivas de autorización.</span><span class="sxs-lookup"><span data-stu-id="642c9-291">Claims can then be used as part of authorization policies.</span></span> <span data-ttu-id="642c9-292">Puede crear una directiva denominada "EmployeeOnly" que requiere la existencia de una notificación denominada "EmployeeNumber", como se muestra en este ejemplo:</span><span class="sxs-lookup"><span data-stu-id="642c9-292">You could create a policy called "EmployeeOnly" that requires the existence of a claim called "EmployeeNumber", as shown in this example:</span></span>

```csharp
public void ConfigureServices(IServiceCollection services)
{
    services.AddMvc();
    services.AddAuthorization(options =>
    {
        options.AddPolicy("EmployeeOnly", policy => policy.RequireClaim("EmployeeNumber"));
    });
}
```

<span data-ttu-id="642c9-293">Esta directiva puede usarse con el \[Authorize\] atributo para proteger cualquier controlador o acción, como se describió anteriormente.</span><span class="sxs-lookup"><span data-stu-id="642c9-293">This policy could then be used with the \[Authorize\] attribute to protect any controller and/or action, as described above.</span></span>

#### <a name="securing-web-apis"></a><span data-ttu-id="642c9-294">Proteger las API Web</span><span class="sxs-lookup"><span data-stu-id="642c9-294">Securing Web APIs</span></span>

<span data-ttu-id="642c9-295">Las API de web mayoría deben implementar un sistema de autenticación basado en tokens.</span><span class="sxs-lookup"><span data-stu-id="642c9-295">Most web APIs should implement a token-based authentication system.</span></span> <span data-ttu-id="642c9-296">Autenticación de token es sin estado y está diseñada para que sea escalable.</span><span class="sxs-lookup"><span data-stu-id="642c9-296">Token authentication is stateless and designed to be scalable.</span></span> <span data-ttu-id="642c9-297">En un sistema basado en tokens de autenticación, el cliente debe autenticarse primero con el proveedor de autenticación.</span><span class="sxs-lookup"><span data-stu-id="642c9-297">In a token-based authentication system, the client must first authenticate with the authentication provider.</span></span> <span data-ttu-id="642c9-298">Si se realiza correctamente, el cliente emite un token, que es simplemente una cadena criptográficamente significativa de caracteres.</span><span class="sxs-lookup"><span data-stu-id="642c9-298">If successful, the client is issued a token, which is simply a cryptographically meaningful string of characters.</span></span> <span data-ttu-id="642c9-299">Cuando el cliente, a continuación, necesita emitir una solicitud a una API, agrega este token como un encabezado en la solicitud.</span><span class="sxs-lookup"><span data-stu-id="642c9-299">When the client then needs to issue a request to an API, it adds this token as a header on the request.</span></span> <span data-ttu-id="642c9-300">El servidor, a continuación, valida el token que se encuentra en el encabezado de solicitud antes de completar la solicitud.</span><span class="sxs-lookup"><span data-stu-id="642c9-300">The server then validates the token found in the request header before completing the request.</span></span> <span data-ttu-id="642c9-301">Figura 7-4 se muestra este proceso.</span><span class="sxs-lookup"><span data-stu-id="642c9-301">Figure 7-4 demonstrates this process.</span></span>

![TokenAuth](./media/image7-4.png)

<span data-ttu-id="642c9-303">**Figura 7-4.**</span><span class="sxs-lookup"><span data-stu-id="642c9-303">**Figure 7-4.**</span></span> <span data-ttu-id="642c9-304">Autenticación basada en token para las API Web.</span><span class="sxs-lookup"><span data-stu-id="642c9-304">Token-based authentication for Web APIs.</span></span>

> ### <a name="references--security"></a><span data-ttu-id="642c9-305">Referencias: seguridad</span><span class="sxs-lookup"><span data-stu-id="642c9-305">References – Security</span></span>
> - <span data-ttu-id="642c9-306">**Información general de documentos de seguridad**</span><span class="sxs-lookup"><span data-stu-id="642c9-306">**Security Docs Overview**</span></span>  
> <span data-ttu-id="642c9-307">https://docs.microsoft.com/aspnet/core/security/</span><span class="sxs-lookup"><span data-stu-id="642c9-307">https://docs.microsoft.com/aspnet/core/security/</span></span>
> - <span data-ttu-id="642c9-308">**Exigir SSL en una aplicación ASP.NET básica**</span><span class="sxs-lookup"><span data-stu-id="642c9-308">**Enforcing SSL in an ASP.NET Core App**</span></span>  
> <span data-ttu-id="642c9-309"><https://docs.microsoft.com/aspnet/core/security/enforcing-ssl></span><span class="sxs-lookup"><span data-stu-id="642c9-309"><https://docs.microsoft.com/aspnet/core/security/enforcing-ssl></span></span>
> - <span data-ttu-id="642c9-310">**Introducción a Identity**</span><span class="sxs-lookup"><span data-stu-id="642c9-310">**Introduction to Identity**</span></span>  
> <span data-ttu-id="642c9-311"><https://docs.microsoft.com/aspnet/core/security/authentication/identity></span><span class="sxs-lookup"><span data-stu-id="642c9-311"><https://docs.microsoft.com/aspnet/core/security/authentication/identity></span></span>
> - <span data-ttu-id="642c9-312">**Introducción a la autorización**</span><span class="sxs-lookup"><span data-stu-id="642c9-312">**Introduction to Authorization**</span></span>  
> <span data-ttu-id="642c9-313"><https://docs.microsoft.com/aspnet/core/security/authorization/introduction></span><span class="sxs-lookup"><span data-stu-id="642c9-313"><https://docs.microsoft.com/aspnet/core/security/authorization/introduction></span></span>
> - <span data-ttu-id="642c9-314">**Autenticación y autorización para las aplicaciones de API de servicio de aplicaciones de Azure**</span><span class="sxs-lookup"><span data-stu-id="642c9-314">**Authentication and Authorization for API Apps in Azure App Service**</span></span>  
> <span data-ttu-id="642c9-315"><https://docs.microsoft.com/azure/app-service-api/app-service-api-authentication></span><span class="sxs-lookup"><span data-stu-id="642c9-315"><https://docs.microsoft.com/azure/app-service-api/app-service-api-authentication></span></span>

## <a name="client-communication"></a><span data-ttu-id="642c9-316">Comunicación de cliente</span><span class="sxs-lookup"><span data-stu-id="642c9-316">Client Communication</span></span>

<span data-ttu-id="642c9-317">Además de servir páginas y responde a las solicitudes de datos a través de las API web, aplicaciones de ASP.NET Core pueden comunicarse directamente con los clientes conectados.</span><span class="sxs-lookup"><span data-stu-id="642c9-317">In addition to serving pages and responding to requests for data via web APIs, ASP.NET Core apps can communicate directly with connected clients.</span></span> <span data-ttu-id="642c9-318">Esta comunicación saliente puede utilizar una amplia variedad de tecnologías de transporte, siendo los más comunes WebSockets.</span><span class="sxs-lookup"><span data-stu-id="642c9-318">This outbound communication can use a variety of transport technologies, the most common being WebSockets.</span></span> <span data-ttu-id="642c9-319">Núcleo de ASP.NET SignalR es una biblioteca que simplifica el proceso para el tipo de funcionalidad de comunicación de servidor a cliente en tiempo real a sus aplicaciones.</span><span class="sxs-lookup"><span data-stu-id="642c9-319">ASP.NET Core SignalR is a library that makes it simple to kind of real-time server-to-client communication functionality to your applications.</span></span> <span data-ttu-id="642c9-320">SignalR admite una variedad de tecnologías de transporte, incluyendo WebSockets y abstrae alejadas varios de los detalles de implementación del programador.</span><span class="sxs-lookup"><span data-stu-id="642c9-320">SignalR supports a variety of transport technologies, including WebSockets, and abstracts away many of the implementation details from the developer.</span></span>

<span data-ttu-id="642c9-321">Núcleo de ASP.NET SignalR está actualmente en fase de desarrollo y estará disponible en la próxima versión de ASP.NET Core.</span><span class="sxs-lookup"><span data-stu-id="642c9-321">ASP.NET Core SignalR is currently under development, and will be available in the next release of ASP.NET Core.</span></span> <span data-ttu-id="642c9-322">Sin embargo, otros [Abrir origen WebSockets bibliotecas](https://github.com/radu-matei/websocket-manager) están disponibles actualmente.</span><span class="sxs-lookup"><span data-stu-id="642c9-322">However, other [open source WebSockets libraries](https://github.com/radu-matei/websocket-manager) are currently available.</span></span>

<span data-ttu-id="642c9-323">Comunicación de cliente en tiempo real, si usando WebSockets directamente u otras técnicas, son útiles en una variedad de escenarios de aplicación.</span><span class="sxs-lookup"><span data-stu-id="642c9-323">Real-time client communication, whether using WebSockets directly or other techniques, are useful in a variety of application scenarios.</span></span> <span data-ttu-id="642c9-324">Estos son algunos ejemplos:</span><span class="sxs-lookup"><span data-stu-id="642c9-324">Some examples include:</span></span>

-   <span data-ttu-id="642c9-325">Aplicaciones de salón de chat en vivo</span><span class="sxs-lookup"><span data-stu-id="642c9-325">Live chat room applications</span></span>

-   <span data-ttu-id="642c9-326">Supervisión de aplicaciones</span><span class="sxs-lookup"><span data-stu-id="642c9-326">Monitoring applications</span></span>

-   <span data-ttu-id="642c9-327">Actualizaciones de progreso de trabajo</span><span class="sxs-lookup"><span data-stu-id="642c9-327">Job progress updates</span></span>

-   <span data-ttu-id="642c9-328">Notificaciones</span><span class="sxs-lookup"><span data-stu-id="642c9-328">Notifications</span></span>

-   <span data-ttu-id="642c9-329">Aplicaciones de formularios interactivos</span><span class="sxs-lookup"><span data-stu-id="642c9-329">Interactive forms applications</span></span>

<span data-ttu-id="642c9-330">Al compilar la comunicación de cliente en las aplicaciones, normalmente hay dos componentes:</span><span class="sxs-lookup"><span data-stu-id="642c9-330">When building client communication into your applications, there are typically two components:</span></span>

-   <span data-ttu-id="642c9-331">Administrador de conexiones de servidor (concentrador de SignalR, WebSocketManager WebSocketHandler)</span><span class="sxs-lookup"><span data-stu-id="642c9-331">Server-side connection manager (SignalR Hub, WebSocketManager WebSocketHandler)</span></span>

-   <span data-ttu-id="642c9-332">Biblioteca de cliente</span><span class="sxs-lookup"><span data-stu-id="642c9-332">Client-side library</span></span>

<span data-ttu-id="642c9-333">Los clientes no están limitados a los exploradores, aplicaciones móviles, aplicaciones de consola, y otras aplicaciones nativas también pueden comunicarse con SignalR/WebSockets.</span><span class="sxs-lookup"><span data-stu-id="642c9-333">Clients are not limited to browsers – mobile apps, console apps, and other native apps can also communicate using SignalR/WebSockets.</span></span> <span data-ttu-id="642c9-334">El programa simple siguiente devuelve todo el contenido enviado a una aplicación de chat en la consola, como parte de una aplicación de ejemplo WebSocketManager:</span><span class="sxs-lookup"><span data-stu-id="642c9-334">The following simple program echoes all content sent to a chat application to the console, as part of a WebSocketManager sample application:</span></span>

```csharp
public class Program
{
    private static Connection _connection;
    public static void Main(string[] args)
    {
        StartConnectionAsync();
        _connection.On("receiveMessage", (arguments) =>;
        {
            Console.WriteLine(\$"{arguments\[0\]} said: {arguments\[1\]}");
        });
        Console.ReadLine();
        StopConnectionAsync();
    }
    
    public static async Task StartConnectionAsync()
    {
        _connection = new Connection();
        await _connection.StartConnectionAsync("ws://localhost:65110/chat");
    }
    
    public static async Task StopConnectionAsync()
    {
        await _connection.StopConnectionAsync();
    }
```

<span data-ttu-id="642c9-335">Considere la posibilidad de experimentan maneras en que las aplicaciones comunican directamente con aplicaciones de cliente, tenga en cuenta si la comunicación en tiempo real mejoraría el usuario de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="642c9-335">Consider ways in which your applications communicate directly with client applications, and consider whether real-time communication would improve your app's user experience.</span></span>

> ### <a name="references--client-communication"></a><span data-ttu-id="642c9-336">Referencias: la comunicación del cliente</span><span class="sxs-lookup"><span data-stu-id="642c9-336">References – Client Communication</span></span>
> - <span data-ttu-id="642c9-337">**Núcleo de ASP.NET SignalR**</span><span class="sxs-lookup"><span data-stu-id="642c9-337">**ASP.NET Core SignalR**</span></span>  
> <span data-ttu-id="642c9-338"><https://github.com/aspnet/SignalR></span><span class="sxs-lookup"><span data-stu-id="642c9-338"><https://github.com/aspnet/SignalR></span></span>
> - <span data-ttu-id="642c9-339">**Administrador de WebSocket**</span><span class="sxs-lookup"><span data-stu-id="642c9-339">**WebSocket Manager**</span></span>  
> <span data-ttu-id="642c9-340">https://github.com/radu-matei/websocket-manager</span><span class="sxs-lookup"><span data-stu-id="642c9-340">https://github.com/radu-matei/websocket-manager</span></span>

## <a name="domain-driven-design--should-you-apply-it"></a><span data-ttu-id="642c9-341">¿Diseño – controlada por el dominio debe aplicarla?</span><span class="sxs-lookup"><span data-stu-id="642c9-341">Domain-Driven Design – Should You Apply It?</span></span>

<span data-ttu-id="642c9-342">Diseño controlada por el dominio (DDD) es un enfoque de agile para la creación de software que resalta centrarse en el *dominio de negocio*.</span><span class="sxs-lookup"><span data-stu-id="642c9-342">Domain-Driven Design (DDD) is an agile approach to building software that emphasizes focusing on the *business domain*.</span></span> <span data-ttu-id="642c9-343">Coloca un gran énfasis en la comunicación e interacción con expert(s) de dominio de negocio que se puede asociar a los desarrolladores de cómo funciona el sistema del mundo real.</span><span class="sxs-lookup"><span data-stu-id="642c9-343">It places a heavy emphasis on communication and interaction with business domain expert(s) who can relate to the developers how the real-world system works.</span></span> <span data-ttu-id="642c9-344">Por ejemplo, si está creando un sistema que controla las operaciones estándar, su experto de dominio puede ser un intermediario de cotizaciones con experiencia.</span><span class="sxs-lookup"><span data-stu-id="642c9-344">For example, if you're building a system that handles stock trades, your domain expert might be an experienced stock broker.</span></span> <span data-ttu-id="642c9-345">DDD está diseñado para resolver problemas empresariales grandes y complejas y a menudo no es adecuado para aplicaciones pequeñas y sencillas, como la inversión en la descripción y el dominio de modelado no vale la pena.</span><span class="sxs-lookup"><span data-stu-id="642c9-345">DDD is designed to address large, complex business problems, and is often not appropriate for smaller, simpler applications, as the investment in understanding and modeling the domain is not worth it.</span></span>

<span data-ttu-id="642c9-346">Al compilar software sigue un enfoque DDD, su equipo (incluidas las partes interesadas no técnicas y colaboradores) se debe desarrollar un *lenguaje ubicuo* para el problema de espacio.</span><span class="sxs-lookup"><span data-stu-id="642c9-346">When building software following a DDD approach, your team (including non-technical stakeholders and contributors) should develop a *ubiquitous language* for the problem space.</span></span> <span data-ttu-id="642c9-347">Es decir, debe utilizarse la misma terminología para las estructuras que podrían existir para conservar el concepto (por ejemplo, tablas de base de datos), el equivalente de software y el concepto del mundo real que se está modelando.</span><span class="sxs-lookup"><span data-stu-id="642c9-347">That is, the same terminology should be used for the real-world concept being modeled, the software equivalent, and any structures that might exist to persist the concept (for example, database tables).</span></span> <span data-ttu-id="642c9-348">Por lo tanto, los conceptos descritos en el lenguaje ubicuo deberían ser la base para su *modelo de dominio*.</span><span class="sxs-lookup"><span data-stu-id="642c9-348">Thus, the concepts described in the ubiquitous language should form the basis for your *domain model*.</span></span>

<span data-ttu-id="642c9-349">El modelo de dominio se compone de objetos que interactúan entre sí para representar el comportamiento del sistema.</span><span class="sxs-lookup"><span data-stu-id="642c9-349">Your domain model is comprised of objects that interact with one another to represent the behavior of the system.</span></span> <span data-ttu-id="642c9-350">Estos objetos pueden estar en las siguientes categorías:</span><span class="sxs-lookup"><span data-stu-id="642c9-350">These objects may fall into the following categories:</span></span>

-   <span data-ttu-id="642c9-351">[Entidades](http://deviq.com/entity/), que representan objetos con un subproceso de identidad.</span><span class="sxs-lookup"><span data-stu-id="642c9-351">[Entities](http://deviq.com/entity/), which represent objects with a thread of identity.</span></span> <span data-ttu-id="642c9-352">Las entidades se almacenan normalmente en la persistencia con una clave por el que puede recuperar después.</span><span class="sxs-lookup"><span data-stu-id="642c9-352">Entities are typically stored in persistence with a key by which they can later be retrieved.</span></span>

-   <span data-ttu-id="642c9-353">[Agregados](http://deviq.com/aggregate-pattern/), que representan grupos de objetos que se deben conservar como una unidad.</span><span class="sxs-lookup"><span data-stu-id="642c9-353">[Aggregates](http://deviq.com/aggregate-pattern/), which represent groups of objects that should be persisted as a unit.</span></span>

-   <span data-ttu-id="642c9-354">[Objetos de valor](http://deviq.com/value-object/), que representan los conceptos que se pueda comparar basándose en la suma de los valores de propiedad.</span><span class="sxs-lookup"><span data-stu-id="642c9-354">[Value objects](http://deviq.com/value-object/), which represent concepts that can be compared on the basis of the sum of their property values.</span></span> <span data-ttu-id="642c9-355">Por ejemplo, DateRange que consta de una fecha de inicio y finalización.</span><span class="sxs-lookup"><span data-stu-id="642c9-355">For example, DateRange consisting of a start and end date.</span></span>

-   <span data-ttu-id="642c9-356">[Eventos de dominio](https://martinfowler.com/eaaDev/DomainEvent.html), que representan lo que ocurre en el sistema que resulten de interés a otras partes del sistema.</span><span class="sxs-lookup"><span data-stu-id="642c9-356">[Domain events](https://martinfowler.com/eaaDev/DomainEvent.html), which represent things happening within the system that are of interest to other parts of the system.</span></span>

<span data-ttu-id="642c9-357">Tenga en cuenta que un modelo de dominio DDD debe encapsular un comportamiento complejo dentro del modelo.</span><span class="sxs-lookup"><span data-stu-id="642c9-357">Note that a DDD domain model should encapsulate complex behavior within the model.</span></span> <span data-ttu-id="642c9-358">Las entidades, en particular, no debe simplemente colecciones de propiedades.</span><span class="sxs-lookup"><span data-stu-id="642c9-358">Entities, in particular, should not merely be collections of properties.</span></span> <span data-ttu-id="642c9-359">Cuando el modelo de dominio no tiene comportamiento y simplemente representa el estado del sistema, se dice que un [anemic modelo](http://deviq.com/anemic-model/), que no es deseable en DDD.</span><span class="sxs-lookup"><span data-stu-id="642c9-359">When the domain model lacks behavior and merely represents the state of the system, it is said to be an [anemic model](http://deviq.com/anemic-model/), which is undesirable in DDD.</span></span>

<span data-ttu-id="642c9-360">Además de estos tipos de modelo, DDD normalmente emplea una variedad de modelos:</span><span class="sxs-lookup"><span data-stu-id="642c9-360">In addition to these model types, DDD typically employs a variety of patterns:</span></span>

-   <span data-ttu-id="642c9-361">[Repositorio](http://deviq.com/repository-pattern/), para resumiendo los detalles de persistencia.</span><span class="sxs-lookup"><span data-stu-id="642c9-361">[Repository](http://deviq.com/repository-pattern/), for abstracting persistence details.</span></span>

-   <span data-ttu-id="642c9-362">[Generador](https://en.wikipedia.org/wiki/Factory_method_pattern), para encapsular la creación de objetos complejos.</span><span class="sxs-lookup"><span data-stu-id="642c9-362">[Factory](https://en.wikipedia.org/wiki/Factory_method_pattern), for encapsulating complex object creation.</span></span>

-   <span data-ttu-id="642c9-363">Eventos de dominio, separe el comportamiento dependiente de desencadenar el comportamiento.</span><span class="sxs-lookup"><span data-stu-id="642c9-363">Domain events, for decoupling dependent behavior from triggering behavior.</span></span>

-   <span data-ttu-id="642c9-364">[Servicios](http://gorodinski.com/blog/2012/04/14/services-in-domain-driven-design-ddd/), para encapsular un comportamiento complejo o detalles de la implementación de infraestructura.</span><span class="sxs-lookup"><span data-stu-id="642c9-364">[Services](http://gorodinski.com/blog/2012/04/14/services-in-domain-driven-design-ddd/), for encapsulating complex behavior and/or infrastructure implementation details.</span></span>

-   <span data-ttu-id="642c9-365">[Comando](https://en.wikipedia.org/wiki/Command_pattern), para separar emitir comandos y ejecutar el comando propio.</span><span class="sxs-lookup"><span data-stu-id="642c9-365">[Command](https://en.wikipedia.org/wiki/Command_pattern), for decoupling issuing commands and executing the command itself.</span></span>

-   <span data-ttu-id="642c9-366">[Especificación de](http://deviq.com/specification-pattern/), para encapsular los detalles de la consulta.</span><span class="sxs-lookup"><span data-stu-id="642c9-366">[Specification](http://deviq.com/specification-pattern/), for encapsulating query details.</span></span>

<span data-ttu-id="642c9-367">DDD también recomienda el uso de la arquitectura de limpieza se ha descrito anteriormente, lo que permite un acoplamiento, encapsulación y el código que se pueda comprobar fácilmente utilizando pruebas unitarias.</span><span class="sxs-lookup"><span data-stu-id="642c9-367">DDD also recommends the use of the Clean Architecture discussed previously, allowing for loose coupling, encapsulation, and code that can easily be verified using unit tests.</span></span>

### <a name="when-should-you-apply-ddd"></a><span data-ttu-id="642c9-368">¿Cuándo debe aplicar DDD</span><span class="sxs-lookup"><span data-stu-id="642c9-368">When Should You Apply DDD</span></span>

<span data-ttu-id="642c9-369">DDD es ideal para aplicaciones de gran tamaño con complejidad significativos para el negocio (no sólo técnicas).</span><span class="sxs-lookup"><span data-stu-id="642c9-369">DDD is well-suited to large applications with significant business (not just technical) complexity.</span></span> <span data-ttu-id="642c9-370">La aplicación debe requieren el conocimiento de expertos de dominio.</span><span class="sxs-lookup"><span data-stu-id="642c9-370">The application should require the knowledge of domain experts.</span></span> <span data-ttu-id="642c9-371">Debe haber un comportamiento importante en el modelo de dominio, que representa las reglas de negocios e interacciones más allá de simplemente almacenar y recuperar el estado actual de registros de diversos almacenes de datos.</span><span class="sxs-lookup"><span data-stu-id="642c9-371">There should be significant behavior in the domain model itself, representing business rules and interactions beyond simply storing and retrieving the current state of various records from data stores.</span></span>

### <a name="when-shouldnt-you-apply-ddd"></a><span data-ttu-id="642c9-372">Cuando no debería aplicar DDD</span><span class="sxs-lookup"><span data-stu-id="642c9-372">When Shouldn't You Apply DDD</span></span>

<span data-ttu-id="642c9-373">DDD implica la inversión ya realizada en el modelado, la arquitectura y comunicación que no puede garantizarse para pequeñas aplicaciones o las aplicaciones que son esencialmente simplemente CRUD (crear/leer/actualizar/eliminar).</span><span class="sxs-lookup"><span data-stu-id="642c9-373">DDD involves investments in modeling, architecture, and communication that may not be warranted for smaller applications or applications that are essentially just CRUD (create/read/update/delete).</span></span> <span data-ttu-id="642c9-374">Si decide enfocar la aplicación siga DDD, pero descubre que el dominio tiene un modelo anemic con ningún comportamiento, necesitará reconsiderar su enfoque.</span><span class="sxs-lookup"><span data-stu-id="642c9-374">If you choose to approach your application following DDD, but find that your domain has an anemic model with no behavior, you may need to rethink your approach.</span></span> <span data-ttu-id="642c9-375">La aplicación no necesita DDD, o puede que necesite asistencia refactorizar la aplicación para encapsular la lógica de negocios en el modelo de dominio, en lugar de en la interfaz de usuario o la base de datos.</span><span class="sxs-lookup"><span data-stu-id="642c9-375">Either your application may not need DDD, or you may need assistance refactoring your application to encapsulate business logic in the domain model, rather than in your database or user interface.</span></span>

<span data-ttu-id="642c9-376">Un enfoque híbrido sería usar solo DDD para las áreas más complejas o transaccionales de la aplicación, pero no para CRUD más sencillo o partes de solo lectura de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="642c9-376">A hybrid approach would be to only use DDD for the transactional or more complex areas of the application, but not for simpler CRUD or read-only portions of the application.</span></span> <span data-ttu-id="642c9-377">Por ejemplo, no necesitan tener las restricciones de un agregado si está consultando datos para mostrar un informe o para visualizar los datos para un panel.</span><span class="sxs-lookup"><span data-stu-id="642c9-377">For instance, you needn't have the constraints of an Aggregate if you're querying data to display a report or to visualize data for a dashboard.</span></span> <span data-ttu-id="642c9-378">Es absolutamente aceptable tener un modelo independiente y más fácil lectura para dichos requisitos.</span><span class="sxs-lookup"><span data-stu-id="642c9-378">It's perfectly acceptable to have a separate, simpler read model for such requirements.</span></span>

> ### <a name="references--domain-driven-design"></a><span data-ttu-id="642c9-379">Referencias: diseño basado en dominio</span><span class="sxs-lookup"><span data-stu-id="642c9-379">References – Domain-Driven Design</span></span>
> - <span data-ttu-id="642c9-380">**DDD en términos sencillos (StackOverflow respuesta)**</span><span class="sxs-lookup"><span data-stu-id="642c9-380">**DDD in Plain English (StackOverflow Answer)**</span></span>  
> <span data-ttu-id="642c9-381"><https://stackoverflow.com/questions/1222392/can-someone-explain-domain-driven-design-ddd-in-plain-english-please/1222488#1222488></span><span class="sxs-lookup"><span data-stu-id="642c9-381"><https://stackoverflow.com/questions/1222392/can-someone-explain-domain-driven-design-ddd-in-plain-english-please/1222488#1222488></span></span>

## <a name="deployment"></a><span data-ttu-id="642c9-382">Implementación</span><span class="sxs-lookup"><span data-stu-id="642c9-382">Deployment</span></span>

<span data-ttu-id="642c9-383">Hay unos pocos pasos implicados en el proceso de implementación de la aplicación de ASP.NET Core, independientemente de donde se hospedará.</span><span class="sxs-lookup"><span data-stu-id="642c9-383">There are a few steps involved in the process of deploying your ASP.NET Core application, regardless of where it will be hosted.</span></span> <span data-ttu-id="642c9-384">Es el primer paso publicar la aplicación, lo que puede hacer con el dotnet publicar el comando de CLI.</span><span class="sxs-lookup"><span data-stu-id="642c9-384">The first step is to publish the application, which can be done using the dotnet publish CLI command.</span></span> <span data-ttu-id="642c9-385">Se compila la aplicación y se colocarán todos los archivos necesarios para ejecutar la aplicación en una carpeta designada.</span><span class="sxs-lookup"><span data-stu-id="642c9-385">This will compile the application and place all of the files needed to run the application into a designated folder.</span></span> <span data-ttu-id="642c9-386">Cuando se implementa desde Visual Studio, este paso se realiza automáticamente.</span><span class="sxs-lookup"><span data-stu-id="642c9-386">When you deploy from Visual Studio, this step is performed for you automatically.</span></span> <span data-ttu-id="642c9-387">La carpeta de publicación contiene archivos .exe y .dll para la aplicación y sus dependencias.</span><span class="sxs-lookup"><span data-stu-id="642c9-387">The publish folder contains .exe and .dll files for the application and its dependencies.</span></span> <span data-ttu-id="642c9-388">Una aplicación independiente también incluirá una versión de .NET runtime.</span><span class="sxs-lookup"><span data-stu-id="642c9-388">A self-contained application will also include a version of the .NET runtime.</span></span> <span data-ttu-id="642c9-389">Las aplicaciones de ASP.NET Core también incluyen archivos de configuración, activos de cliente estático y las vistas de MVC.</span><span class="sxs-lookup"><span data-stu-id="642c9-389">ASP.NET Core applications will also include configuration files, static client assets, and MVC views.</span></span>

<span data-ttu-id="642c9-390">Las aplicaciones de ASP.NET Core son aplicaciones de consola que se deben iniciar cuando el servidor se inicia y se reinicia si se bloquea la aplicación (o servidor).</span><span class="sxs-lookup"><span data-stu-id="642c9-390">ASP.NET Core applications are console applications that must be started when the server boots and restarted if the application (or server) crashes.</span></span> <span data-ttu-id="642c9-391">Un administrador de procesos se puede utilizar para automatizar este proceso.</span><span class="sxs-lookup"><span data-stu-id="642c9-391">A process manager can be used to automate this process.</span></span> <span data-ttu-id="642c9-392">Los administradores de proceso más comunes para ASP.NET Core son Nginx y Apache en Linux y IIS o el servicio de Windows en Windows.</span><span class="sxs-lookup"><span data-stu-id="642c9-392">The most common process managers for ASP.NET Core are Nginx and Apache on Linux and IIS or Windows Service on Windows.</span></span>

<span data-ttu-id="642c9-393">Además de un administrador de procesos, las aplicaciones de ASP.NET Core hospedadas en el servidor de web Kestrel deben usar un servidor proxy inverso.</span><span class="sxs-lookup"><span data-stu-id="642c9-393">In addition to a process manager, ASP.NET Core applications hosted in the Kestrel web server must use a reverse proxy server.</span></span> <span data-ttu-id="642c9-394">Un servidor proxy inverso recibe las solicitudes HTTP de internet y reenvía a Kestrel después de un control preliminar.</span><span class="sxs-lookup"><span data-stu-id="642c9-394">A reverse proxy server receives HTTP requests from the internet and forwards them to Kestrel after some preliminary handling.</span></span> <span data-ttu-id="642c9-395">Servidores proxy inversos proporcionan un nivel de seguridad para la aplicación y son necesarios para las implementaciones de borde (expuestas al tráfico de Internet).</span><span class="sxs-lookup"><span data-stu-id="642c9-395">Reverse proxy servers provide a layer of security for the application, and are required for edge deployments (exposed to traffic from the Internet).</span></span> <span data-ttu-id="642c9-396">Kestrel es relativamente nuevo y todavía no ofrece defensas frente a ciertos ataques.</span><span class="sxs-lookup"><span data-stu-id="642c9-396">Kestrel is relatively new and does not yet offer defenses against certain attacks.</span></span> <span data-ttu-id="642c9-397">Kestrel también no admiten el hospedaje de varias aplicaciones en el mismo puerto, por lo que no se puede usar técnicas como encabezados de host con él para habilitar el hospedaje de varias aplicaciones en el mismo puerto y dirección IP.</span><span class="sxs-lookup"><span data-stu-id="642c9-397">Kestrel also doesn't support hosting multiple applications on the same port, so techniques like host headers cannot be used with it to enable hosting multiple applications on the same port and IP address.</span></span>

![Kestrel a Internet](./media/image7-5.png)

<span data-ttu-id="642c9-399">Figura 7-5 ASP.NET hospedados en Kestrel detrás de un servidor proxy inverso</span><span class="sxs-lookup"><span data-stu-id="642c9-399">Figure 7-5 ASP.NET hosted in Kestrel behind a reverse proxy server</span></span>

<span data-ttu-id="642c9-400">Es otro escenario en el que un proxy inverso puede ser útil proteger varias aplicaciones que usan SSL/HTTPS.</span><span class="sxs-lookup"><span data-stu-id="642c9-400">Another scenario in which a reverse proxy can be helpful is to secure multiple applications using SSL/HTTPS.</span></span> <span data-ttu-id="642c9-401">En este caso, solo el proxy inverso necesitaría tener SSL configurado.</span><span class="sxs-lookup"><span data-stu-id="642c9-401">In this case, only the reverse proxy would need to have SSL configured.</span></span> <span data-ttu-id="642c9-402">Comunicación entre el servidor proxy inverso y Kestrel llevara a cabo a través de HTTP, como se muestra en la figura 7-6.</span><span class="sxs-lookup"><span data-stu-id="642c9-402">Communication between the reverse proxy server and Kestrel could take place over HTTP, as shown in Figure 7-6.</span></span>

![](./media/image7-6.png)

<span data-ttu-id="642c9-403">Figura 7-6 ASP.NET hospedados detrás de un servidor proxy inverso protegidas mediante HTTPS</span><span class="sxs-lookup"><span data-stu-id="642c9-403">Figure 7-6 ASP.NET hosted behind an HTTPS-secured reverse proxy server</span></span>

<span data-ttu-id="642c9-404">Un enfoque cada vez más popular que se va a hospedar la aplicación de ASP.NET Core en un contenedor de Docker, que a continuación, se hospeda localmente o implementar en Azure para hospedar en la nube.</span><span class="sxs-lookup"><span data-stu-id="642c9-404">An increasingly popular approach is to host your ASP.NET Core application in a Docker container, which then can be hosted locally or deployed to Azure for cloud-based hosting.</span></span> <span data-ttu-id="642c9-405">El contenedor Docker podría contener el código de aplicación que se ejecuta en Kestrel y se implementaría detrás de un servidor proxy inverso, como se indicó anteriormente.</span><span class="sxs-lookup"><span data-stu-id="642c9-405">The Docker container could contain your application code, running on Kestrel, and would be deployed behind a reverse proxy server, as shown above.</span></span>

<span data-ttu-id="642c9-406">Si está hospedando la aplicación en Azure, puede usar la puerta de enlace de aplicaciones de Microsoft Azure como un dispositivo virtual dedicado para proporcionar varios servicios.</span><span class="sxs-lookup"><span data-stu-id="642c9-406">If you're hosting your application on Azure, you can use Microsoft Azure Application Gateway as a dedicated virtual appliance to provide several services.</span></span> <span data-ttu-id="642c9-407">Además de actuar como un proxy inverso para las aplicaciones individuales, puerta de enlace de aplicación también puede ofrecer las siguientes características:</span><span class="sxs-lookup"><span data-stu-id="642c9-407">In addition to acting as a reverse proxy for individual applications, Application Gateway can also offer the following features:</span></span>

-   <span data-ttu-id="642c9-408">Equilibrio de carga HTTP</span><span class="sxs-lookup"><span data-stu-id="642c9-408">HTTP load balancing</span></span>

-   <span data-ttu-id="642c9-409">Descarga SSL (SSL solo para Internet)</span><span class="sxs-lookup"><span data-stu-id="642c9-409">SSL offload (SSL only to Internet)</span></span>

-   <span data-ttu-id="642c9-410">SSL de extremo a extremo</span><span class="sxs-lookup"><span data-stu-id="642c9-410">End to End SSL</span></span>

-   <span data-ttu-id="642c9-411">Enrutamiento de varios sitios (consolidar hasta 20 sitios en una sola puerta de enlace de aplicaciones)</span><span class="sxs-lookup"><span data-stu-id="642c9-411">Multi-site routing (consolidate up to 20 sites on a single Application Gateway)</span></span>

-   <span data-ttu-id="642c9-412">Servidor de aplicaciones Web</span><span class="sxs-lookup"><span data-stu-id="642c9-412">Web application firewall</span></span>

-   <span data-ttu-id="642c9-413">Compatibilidad con websocket para</span><span class="sxs-lookup"><span data-stu-id="642c9-413">Websocket support</span></span>

-   <span data-ttu-id="642c9-414">Diagnósticos avanzados</span><span class="sxs-lookup"><span data-stu-id="642c9-414">Advanced diagnostics</span></span>

<span data-ttu-id="642c9-415">*Más información acerca de las opciones de implementación de Azure en el capítulo 10.*</span><span class="sxs-lookup"><span data-stu-id="642c9-415">*Learn more about Azure deployment options in Chapter 10.*</span></span>

> ### <a name="references--deployment"></a><span data-ttu-id="642c9-416">Referencias: implementación</span><span class="sxs-lookup"><span data-stu-id="642c9-416">References – Deployment</span></span>
> - <span data-ttu-id="642c9-417">**Información general de implementación y hospedaje**</span><span class="sxs-lookup"><span data-stu-id="642c9-417">**Hosting and Deployment Overview**</span></span>  
> <span data-ttu-id="642c9-418"><https://docs.microsoft.com/aspnet/core/publishing/></span><span class="sxs-lookup"><span data-stu-id="642c9-418"><https://docs.microsoft.com/aspnet/core/publishing/></span></span>
> - <span data-ttu-id="642c9-419">**Cuándo utilizar Kestrel con un proxy inverso**</span><span class="sxs-lookup"><span data-stu-id="642c9-419">**When to use Kestrel with a reverse proxy**</span></span>  
> <span data-ttu-id="642c9-420"><https://docs.microsoft.com/aspnet/core/fundamentals/servers/kestrel#when-to-use-kestrel-with-a-reverse-proxy></span><span class="sxs-lookup"><span data-stu-id="642c9-420"><https://docs.microsoft.com/aspnet/core/fundamentals/servers/kestrel#when-to-use-kestrel-with-a-reverse-proxy></span></span>
> - <span data-ttu-id="642c9-421">**Host de aplicaciones de ASP.NET Core en Docker**</span><span class="sxs-lookup"><span data-stu-id="642c9-421">**Host ASP.NET Core apps in Docker**</span></span>  
> <span data-ttu-id="642c9-422"><https://docs.microsoft.com/aspnet/core/publishing/docker></span><span class="sxs-lookup"><span data-stu-id="642c9-422"><https://docs.microsoft.com/aspnet/core/publishing/docker></span></span>
> - <span data-ttu-id="642c9-423">**Introducción a la puerta de enlace de aplicación de Azure**</span><span class="sxs-lookup"><span data-stu-id="642c9-423">**Introducing Azure Application Gateway**</span></span>  
> <span data-ttu-id="642c9-424"><https://docs.microsoft.com/azure/application-gateway/application-gateway-introduction></span><span class="sxs-lookup"><span data-stu-id="642c9-424"><https://docs.microsoft.com/azure/application-gateway/application-gateway-introduction></span></span>

>[!div class="step-by-step"]
<span data-ttu-id="642c9-425">[Previous] (common-client-side-web-technologies.md) [Next] (work-with-data-in-asp-net-core-apps.md)</span><span class="sxs-lookup"><span data-stu-id="642c9-425">[Previous] (common-client-side-web-technologies.md) [Next] (work-with-data-in-asp-net-core-apps.md)</span></span>
