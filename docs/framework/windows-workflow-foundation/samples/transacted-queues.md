---
title: Colas de transacción
ms.custom: ''
ms.date: 03/30/2017
ms.prod: .net-framework
ms.reviewer: ''
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: article
ms.assetid: b1b011dd-5e0b-482c-9bb0-9d8727038f14
caps.latest.revision: 9
author: dotnet-bot
ms.author: dotnetcontent
manager: wpickett
ms.workload:
- dotnet
ms.openlocfilehash: 628e91589ad32a2646316401c7b2ddb31b13eace
ms.sourcegitcommit: 2042de78fcdceebb6b8ac4b7a292b93e8782cbf5
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 04/27/2018
---
# <a name="transacted-queues"></a><span data-ttu-id="ac334-102">Colas de transacción</span><span class="sxs-lookup"><span data-stu-id="ac334-102">Transacted Queues</span></span>
<span data-ttu-id="ac334-103">Este ejemplo muestra cómo integrar colas y transacciones en Windows Workflow Foundation (WF) para crear servicios escalables y fiables.</span><span class="sxs-lookup"><span data-stu-id="ac334-103">This sample shows how to integrate queues and transactions in Windows Workflow Foundation (WF) to create reliable and scalable services.</span></span> <span data-ttu-id="ac334-104">A <!--zz <xref:System.Activities.TransactionScope>--> `System.Activities.TransactionScope` se utiliza en el flujo de trabajo de cliente para enviar mensajes a una cola en una transacción mediante el <xref:System.ServiceModel.NetMsmqBinding>.</span><span class="sxs-lookup"><span data-stu-id="ac334-104">A <!--zz <xref:System.Activities.TransactionScope>--> `System.Activities.TransactionScope` is used in the client workflow to send message to a queue under a transaction using the <xref:System.ServiceModel.NetMsmqBinding>.</span></span> <span data-ttu-id="ac334-105"><xref:System.ServiceModel.Activities.TransactedReceiveScope> se utiliza en el servidor para recibir mensajes de la cola y actualizar el estado del flujo de trabajo en la misma transacción.</span><span class="sxs-lookup"><span data-stu-id="ac334-105">A <xref:System.ServiceModel.Activities.TransactedReceiveScope> is used on the server to receive messages from the queue and update the state of the workflow under the same transaction.</span></span>  
  
## <a name="demonstrates"></a><span data-ttu-id="ac334-106">Demostraciones</span><span class="sxs-lookup"><span data-stu-id="ac334-106">Demonstrates</span></span>  
 <span data-ttu-id="ac334-107"><xref:System.Activities.Statements.TransactionScope>, <xref:System.ServiceModel.Activities.TransactedReceiveScope>, <xref:System.ServiceModel.NetMsmqBinding>, <xref:System.ServiceModel.Activities.Receive> y correlación basada en contenidos.</span><span class="sxs-lookup"><span data-stu-id="ac334-107"><xref:System.Activities.Statements.TransactionScope>, <xref:System.ServiceModel.Activities.TransactedReceiveScope>, <xref:System.ServiceModel.NetMsmqBinding>, <xref:System.ServiceModel.Activities.Receive>, and content-based correlation.</span></span>  
  
## <a name="discussion"></a><span data-ttu-id="ac334-108">Explicación</span><span class="sxs-lookup"><span data-stu-id="ac334-108">Discussion</span></span>  
 <span data-ttu-id="ac334-109">Para mostrar las características incluidas en este ejemplo, se crea un servicio de flujo de trabajo `RewardsPoints` que realiza un seguimiento de los puntos ganados y se utiliza para una cuenta determinada.</span><span class="sxs-lookup"><span data-stu-id="ac334-109">To demonstrate the features covered in this sample, a `RewardsPoints` workflow service is created, which keeps track of the points earned and used for a given account.</span></span> <span data-ttu-id="ac334-110">El cliente utiliza <xref:System.Activities.WorkflowInvoker> para simular el envío de varias solicitudes a la cola.</span><span class="sxs-lookup"><span data-stu-id="ac334-110">The client uses <xref:System.Activities.WorkflowInvoker> to simulate posting various requests to the queue.</span></span> <span data-ttu-id="ac334-111">Para mandar por correo un mensaje a la cola en una transacción, la actividad <xref:System.ServiceModel.Activities.Send> se puede colocar dentro de la propiedad <xref:System.Activities.Statements.TransactionScope.Body%2A> de un objeto <xref:System.Activities.Statements.TransactionScope>.</span><span class="sxs-lookup"><span data-stu-id="ac334-111">To post a message to the queue under a transaction, the <xref:System.ServiceModel.Activities.Send> activity can be placed inside the <xref:System.Activities.Statements.TransactionScope.Body%2A> of a <xref:System.Activities.Statements.TransactionScope>.</span></span> <span data-ttu-id="ac334-112">En este ejemplo, el cliente se ejecuta primero, seguido del servidor, para mostrar cómo los mensajes en cola pueden desacoplar las aplicaciones servidor y cliente.</span><span class="sxs-lookup"><span data-stu-id="ac334-112">In this sample, the client runs first, followed by the server, to demonstrate how queued messages can decouple the client and server applications.</span></span>  
  
 <span data-ttu-id="ac334-113">Cuando el cliente se completa, el servicio se configura y se hospeda.</span><span class="sxs-lookup"><span data-stu-id="ac334-113">Once the client completes, the service is configured and hosted.</span></span> <span data-ttu-id="ac334-114">En cuanto se abre, comienza el proceso de los mensajes que ya se han colocado en la cola.</span><span class="sxs-lookup"><span data-stu-id="ac334-114">As soon as it opens, it starts processing the messages that have already been placed in the queue.</span></span> <span data-ttu-id="ac334-115">Cada mensaje se recibe y se procesa bajo la misma transacción del servidor.</span><span class="sxs-lookup"><span data-stu-id="ac334-115">Each message is received and processed under the same server transaction.</span></span> <span data-ttu-id="ac334-116">En este ejemplo, el primer mensaje recibido es una solicitud `CreateAccount` que crea la instancia e inicializa la correlación de contenidos en función del nombre de cuenta pasado como parte del mensaje de solicitud.</span><span class="sxs-lookup"><span data-stu-id="ac334-116">In this sample, the first message received is a `CreateAccount` request that creates the instance and initializes the content correlation based on the account name passed as part of the request message.</span></span> <span data-ttu-id="ac334-117">Para modelar el tipo de servicio que se podría esperar en el mundo real, estas dos actividades <xref:System.ServiceModel.Activities.TransactedReceiveScope> que procesan los mensajes `AddPoints` y `UsePoints` se colocan en bifurcaciones paralelas dentro de un bucle `while` para que puedan procesar repetidamente estos mensajes en cualquier orden.</span><span class="sxs-lookup"><span data-stu-id="ac334-117">To model the kind of service you might expect in the real world, the following two <xref:System.ServiceModel.Activities.TransactedReceiveScope> activities that process the `AddPoints` and `UsePoints` messages are placed in parallel branches within a `while` loop so that they can process these messages repeatedly in any order.</span></span>  
  
 <span data-ttu-id="ac334-118">Tanto el objeto <xref:System.Activities.Statements.TransactionScope> como <xref:System.ServiceModel.Activities.TransactedReceiveScope> tienen un punto de persistencia implícito al final de sus ámbitos, por lo que el uso de estas actividades en [!INCLUDE[wf1](../../../../includes/wf1-md.md)] combinadas con colas es una manera fiable de mover el flujo de trabajo desde un estado coherente al siguiente y asegurarse al mismo tiempo de que nunca se pierdan los mensajes.</span><span class="sxs-lookup"><span data-stu-id="ac334-118"><xref:System.Activities.Statements.TransactionScope> and <xref:System.ServiceModel.Activities.TransactedReceiveScope> each have an implicit persistence point at the end of their scopes, so using these activities in [!INCLUDE[wf1](../../../../includes/wf1-md.md)] combined with queues is a reliable way to move your workflow from one consistent state to the next, while ensuring that messages are never lost.</span></span>  
  
#### <a name="to-set-up-build-and-run-the-sample"></a><span data-ttu-id="ac334-119">Configurar, compilar y ejecutar el ejemplo</span><span class="sxs-lookup"><span data-stu-id="ac334-119">To set up, build, and run the sample</span></span>  
  
1.  <span data-ttu-id="ac334-120">Instale y configure MSMQ.</span><span class="sxs-lookup"><span data-stu-id="ac334-120">Install and configure MSMQ.</span></span> <span data-ttu-id="ac334-121">Vea [instalar Message Queue Server](http://go.microsoft.com/fwlink/?LinkId=178526) para obtener más información.</span><span class="sxs-lookup"><span data-stu-id="ac334-121">See [Installing Message Queuing](http://go.microsoft.com/fwlink/?LinkId=178526) for details.</span></span>  
  
2.  <span data-ttu-id="ac334-122">Ejecute el comando siguiente en una línea de comandos para asegurarse de que MSDTC se está ejecutando.</span><span class="sxs-lookup"><span data-stu-id="ac334-122">Ensure that MSDTC is running by executing the following command on a command line.</span></span> `net start msdtc`  
  
3.  <span data-ttu-id="ac334-123">Compile el proyecto y abra la aplicación ejecutable o el proyecto en [!INCLUDE[vs2010](../../../../includes/vs2010-md.md)] y seleccione una opción de inicio en el menú de depuración.</span><span class="sxs-lookup"><span data-stu-id="ac334-123">Compile the project and open the executable, or open the project in [!INCLUDE[vs2010](../../../../includes/vs2010-md.md)] and select a start option from the debug menu.</span></span> <span data-ttu-id="ac334-124">Primero, se crea la cola; a continuación, el cliente se ejecuta y envía mensajes a la cola y, finalmente, el servicio se inicia y se procesan los mensajes.</span><span class="sxs-lookup"><span data-stu-id="ac334-124">First, the queue is created, then the client runs and posts messages to the queue, and finally the service starts and the messages are processed.</span></span> <span data-ttu-id="ac334-125">Para salir del programa, presione Entrar.</span><span class="sxs-lookup"><span data-stu-id="ac334-125">To exit the program, press ENTER.</span></span>  
  
> [!IMPORTANT]
>  <span data-ttu-id="ac334-126">Puede que los ejemplos ya estén instalados en su equipo.</span><span class="sxs-lookup"><span data-stu-id="ac334-126">The samples may already be installed on your machine.</span></span> <span data-ttu-id="ac334-127">Compruebe el siguiente directorio (predeterminado) antes de continuar.</span><span class="sxs-lookup"><span data-stu-id="ac334-127">Check for the following (default) directory before continuing.</span></span>  
>   
>  `<InstallDrive>:\WF_WCF_Samples`  
>   
>  <span data-ttu-id="ac334-128">Si no existe este directorio, vaya a la página [Windows Communication Foundation (WCF) and Windows Workflow Foundation (WF) Samples for .NET Framework 4](http://go.microsoft.com/fwlink/?LinkId=150780) [Ejemplos de Windows Communication Foundation (WCF) y Windows Workflow Foundation (WF) para .NET Framework 4] para descargar todos los ejemplos de [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)] y [!INCLUDE[wf1](../../../../includes/wf1-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="ac334-128">If this directory does not exist, go to [Windows Communication Foundation (WCF) and Windows Workflow Foundation (WF) Samples for .NET Framework 4](http://go.microsoft.com/fwlink/?LinkId=150780) to download all [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)] and [!INCLUDE[wf1](../../../../includes/wf1-md.md)] samples.</span></span> <span data-ttu-id="ac334-129">Este ejemplo se encuentra en el siguiente directorio.</span><span class="sxs-lookup"><span data-stu-id="ac334-129">This sample is located in the following directory.</span></span>  
>   
>  `<InstallDrive>:\WF_WCF_Samples\WF\Scenario\Transactions\TransactedQueues`
