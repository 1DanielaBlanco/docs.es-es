---
title: "Suprimir el ámbito de transacción"
ms.custom: 
ms.date: 03/30/2017
ms.prod: .net-framework
ms.reviewer: 
ms.suite: 
ms.tgt_pltfrm: 
ms.topic: article
ms.assetid: 49fb6dd4-30d4-4067-925c-c5de44c8c740
caps.latest.revision: "8"
author: dotnet-bot
ms.author: dotnetcontent
manager: wpickett
ms.workload: dotnet
ms.openlocfilehash: 6fe13a8aae93548eedac2647e2429d66121377aa
ms.sourcegitcommit: 16186c34a957fdd52e5db7294f291f7530ac9d24
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 12/22/2017
---
# <a name="suppress-transaction-scope"></a><span data-ttu-id="340fb-102">Suprimir el ámbito de transacción</span><span class="sxs-lookup"><span data-stu-id="340fb-102">Suppress Transaction Scope</span></span>
<span data-ttu-id="340fb-103">El ejemplo muestra cómo crear una actividad `SuppressTransactionScope` personalizada para suprimir la transacción en tiempo de ejecución ambiente, si está presente.</span><span class="sxs-lookup"><span data-stu-id="340fb-103">The sample demonstrates how to author a custom `SuppressTransactionScope` activity to suppress the ambient run-time transaction, if present.</span></span>  
  
> [!IMPORTANT]
>  <span data-ttu-id="340fb-104">Puede que los ejemplos ya estén instalados en su equipo.</span><span class="sxs-lookup"><span data-stu-id="340fb-104">The samples may already be installed on your machine.</span></span> <span data-ttu-id="340fb-105">Compruebe el siguiente directorio (predeterminado) antes de continuar.</span><span class="sxs-lookup"><span data-stu-id="340fb-105">Check for the following (default) directory before continuing.</span></span>  
>   
>  `<InstallDrive>:\WF_WCF_Samples`  
>   
>  <span data-ttu-id="340fb-106">Si no existe este directorio, vaya a la página [Windows Communication Foundation (WCF) and Windows Workflow Foundation (WF) Samples for .NET Framework 4](http://go.microsoft.com/fwlink/?LinkId=150780) [Ejemplos de Windows Communication Foundation (WCF) y Windows Workflow Foundation (WF) para .NET Framework 4] para descargar todos los ejemplos de [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)] y [!INCLUDE[wf1](../../../../includes/wf1-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="340fb-106">If this directory does not exist, go to [Windows Communication Foundation (WCF) and Windows Workflow Foundation (WF) Samples for .NET Framework 4](http://go.microsoft.com/fwlink/?LinkId=150780) to download all [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)] and [!INCLUDE[wf1](../../../../includes/wf1-md.md)] samples.</span></span> <span data-ttu-id="340fb-107">Este ejemplo se encuentra en el siguiente directorio.</span><span class="sxs-lookup"><span data-stu-id="340fb-107">This sample is located in the following directory.</span></span>  
>   
>  `<InstallDrive>:\WF_WCF_Samples\WF\Scenario\Transactions\SuppressTransactionScope`  
  
## <a name="sample-details"></a><span data-ttu-id="340fb-108">Detalles del ejemplo</span><span class="sxs-lookup"><span data-stu-id="340fb-108">Sample Details</span></span>  
 <span data-ttu-id="340fb-109">La actividad personalizada es útil para evitar el flujo de una transacción a otro servicio si el flujo de la transacción no resulta deseable para el escenario determinado.</span><span class="sxs-lookup"><span data-stu-id="340fb-109">The custom activity is useful to prevent a transaction from being flowed out to another service if transaction flow is undesirable for the particular scenario.</span></span> <span data-ttu-id="340fb-110">El tiempo de ejecución de flujo de trabajo dispone de compatibilidad integrada para suprimir la transacción ambiente en la clase <xref:System.Activities.NativeActivity>, pero para utilizar esta compatibilidad es necesario crear una clase <xref:System.Activities.NativeActivity> personalizada como la de este ejemplo.</span><span class="sxs-lookup"><span data-stu-id="340fb-110">The workflow runtime has built-in support for suppressing the ambient transaction in the <xref:System.Activities.NativeActivity> class, but to use this support it is necessary to author a custom <xref:System.Activities.NativeActivity> such as the one in this sample.</span></span>  
  
 <span data-ttu-id="340fb-111">El escenario consta de tres partes.</span><span class="sxs-lookup"><span data-stu-id="340fb-111">The scenario consists of three parts.</span></span> <span data-ttu-id="340fb-112">Primero, una clase <xref:System.Activities.Statements.TransactionScope> crea una transacción en tiempo de ejecución que se convierte en transacción ambiente.</span><span class="sxs-lookup"><span data-stu-id="340fb-112">First, a <xref:System.Activities.Statements.TransactionScope> creates a run-time transaction that becomes ambient.</span></span> <span data-ttu-id="340fb-113">Esto se comprueba mediante una actividad personalizada que imprime los identificadores local y distribuido de la transacción.</span><span class="sxs-lookup"><span data-stu-id="340fb-113">This is verified by a custom activity that prints the local and distributed identifiers of the transaction.</span></span> <span data-ttu-id="340fb-114">A continuación, la transacción fluye a un servicio remoto antes de comenzar la segunda parte.</span><span class="sxs-lookup"><span data-stu-id="340fb-114">The transaction is then flowed to a remote service before beginning the second part.</span></span> <span data-ttu-id="340fb-115">Durante la segunda parte, el flujo de trabajo entra en una actividad `SuppressTransactionScope` y de nuevo repite el proceso de imprimir los identificadores de transacción y hacer fluir la transacción.</span><span class="sxs-lookup"><span data-stu-id="340fb-115">During the second part, the workflow enters a `SuppressTransactionScope` and again repeats the process of printing the transaction identifiers and flowing the transaction.</span></span> <span data-ttu-id="340fb-116">Sin embargo, la actividad personalizada no encuentra una transacción ambiente y el mensaje que fluyó al servicio no contiene la transacción.</span><span class="sxs-lookup"><span data-stu-id="340fb-116">However, the custom activity does not find an ambient transaction and the message flowed to the service does not contain the transaction.</span></span> <span data-ttu-id="340fb-117">Como resultado, el servicio crea una transacción, lo que significa que el identificador distribuido impreso en el cliente y el servicio no coinciden.</span><span class="sxs-lookup"><span data-stu-id="340fb-117">As a result, the service creates a transaction, which means the distributed ID printed on the client and service do not match.</span></span> <span data-ttu-id="340fb-118">La parte final se produce después de salir de `SuppressTransactionScope` cuando la transacción en tiempo de ejecución se convierte en transacción ambiente tal como lo comprueba otro mensaje al servicio con un identificador distribuido que coincide con el identificador del primer mensaje.</span><span class="sxs-lookup"><span data-stu-id="340fb-118">The final part occurs after the `SuppressTransactionScope` exits and the run-time transaction again becomes ambient as verified by another message to the service with a distributed identifier that matches the identifier of the first message.</span></span>  
  
 <span data-ttu-id="340fb-119">La propia actividad deriva de <xref:System.Activities.NativeActivity> porque debe programar una actividad secundaria y agregar una propiedad de ejecución.</span><span class="sxs-lookup"><span data-stu-id="340fb-119">The activity itself derives from <xref:System.Activities.NativeActivity> because it must schedule a child activity and add an execution property.</span></span> <span data-ttu-id="340fb-120">La actividad `SuppressTransactionScope` tiene una clase <xref:System.Activities.Variable> de tipo <xref:System.Activities.RuntimeTransactionHandle>, que se debe utilizar en lugar de un campo de instancia de tipo <xref:System.Activities.RuntimeTransactionHandle> porque se debe inicializar el controlador.</span><span class="sxs-lookup"><span data-stu-id="340fb-120">The `SuppressTransactionScope` has a <xref:System.Activities.Variable> of type <xref:System.Activities.RuntimeTransactionHandle>, which must be used rather than an instance field of type <xref:System.Activities.RuntimeTransactionHandle> because the handle must be initialized.</span></span> <span data-ttu-id="340fb-121">`Variable<RuntimeTransactionHandle>` se agrega a los metadatos de la actividad como una variable de implementación porque solo se utiliza internamente.</span><span class="sxs-lookup"><span data-stu-id="340fb-121">The `Variable<RuntimeTransactionHandle>` is added to the activity’s metadata as an implementation variable because it is only used internally.</span></span>  
  
 <span data-ttu-id="340fb-122">Cuando se ejecuta la actividad, en primer lugar comprueba si se especificó un cuerpo y en ese caso, establece la propiedad `SuppressTransaction` de la clase <xref:System.Activities.RuntimeTransactionHandle>.</span><span class="sxs-lookup"><span data-stu-id="340fb-122">When the activity is executed it first checks to see whether a body was specified and if so, sets the `SuppressTransaction` property on the <xref:System.Activities.RuntimeTransactionHandle>.</span></span> <span data-ttu-id="340fb-123">Una vez establecida la propiedad, se agrega a las propiedades de ejecución y se convierte en ambiente.</span><span class="sxs-lookup"><span data-stu-id="340fb-123">Once the property is set, it is added to the execution properties and becomes ambient.</span></span> <span data-ttu-id="340fb-124">Esto significa que cualquier actividad que sea un elemento secundario de `SuppressTransactionScope` puede ver la propiedad y por consiguiente exige la supresión de la transacción en tiempo de ejecución y hace que una clase <xref:System.Activities.Statements.TransactionScope> anidada produzca una excepción.</span><span class="sxs-lookup"><span data-stu-id="340fb-124">This means that any activity that is a child of the `SuppressTransactionScope` is able to see the property and therefore enforces the suppression of the run-time transaction and causes a nested <xref:System.Activities.Statements.TransactionScope> to throw an exception.</span></span> <span data-ttu-id="340fb-125">Una vez agregado el controlador a las propiedades de ejecución, se programa la ejecución del cuerpo.</span><span class="sxs-lookup"><span data-stu-id="340fb-125">Once the handle is added to the execution properties the body is scheduled to run.</span></span>  
  
#### <a name="to-use-this-sample"></a><span data-ttu-id="340fb-126">Para utilizar este ejemplo</span><span class="sxs-lookup"><span data-stu-id="340fb-126">To use this sample</span></span>  
  
1.  <span data-ttu-id="340fb-127">Abra la solución SuppressTransactionScope.sln en [!INCLUDE[vs2010](../../../../includes/vs2010-md.md)].</span><span class="sxs-lookup"><span data-stu-id="340fb-127">Open the SuppressTransactionScope.sln solution in [!INCLUDE[vs2010](../../../../includes/vs2010-md.md)].</span></span>  
  
2.  <span data-ttu-id="340fb-128">Para compilar la solución, presione CTRL + MAYÚS + B o seleccione **generar solución** desde el **generar** menú.</span><span class="sxs-lookup"><span data-stu-id="340fb-128">To build the solution, press CTRL+SHIFT+B or select **Build Solution** from the **Build** menu.</span></span>  
  
3.  <span data-ttu-id="340fb-129">Una vez que la compilación finalice correctamente, haga clic en la solución y seleccione **Establecer proyectos de inicio**.</span><span class="sxs-lookup"><span data-stu-id="340fb-129">Once the build has succeeded, right-click the solution and select **Set Startup Projects**.</span></span> <span data-ttu-id="340fb-130">En el cuadro de diálogo, seleccione **proyectos de inicio múltiples** y asegúrese de que la acción para ambos proyectos es **iniciar**.</span><span class="sxs-lookup"><span data-stu-id="340fb-130">From the dialog, select **Multiple Startup Projects** and ensure the action for both projects is **Start**.</span></span>  
  
4.  <span data-ttu-id="340fb-131">Presione F5 o seleccione **Iniciar depuración** desde el **depurar** menú.</span><span class="sxs-lookup"><span data-stu-id="340fb-131">Press F5 or select **Start Debugging** from the **Debug** menu.</span></span> <span data-ttu-id="340fb-132">Como alternativa, puede presionar CTRL + F5 o seleccione **iniciar sin depurar** desde el **depurar** menú para ejecutarlo sin depuración.</span><span class="sxs-lookup"><span data-stu-id="340fb-132">Alternatively, you can press CTRL+F5 or select **Start Without Debugging** from the **Debug** menu to run without debugging.</span></span>  
  
    > [!NOTE]
    >  <span data-ttu-id="340fb-133">El servidor debe estar en ejecución antes de iniciar el cliente.</span><span class="sxs-lookup"><span data-stu-id="340fb-133">The server must be running prior to starting the client.</span></span> <span data-ttu-id="340fb-134">El resultado de la ventana de la consola que hospeda el servicio indica cuándo se ha iniciado.</span><span class="sxs-lookup"><span data-stu-id="340fb-134">The output from the console window that hosts the service indicates when it has started.</span></span>  
  
> [!IMPORTANT]
>  <span data-ttu-id="340fb-135">Puede que los ejemplos ya estén instalados en su equipo.</span><span class="sxs-lookup"><span data-stu-id="340fb-135">The samples may already be installed on your machine.</span></span> <span data-ttu-id="340fb-136">Compruebe el siguiente directorio (predeterminado) antes de continuar.</span><span class="sxs-lookup"><span data-stu-id="340fb-136">Check for the following (default) directory before continuing.</span></span>  
>   
>  `<InstallDrive>:\WF_WCF_Samples`  
>   
>  <span data-ttu-id="340fb-137">Si no existe este directorio, vaya a la página [Windows Communication Foundation (WCF) and Windows Workflow Foundation (WF) Samples for .NET Framework 4](http://go.microsoft.com/fwlink/?LinkId=150780) [Ejemplos de Windows Communication Foundation (WCF) y Windows Workflow Foundation (WF) para .NET Framework 4] para descargar todos los ejemplos de [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)] y [!INCLUDE[wf1](../../../../includes/wf1-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="340fb-137">If this directory does not exist, go to [Windows Communication Foundation (WCF) and Windows Workflow Foundation (WF) Samples for .NET Framework 4](http://go.microsoft.com/fwlink/?LinkId=150780) to download all [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)] and [!INCLUDE[wf1](../../../../includes/wf1-md.md)] samples.</span></span> <span data-ttu-id="340fb-138">Este ejemplo se encuentra en el siguiente directorio.</span><span class="sxs-lookup"><span data-stu-id="340fb-138">This sample is located in the following directory.</span></span>  
>   
>  `<InstallDrive>:\WF_WCF_Samples\WF\Scenario\Transactions\SuppressTransactionScope`