---
title: "Ejemplo de proxy de detección"
ms.custom: 
ms.date: 03/30/2017
ms.prod: .net-framework
ms.reviewer: 
ms.suite: 
ms.technology: dotnet-clr
ms.tgt_pltfrm: 
ms.topic: article
ms.assetid: 1dfa02df-15b1-4e97-9c8e-f5f2772711b0
caps.latest.revision: "14"
author: Erikre
ms.author: erikre
manager: erikre
ms.openlocfilehash: f16cf2ffc9e03308ce3b8a5e967c29e624ffd1af
ms.sourcegitcommit: bd1ef61f4bb794b25383d3d72e71041a5ced172e
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 10/18/2017
---
# <a name="discovery-proxy-sample"></a><span data-ttu-id="f7180-102">Ejemplo de proxy de detección</span><span class="sxs-lookup"><span data-stu-id="f7180-102">Discovery Proxy Sample</span></span>
<span data-ttu-id="f7180-103">En este ejemplo se muestra cómo crear una implementación de un proxy de detección para almacenar información acerca de los servicios existentes y el modo en que los clientes pueden consultar información en ese proxy.</span><span class="sxs-lookup"><span data-stu-id="f7180-103">This sample shows how to create an implementation of a Discovery proxy to store information about existing services and how clients can query that proxy for information.</span></span> <span data-ttu-id="f7180-104">Este ejemplo consta de tres proyectos:</span><span class="sxs-lookup"><span data-stu-id="f7180-104">This sample consists of three projects:</span></span>  
  
-   <span data-ttu-id="f7180-105">**Servicio**: un sencillo [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)] servicio de calculadora que se registra con el proxy de detección.</span><span class="sxs-lookup"><span data-stu-id="f7180-105">**Service**: A simple [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)] calculator service that registers itself with the discovery proxy.</span></span>  
  
-   <span data-ttu-id="f7180-106">**Proxy de detección**: la implementación de un servicio de proxy de detección.</span><span class="sxs-lookup"><span data-stu-id="f7180-106">**Discovery Proxy**: The implementation of a discovery proxy service.</span></span>  
  
-   <span data-ttu-id="f7180-107">**Cliente**: aplicación de cliente de WCF que requiere el proxy de detección para buscar servicios.</span><span class="sxs-lookup"><span data-stu-id="f7180-107">**Client**: A WCF client application that calls the discovery proxy to search for services.</span></span>  
  
## <a name="demonstrates"></a><span data-ttu-id="f7180-108">Demostraciones</span><span class="sxs-lookup"><span data-stu-id="f7180-108">Demonstrates</span></span>  
 <span data-ttu-id="f7180-109">Implementación de un proxy de detección</span><span class="sxs-lookup"><span data-stu-id="f7180-109">Discovery proxy implementation</span></span>  
  
> [!IMPORTANT]
>  <span data-ttu-id="f7180-110">Puede que los ejemplos ya estén instalados en su equipo.</span><span class="sxs-lookup"><span data-stu-id="f7180-110">The samples may already be installed on your machine.</span></span> <span data-ttu-id="f7180-111">Compruebe el siguiente directorio (predeterminado) antes de continuar.</span><span class="sxs-lookup"><span data-stu-id="f7180-111">Check for the following (default) directory before continuing.</span></span>  
>   
>  `<InstallDrive>:\WF_WCF_Samples`  
>   
>  <span data-ttu-id="f7180-112">Si no existe este directorio, vaya a la página [Windows Communication Foundation (WCF) and Windows Workflow Foundation (WF) Samples for .NET Framework 4](http://go.microsoft.com/fwlink/?LinkId=150780) [Ejemplos de Windows Communication Foundation (WCF) y Windows Workflow Foundation (WF) para .NET Framework 4] para descargar todos los ejemplos de [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)] y [!INCLUDE[wf1](../../../../includes/wf1-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="f7180-112">If this directory does not exist, go to [Windows Communication Foundation (WCF) and Windows Workflow Foundation (WF) Samples for .NET Framework 4](http://go.microsoft.com/fwlink/?LinkId=150780) to download all [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)] and [!INCLUDE[wf1](../../../../includes/wf1-md.md)] samples.</span></span> <span data-ttu-id="f7180-113">Este ejemplo se encuentra en el siguiente directorio.</span><span class="sxs-lookup"><span data-stu-id="f7180-113">This sample is located in the following directory.</span></span>  
>   
>  `<InstallDrive>:\WF_WCF_Samples\WCF\Basic\Discovery\DiscoveryProxy`  
  
## <a name="discoveryproxy"></a><span data-ttu-id="f7180-114">DiscoveryProxy</span><span class="sxs-lookup"><span data-stu-id="f7180-114">DiscoveryProxy</span></span>  
 <span data-ttu-id="f7180-115">En el método `Main` del archivo Program.cs, el ejemplo muestra cómo se hospeda un servicio de tipo <xref:System.ServiceModel.Discovery.DiscoveryProxy>.</span><span class="sxs-lookup"><span data-stu-id="f7180-115">In the `Main` method of the Program.cs file, the sample shows how a service of type <xref:System.ServiceModel.Discovery.DiscoveryProxy> is hosted.</span></span> <span data-ttu-id="f7180-116">Expone dos extremos, uno de tipo <xref:System.ServiceModel.Discovery.DiscoveryEndpoint> y otro de tipo <xref:System.ServiceModel.Discovery.AnnouncementEndpoint>.</span><span class="sxs-lookup"><span data-stu-id="f7180-116">It exposes two endpoints, one of type <xref:System.ServiceModel.Discovery.DiscoveryEndpoint> and another of type <xref:System.ServiceModel.Discovery.AnnouncementEndpoint>.</span></span> <span data-ttu-id="f7180-117">Ambos utilizan TCP como transporte.</span><span class="sxs-lookup"><span data-stu-id="f7180-117">Both of the endpoints use TCP as a transport.</span></span> <span data-ttu-id="f7180-118"><xref:System.ServiceModel.Discovery.DiscoveryEndpoint> está realizando escuchas en el URI especificado por el parámetro `probeEndpointAddress`, que es donde los clientes pueden enviar mensajes de sondeo que consulten sus datos en el proxy.</span><span class="sxs-lookup"><span data-stu-id="f7180-118">The <xref:System.ServiceModel.Discovery.DiscoveryEndpoint> is listening at the URI specified by the `probeEndpointAddress` parameter, this is where clients can send probe messages to query the proxy for its data.</span></span> <span data-ttu-id="f7180-119"><xref:System.ServiceModel.Discovery.AnnouncementEndpoint> está realizando escuchas en el URI especificado por el parámetro `announcementEndpointAddress`.</span><span class="sxs-lookup"><span data-stu-id="f7180-119">The <xref:System.ServiceModel.Discovery.AnnouncementEndpoint> is listening at the URI specified by the `announcementEndpointAddress` parameter.</span></span> <span data-ttu-id="f7180-120">Se trata del lugar donde el proxy escucha los anuncios.</span><span class="sxs-lookup"><span data-stu-id="f7180-120">This is where the proxy listens to for announcements.</span></span> <span data-ttu-id="f7180-121">Cuando se recibe un anuncio en línea, el proxy agrega el servicio a su memoria caché y, cuando se recibe un anuncio sin conexión, quita el servicio de su memoria caché.</span><span class="sxs-lookup"><span data-stu-id="f7180-121">When an online announcement is received, the proxy adds the service to its cache and when an offline announcement is received it removes the service from its cache.</span></span>  
  
 <span data-ttu-id="f7180-122">DiscoveryProxy.cs contiene la implementación de <xref:System.ServiceModel.Discovery.DiscoveryProxy>.</span><span class="sxs-lookup"><span data-stu-id="f7180-122">The DiscoveryProxy.cs contains the implementation of the <xref:System.ServiceModel.Discovery.DiscoveryProxy>.</span></span> <span data-ttu-id="f7180-123">El proxy debe heredar de la clase <xref:System.Object> y requiere una implementación de <xref:System.Runtime.Remoting.Messaging.AsyncResult>.</span><span class="sxs-lookup"><span data-stu-id="f7180-123">The Proxy must inherit from the <xref:System.Object> class and requires an implementation of <xref:System.Runtime.Remoting.Messaging.AsyncResult>.</span></span> <span data-ttu-id="f7180-124">En la creación de instancias, el proxy crea un nuevo <xref:System.Collections.Generic.Dictionary%602>, que utiliza para almacenar los elementos que conoce.</span><span class="sxs-lookup"><span data-stu-id="f7180-124">At instantiation, the Proxy creates a new <xref:System.Collections.Generic.Dictionary%602>, which it uses to store elements it knows about.</span></span>  
  
 <span data-ttu-id="f7180-125">El archivo está dividido en dos regiones, Métodos de caché de proxy e Implementación de proxy de detección.</span><span class="sxs-lookup"><span data-stu-id="f7180-125">The file is divided into two regions, Proxy Cache Methods and Discovery Proxy Implementation.</span></span> <span data-ttu-id="f7180-126">La región Métodos de caché de proxy contiene los métodos utilizados para actualizar <xref:System.Collections.Generic.Dictionary%602>, realizar consultas a <xref:System.Collections.Generic.Dictionary%602> e imprimir datos de los usuarios.</span><span class="sxs-lookup"><span data-stu-id="f7180-126">The Proxy Cache Methods region contains methods used to update the <xref:System.Collections.Generic.Dictionary%602>, perform queries against the <xref:System.Collections.Generic.Dictionary%602>, and print the data for users.</span></span> <span data-ttu-id="f7180-127">La región Implementación de proxy de detección contiene los métodos invalidados requeridos para la funcionalidad de Anuncio y sondeo.</span><span class="sxs-lookup"><span data-stu-id="f7180-127">The Discovery Proxy Implementation region contains the overridden methods required for the Announcement and Probe functionality.</span></span> <span data-ttu-id="f7180-128">Definen las acciones realizadas por un proxy tras recibir un anuncio en línea, un anuncio sin conexión o un mensaje de sondeo.</span><span class="sxs-lookup"><span data-stu-id="f7180-128">They define the actions taken by a proxy after receiving an Online Announcement, an Offline Announcement, or a Probe message.</span></span>  
  
## <a name="service"></a><span data-ttu-id="f7180-129">Servicio</span><span class="sxs-lookup"><span data-stu-id="f7180-129">Service</span></span>  
 <span data-ttu-id="f7180-130">En el archivo Program.cs en el proyecto de servicio, se utiliza el mismo URI para su extremo de anuncio y para el proxy de detección.</span><span class="sxs-lookup"><span data-stu-id="f7180-130">In the Program.cs file in the Service project, the same URI is used for its announcement endpoint as the discovery proxy.</span></span> <span data-ttu-id="f7180-131">Esto se debe a que el servicio utiliza el extremo para enviar los anuncios, mientras que el proxy lo utiliza para recibirlos.</span><span class="sxs-lookup"><span data-stu-id="f7180-131">This is because service uses the endpoint for sending the announcements, while the proxy uses it for receiving them.</span></span> <span data-ttu-id="f7180-132">El servicio utiliza el <xref:System.ServiceModel.Discovery.EndpointDiscoveryBehavior> y le agrega un extremo de anuncio.</span><span class="sxs-lookup"><span data-stu-id="f7180-132">The service uses the <xref:System.ServiceModel.Discovery.EndpointDiscoveryBehavior> and adds an announcement endpoint to it.</span></span>  
  
## <a name="client"></a><span data-ttu-id="f7180-133">Cliente</span><span class="sxs-lookup"><span data-stu-id="f7180-133">Client</span></span>  
 <span data-ttu-id="f7180-134">El proyecto Cliente utiliza el mismo URI para su extremo de sondeo que el proxy.</span><span class="sxs-lookup"><span data-stu-id="f7180-134">The Client project uses the same URI for its probe endpoint as the Proxy.</span></span> <span data-ttu-id="f7180-135">Esto se debe a que los sondeos en este escenario también se difunden específicamente al extremo disponible en el proxy.</span><span class="sxs-lookup"><span data-stu-id="f7180-135">This is because the probes in this scenario are also being unicast specifically to the endpoint available on the proxy.</span></span> <span data-ttu-id="f7180-136">El cliente se conecta a esta dirección conocida y, a continuación, consulta el servicio.</span><span class="sxs-lookup"><span data-stu-id="f7180-136">The Client connects to this well-known address and then queries it for the service.</span></span> <span data-ttu-id="f7180-137">Una vez ha encontrado el servicio, se conecta a él.</span><span class="sxs-lookup"><span data-stu-id="f7180-137">Once it has found the service it connects to it.</span></span>  
  
#### <a name="to-use-this-sample"></a><span data-ttu-id="f7180-138">Para utilizar este ejemplo</span><span class="sxs-lookup"><span data-stu-id="f7180-138">To use this sample</span></span>  
  
1.  <span data-ttu-id="f7180-139">Cargue la solución de proyecto en [!INCLUDE[vs_current_long](../../../../includes/vs-current-long-md.md)] y compile el proyecto.</span><span class="sxs-lookup"><span data-stu-id="f7180-139">Load the project solution in [!INCLUDE[vs_current_long](../../../../includes/vs-current-long-md.md)] and build the project.</span></span>  
  
2.  <span data-ttu-id="f7180-140">Primero, ejecute la aplicación de proxy de detección, generada en [directorio base de la solución]\DiscoveryProxy\bin\debug.</span><span class="sxs-lookup"><span data-stu-id="f7180-140">First run the Discovery Proxy application, generated in [solution base directory]\DiscoveryProxy\bin\debug.</span></span> <span data-ttu-id="f7180-141">El proxy de detección se debe ejecutar primero porque los extremos de anuncio de TCP deben estar activos para que el servicio envíe sus anuncios.</span><span class="sxs-lookup"><span data-stu-id="f7180-141">The Discovery Proxy must run first because TCP announcement endpoints must be up for the service to send its announcements.</span></span>  
  
3.  <span data-ttu-id="f7180-142">En segundo lugar, ejecute la aplicación de servicio generada en [directorio base de la solución] \Service\bin\debug.</span><span class="sxs-lookup"><span data-stu-id="f7180-142">Second, run the service application generated in [solution base directory]\Service\bin\debug.</span></span> <span data-ttu-id="f7180-143">Al iniciarse, el servicio envía un anuncio al extremo de anuncio del proxy de detección y se registra en la memoria caché del proxy.</span><span class="sxs-lookup"><span data-stu-id="f7180-143">At start-up, the service sends an announcement to the announcement endpoint of the discovery proxy and is registered in the proxy’s cache.</span></span>  
  
4.  <span data-ttu-id="f7180-144">Después, ejecute la aplicación cliente, generada en [directorio base de la solución]\Client\bin\debug.</span><span class="sxs-lookup"><span data-stu-id="f7180-144">Next, run the client application, generated in [solution base directory]\Client\bin\debug.</span></span> <span data-ttu-id="f7180-145">El cliente consulta el proxy, obtiene la dirección de servicio y, a continuación, se conecta al servicio.</span><span class="sxs-lookup"><span data-stu-id="f7180-145">The client queries the proxy, gets the service address and then connects to the service.</span></span>  
  
5.  <span data-ttu-id="f7180-146">Por último, termine el cliente, el servicio y, a continuación, el proxy.</span><span class="sxs-lookup"><span data-stu-id="f7180-146">Lastly, terminate the client, service and then the proxy.</span></span> <span data-ttu-id="f7180-147">El proxy se debe estar ejecutando para que reciba el anuncio sin conexión del servicio.</span><span class="sxs-lookup"><span data-stu-id="f7180-147">The proxy must be running for it to receive the service's offline announcement.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="f7180-148">Vea también</span><span class="sxs-lookup"><span data-stu-id="f7180-148">See Also</span></span>
