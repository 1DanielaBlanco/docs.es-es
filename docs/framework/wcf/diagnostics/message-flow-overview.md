---
title: "Información general del flujo de mensajes"
ms.custom: 
ms.date: 03/30/2017
ms.prod: .net-framework
ms.reviewer: 
ms.suite: 
ms.technology: dotnet-clr
ms.tgt_pltfrm: 
ms.topic: article
ms.assetid: fb0899e1-84cc-4d90-b45b-dc5a50063943
caps.latest.revision: "8"
author: Erikre
ms.author: erikre
manager: erikre
ms.openlocfilehash: cbee0c387c4519858426a062d927ebffe9513c0c
ms.sourcegitcommit: bd1ef61f4bb794b25383d3d72e71041a5ced172e
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 10/18/2017
---
# <a name="message-flow-overview"></a><span data-ttu-id="61d68-102">Información general del flujo de mensajes</span><span class="sxs-lookup"><span data-stu-id="61d68-102">Message Flow Overview</span></span>
<span data-ttu-id="61d68-103">En un sistema distribuido que contiene servicios interconectados es necesario determinar las relaciones causales entre los servicios.</span><span class="sxs-lookup"><span data-stu-id="61d68-103">In a distributed system containing interconnected services, it is necessary to determine causal relationships between the services.</span></span> <span data-ttu-id="61d68-104">Es importante conocer los distintos componentes que formaron parte de un flujo de solicitud para admitir escenarios críticos, como los de supervisión de estado, solución de problemas y análisis de la causa raíz.</span><span class="sxs-lookup"><span data-stu-id="61d68-104">It is important to understand the various components that were part of a request flow to support critical scenarios such as health monitoring, troubleshooting, and root cause analysis.</span></span> <span data-ttu-id="61d68-105">Para habilitar la correlación de seguimientos entre varios servicios, en .NET Framework 4 agregamos compatibilidad a través de las siguientes características:</span><span class="sxs-lookup"><span data-stu-id="61d68-105">To enable the correlation of traces between various services, in the .NET Framework 4 we added support through the following features:</span></span>  
  
-   <span data-ttu-id="61d68-106">Seguimiento analítico: característica de seguimiento de alto rendimiento y bajo nivel de detalle que usa el Seguimiento de eventos para Windows (ETW).</span><span class="sxs-lookup"><span data-stu-id="61d68-106">Analytic tracing: A high performance and low verbosity tracing feature using Event Tracing for Windows (ETW).</span></span>  
  
-   <span data-ttu-id="61d68-107">Modelo de actividad de un extremo a otro para servicios de WCF/WF: esta característica admite la correlación de seguimientos que generan los espacios de nombres <xref:System.ServiceModel> y <xref:System.Workflow.ComponentModel>.</span><span class="sxs-lookup"><span data-stu-id="61d68-107">End-to-end activity model for WCF/WF services: This feature supports correlation of traces generated by the <xref:System.ServiceModel> and <xref:System.Workflow.ComponentModel> namespaces.</span></span>  
  
-   <span data-ttu-id="61d68-108">Seguimiento de ETW para WF: esta característica utiliza los registros de seguimiento generados por los servicios WF para proporcionar visibilidad del progreso y estado actual del flujo de trabajo.</span><span class="sxs-lookup"><span data-stu-id="61d68-108">ETW tracking for WF: This feature uses tracking records generated by WF services to provide visibility into the workflow’s current state and progress.</span></span>  
  
 <span data-ttu-id="61d68-109">Los errores que figuran en un registro de seguimiento se pueden utilizar para encontrar defectos en el código o mensajes con formato incorrecto.</span><span class="sxs-lookup"><span data-stu-id="61d68-109">Errors logged in a tracking or tracing record can be used to find code defects or incorrectly formed messages.</span></span> <span data-ttu-id="61d68-110">La propiedad ActivityId del nodo Correlation en el encabezado del mensaje del evento se puede utilizar para determinar la actividad con errores.</span><span class="sxs-lookup"><span data-stu-id="61d68-110">The ActivityId property of the Correlation node in the event’s message header can be used to determine the faulting activity.</span></span> <span data-ttu-id="61d68-111">Para habilitar el seguimiento del flujo de mensajes por Id. de actividad, vea [configurar el seguimiento de flujo de mensaje](../../../../docs/framework/wcf/diagnostics/etw/configuring-message-flow-tracing.md).</span><span class="sxs-lookup"><span data-stu-id="61d68-111">To enable message flow tracing by activity ID, see [Configuring Message Flow Tracing](../../../../docs/framework/wcf/diagnostics/etw/configuring-message-flow-tracing.md).</span></span> <span data-ttu-id="61d68-112">En este tema se muestra cómo habilitar el seguimiento del flujo de mensajes en el proyecto creado en el tutorial de introducción.</span><span class="sxs-lookup"><span data-stu-id="61d68-112">This topic demonstrates how to enable message flow tracing in the project created in the Getting Started tutorial.</span></span>  
  
### <a name="to-enable-message-flow-tracing-in-the-getting-started-tutorial"></a><span data-ttu-id="61d68-113">Para habilitar el seguimiento del flujo de mensajes en el tutorial de introducción</span><span class="sxs-lookup"><span data-stu-id="61d68-113">To enable message flow tracing in the Getting Started tutorial</span></span>  
  
1.  <span data-ttu-id="61d68-114">Abra el Visor de eventos, haga clic en **iniciar**, **ejecutar**y escriba `eventvwr.exe`.</span><span class="sxs-lookup"><span data-stu-id="61d68-114">Open Event Viewer by clicking **Start**, **Run**, and entering `eventvwr.exe`.</span></span>  
  
2.  <span data-ttu-id="61d68-115">Si no ha habilitado la traza analítica, expanda **registros de aplicaciones y servicios**, **Microsoft**, **Windows**, **servidor de aplicaciones** .</span><span class="sxs-lookup"><span data-stu-id="61d68-115">If you haven’t enabled analytic tracing, expand **Applications and Services Logs**, **Microsoft**, **Windows**, **Application Server-Applications**.</span></span> <span data-ttu-id="61d68-116">Seleccione **vista**, **mostrar analíticos y de depuración registros**.</span><span class="sxs-lookup"><span data-stu-id="61d68-116">Select **View**, **Show Analytic and Debug Logs**.</span></span> <span data-ttu-id="61d68-117">Haga clic en **analítico** y seleccione **Habilitar registro**.</span><span class="sxs-lookup"><span data-stu-id="61d68-117">Right-click **Analytic** and select **Enable Log**.</span></span> <span data-ttu-id="61d68-118">Deje el Visor de eventos abierto para que se puedan ver los seguimientos.</span><span class="sxs-lookup"><span data-stu-id="61d68-118">Leave Event Viewer open so that traces can be viewed.</span></span>  
  
3.  <span data-ttu-id="61d68-119">Abra el ejemplo creado en el [Tutorial de introducción](../../../../docs/framework/wcf/getting-started-tutorial.md) en [!INCLUDE[vs_current_long](../../../../includes/vs-current-long-md.md)].</span><span class="sxs-lookup"><span data-stu-id="61d68-119">Open the sample created in the [Getting Started Tutorial](../../../../docs/framework/wcf/getting-started-tutorial.md) in [!INCLUDE[vs_current_long](../../../../includes/vs-current-long-md.md)].</span></span> <span data-ttu-id="61d68-120">Observe que debe ejecutar [!INCLUDE[vs_current_long](../../../../includes/vs-current-long-md.md)] como administrador para que se pueda crear el servicio.</span><span class="sxs-lookup"><span data-stu-id="61d68-120">Note that you must run [!INCLUDE[vs_current_long](../../../../includes/vs-current-long-md.md)] as an administrator so that the service can be created.</span></span> <span data-ttu-id="61d68-121">Si tiene la [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] ejemplos instalados, puede abrir el [Introducción](../../../../docs/framework/wcf/samples/getting-started-sample.md), que contiene el proyecto completado creado en el tutorial.</span><span class="sxs-lookup"><span data-stu-id="61d68-121">If you have the [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] samples installed, you can open the [Getting Started](../../../../docs/framework/wcf/samples/getting-started-sample.md), which contains the completed project created in the tutorial.</span></span>  
  
4.  <span data-ttu-id="61d68-122">Haga clic en el **servicio** de proyecto y seleccione **agregar**, **nuevo elemento**.</span><span class="sxs-lookup"><span data-stu-id="61d68-122">Right-click the **Service** project and select **Add**, **New Item**.</span></span> <span data-ttu-id="61d68-123">Seleccione **archivo de configuración de aplicación** y haga clic en **Aceptar**.</span><span class="sxs-lookup"><span data-stu-id="61d68-123">Select **Application Configuration File** and click **OK**.</span></span>  
  
5.  <span data-ttu-id="61d68-124">Agregue el siguiente código al archivo App.Config creado en el paso anterior.</span><span class="sxs-lookup"><span data-stu-id="61d68-124">Add the following code to the App.Config file created in the previous step.</span></span>  
  
    ```xml  
    <system.serviceModel>  
      <diagnostics>  
        <endToEndTracing propagateActivity="true" messageFlowTracing="true"/>  
      </diagnostics>  
    </system.serviceModel>  
    ```  
  
6.  <span data-ttu-id="61d68-125">Ejecute la aplicación de servidor sin depurar presionando CTRL+F5.</span><span class="sxs-lookup"><span data-stu-id="61d68-125">Execute the server application without debugging by pressing CTRL+F5.</span></span> <span data-ttu-id="61d68-126">Ejecutar el proyecto cliente haciendo clic en el **cliente** proyecto y seleccione **depurar**, **Iniciar nueva instancia**.</span><span class="sxs-lookup"><span data-stu-id="61d68-126">Execute the client project by right-clicking the **Client** project and selecting **Debug**, **Start New Instance**.</span></span>  
  
7.  <span data-ttu-id="61d68-127">Para realizar el seguimiento de los eventos del cliente al servidor, agregue lo siguiente al archivo de configuración de la aplicación en el proyecto Cliente.</span><span class="sxs-lookup"><span data-stu-id="61d68-127">To trace the events from the client to the server, add the following to the application configuration file in the Client project.</span></span>  
  
    ```xml  
    <diagnostics>  
      <endToEndTracing propagateActivity="true" messageFlowTracing="true"/>  
    </diagnostics>  
    ```  
  
8.  <span data-ttu-id="61d68-128">En Program.cs, en el cliente, agregue la siguiente instrucción Using.</span><span class="sxs-lookup"><span data-stu-id="61d68-128">In Program.cs in the client, add the following Using statement.</span></span>  
  
    ```  
    using System.Diagnostics;  
    ```  
  
9. <span data-ttu-id="61d68-129">En el método Main del archivo program.cs del proyecto de cliente, establezca el GUID de seguimiento para que se propague en el registro de eventos.</span><span class="sxs-lookup"><span data-stu-id="61d68-129">In the Main method in the program.cs file in the client project, set the Trace GUID to be propagated in the event log.</span></span>  
  
    ```  
    Guid guid = Guid.NewGuid();  
    Trace.CorrelationManager.ActivityId = guid;  
    ```  
  
10. <span data-ttu-id="61d68-130">Actualice y examine el **analítico** registro.</span><span class="sxs-lookup"><span data-stu-id="61d68-130">Refresh and examine the **Analytic**  log.</span></span>  <span data-ttu-id="61d68-131">Busque un evento con el identificador de evento 220.</span><span class="sxs-lookup"><span data-stu-id="61d68-131">Look for an event with Event ID 220.</span></span>  <span data-ttu-id="61d68-132">Seleccione el evento y haga clic en el **detalles** en el panel de vista previa.</span><span class="sxs-lookup"><span data-stu-id="61d68-132">Select the event, and click the **Details** tab in the preview pane.</span></span> <span data-ttu-id="61d68-133">Este evento contendrá el identificador de correlación de la actividad de llamada.</span><span class="sxs-lookup"><span data-stu-id="61d68-133">This event will contain the correlation ID for the calling activity.</span></span>  
  
    ```xml  
    <Correlation ActivityID="{A066CCF1-8AB3-459B-B62F-F79F957A5036}" />  
    ```  
  
    > [!NOTE]
    >  <span data-ttu-id="61d68-134">Todos los eventos con el mismo GUID en ActivityID están relacionados con la misma solicitud.</span><span class="sxs-lookup"><span data-stu-id="61d68-134">All events with the same GUID in the ActivityID are related to one request.</span></span> <span data-ttu-id="61d68-135">Esto se puede utilizar para poner en correlación los mensajes de un cliente concreto y un servicio concreto.</span><span class="sxs-lookup"><span data-stu-id="61d68-135">This can be used to correlate messages from a specific client to a specific service.</span></span> <span data-ttu-id="61d68-136">Si el cliente llama a otro servicio, el mismo cliente podría identificarse a través de ActivityID.</span><span class="sxs-lookup"><span data-stu-id="61d68-136">If the client called another service, then the same client could be identified by ActivityID.</span></span>  
  
11. <span data-ttu-id="61d68-137">En algunos casos, ActivityID puede cambiar del GUID original a un nuevo ActivityID.</span><span class="sxs-lookup"><span data-stu-id="61d68-137">In some cases, the ActivityID can change from the original GUID to a new ActivityID.</span></span> <span data-ttu-id="61d68-138">En ese caso, se emite un evento de transferencia.</span><span class="sxs-lookup"><span data-stu-id="61d68-138">In that case, a transfer event is emitted.</span></span> <span data-ttu-id="61d68-139">Este identificador de evento es 499 y el evento contendrá los siguientes datos en el encabezado.</span><span class="sxs-lookup"><span data-stu-id="61d68-139">This event ID is 499, and the event will contain the following data in the header.</span></span>  
  
    ```xml  
    <Event xmlns="http://schemas.microsoft.com/win/2004/08/events/event">  
        <System>  
            <Provider Name="Microsoft-Windows-Application Server-Applications" Guid="{c651f5f6-1c0d-492e-8ae1-b4efd7c9d503}" />   
            <EventID>499</EventID>   
            ...  
            <Correlation ActivityID="{A066CCF1-8AB3-459B-B62F-F79F957A5036}" RelatedActivityID="{85FC0930-9C49-42DA-804B-A7368104BD1B}" />   
            ...  
       </System>  
    </Event>  
    ```  
  
    > [!NOTE]
    >  <span data-ttu-id="61d68-140">El evento de transferencia registra el cambio del ActivityID activo con respecto al GUID especificado como el ActivityID para el GUID especificado como RelatedActivityID.</span><span class="sxs-lookup"><span data-stu-id="61d68-140">The transfer event records the change of the active ActivityID from the GUID specified as the ActivityID to the GUID specified as RelatedActivityID.</span></span> <span data-ttu-id="61d68-141">Una vez emitido el evento de transferencia, todos los eventos contendrán el nuevo GUID como ActivityID.</span><span class="sxs-lookup"><span data-stu-id="61d68-141">After the transfer event is emitted, all events will contain the new GUID as the ActivityID.</span></span>
