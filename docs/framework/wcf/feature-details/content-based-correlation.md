---
title: "Correlación basada en contenido"
ms.custom: 
ms.date: 03/30/2017
ms.prod: .net-framework
ms.reviewer: 
ms.suite: 
ms.technology: dotnet-clr
ms.tgt_pltfrm: 
ms.topic: article
ms.assetid: f46a2b68-8d24-4122-bbee-9573fc3f9fb4
caps.latest.revision: "17"
author: Erikre
ms.author: erikre
manager: erikre
ms.openlocfilehash: dda6e063744b8a745c5f4be576344ff2823de267
ms.sourcegitcommit: bd1ef61f4bb794b25383d3d72e71041a5ced172e
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 10/18/2017
---
# <a name="content-based-correlation"></a><span data-ttu-id="dae3d-102">Correlación basada en contenido</span><span class="sxs-lookup"><span data-stu-id="dae3d-102">Content Based Correlation</span></span>
<span data-ttu-id="dae3d-103">Cuando los servicios de flujo de trabajo se comunican con clientes y otros servicios, suele haber ciertos datos en los mensajes intercambiados que relacionan de forma única un mensaje con una instancia determinada.</span><span class="sxs-lookup"><span data-stu-id="dae3d-103">When workflow services communicate with clients and other services, often there is some data in the exchanged messages that uniquely relates a message to a particular instance.</span></span> <span data-ttu-id="dae3d-104">La correlación basada en contenidos usa estos datos en el mensaje, como un número de cliente o un identificador de orden, para enrutar los mensajes a la instancia de flujo de trabajo apropiada.</span><span class="sxs-lookup"><span data-stu-id="dae3d-104">Content-based correlation uses this data in the message, such as a customer number or order ID, to route messages to the proper workflow instance.</span></span> <span data-ttu-id="dae3d-105">En este tema, se explica cómo utilizar la correlación basada en contenidos en flujos de trabajo.</span><span class="sxs-lookup"><span data-stu-id="dae3d-105">This topic explains how to use content-based correlation in workflows.</span></span>  
  
## <a name="using-content-based-correlation"></a><span data-ttu-id="dae3d-106">Utilizar la correlación basada en contenidos</span><span class="sxs-lookup"><span data-stu-id="dae3d-106">Using Content-Based Correlation</span></span>  
 <span data-ttu-id="dae3d-107">Se utiliza la correlación basada en contenidos cuando un servicio de flujo de trabajo tiene varios métodos a los que se accede mediante un cliente único y una parte de los datos de los mensajes intercambiados identifica la instancia deseada.</span><span class="sxs-lookup"><span data-stu-id="dae3d-107">Content-based correlation is used when a workflow service has multiple methods that are accessed by a single client and a piece of data in the exchanged messages identifies the desired instance.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="dae3d-108">La correlación basada en contenidos es útil cuando no se puede usar la correlación del contexto porque el enlace no es ninguno de los enlaces de intercambio de contexto compatibles.</span><span class="sxs-lookup"><span data-stu-id="dae3d-108">Content-based correlation is useful when context correlation cannot be used because the binding is not one of the supported context exchange bindings.</span></span> [!INCLUDE[crabout](../../../../includes/crabout-md.md)]<span data-ttu-id="dae3d-109">correlación de contexto, vea [intercambio de contexto](../../../../docs/framework/wcf/feature-details/context-exchange-correlation.md).</span><span class="sxs-lookup"><span data-stu-id="dae3d-109"> context correlation, see [Context Exchange](../../../../docs/framework/wcf/feature-details/context-exchange-correlation.md).</span></span>  
  
 <span data-ttu-id="dae3d-110">Cada actividad de mensajería utilizada en estas comunicaciones debe especificar la ubicación de los datos del mensaje que identifican de forma única la instancia.</span><span class="sxs-lookup"><span data-stu-id="dae3d-110">Each messaging activity used in these communications must specify the location of the data in the message that uniquely identifies the instance.</span></span> <span data-ttu-id="dae3d-111">Esto se hace proporcionando <xref:System.ServiceModel.MessageQuerySet>, utilizando <xref:System.ServiceModel.Activities.QueryCorrelationInitializer> o <xref:System.ServiceModel.Activities.Receive.CorrelatesOn%2A>, de manera que se envía una consulta al mensaje sobre la parte o las partes de los datos que identifican de forma única la instancia.</span><span class="sxs-lookup"><span data-stu-id="dae3d-111">This is done by providing a <xref:System.ServiceModel.MessageQuerySet>, using either a <xref:System.ServiceModel.Activities.QueryCorrelationInitializer> or <xref:System.ServiceModel.Activities.Receive.CorrelatesOn%2A>, that queries the message for the piece or pieces of data that uniquely identify the instance.</span></span>  
  
> [!WARNING]
>  <span data-ttu-id="dae3d-112">A los datos que se utilizan para identificar la instancia se les aplica un algoritmo hash en una clave de correlación.</span><span class="sxs-lookup"><span data-stu-id="dae3d-112">The data that is used to identify the instance is hashed into a correlation key.</span></span> <span data-ttu-id="dae3d-113">Preste atención para asegurarse de que los datos utilizados para la correlación son únicos; de otro modo, podrían producirse colisiones en la clave a la que se ha aplicado un algoritmo hash y hacer que los mensajes se envíen a un destino incorrecto.</span><span class="sxs-lookup"><span data-stu-id="dae3d-113">Care must be taken to ensure that the data used for correlation is unique or else collisions in the hashed key could occur and cause messages to be misrouted.</span></span> <span data-ttu-id="dae3d-114">Por ejemplo, una correlación basada solamente en un nombre de cliente puede producir una colisión porque puede haber múltiples clientes con el mismo nombre.</span><span class="sxs-lookup"><span data-stu-id="dae3d-114">For example, a correlation based solely on a customer name may cause a collision because there may be multiple customers with the same name.</span></span> <span data-ttu-id="dae3d-115">Los dos puntos (`:`) no se deberían utilizar como parte de los datos empleados para la correlación del mensaje, porque ya se utilizan para delimitar el valor y la clave de la consulta del mensaje para formar la cadena a la que, posteriormente, se aplica un algoritmo hash.</span><span class="sxs-lookup"><span data-stu-id="dae3d-115">The colon (`:`) should not be used as part of the data used to correlate the message because it is already used to delimit the message query’s key and value to form the string that is subsequently hashed.</span></span>  
  
 <span data-ttu-id="dae3d-116">En el ejemplo siguiente, la inicial <xref:System.ServiceModel.Activities.Receive> / <xref:System.ServiceModel.Activities.SendReply> en un servicio de flujo de trabajo devuelve un `OrderId`, que, a continuación, se pasa por el cliente en la llamada al siguiente <xref:System.ServiceModel.Activities.Receive> actividad en el servicio de flujo de trabajo.</span><span class="sxs-lookup"><span data-stu-id="dae3d-116">In the following example, the initial <xref:System.ServiceModel.Activities.Receive>/<xref:System.ServiceModel.Activities.SendReply> in a workflow service returns an `OrderId`, which is then passed back by the client on the call to the following <xref:System.ServiceModel.Activities.Receive> activity in the workflow service.</span></span>  
  
 [!code-csharp[CFX_ContentCorrelation#1](../../../../samples/snippets/csharp/VS_Snippets_CFX/cfx_contentcorrelation/cs/program.cs#1)]  
  
 <span data-ttu-id="dae3d-117">En el ejemplo anterior, se muestra una correlación basada en contenidos que se inicializada mediante <xref:System.ServiceModel.Activities.SendReply>.</span><span class="sxs-lookup"><span data-stu-id="dae3d-117">The previous example shows a content-based correlation that is initialized by the <xref:System.ServiceModel.Activities.SendReply>.</span></span> <span data-ttu-id="dae3d-118"><xref:System.ServiceModel.MessageQuerySet> especifica que los datos utilizados para identificar los mensajes subsiguientes de este servicio son `OrderId`.</span><span class="sxs-lookup"><span data-stu-id="dae3d-118">The <xref:System.ServiceModel.MessageQuerySet> specifies that the data used to identify subsequent messages to this service is the `OrderId`.</span></span>  
  
 [!code-csharp[CFX_ContentCorrelation#2](../../../../samples/snippets/csharp/VS_Snippets_CFX/cfx_contentcorrelation/cs/program.cs#2)]  
  
 <span data-ttu-id="dae3d-119">La actividad <xref:System.ServiceModel.Activities.Receive> que sigue a <xref:System.ServiceModel.Activities.SendReply> en el flujo de trabajo continúa la correlación inicializada por <xref:System.ServiceModel.Activities.SendReply>.</span><span class="sxs-lookup"><span data-stu-id="dae3d-119">The <xref:System.ServiceModel.Activities.Receive> activity that follows the <xref:System.ServiceModel.Activities.SendReply> in the workflow follows the correlation that was initialized by the <xref:System.ServiceModel.Activities.SendReply>.</span></span> <span data-ttu-id="dae3d-120">Ambas actividades comparten la misma clase <xref:System.ServiceModel.Activities.CorrelationHandle>, pero cada una tiene su propia <xref:System.ServiceModel.MessageQuerySet> y <xref:System.ServiceModel.XPathMessageQuery> que especifica dónde están los datos de identificación de ese mensaje en particular.</span><span class="sxs-lookup"><span data-stu-id="dae3d-120">Both activities share the same <xref:System.ServiceModel.Activities.CorrelationHandle>, but each one has its own <xref:System.ServiceModel.MessageQuerySet> and <xref:System.ServiceModel.XPathMessageQuery> that specifies where the identifying data is in that particular message.</span></span> <span data-ttu-id="dae3d-121">En la actividad que inicializa la correlación, <xref:System.ServiceModel.MessageQuerySet> se especifica en la propiedad <xref:System.ServiceModel.Activities.Receive.CorrelationInitializers%2A> y, para cualquier actividad <xref:System.ServiceModel.Activities.Receive> siguiente, se especifica utilizando la propiedad <xref:System.ServiceModel.Activities.Receive.CorrelatesOn%2A>.</span><span class="sxs-lookup"><span data-stu-id="dae3d-121">On the activity that initializes the correlation, this <xref:System.ServiceModel.MessageQuerySet> is specified in the <xref:System.ServiceModel.Activities.Receive.CorrelationInitializers%2A> property, and for any following <xref:System.ServiceModel.Activities.Receive> activities, it is specified using the <xref:System.ServiceModel.Activities.Receive.CorrelatesOn%2A> property.</span></span>  
  
 [!code-csharp[CFX_ContentCorrelation#3](../../../../samples/snippets/csharp/VS_Snippets_CFX/cfx_contentcorrelation/cs/program.cs#3)]  
  
 <span data-ttu-id="dae3d-122">Cualquier actividad de mensajería (<xref:System.ServiceModel.Activities.Send>, <xref:System.ServiceModel.Activities.Receive>, <xref:System.ServiceModel.Activities.SendReply>, <xref:System.ServiceModel.Activities.ReceiveReply>) puede inicializar una correlación basada en contenidos cuando los datos se transmiten como parte de un mensaje.</span><span class="sxs-lookup"><span data-stu-id="dae3d-122">A content-based correlation can be initialized by any messaging activity (<xref:System.ServiceModel.Activities.Send>, <xref:System.ServiceModel.Activities.Receive>, <xref:System.ServiceModel.Activities.SendReply>, <xref:System.ServiceModel.Activities.ReceiveReply>) when the data flows as part of a message.</span></span> <span data-ttu-id="dae3d-123">Si la parte determinada de los datos no se transmite como parte de un mensaje, entonces se puede inicializar explícitamente utilizando la actividad <xref:System.ServiceModel.Activities.InitializeCorrelation>.</span><span class="sxs-lookup"><span data-stu-id="dae3d-123">If the particular piece of data does not flow as part of a message, then it can be initialized explicitly by using the <xref:System.ServiceModel.Activities.InitializeCorrelation> activity.</span></span> <span data-ttu-id="dae3d-124">Si es necesario que múltiples partes de los datos identifiquen el mensaje de forma única, entonces pueden agregarse múltiples consultas a <xref:System.ServiceModel.MessageQuerySet>.</span><span class="sxs-lookup"><span data-stu-id="dae3d-124">If multiple pieces of data are required to uniquely identify the message, then multiple queries can be added to the <xref:System.ServiceModel.MessageQuerySet>.</span></span> <span data-ttu-id="dae3d-125">En estos ejemplos, <xref:System.ServiceModel.Activities.CorrelationHandle> se proporcionó explícitamente a cada una de las actividades utilizando las propiedades `CorrelatesWith` o `CorrelationHandle`, pero si solo hay una correlación requerida para el flujo de trabajo completo, como en este ejemplo, donde todo se correlaciona en `OrderId`, la administración de identificación de correlación implícita proporcionada por <xref:System.ServiceModel.Activities.WorkflowServiceHost> es suficiente.</span><span class="sxs-lookup"><span data-stu-id="dae3d-125">In these examples, a <xref:System.ServiceModel.Activities.CorrelationHandle> was explicitly provided to each of the activities using the `CorrelatesWith` or `CorrelationHandle` properties, but if there is only one correlation required for the entire workflow, such as in this example where everything correlates on `OrderId`, the implicit correlation handle management provided by <xref:System.ServiceModel.Activities.WorkflowServiceHost> is sufficient.</span></span>  
  
## <a name="using-the-initializecorrelation-activity"></a><span data-ttu-id="dae3d-126">Usar la actividad InitializeCorrelation</span><span class="sxs-lookup"><span data-stu-id="dae3d-126">Using the InitializeCorrelation Activity</span></span>  
 <span data-ttu-id="dae3d-127">En el ejemplo anterior, `OrderId` se transmitió al autor de la llamada a través de la actividad <xref:System.ServiceModel.Activities.SendReply>, y ahí es donde se inicializó la correlación.</span><span class="sxs-lookup"><span data-stu-id="dae3d-127">In the previous example, the `OrderId` flowed to the caller through the <xref:System.ServiceModel.Activities.SendReply> activity and this is where the correlation was initialized.</span></span> <span data-ttu-id="dae3d-128">E mismo comportamiento se puede lograr utilizando la actividad <xref:System.ServiceModel.Activities.InitializeCorrelation>.</span><span class="sxs-lookup"><span data-stu-id="dae3d-128">The same behavior can be accomplished by using the <xref:System.ServiceModel.Activities.InitializeCorrelation> activity.</span></span> <span data-ttu-id="dae3d-129">La actividad <xref:System.ServiceModel.Activities.InitializeCorrelation> toma <xref:System.ServiceModel.Activities.CorrelationHandle> y un diccionario de elementos que representan los datos utilizados para asignar el mensaje a la instancia correcta.</span><span class="sxs-lookup"><span data-stu-id="dae3d-129">The <xref:System.ServiceModel.Activities.InitializeCorrelation> activity takes the <xref:System.ServiceModel.Activities.CorrelationHandle> and a dictionary of items that represent the data used to map the message to the correct instance.</span></span> <span data-ttu-id="dae3d-130">Para utilizar la actividad <xref:System.ServiceModel.Activities.InitializeCorrelation> en el ejemplo anterior, quite <xref:System.ServiceModel.Activities.SendReply.CorrelationInitializers%2A> de la actividad <xref:System.ServiceModel.Activities.SendReply> e inicialice la correlación mediante la actividad <xref:System.ServiceModel.Activities.InitializeCorrelation>.</span><span class="sxs-lookup"><span data-stu-id="dae3d-130">To use the <xref:System.ServiceModel.Activities.InitializeCorrelation> activity in the preceding sample, remove the <xref:System.ServiceModel.Activities.SendReply.CorrelationInitializers%2A> from the <xref:System.ServiceModel.Activities.SendReply> activity and initialize the correlation using the <xref:System.ServiceModel.Activities.InitializeCorrelation> activity.</span></span>  
  
 [!code-csharp[CFX_ContentCorrelation#4](../../../../samples/snippets/csharp/VS_Snippets_CFX/cfx_contentcorrelation/cs/program.cs#4)]  
  
 <span data-ttu-id="dae3d-131">A continuación, la actividad <xref:System.ServiceModel.Activities.InitializeCorrelation> se utiliza en el flujo de trabajo, una vez rellenadas las variables que contienen los datos, pero antes de la actividad <xref:System.ServiceModel.Activities.Receive> que se correlaciona con la clase <xref:System.ServiceModel.Activities.CorrelationHandle> inicializada.</span><span class="sxs-lookup"><span data-stu-id="dae3d-131">The <xref:System.ServiceModel.Activities.InitializeCorrelation> activity is then used in the workflow, after the variables that hold the data are populated but before the <xref:System.ServiceModel.Activities.Receive> activity that correlates with the initialized <xref:System.ServiceModel.Activities.CorrelationHandle>.</span></span>  
  
 [!code-csharp[CFX_ContentCorrelation#5](../../../../samples/snippets/csharp/VS_Snippets_CFX/cfx_contentcorrelation/cs/program.cs#5)]  
  
## <a name="configuring-xpath-queries-using-the-workflow-designer"></a><span data-ttu-id="dae3d-132">Configurar consultas de XPath utilizando el Diseñador de flujo de trabajo</span><span class="sxs-lookup"><span data-stu-id="dae3d-132">Configuring XPath Queries Using the Workflow Designer</span></span>  
 <span data-ttu-id="dae3d-133">En los ejemplos anteriores, las actividades y las consultas XPath utilizadas en las consultas del mensaje se especificaron en código.</span><span class="sxs-lookup"><span data-stu-id="dae3d-133">In the previous examples, the activities and the XPath queries used in the message queries were specified in code.</span></span> <span data-ttu-id="dae3d-134">El Diseñador de flujo de trabajo en [!INCLUDE[vs_current_long](../../../../includes/vs-current-long-md.md)] también proporciona la capacidad de generar XPaths de los tipos `DataContract` para la correlación basada en contenidos.</span><span class="sxs-lookup"><span data-stu-id="dae3d-134">The workflow designer in [!INCLUDE[vs_current_long](../../../../includes/vs-current-long-md.md)] also provides the ability to generate XPaths from `DataContract` types for content-based correlation.</span></span> <span data-ttu-id="dae3d-135">El primer XPath configurado en el ejemplo anterior se configuró para <xref:System.ServiceModel.Activities.SendReply>.</span><span class="sxs-lookup"><span data-stu-id="dae3d-135">The first XPath configured in the previous example was configured for the <xref:System.ServiceModel.Activities.SendReply>.</span></span>  
  
 [!code-csharp[CFX_ContentCorrelation#2](../../../../samples/snippets/csharp/VS_Snippets_CFX/cfx_contentcorrelation/cs/program.cs#2)]  
  
 <span data-ttu-id="dae3d-136">Para configurar el XPath para una actividad de mensajería en el Diseñador de flujo de trabajo, seleccione la actividad en el Diseñador de flujo de trabajo.</span><span class="sxs-lookup"><span data-stu-id="dae3d-136">To configure the XPath for a messaging activity in the workflow designer, select the activity in the workflow designer.</span></span> <span data-ttu-id="dae3d-137">Si la actividad está inicializando la correlación, como se muestra en el ejemplo anterior, haga clic en el botón de puntos suspensivos para la **CorrelationInitializers** propiedad en el **propiedades** ventana.</span><span class="sxs-lookup"><span data-stu-id="dae3d-137">If the activity is initializing the correlation, as in the previous example, click the ellipsis button for the **CorrelationInitializers** property in the **Properties** window.</span></span> <span data-ttu-id="dae3d-138">Esto muestra la **agregar inicializadores de correlación** cuadro de diálogo.</span><span class="sxs-lookup"><span data-stu-id="dae3d-138">This displays the **Add Correlation Initializers** dialog window.</span></span> <span data-ttu-id="dae3d-139">En este cuadro de diálogo, puede especificar el tipo de correlación y seleccionar el contenido que se usará para ella.</span><span class="sxs-lookup"><span data-stu-id="dae3d-139">From this dialog you can specify the correlation type and select the content that is used for the correlation.</span></span> <span data-ttu-id="dae3d-140">El <xref:System.ServiceModel.Activities.CorrelationHandle> variable se especifica en el **agregar inicializador** cuadro y el tipo de correlación y datos utilizados para la correlación se seleccionan en el **consultas XPath** sección del cuadro de diálogo.</span><span class="sxs-lookup"><span data-stu-id="dae3d-140">The <xref:System.ServiceModel.Activities.CorrelationHandle> variable is specified in the **Add initializer** box, and the correlation type and data used for the correlation is selected from the **XPath Queries** section of the dialog box.</span></span>  
  
 <span data-ttu-id="dae3d-141">![Cuadro de diálogo de CorrelationInitializer](../../../../docs/framework/wcf/feature-details/media/correlationinitializerdlg.jpg "CorrelationInitializerDlg")</span><span class="sxs-lookup"><span data-stu-id="dae3d-141">![CorrelationInitializer Dialog](../../../../docs/framework/wcf/feature-details/media/correlationinitializerdlg.jpg "CorrelationInitializerDlg")</span></span>  
  
 <span data-ttu-id="dae3d-142">La segunda consulta XPath del ejemplo anterior se configuró en la actividad <xref:System.ServiceModel.Activities.Receive>.</span><span class="sxs-lookup"><span data-stu-id="dae3d-142">The second XPath query in the previous example was configured in the <xref:System.ServiceModel.Activities.Receive> activity.</span></span>  
  
 [!code-csharp[CFX_ContentCorrelation#3](../../../../samples/snippets/csharp/VS_Snippets_CFX/cfx_contentcorrelation/cs/program.cs#3)]  
  
 <span data-ttu-id="dae3d-143">Para configurar la consulta XPath para una actividad de mensajería que no inicializa la correlación, seleccione la actividad en el Diseñador de flujo de trabajo y, a continuación, haga clic en el botón de puntos suspensivos para la **CorrelatesOn** propiedad en el  **Propiedades** ventana.</span><span class="sxs-lookup"><span data-stu-id="dae3d-143">To configure the XPath query for a messaging activity that does not initialize the correlation, select the activity in the workflow designer and then click the ellipsis button for the **CorrelatesOn** property in the **Properties** window.</span></span> <span data-ttu-id="dae3d-144">Esto muestra la **definición de CorrelatesOn** cuadro de diálogo.</span><span class="sxs-lookup"><span data-stu-id="dae3d-144">This displays the **CorrelatesOn Definition** dialog window.</span></span>  
  
 <span data-ttu-id="dae3d-145">![Definición de CorrelatesOn](../../../../docs/framework/wcf/feature-details/media/correlatesondialog.jpg "CorrelatesOnDialog")</span><span class="sxs-lookup"><span data-stu-id="dae3d-145">![CorrelatesOn Definition](../../../../docs/framework/wcf/feature-details/media/correlatesondialog.jpg "CorrelatesOnDialog")</span></span>  
  
 <span data-ttu-id="dae3d-146">En este cuadro de diálogo, puede especificar el <xref:System.ServiceModel.Activities.CorrelationHandle> y seleccionar elementos en el **consultas XPath** lista para compilar la consulta XPath.</span><span class="sxs-lookup"><span data-stu-id="dae3d-146">From this dialog you specify the <xref:System.ServiceModel.Activities.CorrelationHandle> and choose items in the **XPath Queries** list to build the XPath query.</span></span>
