---
title: Consideraciones de rendimiento para la interoperabilidad entre Direct3D9 y WPF
ms.date: 03/30/2017
helpviewer_keywords:
- WPF [WPF], Direct3D9 interop performance
- Direct3D9 [WPF interoperability], performance
ms.assetid: ea8baf91-12fe-4b44-ac4d-477110ab14dd
ms.openlocfilehash: 52085579c2a432e7db1ebec096a931e0d51718f8
ms.sourcegitcommit: 3d5d33f384eeba41b2dff79d096f47ccc8d8f03d
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 05/04/2018
ms.locfileid: "33549209"
---
# <a name="performance-considerations-for-direct3d9-and-wpf-interoperability"></a><span data-ttu-id="899eb-102">Consideraciones de rendimiento para la interoperabilidad entre Direct3D9 y WPF</span><span class="sxs-lookup"><span data-stu-id="899eb-102">Performance Considerations for Direct3D9 and WPF Interoperability</span></span>
<span data-ttu-id="899eb-103">Puede hospedar contenido de Direct3D9 mediante la <xref:System.Windows.Interop.D3DImage> clase.</span><span class="sxs-lookup"><span data-stu-id="899eb-103">You can host Direct3D9 content by using the <xref:System.Windows.Interop.D3DImage> class.</span></span> <span data-ttu-id="899eb-104">Hospedar contenido de Direct3D9 puede afectar al rendimiento de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="899eb-104">Hosting Direct3D9 content can affect the performance of your application.</span></span> <span data-ttu-id="899eb-105">En este tema se describe las prácticas recomendadas para optimizar el rendimiento al hospedar contenido de Direct3D9 en una aplicación de Windows Presentation Foundation (WPF).</span><span class="sxs-lookup"><span data-stu-id="899eb-105">This topic describes best practices to optimize performance when hosting Direct3D9 content in a Windows Presentation Foundation (WPF) application.</span></span> <span data-ttu-id="899eb-106">Estas prácticas recomendadas incluyen cómo utilizar <xref:System.Windows.Interop.D3DImage> y las prácticas recomendadas cuando está utilizando Windows Vista, Windows XP, y muestra varios monitores.</span><span class="sxs-lookup"><span data-stu-id="899eb-106">These best practices include how to use <xref:System.Windows.Interop.D3DImage> and best practices when you are using Windows Vista, Windows XP, and multi-monitor displays.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="899eb-107">Para obtener ejemplos de código que muestran estas prácticas recomendadas, consulte [WPF y Direct3D9 interoperación](../../../../docs/framework/wpf/advanced/wpf-and-direct3d9-interoperation.md).</span><span class="sxs-lookup"><span data-stu-id="899eb-107">For code examples that demonstrate these best practices, see [WPF and Direct3D9 Interoperation](../../../../docs/framework/wpf/advanced/wpf-and-direct3d9-interoperation.md).</span></span>  
  
## <a name="use-d3dimage-sparingly"></a><span data-ttu-id="899eb-108">Utilizar D3DImage con moderación</span><span class="sxs-lookup"><span data-stu-id="899eb-108">Use D3DImage Sparingly</span></span>  
 <span data-ttu-id="899eb-109">Contenido de Direct3D9 hospedado en un <xref:System.Windows.Interop.D3DImage> instancia no se representa tan rápido como en una aplicación de Direct3D pura.</span><span class="sxs-lookup"><span data-stu-id="899eb-109">Direct3D9 content hosted in a <xref:System.Windows.Interop.D3DImage> instance does not render as fast as in a pure Direct3D application.</span></span> <span data-ttu-id="899eb-110">Copiar en la superficie y vaciar el búfer de comandos pueden ser operaciones costosas.</span><span class="sxs-lookup"><span data-stu-id="899eb-110">Copying the surface and flushing the command buffer can be costly operations.</span></span> <span data-ttu-id="899eb-111">Como el número de <xref:System.Windows.Interop.D3DImage> aumenta de instancias, más baja se produce y degrada el rendimiento.</span><span class="sxs-lookup"><span data-stu-id="899eb-111">As the number of <xref:System.Windows.Interop.D3DImage> instances increases, more flushing occurs, and performance degrades.</span></span> <span data-ttu-id="899eb-112">Por lo tanto, debe usar <xref:System.Windows.Interop.D3DImage> con moderación.</span><span class="sxs-lookup"><span data-stu-id="899eb-112">Therefore, you should use <xref:System.Windows.Interop.D3DImage> sparingly.</span></span>  
  
## <a name="best-practices-on-windows-vista"></a><span data-ttu-id="899eb-113">Procedimientos recomendados en Windows Vista</span><span class="sxs-lookup"><span data-stu-id="899eb-113">Best Practices on Windows Vista</span></span>  
 <span data-ttu-id="899eb-114">Para obtener el mejor rendimiento en Windows Vista con una presentación que está configurado para usar el modelo de controlador de pantalla de Windows (WDDM), debe crear la superficie de Direct3D9 en un `IDirect3DDevice9Ex` dispositivo.</span><span class="sxs-lookup"><span data-stu-id="899eb-114">For best performance on Windows Vista with a display that is configured to use the Windows Display Driver Model (WDDM), create your Direct3D9 surface on an `IDirect3DDevice9Ex` device.</span></span> <span data-ttu-id="899eb-115">Esto permite compartir expuesta.</span><span class="sxs-lookup"><span data-stu-id="899eb-115">This enables surface sharing.</span></span> <span data-ttu-id="899eb-116">La tarjeta de vídeo debe admitir la `D3DDEVCAPS2_CAN_STRETCHRECT_FROM_TEXTURES` y `D3DCAPS2_CANSHARERESOURCE` funciones del controlador en Windows Vista.</span><span class="sxs-lookup"><span data-stu-id="899eb-116">The video card must support the `D3DDEVCAPS2_CAN_STRETCHRECT_FROM_TEXTURES` and `D3DCAPS2_CANSHARERESOURCE` driver capabilities on Windows Vista.</span></span> <span data-ttu-id="899eb-117">Cualquier otra configuración hará que la superficie que se copiará a través del software, lo que reduce significativamente el rendimiento.</span><span class="sxs-lookup"><span data-stu-id="899eb-117">Any other settings cause the surface to be copied through software, which reduces performance significantly.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="899eb-118">Si Windows Vista tiene una presentación que está configurada para usar el modelo Windows XP Mostrar controlador (XDDM), la superficie siempre se copia a través de software, independientemente de la configuración.</span><span class="sxs-lookup"><span data-stu-id="899eb-118">If Windows Vista has a display that is configured to use the Windows XP Display Driver Model (XDDM), the surface is always copied through software, regardless of settings.</span></span> <span data-ttu-id="899eb-119">Con las opciones adecuadas y la tarjeta de vídeo, verá un mejor rendimiento en Windows Vista cuando se usa el WDDM porque se realizan copias de superficie en hardware.</span><span class="sxs-lookup"><span data-stu-id="899eb-119">With the proper settings and video card, you will see better performance on Windows Vista when you use the WDDM because surface copies are performed in hardware.</span></span>  
  
## <a name="best-practices-on-windows-xp"></a><span data-ttu-id="899eb-120">Procedimientos recomendados en Windows XP</span><span class="sxs-lookup"><span data-stu-id="899eb-120">Best Practices on Windows XP</span></span>  
 <span data-ttu-id="899eb-121">Para obtener el mejor rendimiento en Windows XP, que usa el modelo de controlador de pantalla de Windows XP (XDDM), cree una superficie bloqueable que se comporta correctamente cuando el `IDirect3DSurface9::GetDC` se llama al método.</span><span class="sxs-lookup"><span data-stu-id="899eb-121">For best performance on Windows XP, which uses the Windows XP Display Driver Model (XDDM), create a lockable surface that behaves correctly when the `IDirect3DSurface9::GetDC` method is called.</span></span> <span data-ttu-id="899eb-122">Internamente, la `BitBlt` método transfiere la superficie en todos los dispositivos de hardware.</span><span class="sxs-lookup"><span data-stu-id="899eb-122">Internally, the `BitBlt` method transfers the surface across devices in hardware.</span></span> <span data-ttu-id="899eb-123">El `GetDC` método siempre funciona en las superficies XRGB.</span><span class="sxs-lookup"><span data-stu-id="899eb-123">The `GetDC` method always works on XRGB surfaces.</span></span> <span data-ttu-id="899eb-124">Sin embargo, si el equipo cliente ejecuta Windows XP con SP3 o SP2, y si el cliente también tiene la revisión de la característica de ventana en capas, este método solo funciona en las superficies ARGB.</span><span class="sxs-lookup"><span data-stu-id="899eb-124">However, if the client computer is running Windows XP with SP3 or SP2, and if the client also has the hotfix for the layered-window feature, this method only works on ARGB surfaces.</span></span> <span data-ttu-id="899eb-125">La tarjeta de vídeo debe admitir la `D3DDEVCAPS2_CAN_STRETCHRECT_FROM_TEXTURES` capacidad de controlador.</span><span class="sxs-lookup"><span data-stu-id="899eb-125">The video card must support the `D3DDEVCAPS2_CAN_STRETCHRECT_FROM_TEXTURES` driver capability.</span></span>  
  
 <span data-ttu-id="899eb-126">Una profundidad de visualización de escritorio de 16 bits puede reducir significativamente el rendimiento.</span><span class="sxs-lookup"><span data-stu-id="899eb-126">A 16-bit desktop display depth can significantly reduce performance.</span></span> <span data-ttu-id="899eb-127">Se recomienda un escritorio de 32 bits.</span><span class="sxs-lookup"><span data-stu-id="899eb-127">A 32-bit desktop is recommended.</span></span>  
  
 <span data-ttu-id="899eb-128">Si va a desarrollar para Windows Vista y Windows XP, pruebe el rendimiento en Windows XP.</span><span class="sxs-lookup"><span data-stu-id="899eb-128">If you are developing for Windows Vista and Windows XP, test the performance on Windows XP.</span></span> <span data-ttu-id="899eb-129">Quedarse sin memoria de vídeo en Windows XP es una preocupación.</span><span class="sxs-lookup"><span data-stu-id="899eb-129">Running out of video memory on Windows XP is a concern.</span></span> <span data-ttu-id="899eb-130">Además, <xref:System.Windows.Interop.D3DImage> en Windows XP usa más memoria de vídeo y ancho de banda que Windows Vista WDDM, debido a una copia de memoria de vídeo adicional es necesario.</span><span class="sxs-lookup"><span data-stu-id="899eb-130">In addition, <xref:System.Windows.Interop.D3DImage> on Windows XP uses more video memory and bandwidth than Windows Vista WDDM, due to a necessary extra video memory copy.</span></span> <span data-ttu-id="899eb-131">Por lo tanto, puede esperar un rendimiento sea peor en Windows XP que en Windows Vista para el mismo hardware de vídeo.</span><span class="sxs-lookup"><span data-stu-id="899eb-131">Therefore, you can expect performance to be worse on Windows XP than on Windows Vista for the same video hardware.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="899eb-132">XDDM está disponible en Windows XP y Windows Vista; Sin embargo, WDDM solo está disponible en Windows Vista.</span><span class="sxs-lookup"><span data-stu-id="899eb-132">XDDM is available on both Windows XP and Windows Vista; however, WDDM is available only on Windows Vista.</span></span>  
  
## <a name="general-best-practices"></a><span data-ttu-id="899eb-133">Procedimientos recomendados generales</span><span class="sxs-lookup"><span data-stu-id="899eb-133">General Best Practices</span></span>  
 <span data-ttu-id="899eb-134">Cuando se crea el dispositivo, use la `D3DCREATE_MULTITHREADED` indicador de creación.</span><span class="sxs-lookup"><span data-stu-id="899eb-134">When you create the device, use the `D3DCREATE_MULTITHREADED` creation flag.</span></span> <span data-ttu-id="899eb-135">Esto reduce el rendimiento, pero el sistema de representación de WPF llama a métodos en este dispositivo desde otro subproceso.</span><span class="sxs-lookup"><span data-stu-id="899eb-135">This reduces performance, but the WPF rendering system calls methods on this device from another thread.</span></span> <span data-ttu-id="899eb-136">Asegúrese de seguir el protocolo de bloqueo correctamente, por lo que no haya dos subprocesos acceda al dispositivo al mismo tiempo.</span><span class="sxs-lookup"><span data-stu-id="899eb-136">Be sure to follow the locking protocol correctly, so that no two threads access the device at the same time.</span></span>  
  
 <span data-ttu-id="899eb-137">Si la representación se realiza en un subproceso administrado de WPF, se recomienda encarecidamente que cree el dispositivo con el `D3DCREATE_FPU_PRESERVE` indicador de creación.</span><span class="sxs-lookup"><span data-stu-id="899eb-137">If your rendering is performed on a WPF managed thread, it is strongly recommended that you create the device with the `D3DCREATE_FPU_PRESERVE` creation flag.</span></span> <span data-ttu-id="899eb-138">Sin esta configuración, la representación D3D puede reducir la exactitud de las operaciones de doble precisión WPF y presentar problemas de representación.</span><span class="sxs-lookup"><span data-stu-id="899eb-138">Without this setting, the D3D rendering can reduce the accuracy of WPF double-precision operations and introduce rendering issues.</span></span>  
  
 <span data-ttu-id="899eb-139">Disponer en mosaico un <xref:System.Windows.Interop.D3DImage> es rápido, a menos que se coloca en mosaico una superficie no pow2 sin compatibilidad con el hardware o si coloca en mosaico una <xref:System.Windows.Media.DrawingBrush> o <xref:System.Windows.Media.VisualBrush> que contiene un <xref:System.Windows.Interop.D3DImage>.</span><span class="sxs-lookup"><span data-stu-id="899eb-139">Tiling a <xref:System.Windows.Interop.D3DImage> is fast, unless you tile a non-pow2 surface without hardware support, or if you tile a <xref:System.Windows.Media.DrawingBrush> or <xref:System.Windows.Media.VisualBrush> that contains a <xref:System.Windows.Interop.D3DImage>.</span></span>  
  
## <a name="best-practices-for-multi-monitor-displays"></a><span data-ttu-id="899eb-140">Procedimientos recomendados para presentaciones en varios monitores</span><span class="sxs-lookup"><span data-stu-id="899eb-140">Best Practices for Multi-Monitor Displays</span></span>  
 <span data-ttu-id="899eb-141">Si está usando un equipo que tiene varios monitores, debe seguir los procedimientos recomendados descritos anteriormente.</span><span class="sxs-lookup"><span data-stu-id="899eb-141">If you are using a computer that has multiple monitors, you should follow the previously described best practices.</span></span> <span data-ttu-id="899eb-142">También hay algunas consideraciones de rendimiento adicionales para una configuración de varios monitor.</span><span class="sxs-lookup"><span data-stu-id="899eb-142">There are also some additional performance considerations for a multi-monitor configuration.</span></span>  
  
 <span data-ttu-id="899eb-143">Cuando se crea el búfer de reserva, se crea en un dispositivo específico y el adaptador, pero WPF puede mostrar el búfer frontal en ningún adaptador.</span><span class="sxs-lookup"><span data-stu-id="899eb-143">When you create the back buffer, it is created on a specific device and adapter, but WPF may display the front buffer on any adapter.</span></span> <span data-ttu-id="899eb-144">Copiar a través de adaptadores que se va a actualizar el búfer frontal puede resultar muy caro.</span><span class="sxs-lookup"><span data-stu-id="899eb-144">Copying across adapters to update the front buffer can be very expensive.</span></span> <span data-ttu-id="899eb-145">En Windows Vista que está configurado para utilizar el WDDM con varias tarjetas de vídeo y con un `IDirect3DDevice9Ex` dispositivo, si el búfer frontal se encuentra en un adaptador diferente pero la misma tarjeta de vídeo, no hay ninguna reducción del rendimiento.</span><span class="sxs-lookup"><span data-stu-id="899eb-145">On Windows Vista that is configured to use the WDDM with multiple video cards and with an `IDirect3DDevice9Ex` device, if the front buffer is on a different adapter but still the same video card, there is no performance penalty.</span></span> <span data-ttu-id="899eb-146">Sin embargo, en Windows XP y el XDDM con varias tarjetas de vídeo, hay una reducción del rendimiento significativa cuando el búfer frontal se muestra en un adaptador distinto que el búfer de reserva.</span><span class="sxs-lookup"><span data-stu-id="899eb-146">However, on Windows XP and the XDDM with multiple video cards, there is a significant performance penalty when the front buffer is displayed on a different adapter than the back buffer.</span></span> <span data-ttu-id="899eb-147">Para obtener más información, consulte [WPF y Direct3D9 interoperación](../../../../docs/framework/wpf/advanced/wpf-and-direct3d9-interoperation.md).</span><span class="sxs-lookup"><span data-stu-id="899eb-147">For more information, see [WPF and Direct3D9 Interoperation](../../../../docs/framework/wpf/advanced/wpf-and-direct3d9-interoperation.md).</span></span>  
  
## <a name="performance-summary"></a><span data-ttu-id="899eb-148">Resumen de rendimiento</span><span class="sxs-lookup"><span data-stu-id="899eb-148">Performance Summary</span></span>  
 <span data-ttu-id="899eb-149">La siguiente tabla muestra el rendimiento de la actualización del búfer frontal como una función de sistema operativo, el formato de píxel y posibilidad de bloqueo de superficie.</span><span class="sxs-lookup"><span data-stu-id="899eb-149">The following table shows performance of the front buffer update as a function of operating system, pixel format, and surface lockability.</span></span> <span data-ttu-id="899eb-150">El búfer frontal y búfer de reserva se supone que en el mismo adaptador.</span><span class="sxs-lookup"><span data-stu-id="899eb-150">The front buffer and back buffer are assumed to be on the same adapter.</span></span> <span data-ttu-id="899eb-151">Dependiendo de la configuración del adaptador, las actualizaciones de hardware son generalmente mucho más rápidas que las actualizaciones de software.</span><span class="sxs-lookup"><span data-stu-id="899eb-151">Depending on the adapter configuration, hardware updates are generally much faster than software updates.</span></span>  
  
|<span data-ttu-id="899eb-152">Formato de píxel de la superficie</span><span class="sxs-lookup"><span data-stu-id="899eb-152">Surface pixel format</span></span>|<span data-ttu-id="899eb-153">Windows Vista, WDDM y 9Ex</span><span class="sxs-lookup"><span data-stu-id="899eb-153">Windows Vista, WDDM and 9Ex</span></span>|<span data-ttu-id="899eb-154">Otras configuraciones de Windows Vista</span><span class="sxs-lookup"><span data-stu-id="899eb-154">Other Windows Vista configurations</span></span>|<span data-ttu-id="899eb-155">Windows XP SP3 o SP2 con la revisión</span><span class="sxs-lookup"><span data-stu-id="899eb-155">Windows XP SP3 or SP2 w/ hotfix</span></span>|<span data-ttu-id="899eb-156">Windows XP SP2</span><span class="sxs-lookup"><span data-stu-id="899eb-156">Windows XP SP2</span></span>|  
|--------------------------|---------------------------------|----------------------------------------|--------------------------------------|--------------------|  
|<span data-ttu-id="899eb-157">D3DFMT_X8R8G8B8 (no bloqueable)</span><span class="sxs-lookup"><span data-stu-id="899eb-157">D3DFMT_X8R8G8B8 (not lockable)</span></span>|<span data-ttu-id="899eb-158">**Actualización de hardware**</span><span class="sxs-lookup"><span data-stu-id="899eb-158">**Hardware Update**</span></span>|<span data-ttu-id="899eb-159">Actualización de software</span><span class="sxs-lookup"><span data-stu-id="899eb-159">Software Update</span></span>|<span data-ttu-id="899eb-160">Actualización de software</span><span class="sxs-lookup"><span data-stu-id="899eb-160">Software Update</span></span>|<span data-ttu-id="899eb-161">Actualización de software</span><span class="sxs-lookup"><span data-stu-id="899eb-161">Software Update</span></span>|  
|<span data-ttu-id="899eb-162">D3DFMT_X8R8G8B8 (bloqueable)</span><span class="sxs-lookup"><span data-stu-id="899eb-162">D3DFMT_X8R8G8B8 (lockable)</span></span>|<span data-ttu-id="899eb-163">**Actualización de hardware**</span><span class="sxs-lookup"><span data-stu-id="899eb-163">**Hardware Update**</span></span>|<span data-ttu-id="899eb-164">Actualización de software</span><span class="sxs-lookup"><span data-stu-id="899eb-164">Software Update</span></span>|<span data-ttu-id="899eb-165">**Actualización de hardware**</span><span class="sxs-lookup"><span data-stu-id="899eb-165">**Hardware Update**</span></span>|<span data-ttu-id="899eb-166">**Actualización de hardware**</span><span class="sxs-lookup"><span data-stu-id="899eb-166">**Hardware Update**</span></span>|  
|<span data-ttu-id="899eb-167">D3DFMT_A8R8G8B8 (no bloqueable)</span><span class="sxs-lookup"><span data-stu-id="899eb-167">D3DFMT_A8R8G8B8 (not lockable)</span></span>|<span data-ttu-id="899eb-168">**Actualización de hardware**</span><span class="sxs-lookup"><span data-stu-id="899eb-168">**Hardware Update**</span></span>|<span data-ttu-id="899eb-169">Actualización de software</span><span class="sxs-lookup"><span data-stu-id="899eb-169">Software Update</span></span>|<span data-ttu-id="899eb-170">Actualización de software</span><span class="sxs-lookup"><span data-stu-id="899eb-170">Software Update</span></span>|<span data-ttu-id="899eb-171">Actualización de software</span><span class="sxs-lookup"><span data-stu-id="899eb-171">Software Update</span></span>|  
|<span data-ttu-id="899eb-172">D3DFMT_A8R8G8B8 (bloqueable)</span><span class="sxs-lookup"><span data-stu-id="899eb-172">D3DFMT_A8R8G8B8 (lockable)</span></span>|<span data-ttu-id="899eb-173">**Actualización de hardware**</span><span class="sxs-lookup"><span data-stu-id="899eb-173">**Hardware Update**</span></span>|<span data-ttu-id="899eb-174">Actualización de software</span><span class="sxs-lookup"><span data-stu-id="899eb-174">Software Update</span></span>|<span data-ttu-id="899eb-175">**Actualización de hardware**</span><span class="sxs-lookup"><span data-stu-id="899eb-175">**Hardware Update**</span></span>|<span data-ttu-id="899eb-176">Actualización de software</span><span class="sxs-lookup"><span data-stu-id="899eb-176">Software Update</span></span>|  
  
## <a name="see-also"></a><span data-ttu-id="899eb-177">Vea también</span><span class="sxs-lookup"><span data-stu-id="899eb-177">See Also</span></span>  
 <xref:System.Windows.Interop.D3DImage>  
 [<span data-ttu-id="899eb-178">Interoperabilidad entre WPF y Direct3D9</span><span class="sxs-lookup"><span data-stu-id="899eb-178">WPF and Direct3D9 Interoperation</span></span>](../../../../docs/framework/wpf/advanced/wpf-and-direct3d9-interoperation.md)  
 [<span data-ttu-id="899eb-179">Tutorial: Crear contenido Direct3D9 para hospedarlo en WPF</span><span class="sxs-lookup"><span data-stu-id="899eb-179">Walkthrough: Creating Direct3D9 Content for Hosting in WPF</span></span>](../../../../docs/framework/wpf/advanced/walkthrough-creating-direct3d9-content-for-hosting-in-wpf.md)  
 [<span data-ttu-id="899eb-180">Tutorial: Hospedar contenido Direct3D9 en WPF</span><span class="sxs-lookup"><span data-stu-id="899eb-180">Walkthrough: Hosting Direct3D9 Content in WPF</span></span>](../../../../docs/framework/wpf/advanced/walkthrough-hosting-direct3d9-content-in-wpf.md)
