---
title: "Ensamblados recopilables para la generación de tipo dinámico"
description: 
ms.date: 08/29/2017
ms.prod: .net
ms.technology: dotnet-clr
ms.tgt_pltfrm: 
ms.topic: article
helpviewer_keywords:
- reflection, dynamic assembly
- assemblies, collectible
- collectible assemblies, retrieving
author: rpetrusha
ms.author: ronpet
manager: wpickett
ms.openlocfilehash: 2c9a613f4cc13c3e4189a59ace2e05d01d1bcb4f
ms.sourcegitcommit: bd1ef61f4bb794b25383d3d72e71041a5ced172e
ms.translationtype: HT
ms.contentlocale: es-ES
ms.lasthandoff: 10/18/2017
---
# <a name="collectible-assemblies-for-dynamic-type-generation"></a><span data-ttu-id="d74e9-102">Ensamblados recopilables para la generación de tipo dinámico</span><span class="sxs-lookup"><span data-stu-id="d74e9-102">Collectible assemblies for dynamic type generation</span></span>

<span data-ttu-id="d74e9-103">*Ensamblados recopilables* son ensamblados dinámicos que se pueden descargar sin descargar el dominio de aplicación en el que se crearon.</span><span class="sxs-lookup"><span data-stu-id="d74e9-103">*Collectible assemblies* are dynamic assemblies that can be unloaded without unloading the application domain in which they were created.</span></span> <span data-ttu-id="d74e9-104">Se puede reclamar toda la memoria administrada y utilizada por un ensamblado recopilable y los tipos que contiene.</span><span class="sxs-lookup"><span data-stu-id="d74e9-104">All managed and unmanaged memory used by a collectible assembly and the types it contains can be reclaimed.</span></span> <span data-ttu-id="d74e9-105">Información como el nombre de ensamblado se quita de las tablas internas.</span><span class="sxs-lookup"><span data-stu-id="d74e9-105">Information such as the assembly name is removed from internal tables.</span></span>

<span data-ttu-id="d74e9-106">Para habilitar la descarga, use la <xref:System.Reflection.Emit.AssemblyBuilderAccess.RunAndCollect?displayProperty=nameWithType> marca cuando se crea un ensamblado dinámico.</span><span class="sxs-lookup"><span data-stu-id="d74e9-106">To enable unloading, use the <xref:System.Reflection.Emit.AssemblyBuilderAccess.RunAndCollect?displayProperty=nameWithType> flag when you create a dynamic assembly.</span></span> <span data-ttu-id="d74e9-107">El ensamblado es transitorio (es decir, no se puede guardar) y está sujeto a limitaciones descritas en la [restricciones de los ensamblados recopilables](#restrictions-on-collectible-assemblies) sección.</span><span class="sxs-lookup"><span data-stu-id="d74e9-107">The assembly is transient (that is, it cannot be saved) and is subject to limitations described in the [Restrictions on Collectible Assemblies](#restrictions-on-collectible-assemblies) section.</span></span> <span data-ttu-id="d74e9-108">Common language runtime (CLR) descarga automáticamente un ensamblado recopilable cuando libere todos los objetos asociados con el ensamblado.</span><span class="sxs-lookup"><span data-stu-id="d74e9-108">The common language runtime (CLR) unloads a collectible assembly automatically when you release all objects associated with the assembly.</span></span> <span data-ttu-id="d74e9-109">En todos los demás aspectos, los ensamblados recopilables se crean y se usan en la misma manera que otros ensamblados dinámicos.</span><span class="sxs-lookup"><span data-stu-id="d74e9-109">In all other respects, collectible assemblies are created and used in the same way as other dynamic assemblies.</span></span>

## <a name="lifetime-of-collectible-assemblies"></a><span data-ttu-id="d74e9-110">Duración de los ensamblados recopilables</span><span class="sxs-lookup"><span data-stu-id="d74e9-110">Lifetime of collectible assemblies</span></span>

<span data-ttu-id="d74e9-111">La duración de un ensamblado recopilable se controla mediante la existencia de referencias a los tipos que contiene y los objetos que se crean a partir de esos tipos.</span><span class="sxs-lookup"><span data-stu-id="d74e9-111">The lifetime of a collectible assembly is controlled by the existence of references to the types it contains and the objects that are created from those types.</span></span> <span data-ttu-id="d74e9-112">Common language runtime no descarga un ensamblado como uno o varios de los siguientes existen (`T` es cualquier tipo que se define en el ensamblado):</span><span class="sxs-lookup"><span data-stu-id="d74e9-112">The common language runtime does not unload an assembly as long as one or more of the following exist (`T` is any type that is defined in the assembly):</span></span> 

- <span data-ttu-id="d74e9-113">Instancia de `T`.</span><span class="sxs-lookup"><span data-stu-id="d74e9-113">An instance of `T`.</span></span>

- <span data-ttu-id="d74e9-114">Una instancia de una matriz de `T`.</span><span class="sxs-lookup"><span data-stu-id="d74e9-114">An instance of an array of `T`.</span></span>
 
- <span data-ttu-id="d74e9-115">Una instancia de un tipo genérico que tiene `T` como uno de sus argumentos de tipo.</span><span class="sxs-lookup"><span data-stu-id="d74e9-115">An instance of a generic type that has `T` as one of its type arguments.</span></span> <span data-ttu-id="d74e9-116">Esto incluye las colecciones genéricas de `T`, incluso si esa colección está vacía.</span><span class="sxs-lookup"><span data-stu-id="d74e9-116">This includes generic collections of `T`, even if that collection is empty.</span></span>

- <span data-ttu-id="d74e9-117">Una instancia de <xref:System.Type> o <xref:System.Reflection.Emit.TypeBuilder> que representa `T`.</span><span class="sxs-lookup"><span data-stu-id="d74e9-117">An instance of <xref:System.Type> or <xref:System.Reflection.Emit.TypeBuilder> that represents `T`.</span></span> 

   > [!IMPORTANT]
   > <span data-ttu-id="d74e9-118">Debe liberar todos los objetos que representan partes del ensamblado.</span><span class="sxs-lookup"><span data-stu-id="d74e9-118">You must release all objects that represent parts of the assembly.</span></span> <span data-ttu-id="d74e9-119">El <xref:System.Reflection.Emit.ModuleBuilder> que define `T` mantiene una referencia a la <xref:System.Reflection.Emit.TypeBuilder>y el <xref:System.Reflection.Emit.AssemblyBuilder> objeto mantiene una referencia a la <xref:System.Reflection.Emit.ModuleBuilder>, por lo que deben liberarse las referencias a estos objetos.</span><span class="sxs-lookup"><span data-stu-id="d74e9-119">The <xref:System.Reflection.Emit.ModuleBuilder> that defines `T` keeps a reference to the <xref:System.Reflection.Emit.TypeBuilder>, and the <xref:System.Reflection.Emit.AssemblyBuilder> object keeps a reference to the <xref:System.Reflection.Emit.ModuleBuilder>, so references to these objects must be released.</span></span> <span data-ttu-id="d74e9-120">Incluso la existencia de un <xref:System.Reflection.Emit.LocalBuilder> o un <xref:System.Reflection.Emit.ILGenerator> utilizados en la fabricación de `T` impide la descarga.</span><span class="sxs-lookup"><span data-stu-id="d74e9-120">Even the existence of a <xref:System.Reflection.Emit.LocalBuilder> or an <xref:System.Reflection.Emit.ILGenerator> used in the construction of `T` prevents unloading.</span></span>

- <span data-ttu-id="d74e9-121">Una referencia estática a `T` por otro tipo definido dinámicamente `T1` que sigue siendo accesible mediante la ejecución de código.</span><span class="sxs-lookup"><span data-stu-id="d74e9-121">A static reference to `T` by another dynamically defined type `T1` that is still reachable by executing code.</span></span> <span data-ttu-id="d74e9-122">Por ejemplo, `T1` pueden derivar de `T`, o `T` podría ser el tipo de un parámetro en un método de `T1`.</span><span class="sxs-lookup"><span data-stu-id="d74e9-122">For example, `T1` might derive from `T`, or `T` might be the type of a parameter in a method of `T1`.</span></span>
 
- <span data-ttu-id="d74e9-123">A **ByRef** a un campo estático que pertenece a `T`.</span><span class="sxs-lookup"><span data-stu-id="d74e9-123">A **ByRef** to a static field that belongs to `T`.</span></span>

- <span data-ttu-id="d74e9-124">A <xref:System.RuntimeTypeHandle>, <xref:System.RuntimeFieldHandle>, o <xref:System.RuntimeMethodHandle> que hace referencia a `T` o a un componente de `T`.</span><span class="sxs-lookup"><span data-stu-id="d74e9-124">A <xref:System.RuntimeTypeHandle>, <xref:System.RuntimeFieldHandle>, or <xref:System.RuntimeMethodHandle> that refers to `T` or to a component of `T`.</span></span>

- <span data-ttu-id="d74e9-125">Una instancia de cualquier objeto de reflexión que se podría utilizar de forma indirecta o directamente para tener acceso a la <xref:System.Type> objeto que representa `T`.</span><span class="sxs-lookup"><span data-stu-id="d74e9-125">An instance of any reflection object that could be used indirectly or directly to access the <xref:System.Type> object that represents `T`.</span></span> <span data-ttu-id="d74e9-126">Por ejemplo, el <xref:System.Type> objeto `T` puede obtenerse a partir de un tipo de matriz cuyo tipo de elemento es `T`, o de un tipo genérico que tiene `T` como un argumento de tipo.</span><span class="sxs-lookup"><span data-stu-id="d74e9-126">For example, the <xref:System.Type> object for `T` can be obtained from an array type whose element type is `T`, or from a generic type that has `T` as a type argument.</span></span> 

- <span data-ttu-id="d74e9-127">Un método `M` en la pila de llamadas de cualquier subproceso, donde `M` es un método de `T` o un método de nivel de módulo que se define en el ensamblado.</span><span class="sxs-lookup"><span data-stu-id="d74e9-127">A method `M` on the call stack of any thread, where `M` is a method of `T` or a module-level method that is defined in the assembly.</span></span>

- <span data-ttu-id="d74e9-128">Un delegado a un método estático que se define en un módulo del ensamblado.</span><span class="sxs-lookup"><span data-stu-id="d74e9-128">A delegate to a static method that is defined in a module of the assembly.</span></span>

<span data-ttu-id="d74e9-129">Si solo existe un elemento de esta lista para un solo tipo o un método en el ensamblado, el tiempo de ejecución no puede descargar el ensamblado.</span><span class="sxs-lookup"><span data-stu-id="d74e9-129">If only one item from this list exists for only one type or one method in the assembly, the runtime cannot unload the assembly.</span></span>

> [!NOTE]
> <span data-ttu-id="d74e9-130">El runtime descarga realmente el ensamblado hasta que se han ejecutado los finalizadores para todos los elementos de la lista.</span><span class="sxs-lookup"><span data-stu-id="d74e9-130">The runtime does not actually unload the assembly until finalizers have run for all items in the list.</span></span>

<span data-ttu-id="d74e9-131">Para fines de seguimiento de la duración, escriba como un tipo genérico construido `List<int>` (en C#) o `List(Of Integer)` (en Visual Basic) que se crea y utiliza en la generación de un ensamblado recopilable se considera que se han definido en el ensamblado que contiene la interfaz genérica definición de tipo o en un ensamblado que contiene la definición de uno de sus argumentos de tipo.</span><span class="sxs-lookup"><span data-stu-id="d74e9-131">For purposes of tracking lifetime, a constructed generic type such as `List<int>` (in C#) or `List(Of Integer)` (in Visual Basic) that is created and used in the generation of a collectible assembly is considered to have been defined either in the assembly that contains the generic type definition or in an assembly that contains the definition of one of its type arguments.</span></span> <span data-ttu-id="d74e9-132">El ensamblado exacto que se usa es un detalle de implementación y sujeto a cambios.</span><span class="sxs-lookup"><span data-stu-id="d74e9-132">The exact assembly that is used is an implementation detail and subject to change.</span></span>
 
## <a name="restrictions-on-collectible-assemblies"></a><span data-ttu-id="d74e9-133">Restricciones de los ensamblados recopilables</span><span class="sxs-lookup"><span data-stu-id="d74e9-133">Restrictions on collectible assemblies</span></span>

<span data-ttu-id="d74e9-134">Las siguientes restricciones se aplican a los ensamblados recopilables:</span><span class="sxs-lookup"><span data-stu-id="d74e9-134">The following restrictions apply to collectible assemblies:</span></span> 

- <span data-ttu-id="d74e9-135">**Referencias estáticas** </span><span class="sxs-lookup"><span data-stu-id="d74e9-135">**Static references** </span></span>  
  <span data-ttu-id="d74e9-136">Tipos en un ensamblado dinámico normal no pueden tener referencias estáticas a tipos que se definen en un ensamblado recopilable.</span><span class="sxs-lookup"><span data-stu-id="d74e9-136">Types in an ordinary dynamic assembly cannot have static references to types that are defined in a collectible assembly.</span></span> <span data-ttu-id="d74e9-137">Por ejemplo, si define un tipo normal que hereda de un tipo en un ensamblado recopilable, un <xref:System.NotSupportedException> se produce la excepción.</span><span class="sxs-lookup"><span data-stu-id="d74e9-137">For example, if you define an ordinary type that inherits from a type in a collectible assembly, a <xref:System.NotSupportedException> exception is thrown.</span></span> <span data-ttu-id="d74e9-138">Un tipo en un ensamblado recopilable puede tener referencias estáticas a un tipo en otro ensamblado recopilable, pero esto extiende la duración del ensamblado que se hace referencia a la duración del ensamblado de referencia.</span><span class="sxs-lookup"><span data-stu-id="d74e9-138">A type in a collectible assembly can have static references to a type in another collectible assembly, but this extends the lifetime of the referenced assembly to the lifetime of the referencing assembly.</span></span>

- <span data-ttu-id="d74e9-139">**Interoperabilidad COM** </span><span class="sxs-lookup"><span data-stu-id="d74e9-139">**COM interop** </span></span>  
   <span data-ttu-id="d74e9-140">No hay ninguna interfaz COM se puede definir dentro de un ensamblado recopilable y ninguna instancia de tipos dentro de un ensamblado recopilable se puede convertir en objetos COM.</span><span class="sxs-lookup"><span data-stu-id="d74e9-140">No COM interfaces can be defined within a collectible assembly, and no instances of types within a collectible assembly can be converted into COM objects.</span></span> <span data-ttu-id="d74e9-141">Un tipo en un ensamblado recopilable no puede actuar como un contenedor COM invocable (CCW) o el contenedor invocable en tiempo de ejecución (RCW).</span><span class="sxs-lookup"><span data-stu-id="d74e9-141">A type in a collectible assembly cannot serve as a COM callable wrapper (CCW) or runtime callable wrapper (RCW).</span></span> <span data-ttu-id="d74e9-142">Sin embargo, los tipos de ensamblados recopilables pueden usar objetos que implementan interfaces COM.</span><span class="sxs-lookup"><span data-stu-id="d74e9-142">However, types in collectible assemblies can use objects that implement COM interfaces.</span></span>

- <span data-ttu-id="d74e9-143">**Invocación de plataforma** </span><span class="sxs-lookup"><span data-stu-id="d74e9-143">**Platform invoke** </span></span>  
   <span data-ttu-id="d74e9-144">Métodos que tienen el <xref:System.Runtime.InteropServices.DllImportAttribute> no se compilará el atributo cuando se declaran en un ensamblado recopilable.</span><span class="sxs-lookup"><span data-stu-id="d74e9-144">Methods that have the <xref:System.Runtime.InteropServices.DllImportAttribute> attribute will not compile when they are declared in a collectible assembly.</span></span> <span data-ttu-id="d74e9-145">El <xref:System.Reflection.Emit.OpCodes.Calli?displayProperty=nameWithType> no se puede usar la instrucción en la implementación de un tipo en un ensamblado recopilable y no se puede ordenar estos tipos a código no administrado.</span><span class="sxs-lookup"><span data-stu-id="d74e9-145">The <xref:System.Reflection.Emit.OpCodes.Calli?displayProperty=nameWithType> instruction cannot be used in the implementation of a type in a collectible assembly, and such types cannot be marshaled to unmanaged code.</span></span> <span data-ttu-id="d74e9-146">Sin embargo, se puede llamar a código nativo mediante el uso de un punto de entrada que se declara en un ensamblado no recopilable.</span><span class="sxs-lookup"><span data-stu-id="d74e9-146">However, you can call into native code by using an entry point that is declared in a non-collectible assembly.</span></span>
 
- <span data-ttu-id="d74e9-147">**El cálculo de referencias** </span><span class="sxs-lookup"><span data-stu-id="d74e9-147">**Marshaling** </span></span>  
   <span data-ttu-id="d74e9-148">No se pueden calcular las referencias de objetos (en particular, delegados) que se definen en ensamblados recopilables.</span><span class="sxs-lookup"><span data-stu-id="d74e9-148">Objects (in particular, delegates) that are defined in collectible assemblies cannot be marshaled.</span></span> <span data-ttu-id="d74e9-149">Se trata de una restricción en todos los tipos transitorios emitidos.</span><span class="sxs-lookup"><span data-stu-id="d74e9-149">This is a restriction on all transient emitted types.</span></span>

- <span data-ttu-id="d74e9-150">**Carga de ensamblados** </span><span class="sxs-lookup"><span data-stu-id="d74e9-150">**Assembly loading** </span></span>  
   <span data-ttu-id="d74e9-151">La emisión de reflexión es el único mecanismo que se admite para cargar ensamblados recopilables.</span><span class="sxs-lookup"><span data-stu-id="d74e9-151">Reflection emit is the only mechanism that is supported for loading collectible assemblies.</span></span> <span data-ttu-id="d74e9-152">Ensamblados que se cargan mediante el uso de cualquier otra forma de carga de ensamblado no se pueden descargar.</span><span class="sxs-lookup"><span data-stu-id="d74e9-152">Assemblies that are loaded by using any other form of assembly loading cannot be unloaded.</span></span>
 
- <span data-ttu-id="d74e9-153">**Objetos enlazados a un contexto**  </span><span class="sxs-lookup"><span data-stu-id="d74e9-153">**Context-bound objects**  </span></span>  
   <span data-ttu-id="d74e9-154">No se admiten variables de contexto estático.</span><span class="sxs-lookup"><span data-stu-id="d74e9-154">Context-static variables are not supported.</span></span> <span data-ttu-id="d74e9-155">No se pueden extender tipos en un ensamblado recopilable <xref:System.ContextBoundObject>.</span><span class="sxs-lookup"><span data-stu-id="d74e9-155">Types in a collectible assembly cannot extend <xref:System.ContextBoundObject>.</span></span> <span data-ttu-id="d74e9-156">Sin embargo, código de ensamblados recopilables puede usar objetos enlazados a un contexto que se definen en otro lugar.</span><span class="sxs-lookup"><span data-stu-id="d74e9-156">However, code in collectible assemblies can use context-bound objects that are defined elsewhere.</span></span>

- <span data-ttu-id="d74e9-157">**Datos estáticos de subproceso**     </span><span class="sxs-lookup"><span data-stu-id="d74e9-157">**Thread-static data**     </span></span>  
   <span data-ttu-id="d74e9-158">No se admiten variables de subproceso estático.</span><span class="sxs-lookup"><span data-stu-id="d74e9-158">Thread-static variables are not supported.</span></span>

## <a name="see-also"></a><span data-ttu-id="d74e9-159">Vea también</span><span class="sxs-lookup"><span data-stu-id="d74e9-159">See also</span></span>

[<span data-ttu-id="d74e9-160">Emitir métodos y ensamblados dinámicos</span><span class="sxs-lookup"><span data-stu-id="d74e9-160">Emitting Dynamic Methods and Assemblies</span></span>](emitting-dynamic-methods-and-assemblies.md)
