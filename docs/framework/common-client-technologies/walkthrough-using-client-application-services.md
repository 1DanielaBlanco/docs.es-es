---
title: 'Tutorial: Usar servicios de aplicaciones cliente'
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
helpviewer_keywords:
- application services host [client application services]
- client application services, walkthroughs
ms.assetid: bb7c8950-4517-4dae-b705-b74a14059b26
ms.openlocfilehash: b800848fc3cefb1f82fb5822007bc670c1684363
ms.sourcegitcommit: 3c1c3ba79895335ff3737934e39372555ca7d6d0
ms.translationtype: HT
ms.contentlocale: es-ES
ms.lasthandoff: 09/06/2018
ms.locfileid: "43788933"
---
# <a name="walkthrough-using-client-application-services"></a><span data-ttu-id="d5a55-102">Tutorial: Usar servicios de aplicaciones cliente</span><span class="sxs-lookup"><span data-stu-id="d5a55-102">Walkthrough: Using Client Application Services</span></span>
<span data-ttu-id="d5a55-103">En este tema se describe cómo crear una aplicación de Windows que usa los servicios de aplicaciones cliente para autenticar usuarios y recuperar la configuración y los roles de usuario.</span><span class="sxs-lookup"><span data-stu-id="d5a55-103">This topic describes how to create a Windows application that uses client application services to authenticate users and retrieve user roles and settings.</span></span>  
  
 <span data-ttu-id="d5a55-104">En este tutorial, realizará las tareas siguientes:</span><span class="sxs-lookup"><span data-stu-id="d5a55-104">In this walkthrough, you perform the following tasks:</span></span>  
  
-   <span data-ttu-id="d5a55-105">Cree una aplicación de Windows Forms y use el diseñador de proyectos de Visual Studio para habilitar y configurar servicios de aplicaciones cliente.</span><span class="sxs-lookup"><span data-stu-id="d5a55-105">Create a Windows Forms application and use the Visual Studio project designer to enable and configure client application services.</span></span>  
  
-   <span data-ttu-id="d5a55-106">Cree una aplicación simple de servicio web ASP.NET para hospedar los servicios de aplicación y probar la configuración del cliente.</span><span class="sxs-lookup"><span data-stu-id="d5a55-106">Create a simple ASP.NET Web Service application to host the application services and test your client configuration.</span></span>  
  
-   <span data-ttu-id="d5a55-107">Agregue la autenticación mediante formularios a la aplicación.</span><span class="sxs-lookup"><span data-stu-id="d5a55-107">Add forms authentication to your application.</span></span> <span data-ttu-id="d5a55-108">Comenzará usando un nombre de usuario y una contraseña codificados de forma rígida para probar el servicio.</span><span class="sxs-lookup"><span data-stu-id="d5a55-108">You will start by using a hard-coded user name and password to test the service.</span></span> <span data-ttu-id="d5a55-109">A continuación, agregará un formulario de inicio de sesión especificándolo como proveedor de credenciales en la configuración de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="d5a55-109">You will then add a login form by specifying it as a credentials provider in your application configuration.</span></span>  
  
-   <span data-ttu-id="d5a55-110">Agregue funcionalidad basada en roles, habilitando y mostrando un botón solo para los usuarios con el rol de administrador.</span><span class="sxs-lookup"><span data-stu-id="d5a55-110">Add role-based functionality, enabling and displaying a button only for users in the "manager" role.</span></span>  
  
-   <span data-ttu-id="d5a55-111">Acceda a la configuración web.</span><span class="sxs-lookup"><span data-stu-id="d5a55-111">Access Web settings.</span></span> <span data-ttu-id="d5a55-112">Comenzará cargando la configuración web de un usuario autenticado (de prueba) en la página **Configuración** del diseñador de proyectos.</span><span class="sxs-lookup"><span data-stu-id="d5a55-112">You will start by loading Web settings for an authenticated (test) user on the **Settings** page of the project designer.</span></span> <span data-ttu-id="d5a55-113">A continuación, usará el Diseñador de Windows Forms para enlazar un cuadro de texto a una configuración web.</span><span class="sxs-lookup"><span data-stu-id="d5a55-113">You will then use the Windows Forms Designer to bind a text box to a Web setting.</span></span> <span data-ttu-id="d5a55-114">Por último, guardará el valor modificado en el servidor.</span><span class="sxs-lookup"><span data-stu-id="d5a55-114">Finally, you will save the modified value back to the server.</span></span>  
  
-   <span data-ttu-id="d5a55-115">Implemente el cierre de sesión.</span><span class="sxs-lookup"><span data-stu-id="d5a55-115">Implement logout.</span></span> <span data-ttu-id="d5a55-116">Agregará una opción de cierre de sesión al formulario y llamará a un método de cierre de sesión.</span><span class="sxs-lookup"><span data-stu-id="d5a55-116">You will add a logout option to the form and call a logout method.</span></span>  
  
-   <span data-ttu-id="d5a55-117">Habilite el modo sin conexión.</span><span class="sxs-lookup"><span data-stu-id="d5a55-117">Enable offline mode.</span></span> <span data-ttu-id="d5a55-118">Proporcionará una casilla para que los usuarios puedan especificar su estado de conexión.</span><span class="sxs-lookup"><span data-stu-id="d5a55-118">You will provide a check box so that users can specify their connection status.</span></span> <span data-ttu-id="d5a55-119">A continuación, usará este valor para especificar si los proveedores de servicios de aplicaciones cliente usarán los datos almacenados en caché localmente en lugar de acceder a sus servicios web.</span><span class="sxs-lookup"><span data-stu-id="d5a55-119">You will then use this value to specify whether the client application service providers will use locally cached data instead of accessing their Web services.</span></span> <span data-ttu-id="d5a55-120">Por último, volverá a autenticar al usuario actual cuando la aplicación vuelva al modo en línea.</span><span class="sxs-lookup"><span data-stu-id="d5a55-120">Finally, you will re-authenticate the current user when the application returns to online mode.</span></span>  
  
## <a name="prerequisites"></a><span data-ttu-id="d5a55-121">Requisitos previos</span><span class="sxs-lookup"><span data-stu-id="d5a55-121">Prerequisites</span></span>  
 <span data-ttu-id="d5a55-122">Necesita el componente siguiente para completar este tutorial:</span><span class="sxs-lookup"><span data-stu-id="d5a55-122">You need the following component to complete this walkthrough:</span></span>  
  
-   [!INCLUDE[vs_orcas_long](../../../includes/vs-orcas-long-md.md)]<span data-ttu-id="d5a55-123">.</span><span class="sxs-lookup"><span data-stu-id="d5a55-123">.</span></span>  
  
## <a name="creating-the-client-application"></a><span data-ttu-id="d5a55-124">Crear la aplicación cliente.</span><span class="sxs-lookup"><span data-stu-id="d5a55-124">Creating the Client Application</span></span>  
 <span data-ttu-id="d5a55-125">Lo primero que hará es crear un proyecto de Windows Forms.</span><span class="sxs-lookup"><span data-stu-id="d5a55-125">The first thing that you will do is create a Windows Forms project.</span></span> <span data-ttu-id="d5a55-126">Este tutorial usa Windows Forms porque más personas están familiarizadas con él, pero el proceso es similar para los proyectos de Windows Presentation Foundation (WPF).</span><span class="sxs-lookup"><span data-stu-id="d5a55-126">This walkthrough uses Windows Forms because more people are familiar with it, but the process is similar for Windows Presentation Foundation (WPF) projects.</span></span>  
  
#### <a name="to-create-a-client-application-and-enable-client-application-services"></a><span data-ttu-id="d5a55-127">Para crear una aplicación cliente y habilitar servicios de aplicaciones cliente</span><span class="sxs-lookup"><span data-stu-id="d5a55-127">To create a client application and enable client application services</span></span>  
  
1.  <span data-ttu-id="d5a55-128">En Visual Studio, seleccione la opción de menú **Archivo &#124; Nuevo &#124; Proyecto**.</span><span class="sxs-lookup"><span data-stu-id="d5a55-128">In Visual Studio, select the **File &#124; New &#124; Project** menu option.</span></span>  
  
2.  <span data-ttu-id="d5a55-129">En el cuadro de diálogo **Nuevo proyecto**, en el panel **Tipos de proyecto**, expanda el nodo **Visual Basic** o **Visual C#** y seleccione el tipo de proyecto **Windows**.</span><span class="sxs-lookup"><span data-stu-id="d5a55-129">In the **New Project** dialog box, in the **Project types** pane, expand the **Visual Basic** or **Visual C#** node and select the **Windows** project type.</span></span>  
  
3.  <span data-ttu-id="d5a55-130">Asegúrese de que está seleccionado **.NET Framework 3.5** y, a continuación, seleccione la plantilla de **Aplicación de Windows Forms** .</span><span class="sxs-lookup"><span data-stu-id="d5a55-130">Make sure that **.NET Framework 3.5** is selected, and then select the **Windows Forms Application** template.</span></span>  
  
4.  <span data-ttu-id="d5a55-131">Cambie el valor de **Nombre** del proyecto a `ClientAppServicesDemo`y haga clic en **Aceptar**.</span><span class="sxs-lookup"><span data-stu-id="d5a55-131">Change the project **Name** to `ClientAppServicesDemo`, and then click **OK**.</span></span>  
  
     <span data-ttu-id="d5a55-132">Se abre un nuevo proyecto de Windows Forms en Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="d5a55-132">A new Windows Forms project is opened in Visual Studio.</span></span>  
  
5.  <span data-ttu-id="d5a55-133">En el menú **Proyecto** , seleccione **Propiedades de ClientAppServicesDemo**.</span><span class="sxs-lookup"><span data-stu-id="d5a55-133">On the **Project** menu, select **ClientAppServicesDemo Properties**.</span></span>  
  
     <span data-ttu-id="d5a55-134">Aparece el diseñador de proyectos.</span><span class="sxs-lookup"><span data-stu-id="d5a55-134">The project designer appears.</span></span>  
  
6.  <span data-ttu-id="d5a55-135">En la pestaña **Servicios** , seleccione **Habilitar servicios de aplicaciones cliente**.</span><span class="sxs-lookup"><span data-stu-id="d5a55-135">On the **Services** tab, select **Enable client application services**.</span></span>  
  
7.  <span data-ttu-id="d5a55-136">Asegúrese de que esté seleccionada la opción **Usar autenticación de formularios** y, luego, establezca **Ubicación del servicio de autenticación**, **Ubicación del servicio de roles**y **Ubicación del servicio de configuración web** al valor `http://localhost:55555/AppServices`.</span><span class="sxs-lookup"><span data-stu-id="d5a55-136">Make sure that **Use Forms authentication** is selected, and then set **Authentication service location**, **Roles service location**, and **Web settings service location** to `http://localhost:55555/AppServices`.</span></span>  
  
8.  <span data-ttu-id="d5a55-137">En Visual Basic, en la pestaña **Aplicación**, establezca **Modo de autenticación** en **Definido por la aplicación**.</span><span class="sxs-lookup"><span data-stu-id="d5a55-137">For Visual Basic, on the **Application** tab, set **Authentication mode** to **Application-defined**.</span></span>  
  
 <span data-ttu-id="d5a55-138">El diseñador almacena los valores especificados en el archivo app.config de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="d5a55-138">The designer stores the specified settings in the application's app.config file.</span></span>  
  
 <span data-ttu-id="d5a55-139">En este punto, la aplicación está configurada para acceder a los tres servicios del mismo host.</span><span class="sxs-lookup"><span data-stu-id="d5a55-139">At this point, the application is configured to access all three services from the same host.</span></span> <span data-ttu-id="d5a55-140">En la siguiente sección, creará el host como una aplicación de servicio web simple, lo que le permite probar la configuración de cliente.</span><span class="sxs-lookup"><span data-stu-id="d5a55-140">In the next section, you will create the host as a simple Web service application, enabling you to test your client configuration.</span></span>  
  
## <a name="creating-the-application-services-host"></a><span data-ttu-id="d5a55-141">Crear el host de servicios de aplicación</span><span class="sxs-lookup"><span data-stu-id="d5a55-141">Creating the Application Services Host</span></span>  
 <span data-ttu-id="d5a55-142">En esta sección, creará una aplicación de servicio web simple que tiene acceso a los datos del usuario desde un archivo de base de datos local de SQL Server Compact.</span><span class="sxs-lookup"><span data-stu-id="d5a55-142">In this section, you will create a simple Web service application that accesses user data from a local SQL Server Compact database file.</span></span> <span data-ttu-id="d5a55-143">Tras ello, rellenará la base de datos mediante la [ASP.NET Web Site Administration Tool](https://msdn.microsoft.com/library/100ddd8b-7d11-4df9-91ef-0bbbe92e5aec).</span><span class="sxs-lookup"><span data-stu-id="d5a55-143">Then, you will populate the database using the [ASP.NET Web Site Administration Tool](https://msdn.microsoft.com/library/100ddd8b-7d11-4df9-91ef-0bbbe92e5aec).</span></span> <span data-ttu-id="d5a55-144">Esta sencilla configuración permite probar rápidamente la aplicación cliente.</span><span class="sxs-lookup"><span data-stu-id="d5a55-144">This simple configuration enables you to quickly test your client application.</span></span> <span data-ttu-id="d5a55-145">Como alternativa, puede configurar el host del servicio web para acceder a los datos del usuario desde una base de datos completa de SQL Server o a través de las clases personalizadas <xref:System.Web.Security.MembershipProvider> y <xref:System.Web.Security.RoleProvider> .</span><span class="sxs-lookup"><span data-stu-id="d5a55-145">As an alternative, you can configure the Web service host to access user data from a full SQL Server database or through custom <xref:System.Web.Security.MembershipProvider> and <xref:System.Web.Security.RoleProvider> classes.</span></span> <span data-ttu-id="d5a55-146">Para obtener más información, consulta [Creating and Configuring the Application Services Database for SQL Server](https://msdn.microsoft.com/library/ab894e83-7e2f-4af8-a116-b1bff8f815b2).</span><span class="sxs-lookup"><span data-stu-id="d5a55-146">For more information, see [Creating and Configuring the Application Services Database for SQL Server](https://msdn.microsoft.com/library/ab894e83-7e2f-4af8-a116-b1bff8f815b2).</span></span>  
  
 <span data-ttu-id="d5a55-147">En el siguiente procedimiento, creará y configurará el servicio web AppServices.</span><span class="sxs-lookup"><span data-stu-id="d5a55-147">In the following procedure, you create and configure the AppServices Web service.</span></span>  
  
#### <a name="to-create-and-configure-the-application-services-host"></a><span data-ttu-id="d5a55-148">Para crear y configurar el host de servicios de aplicación</span><span class="sxs-lookup"><span data-stu-id="d5a55-148">To create and configure the application services host</span></span>  
  
1.  <span data-ttu-id="d5a55-149">En el **Explorador de soluciones**, seleccione la solución ClientAppServicesDemo y, en el menú **Archivo**, seleccione **Agregar &#124; Nuevo proyecto**.</span><span class="sxs-lookup"><span data-stu-id="d5a55-149">In **Solution Explorer**, select the ClientAppServicesDemo solution, and then on the **File** menu, select **Add &#124; New Project**.</span></span>  
  
2.  <span data-ttu-id="d5a55-150">En el cuadro de diálogo **Agregar nuevo proyecto**, en el panel **Tipos de proyecto**, expanda el nodo **Visual Basic** o **Visual C#** y seleccione el tipo de proyecto **Web**.</span><span class="sxs-lookup"><span data-stu-id="d5a55-150">In the **Add New Project** dialog box, in the **Project types** pane, expand the **Visual Basic** or **Visual C#** node and select the **Web** project type.</span></span>  
  
3.  <span data-ttu-id="d5a55-151">Asegúrese de que está seleccionado **.NET Framework 3.5** y, a continuación, seleccione la plantilla de **Aplicación de servicios web ASP.NET** .</span><span class="sxs-lookup"><span data-stu-id="d5a55-151">Make sure that **.NET Framework 3.5** is selected, and then select the **ASP.NET Web Service Application** template.</span></span>  
  
4.  <span data-ttu-id="d5a55-152">Cambie el valor de **Nombre** del proyecto a `AppServices` y haga clic en **Aceptar**.</span><span class="sxs-lookup"><span data-stu-id="d5a55-152">Change the project **Name** to `AppServices` and then click **OK**.</span></span>  
  
     <span data-ttu-id="d5a55-153">Se agrega a la solución un nuevo proyecto de aplicación de servicio web ASP.NET y el archivo Service1.asmx.vb o Service1.asmx.cs aparece en el editor.</span><span class="sxs-lookup"><span data-stu-id="d5a55-153">A new ASP.NET Web service application project is added to the solution, and the Service1.asmx.vb or Service1.asmx.cs file appears in the editor.</span></span>  
  
    > [!NOTE]
    >  <span data-ttu-id="d5a55-154">El archivo Service1.asmx.vb o Service1.asmx.cs no se usa en este ejemplo.</span><span class="sxs-lookup"><span data-stu-id="d5a55-154">The Service1.asmx.vb or Service1.asmx.cs file is not used in this example.</span></span> <span data-ttu-id="d5a55-155">Si desea mantener el entorno de trabajo despejado, puede cerrarlo y eliminarlo del **Explorador de soluciones**.</span><span class="sxs-lookup"><span data-stu-id="d5a55-155">If you want to keep your work environment uncluttered, you can close it and delete it from **Solution Explorer**.</span></span>  
  
5.  <span data-ttu-id="d5a55-156">En el **Explorador de soluciones**, seleccione el proyecto AppServices y, a continuación, en el menú **Proyecto** , seleccione **Propiedades de AppServices**.</span><span class="sxs-lookup"><span data-stu-id="d5a55-156">In **Solution Explorer**, select the AppServices project, and then on the **Project** menu, select **AppServices Properties**.</span></span>  
  
     <span data-ttu-id="d5a55-157">Aparece el diseñador de proyectos.</span><span class="sxs-lookup"><span data-stu-id="d5a55-157">The project designer appears.</span></span>  
  
6.  <span data-ttu-id="d5a55-158">En la pestaña **Web** , asegúrese de que está seleccionado **Usar el servidor de desarrollo de Visual Studio** .</span><span class="sxs-lookup"><span data-stu-id="d5a55-158">On the **Web** tab, make sure that **Use Visual Studio Development Server** is selected.</span></span>  
  
7.  <span data-ttu-id="d5a55-159">Seleccione **Puerto específico**, especifique un valor de `55555`y después establezca el valor de **Ruta de acceso virtual** a `/AppServices`.</span><span class="sxs-lookup"><span data-stu-id="d5a55-159">Select **Specific port**, specify a value of `55555`, and then set **Virtual path** to `/AppServices`.</span></span>  
  
8.  <span data-ttu-id="d5a55-160">Guarde todos los archivos.</span><span class="sxs-lookup"><span data-stu-id="d5a55-160">Save all files.</span></span>  
  
9. <span data-ttu-id="d5a55-161">En el **Explorador de soluciones**, abra el archivo Web.config y busque la etiqueta de apertura `<system.web>` .</span><span class="sxs-lookup"><span data-stu-id="d5a55-161">In **Solution Explorer**, open Web.config and find the `<system.web>` opening tag.</span></span>  
  
10. <span data-ttu-id="d5a55-162">Agregue el siguiente marcado antes de la etiqueta `<system.web>` .</span><span class="sxs-lookup"><span data-stu-id="d5a55-162">Add the following markup before the `<system.web>` tag.</span></span>  
  
     <span data-ttu-id="d5a55-163">Los elementos `authenticationService`, `profileService`y `roleService` de este marcado habilitan y configuran los servicios de aplicación.</span><span class="sxs-lookup"><span data-stu-id="d5a55-163">The `authenticationService`, `profileService`, and `roleService` elements in this markup enable and configure the application services.</span></span> <span data-ttu-id="d5a55-164">Para realizar pruebas, el atributo `requireSSL` del elemento `authenticationService` se establece en "false".</span><span class="sxs-lookup"><span data-stu-id="d5a55-164">For testing purposes, the `requireSSL` attribute of the `authenticationService` element is set to "false".</span></span> <span data-ttu-id="d5a55-165">Los atributos `readAccessProperties` y `writeAccessProperties` del elemento `profileService` indican que la propiedad `WebSettingsTestText` es de lectura/escritura.</span><span class="sxs-lookup"><span data-stu-id="d5a55-165">The `readAccessProperties` and `writeAccessProperties` attributes of the `profileService` element indicate that the `WebSettingsTestText` property is read/write.</span></span>  
  
    > [!NOTE]
    >  <span data-ttu-id="d5a55-166">En el código de producción, siempre debería acceder al servicio de autenticación a través de la capa de sockets seguros (SSL, mediante el protocolo HTTPS).</span><span class="sxs-lookup"><span data-stu-id="d5a55-166">In production code, you should always access the authentication service over the secure sockets layer (SSL, by using the HTTPS protocol).</span></span> <span data-ttu-id="d5a55-167">Para obtener información sobre cómo configurar SSL, consulte [Configurar la capa de sockets seguros](https://go.microsoft.com/fwlink/?LinkId=91844).</span><span class="sxs-lookup"><span data-stu-id="d5a55-167">For information about how to set up SSL, see [Configuring Secure Sockets Layer (IIS 6.0 Operations Guide)](https://go.microsoft.com/fwlink/?LinkId=91844).</span></span>  
  
    ```xml  
    <system.web.extensions>  
      <scripting>  
        <webServices>  
          <authenticationService enabled="true" requireSSL = "false"/>  
          <profileService enabled="true"  
            readAccessProperties="WebSettingsTestText"  
            writeAccessProperties="WebSettingsTestText" />  
          <roleService enabled="true"/>  
        </webServices>  
      </scripting>  
    </system.web.extensions>  
    ```  
  
11. <span data-ttu-id="d5a55-168">Agregue el siguiente marcado después de la etiqueta de apertura `<system.web>` para que esté dentro del elemento `<system.web>` .</span><span class="sxs-lookup"><span data-stu-id="d5a55-168">Add the following markup after the `<system.web>` opening tag so that it is within the `<system.web>` element.</span></span>  
  
     <span data-ttu-id="d5a55-169">El elemento `profile` configura una sola configuración de sitio web llamada `WebSettingsTestText`.</span><span class="sxs-lookup"><span data-stu-id="d5a55-169">The `profile` element configures a single Web setting named `WebSettingsTestText`.</span></span>  
  
    ```xml  
    <profile enabled="true" >  
      <properties>  
        <add name="WebSettingsTestText" type="string"   
          readOnly="false" defaultValue="DefaultText"   
          serializeAs="String" allowAnonymous="false" />  
      </properties>  
    </profile>  
    ```  
  
 <span data-ttu-id="d5a55-170">En el siguiente procedimiento, usará la herramienta Administración de sitios web de ASP.NET para completar la configuración del servicio y rellenar el archivo de base de datos local.</span><span class="sxs-lookup"><span data-stu-id="d5a55-170">In the following procedure, you use the ASP.NET Web Site Administration tool to complete the service configuration and populate the local database file.</span></span> <span data-ttu-id="d5a55-171">Agregará dos usuarios, denominados `employee` y `manager` , que pertenecen a dos roles con los mismos nombres.</span><span class="sxs-lookup"><span data-stu-id="d5a55-171">You will add two users named `employee` and `manager` belonging to two roles with the same names.</span></span> <span data-ttu-id="d5a55-172">Las contraseñas de usuario son `employee!` y `manager!` , respectivamente.</span><span class="sxs-lookup"><span data-stu-id="d5a55-172">The user passwords are `employee!` and `manager!` respectively.</span></span>  
  
#### <a name="to-configure-membership-and-roles"></a><span data-ttu-id="d5a55-173">Para configurar la pertenencia y los roles</span><span class="sxs-lookup"><span data-stu-id="d5a55-173">To configure membership and roles</span></span>  
  
1.  <span data-ttu-id="d5a55-174">En el **Explorador de soluciones**, seleccione el proyecto AppServices y, a continuación, en el menú **Proyecto** , seleccione **Configuración de ASP.NET**.</span><span class="sxs-lookup"><span data-stu-id="d5a55-174">In **Solution Explorer**, select the AppServices project, and then on the **Project** menu, select **ASP.NET Configuration**.</span></span>  
  
     <span data-ttu-id="d5a55-175">Aparece la **Herramienta Administración de sitios web de ASP.NET** .</span><span class="sxs-lookup"><span data-stu-id="d5a55-175">The **ASP.NET Web Site Administration Tool** appears.</span></span>  
  
2.  <span data-ttu-id="d5a55-176">En la pestaña **Seguridad** , haga clic en **Usar el Asistente para la configuración de seguridad para configurar la seguridad paso a paso**.</span><span class="sxs-lookup"><span data-stu-id="d5a55-176">On the **Security** tab, click **Use the security Setup Wizard to configure security step by step**.</span></span>  
  
     <span data-ttu-id="d5a55-177">El **Asistente para configurar la seguridad** aparece y muestra el paso **Página principal** .</span><span class="sxs-lookup"><span data-stu-id="d5a55-177">The **Security Setup Wizard** appears and displays the **Welcome** step.</span></span>  
  
3.  <span data-ttu-id="d5a55-178">Haga clic en **Siguiente**.</span><span class="sxs-lookup"><span data-stu-id="d5a55-178">Click **Next**.</span></span>  
  
     <span data-ttu-id="d5a55-179">Aparece el paso **Seleccionar el método de acceso** .</span><span class="sxs-lookup"><span data-stu-id="d5a55-179">The **Select Access Method** step appears.</span></span>  
  
4.  <span data-ttu-id="d5a55-180">Seleccione **Desde Internet**.</span><span class="sxs-lookup"><span data-stu-id="d5a55-180">Select **From the internet**.</span></span> <span data-ttu-id="d5a55-181">Esto configura el servicio de modo que use la autenticación mediante formularios en lugar de la autenticación de Windows.</span><span class="sxs-lookup"><span data-stu-id="d5a55-181">This configures the service to use Forms authentication instead of Windows authentication.</span></span>  
  
5.  <span data-ttu-id="d5a55-182">Haga clic en **Siguiente** dos veces.</span><span class="sxs-lookup"><span data-stu-id="d5a55-182">Click **Next** twice.</span></span>  
  
     <span data-ttu-id="d5a55-183">Aparece el paso **Definir roles** .</span><span class="sxs-lookup"><span data-stu-id="d5a55-183">The **Define Roles** step appears.</span></span>  
  
6.  <span data-ttu-id="d5a55-184">Seleccione **Habilitar los roles para este sitio web**.</span><span class="sxs-lookup"><span data-stu-id="d5a55-184">Select **Enable roles for this Web site**.</span></span>  
  
7.  <span data-ttu-id="d5a55-185">Haga clic en **Siguiente**.</span><span class="sxs-lookup"><span data-stu-id="d5a55-185">Click **Next**.</span></span> <span data-ttu-id="d5a55-186">Aparece el formulario **Crear nuevo rol** .</span><span class="sxs-lookup"><span data-stu-id="d5a55-186">The **Create New Role** form appears.</span></span>  
  
8.  <span data-ttu-id="d5a55-187">En el cuadro de texto **Nombre nuevo de rol** , escriba `manager` y, después, haga clic en **Agregar rol**.</span><span class="sxs-lookup"><span data-stu-id="d5a55-187">In the **New Role Name** text box, type `manager` and then click **Add Role**.</span></span>  
  
     <span data-ttu-id="d5a55-188">Aparece la tabla **Roles existentes** con el valor especificado.</span><span class="sxs-lookup"><span data-stu-id="d5a55-188">The **Existing Roles** table appears with the specified value.</span></span>  
  
9. <span data-ttu-id="d5a55-189">En el cuadro de texto **Nombre nuevo de rol** , reemplace `manager` con `employee` y haga clic en **Agregar rol**.</span><span class="sxs-lookup"><span data-stu-id="d5a55-189">In the **New Role Name** text box, replace `manager` with `employee` and then click **Add Role**.</span></span>  
  
     <span data-ttu-id="d5a55-190">El nuevo valor aparece en la tabla **Roles existentes** .</span><span class="sxs-lookup"><span data-stu-id="d5a55-190">The new value appears in the **Existing Roles** table.</span></span>  
  
10. <span data-ttu-id="d5a55-191">Haga clic en **Siguiente**.</span><span class="sxs-lookup"><span data-stu-id="d5a55-191">Click **Next**.</span></span>  
  
     <span data-ttu-id="d5a55-192">Aparece el paso **Agregar usuarios nuevos** .</span><span class="sxs-lookup"><span data-stu-id="d5a55-192">The **Add New Users** step appears.</span></span>  
  
11. <span data-ttu-id="d5a55-193">En el formulario **Crear usuario** , especifique los valores siguientes.</span><span class="sxs-lookup"><span data-stu-id="d5a55-193">In the **Create User** form, specify the following values.</span></span>  
  
  	|||  
  	|-|-|  
  	|<span data-ttu-id="d5a55-194">**Nombre de usuario**</span><span class="sxs-lookup"><span data-stu-id="d5a55-194">**User Name**</span></span>|`manager`|  
  	|<span data-ttu-id="d5a55-195">**Contraseña**</span><span class="sxs-lookup"><span data-stu-id="d5a55-195">**Password**</span></span>|`manager!`|  
  	|<span data-ttu-id="d5a55-196">**Confirmar contraseña**</span><span class="sxs-lookup"><span data-stu-id="d5a55-196">**Confirm Password**</span></span>|`manager!`|  
  	|<span data-ttu-id="d5a55-197">**Correo electrónico**</span><span class="sxs-lookup"><span data-stu-id="d5a55-197">**Email**</span></span>|`manager@contoso.com`|  
  	|<span data-ttu-id="d5a55-198">**Pregunta de seguridad**</span><span class="sxs-lookup"><span data-stu-id="d5a55-198">**Security Question**</span></span>|`manager`|  
  	|<span data-ttu-id="d5a55-199">**Respuesta de seguridad**</span><span class="sxs-lookup"><span data-stu-id="d5a55-199">**Security Answer**</span></span>|`manager`|  
  
12. <span data-ttu-id="d5a55-200">Haga clic en **Crear usuario**.</span><span class="sxs-lookup"><span data-stu-id="d5a55-200">Click **Create User**.</span></span>  
  
     <span data-ttu-id="d5a55-201">Aparece un mensaje que indica que la operación es correcta.</span><span class="sxs-lookup"><span data-stu-id="d5a55-201">A success message appears.</span></span>  
  
    > [!NOTE]
    >  <span data-ttu-id="d5a55-202">En el formulario son necesarios los valores de **Correo electrónico**, **Pregunta de seguridad**y **Respuesta de seguridad**, pero no se usan en este ejemplo.</span><span class="sxs-lookup"><span data-stu-id="d5a55-202">The **Email**, **Security Question**, and **Security Answer** values are required by the form, but are not used in this example.</span></span>  
  
13. <span data-ttu-id="d5a55-203">Haga clic en **Continuar**.</span><span class="sxs-lookup"><span data-stu-id="d5a55-203">Click **Continue**.</span></span>  
  
     <span data-ttu-id="d5a55-204">Vuelve a aparecer el formulario **Crear usuario** .</span><span class="sxs-lookup"><span data-stu-id="d5a55-204">The **Create User** form reappears.</span></span>  
  
14. <span data-ttu-id="d5a55-205">En el formulario **Crear usuario** , especifique los valores siguientes.</span><span class="sxs-lookup"><span data-stu-id="d5a55-205">In the **Create User** form, specify the following values.</span></span>  
  
  	|||  
  	|-|-|  
  	|<span data-ttu-id="d5a55-206">**Nombre de usuario**</span><span class="sxs-lookup"><span data-stu-id="d5a55-206">**User Name**</span></span>|`employee`|  
  	|<span data-ttu-id="d5a55-207">**Contraseña**</span><span class="sxs-lookup"><span data-stu-id="d5a55-207">**Password**</span></span>|`employee!`|  
  	|<span data-ttu-id="d5a55-208">**Confirmar contraseña**</span><span class="sxs-lookup"><span data-stu-id="d5a55-208">**Confirm Password**</span></span>|`employee!`|  
  	|<span data-ttu-id="d5a55-209">**Correo electrónico**</span><span class="sxs-lookup"><span data-stu-id="d5a55-209">**Email**</span></span>|`employee@contoso.com`|  
  	|<span data-ttu-id="d5a55-210">**Pregunta de seguridad**</span><span class="sxs-lookup"><span data-stu-id="d5a55-210">**Security Question**</span></span>|`Employee`|  
  	|<span data-ttu-id="d5a55-211">**Respuesta de seguridad**</span><span class="sxs-lookup"><span data-stu-id="d5a55-211">**Security Answer**</span></span>|`employee`|  
  
15. <span data-ttu-id="d5a55-212">Haga clic en **Crear usuario**.</span><span class="sxs-lookup"><span data-stu-id="d5a55-212">Click **Create User**.</span></span>  
  
     <span data-ttu-id="d5a55-213">Aparece un mensaje que indica que la operación es correcta.</span><span class="sxs-lookup"><span data-stu-id="d5a55-213">A success message appears.</span></span>  
  
16. <span data-ttu-id="d5a55-214">Haga clic en **Finalizar**.</span><span class="sxs-lookup"><span data-stu-id="d5a55-214">Click **Finish**.</span></span>  
  
     <span data-ttu-id="d5a55-215">Vuelve a aparecer la **Herramienta Administración de sitios web** .</span><span class="sxs-lookup"><span data-stu-id="d5a55-215">The **Web Site Administration Tool** reappears.</span></span>  
  
17. <span data-ttu-id="d5a55-216">Haga clic en **Usuarios administradores**.</span><span class="sxs-lookup"><span data-stu-id="d5a55-216">Click **Manager users**.</span></span>  
  
     <span data-ttu-id="d5a55-217">Aparece la lista de usuarios.</span><span class="sxs-lookup"><span data-stu-id="d5a55-217">The list of users appears.</span></span>  
  
18. <span data-ttu-id="d5a55-218">Haga clic en **Editar roles** para el usuario **employee** y, a continuación, seleccione el rol **employee** .</span><span class="sxs-lookup"><span data-stu-id="d5a55-218">Click **Edit roles** for the **employee** user, and then select the **employee** role.</span></span>  
  
19. <span data-ttu-id="d5a55-219">Haga clic en **Editar roles** para el usuario **manager** y, a continuación, seleccione el rol **manager** .</span><span class="sxs-lookup"><span data-stu-id="d5a55-219">Click **Edit roles** for the **manager** user, and then select the **manager** role.</span></span>  
  
20. <span data-ttu-id="d5a55-220">Cierre la ventana del explorador que hospeda la **Herramienta Administración de sitios web**.</span><span class="sxs-lookup"><span data-stu-id="d5a55-220">Close the browser window that hosts the **Web Site Administration Tool**.</span></span>  
  
21. <span data-ttu-id="d5a55-221">Si aparece un cuadro de mensaje preguntándole si desea volver a cargar el archivo Web.config modificado, haga clic en **Sí**.</span><span class="sxs-lookup"><span data-stu-id="d5a55-221">If a message box appears asking if you want to reload the modified Web.config file, click **Yes**.</span></span>  
  
 <span data-ttu-id="d5a55-222">Esto completa la configuración del servicio web.</span><span class="sxs-lookup"><span data-stu-id="d5a55-222">This completes the Web service setup.</span></span> <span data-ttu-id="d5a55-223">En este punto, puede presionar F5 para ejecutar la aplicación cliente y el **servidor de desarrollo de ASP.NET** se iniciará automáticamente junto con la aplicación cliente.</span><span class="sxs-lookup"><span data-stu-id="d5a55-223">At this point, you can press F5 to run the client application, and the **ASP.NET Development Server** will start automatically along with your client application.</span></span> <span data-ttu-id="d5a55-224">El servidor seguirá ejecutándose después de que salga de la aplicación, pero se reiniciará cuando reinicie la aplicación.</span><span class="sxs-lookup"><span data-stu-id="d5a55-224">The server will continue to run after you exit the application, but will restart when you restart the application.</span></span> <span data-ttu-id="d5a55-225">Esto le permite detectar los cambios que haya realizado en Web.config.</span><span class="sxs-lookup"><span data-stu-id="d5a55-225">This allows it to detect any changes you have made to Web.config.</span></span>  
  
 <span data-ttu-id="d5a55-226">Para detener manualmente el servidor, haga clic con el botón derecho en el icono del servidor de desarrollo de ASP.NET en el área de notificación de la barra de tareas y, a continuación, haga clic en **Detener**.</span><span class="sxs-lookup"><span data-stu-id="d5a55-226">To stop the server manually, right-click the ASP.NET Development Server icon in the notification area of the taskbar and then click **Stop**.</span></span> <span data-ttu-id="d5a55-227">Esto resulta útil en ocasiones para asegurarse de que se produzca un reinicio limpio.</span><span class="sxs-lookup"><span data-stu-id="d5a55-227">This is useful occasionally to make sure that a clean restart occurs.</span></span>  
  
## <a name="adding-forms-authentication"></a><span data-ttu-id="d5a55-228">Agregar la autenticación mediante formularios</span><span class="sxs-lookup"><span data-stu-id="d5a55-228">Adding Forms Authentication</span></span>  
 <span data-ttu-id="d5a55-229">En el siguiente procedimiento, agregará código al formulario principal que intenta validar al usuario y que deniega el acceso cuando el usuario proporciona credenciales no válidas.</span><span class="sxs-lookup"><span data-stu-id="d5a55-229">In the following procedure, you add code to the main form that attempts to validate the user, and denies access when the user supplies invalid credentials.</span></span> <span data-ttu-id="d5a55-230">Usará un nombre de usuario y una contraseña codificados de forma rígida para probar el servicio.</span><span class="sxs-lookup"><span data-stu-id="d5a55-230">You use a hard-coded user name and password to test the service.</span></span>  
  
#### <a name="to-validate-the-user-in-your-application-code"></a><span data-ttu-id="d5a55-231">Para validar al usuario en el código de aplicación</span><span class="sxs-lookup"><span data-stu-id="d5a55-231">To validate the user in your application code</span></span>  
  
1.  <span data-ttu-id="d5a55-232">En el **Explorador de soluciones**, en el proyecto ClientAppServicesDemo, agregue una referencia al ensamblado System.Web.</span><span class="sxs-lookup"><span data-stu-id="d5a55-232">In **Solution Explorer**, in the ClientAppServicesDemo project, add a reference to the System.Web assembly.</span></span>  
  
2.  <span data-ttu-id="d5a55-233">Seleccione el archivo Form1 y **Vista &#124; Código** en el menú principal de Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="d5a55-233">Select the Form1 file and then select **View &#124; Code** from the Visual Studio main menu.</span></span>  
  
3.  <span data-ttu-id="d5a55-234">En el editor de código, agregue las instrucciones siguientes al principio del archivo Form1.</span><span class="sxs-lookup"><span data-stu-id="d5a55-234">In the code editor, add the following statements to the top of the Form1 file.</span></span>  
  
     [!code-csharp[ClientApplicationServices#001](../../../samples/snippets/csharp/VS_Snippets_Winforms/ClientApplicationServices/CS/Form1.cs#001)]
     [!code-vb[ClientApplicationServices#001](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/ClientApplicationServices/VB/Form1.vb#001)]  
  
4.  <span data-ttu-id="d5a55-235">En el **Explorador de soluciones**, haga doble clic en Form1 para mostrar el diseñador.</span><span class="sxs-lookup"><span data-stu-id="d5a55-235">In **Solution Explorer**, double-click Form1 to display the designer.</span></span>  
  
5.  <span data-ttu-id="d5a55-236">En el diseñador, haga doble clic en la superficie del formulario para generar un controlador de eventos <xref:System.Windows.Forms.Form.Load?displayProperty=nameWithType> denominado `Form1_Load`.</span><span class="sxs-lookup"><span data-stu-id="d5a55-236">In the designer, double-click the form surface to generate a <xref:System.Windows.Forms.Form.Load?displayProperty=nameWithType> event handler named `Form1_Load`.</span></span>  
  
     <span data-ttu-id="d5a55-237">Aparece el editor de código con el cursor en el método `Form1_Load` .</span><span class="sxs-lookup"><span data-stu-id="d5a55-237">The code editor appears with the cursor in the `Form1_Load` method.</span></span>  
  
6.  <span data-ttu-id="d5a55-238">Agregue el código siguiente al método `Form1_Load` .</span><span class="sxs-lookup"><span data-stu-id="d5a55-238">Add the following code to the `Form1_Load` method.</span></span>  
  
     <span data-ttu-id="d5a55-239">Este código deniega el acceso a los usuarios no autenticados y sale de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="d5a55-239">This code denies access to unauthenticated users by exiting the application.</span></span> <span data-ttu-id="d5a55-240">Como alternativa, puede permitir que los usuarios no autenticados accedan al formulario, pero denegándoles el acceso a alguna funcionalidad específica.</span><span class="sxs-lookup"><span data-stu-id="d5a55-240">Alternatively, you could allow unauthenticated users access to the form, but deny access to specific functionality.</span></span> <span data-ttu-id="d5a55-241">Normalmente, no seguirá este procedimiento para codificar de forma rígida el nombre de usuario y la contraseña, pero resulta útil para realizar pruebas.</span><span class="sxs-lookup"><span data-stu-id="d5a55-241">Normally, you will not hard-code the user name and password like this, but it is useful for testing purposes.</span></span> <span data-ttu-id="d5a55-242">En la siguiente sección, reemplazará este código por un código más sólido que muestra un cuadro de diálogo de inicio de sesión e incluye control de excepciones.</span><span class="sxs-lookup"><span data-stu-id="d5a55-242">In the next section, you will replace this code with more robust code that displays a login dialog box and includes exception handling.</span></span>  
  
     <span data-ttu-id="d5a55-243">Tenga en cuenta que el método `static` <xref:System.Web.Security.Membership.ValidateUser%2A?displayProperty=nameWithType> está en [!INCLUDE[dnprdnext](../../../includes/dnprdnext-md.md)].</span><span class="sxs-lookup"><span data-stu-id="d5a55-243">Note that the `static` <xref:System.Web.Security.Membership.ValidateUser%2A?displayProperty=nameWithType> method is in the [!INCLUDE[dnprdnext](../../../includes/dnprdnext-md.md)].</span></span> <span data-ttu-id="d5a55-244">Este método delega su trabajo en el proveedor de autenticación configurado y devuelve `true` si la autenticación se realiza correctamente.</span><span class="sxs-lookup"><span data-stu-id="d5a55-244">This method delegates its work to the configured authentication provider, and returns `true` if authentication is successful.</span></span> <span data-ttu-id="d5a55-245">La aplicación no requiere una referencia directa al proveedor de autenticación del cliente.</span><span class="sxs-lookup"><span data-stu-id="d5a55-245">Your application does not require a direct reference to the client authentication provider.</span></span>  
  
     [!code-csharp[ClientApplicationServices#300](../../../samples/snippets/csharp/VS_Snippets_Winforms/ClientApplicationServices/CS/Class1.cs#300)]
     [!code-vb[ClientApplicationServices#300](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/ClientApplicationServices/VB/Class1.vb#300)]  
  
 <span data-ttu-id="d5a55-246">Ahora puede presionar F5 para ejecutar la aplicación y, puesto que proporcionó un nombre de usuario y una contraseña correctos, verá el formulario.</span><span class="sxs-lookup"><span data-stu-id="d5a55-246">You can now press F5 to run the application, and because you provide a correct user name and password, you will see the form.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="d5a55-247">Si no puede ejecutar la aplicación, intente detener el servidor de desarrollo de ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="d5a55-247">If you are unable to run the application, try stopping the ASP.NET Development Server.</span></span> <span data-ttu-id="d5a55-248">Cuando el servidor se reinicie, compruebe que el puerto está establecido en 55555.</span><span class="sxs-lookup"><span data-stu-id="d5a55-248">When the server restarts, verify that the port is set to 55555.</span></span>  
  
 <span data-ttu-id="d5a55-249">Si en vez de eso desea ver el mensaje de error, cambie los parámetros <xref:System.Web.Security.Membership.ValidateUser%2A> .</span><span class="sxs-lookup"><span data-stu-id="d5a55-249">To see the error message instead, change the <xref:System.Web.Security.Membership.ValidateUser%2A> parameters.</span></span> <span data-ttu-id="d5a55-250">Por ejemplo, reemplace el segundo parámetro `"manager!"` con una contraseña incorrecta, como `"MANAGER"`.</span><span class="sxs-lookup"><span data-stu-id="d5a55-250">For example, replace the second `"manager!"` parameter with an incorrect password like `"MANAGER"`.</span></span>  
  
## <a name="adding-a-login-form-as-a-credentials-provider"></a><span data-ttu-id="d5a55-251">Agregar un formulario de inicio de sesión como proveedor de credenciales</span><span class="sxs-lookup"><span data-stu-id="d5a55-251">Adding a Login Form as a Credentials Provider</span></span>  
 <span data-ttu-id="d5a55-252">Puede adquirir las credenciales de usuario en el código de aplicación y pasarlas al método <xref:System.Web.Security.Membership.ValidateUser%2A> .</span><span class="sxs-lookup"><span data-stu-id="d5a55-252">You can acquire the user credentials in your application code and pass them to the <xref:System.Web.Security.Membership.ValidateUser%2A> method.</span></span> <span data-ttu-id="d5a55-253">Sin embargo, a menudo resulta útil separar el código de adquisición de credenciales y el código de aplicación, por si desea cambiarlo más adelante.</span><span class="sxs-lookup"><span data-stu-id="d5a55-253">However, it is often useful to keep your credentials-acquiring code separate from your application code, in case you want to change it later.</span></span>  
  
 <span data-ttu-id="d5a55-254">En el procedimiento siguiente, configurará la aplicación para que use un proveedor de credenciales y, a continuación, cambiará su llamada al método <xref:System.Web.Security.Membership.ValidateUser%2A> para que pase <xref:System.String.Empty> a ambos parámetros.</span><span class="sxs-lookup"><span data-stu-id="d5a55-254">In the following procedure, you configure your application to use a credentials provider, and then change your <xref:System.Web.Security.Membership.ValidateUser%2A> method call to pass <xref:System.String.Empty> for both parameters.</span></span> <span data-ttu-id="d5a55-255">Las cadenas vacías señalan el método <xref:System.Web.Security.Membership.ValidateUser%2A> para llamar al método <xref:System.Web.ClientServices.Providers.IClientFormsAuthenticationCredentialsProvider.GetCredentials%2A> del proveedor de credenciales configurado.</span><span class="sxs-lookup"><span data-stu-id="d5a55-255">The empty strings signal the <xref:System.Web.Security.Membership.ValidateUser%2A> method to call the <xref:System.Web.ClientServices.Providers.IClientFormsAuthenticationCredentialsProvider.GetCredentials%2A> method of the configured credentials provider.</span></span>  
  
#### <a name="to-configure-your-application-to-use-a-credentials-provider"></a><span data-ttu-id="d5a55-256">Para configurar la aplicación de modo que use un proveedor de credenciales</span><span class="sxs-lookup"><span data-stu-id="d5a55-256">To configure your application to use a credentials provider</span></span>  
  
1.  <span data-ttu-id="d5a55-257">En el **Explorador de soluciones**, seleccione el proyecto ClientAppServicesDemo y, a continuación, en el menú **Proyecto** , seleccione **Propiedades de ClientAppServicesDemo**.</span><span class="sxs-lookup"><span data-stu-id="d5a55-257">In **Solution Explorer**, select the ClientAppServicesDemo project, and then on the **Project** menu, select **ClientAppServicesDemo Properties**.</span></span>  
  
     <span data-ttu-id="d5a55-258">Aparece el diseñador de proyectos.</span><span class="sxs-lookup"><span data-stu-id="d5a55-258">The project designer appears.</span></span>  
  
2.  <span data-ttu-id="d5a55-259">En la pestaña **Servicios** , establezca **Opcional: proveedor de credenciales** en el valor siguiente.</span><span class="sxs-lookup"><span data-stu-id="d5a55-259">On the **Services** tab, set **Optional: Credential provider** to the following value.</span></span> <span data-ttu-id="d5a55-260">Este valor indica el nombre de tipo calificado con el ensamblado.</span><span class="sxs-lookup"><span data-stu-id="d5a55-260">This value indicates the assembly-qualified type name.</span></span>  
  
    ```  
    ClientAppServicesDemo.Login, ClientAppServicesDemo  
    ```  
  
3.  <span data-ttu-id="d5a55-261">En el archivo de código Form1, reemplace el código del método `Form1_Load` por el siguiente código.</span><span class="sxs-lookup"><span data-stu-id="d5a55-261">In the Form1 code file, replace the code in the `Form1_Load` method with the following code.</span></span>  
  
     <span data-ttu-id="d5a55-262">Este código muestra un mensaje de bienvenida y, a continuación, llama al método `ValidateUsingCredentialsProvider` que agregará en el paso siguiente.</span><span class="sxs-lookup"><span data-stu-id="d5a55-262">This code displays a welcome message and then calls the `ValidateUsingCredentialsProvider` method that you will add in the next step.</span></span> <span data-ttu-id="d5a55-263">Si el usuario no está autenticado, el método `ValidateUsingCredentialsProvider` devuelve `false` y se devuelve el método `Form1_Load` .</span><span class="sxs-lookup"><span data-stu-id="d5a55-263">If the user is not authenticated, the `ValidateUsingCredentialsProvider` method returns `false` and the `Form1_Load` method returns.</span></span> <span data-ttu-id="d5a55-264">Esto impide la ejecución de código adicional antes de salir de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="d5a55-264">This prevents any additional code from running before the application exits.</span></span> <span data-ttu-id="d5a55-265">El mensaje de bienvenida es útil para indicar cuándo se reinicia la aplicación.</span><span class="sxs-lookup"><span data-stu-id="d5a55-265">The welcome message is useful to make it clear when the application restarts.</span></span> <span data-ttu-id="d5a55-266">Agregará código para reiniciar la aplicación al implementar el cierre de sesión más adelante en este tutorial.</span><span class="sxs-lookup"><span data-stu-id="d5a55-266">You will add code to restart the application when you implement logout later in this walkthrough.</span></span>  
  
     [!code-csharp[ClientApplicationServices#011](../../../samples/snippets/csharp/VS_Snippets_Winforms/ClientApplicationServices/CS/Form1.cs#011)]
     [!code-vb[ClientApplicationServices#011](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/ClientApplicationServices/VB/Form1.vb#011)]  
  
4.  <span data-ttu-id="d5a55-267">Agregue el método siguiente después del método `Form1_Load` .</span><span class="sxs-lookup"><span data-stu-id="d5a55-267">Add the following method after the `Form1_Load` method.</span></span>  
  
     <span data-ttu-id="d5a55-268">Este método pasa cadenas vacías al método `static` <xref:System.Web.Security.Membership.ValidateUser%2A?displayProperty=nameWithType> , que hace que aparezca el cuadro de diálogo de inicio de sesión.</span><span class="sxs-lookup"><span data-stu-id="d5a55-268">This method passes empty strings to the `static` <xref:System.Web.Security.Membership.ValidateUser%2A?displayProperty=nameWithType> method, which causes the Login dialog box to appear.</span></span> <span data-ttu-id="d5a55-269">Si el servicio de autenticación no está disponible, el método <xref:System.Web.Security.Membership.ValidateUser%2A> producirá una <xref:System.Net.WebException>.</span><span class="sxs-lookup"><span data-stu-id="d5a55-269">If the authentication service is unavailable, the <xref:System.Web.Security.Membership.ValidateUser%2A> method will throw a <xref:System.Net.WebException>.</span></span> <span data-ttu-id="d5a55-270">En este caso, el método `ValidateUsingCredentialsProvider` muestra un mensaje de advertencia y pregunta al usuario si desea volver a intentarlo en modo sin conexión.</span><span class="sxs-lookup"><span data-stu-id="d5a55-270">In this case, the `ValidateUsingCredentialsProvider` method displays a warning message and asks if the user wants to try again in offline mode.</span></span> <span data-ttu-id="d5a55-271">Esta funcionalidad requiere la característica **Guardar hash de contraseña para permitir el inicio de sesión sin conexión** que se describe en [How to: Configure Client Application Services](../../../docs/framework/common-client-technologies/how-to-configure-client-application-services.md).</span><span class="sxs-lookup"><span data-stu-id="d5a55-271">This functionality requires the **Save password hash locally to enable offline login** feature described in [How to: Configure Client Application Services](../../../docs/framework/common-client-technologies/how-to-configure-client-application-services.md).</span></span> <span data-ttu-id="d5a55-272">Esta característica está habilitada de manera predeterminada para los proyectos nuevos.</span><span class="sxs-lookup"><span data-stu-id="d5a55-272">This feature is enabled by default for new projects.</span></span>  
  
     <span data-ttu-id="d5a55-273">Si no se valida el usuario, el método `ValidateUsingCredentialsProvider` muestra un mensaje de error y sale de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="d5a55-273">If the user is not validated, the `ValidateUsingCredentialsProvider` method displays an error message and exits the application.</span></span> <span data-ttu-id="d5a55-274">Por último, este método devuelve el resultado del intento de autenticación.</span><span class="sxs-lookup"><span data-stu-id="d5a55-274">Finally, this method returns the result of the authentication attempt.</span></span>  
  
     [!code-csharp[ClientApplicationServices#020](../../../samples/snippets/csharp/VS_Snippets_Winforms/ClientApplicationServices/CS/Form1.cs#020)]
     [!code-vb[ClientApplicationServices#020](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/ClientApplicationServices/VB/Form1.vb#020)]  
  
### <a name="creating-a-login-form"></a><span data-ttu-id="d5a55-275">Crear un formulario de inicio de sesión</span><span class="sxs-lookup"><span data-stu-id="d5a55-275">Creating a Login Form</span></span>  
 <span data-ttu-id="d5a55-276">Un proveedor de credenciales es una clase que implementa la interfaz <xref:System.Web.ClientServices.Providers.IClientFormsAuthenticationCredentialsProvider> .</span><span class="sxs-lookup"><span data-stu-id="d5a55-276">A credentials provider is a class that implements the <xref:System.Web.ClientServices.Providers.IClientFormsAuthenticationCredentialsProvider> interface.</span></span> <span data-ttu-id="d5a55-277">Esta interfaz tiene un método único denominado <xref:System.Web.ClientServices.Providers.IClientFormsAuthenticationCredentialsProvider.GetCredentials%2A> que devuelve un objeto <xref:System.Web.ClientServices.Providers.ClientFormsAuthenticationCredentials> .</span><span class="sxs-lookup"><span data-stu-id="d5a55-277">This interface has a single method named <xref:System.Web.ClientServices.Providers.IClientFormsAuthenticationCredentialsProvider.GetCredentials%2A> that returns a <xref:System.Web.ClientServices.Providers.ClientFormsAuthenticationCredentials> object.</span></span> <span data-ttu-id="d5a55-278">Los procedimientos siguientes describen cómo crear un cuadro de diálogo de inicio de sesión que implementa <xref:System.Web.ClientServices.Providers.IClientFormsAuthenticationCredentialsProvider.GetCredentials%2A> para que aparezca y devuelva las credenciales especificadas por el usuario.</span><span class="sxs-lookup"><span data-stu-id="d5a55-278">The following procedures describe how to create a login dialog box that implements <xref:System.Web.ClientServices.Providers.IClientFormsAuthenticationCredentialsProvider.GetCredentials%2A> to display itself and return the user-specified credentials.</span></span>  
  
 <span data-ttu-id="d5a55-279">Se proporcionan procedimientos independientes para Visual Basic y C# porque Visual Basic proporciona una plantilla **Formulario de inicio de sesión**.</span><span class="sxs-lookup"><span data-stu-id="d5a55-279">Separate procedures are provided for Visual Basic and C# because Visual Basic provides a **Login Form** template.</span></span> <span data-ttu-id="d5a55-280">Esto ahorra tiempo y esfuerzo de codificación.</span><span class="sxs-lookup"><span data-stu-id="d5a55-280">This saves some time and coding effort.</span></span>  
  
##### <a name="to-create-a-login-dialog-box-as-a-credentials-provider-in-visual-basic"></a><span data-ttu-id="d5a55-281">Para crear un cuadro de diálogo de inicio de sesión como proveedor de credenciales en Visual Basic</span><span class="sxs-lookup"><span data-stu-id="d5a55-281">To create a login dialog box as a credentials provider in Visual Basic</span></span>  
  
1.  <span data-ttu-id="d5a55-282">En el **Explorador de soluciones**, seleccione el proyecto ClientAppServicesDemo y, a continuación, en el menú **Proyecto** , seleccione **Agregar nuevo elemento**.</span><span class="sxs-lookup"><span data-stu-id="d5a55-282">In **Solution Explorer**, select the ClientAppServicesDemo project, and then on the **Project** menu, select **Add New Item**.</span></span>  
  
2.  <span data-ttu-id="d5a55-283">En el cuadro de diálogo **Agregar nuevo elemento** , seleccione la plantilla **Formulario de inicio de sesión** , cambie el valor de **Nombre** del elemento a `Login.vb`y haga clic en **Agregar**.</span><span class="sxs-lookup"><span data-stu-id="d5a55-283">In the **Add New Item** dialog box, select the **Login Form** template, change the item **Name** to `Login.vb`, and then click **Add**.</span></span>  
  
     <span data-ttu-id="d5a55-284">El cuadro de diálogo de inicio de sesión aparece en el Diseñador de Windows Forms.</span><span class="sxs-lookup"><span data-stu-id="d5a55-284">The login dialog box appears in the Windows Forms Designer.</span></span>  
  
3.  <span data-ttu-id="d5a55-285">En el diseñador, seleccione el botón **Aceptar** y, a continuación, en la ventana **Propiedades** , establezca `DialogResult` en `OK`.</span><span class="sxs-lookup"><span data-stu-id="d5a55-285">In the designer, select the **OK** button and then, in the **Properties** window, set `DialogResult` to `OK`.</span></span>  
  
4.  <span data-ttu-id="d5a55-286">En el diseñador, agregue un control `CheckBox` al formulario en el cuadro de texto **Contraseña** .</span><span class="sxs-lookup"><span data-stu-id="d5a55-286">In the designer, add a `CheckBox` control to the form under the **Password** text box.</span></span>  
  
5.  <span data-ttu-id="d5a55-287">En la ventana **Propiedades**, especifique un valor **(Nombre)** de `rememberMeCheckBox` y un valor **Texto** de `&Remember me`.</span><span class="sxs-lookup"><span data-stu-id="d5a55-287">In the **Properties** window, specify a **(Name)** value of `rememberMeCheckBox` and a **Text** value of `&Remember me`.</span></span>  
  
6.  <span data-ttu-id="d5a55-288">Seleccione **Vista &#124; Código** en el menú principal de Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="d5a55-288">Select **View &#124; Code** from the Visual Studio main menu.</span></span>  
  
7.  <span data-ttu-id="d5a55-289">En el Editor de código, agregue el siguiente código al principio del archivo.</span><span class="sxs-lookup"><span data-stu-id="d5a55-289">In the code editor, add the following code to the top of the file.</span></span>  
  
     [!code-vb[ClientApplicationServices#101](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/ClientApplicationServices/VB/Login.vb#101)]  
  
8.  <span data-ttu-id="d5a55-290">Modifique la firma de la clase de modo que la clase implemente la interfaz <xref:System.Web.ClientServices.Providers.IClientFormsAuthenticationCredentialsProvider> .</span><span class="sxs-lookup"><span data-stu-id="d5a55-290">Modify the class signature so that the class implements the <xref:System.Web.ClientServices.Providers.IClientFormsAuthenticationCredentialsProvider> interface.</span></span>  
  
     [!code-vb[ClientApplicationServices#110](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/ClientApplicationServices/VB/Class1.vb#110)]  
  
9. <span data-ttu-id="d5a55-291">Asegúrese de que el cursor está después de `IClientformsAuthenticationCredentialsProvider`y, a continuación, presione ENTRAR para generar el método `GetCredentials` .</span><span class="sxs-lookup"><span data-stu-id="d5a55-291">Make sure that the cursor is after `IClientformsAuthenticationCredentialsProvider`, and then press ENTER to generate the `GetCredentials` method.</span></span>  
  
10. <span data-ttu-id="d5a55-292">Busque la implementación de <xref:System.Web.ClientServices.Providers.IClientFormsAuthenticationCredentialsProvider.GetCredentials%2A> y, a continuación, reemplácela por el código siguiente.</span><span class="sxs-lookup"><span data-stu-id="d5a55-292">Locate the <xref:System.Web.ClientServices.Providers.IClientFormsAuthenticationCredentialsProvider.GetCredentials%2A> implementation and then replace it with the following code.</span></span>  
  
     [!code-vb[ClientApplicationServices#120](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/ClientApplicationServices/VB/Login.vb#120)]  
  
 <span data-ttu-id="d5a55-293">El siguiente procedimiento de C# proporciona toda la lista de código de un cuadro de diálogo de inicio de sesión simple.</span><span class="sxs-lookup"><span data-stu-id="d5a55-293">The following C# procedure provides the entire code listing for a simple login dialog box.</span></span> <span data-ttu-id="d5a55-294">El diseño de este cuadro de diálogo es un poco tosco, pero lo importante es la implementación de <xref:System.Web.ClientServices.Providers.IClientFormsAuthenticationCredentialsProvider.GetCredentials%2A> .</span><span class="sxs-lookup"><span data-stu-id="d5a55-294">The layout for this dialog box is a bit crude, but the important part is the <xref:System.Web.ClientServices.Providers.IClientFormsAuthenticationCredentialsProvider.GetCredentials%2A> implementation.</span></span>  
  
##### <a name="to-create-a-login-dialog-box-as-a-credentials-provider-in-c"></a><span data-ttu-id="d5a55-295">Para crear un cuadro de diálogo de inicio de sesión como proveedor de credenciales en C#</span><span class="sxs-lookup"><span data-stu-id="d5a55-295">To create a login dialog box as a credentials provider in C#</span></span>  
  
1.  <span data-ttu-id="d5a55-296">En el **Explorador de soluciones**, seleccione el proyecto ClientAppServicesDemo y, a continuación, en el menú **Proyecto** , seleccione **Agregar clase**.</span><span class="sxs-lookup"><span data-stu-id="d5a55-296">In **Solution Explorer**, select the ClientAppServicesDemo project, and then on the **Project** menu, select **Add Class**.</span></span>  
  
2.  <span data-ttu-id="d5a55-297">En el cuadro de diálogo **Agregar nuevo elemento** , cambie el valor de **Nombre** a `Login.cs`y haga clic en **Agregar**.</span><span class="sxs-lookup"><span data-stu-id="d5a55-297">In the **Add New Item** dialog box, change the **Name** to `Login.cs`, and then click **Add**.</span></span>  
  
     <span data-ttu-id="d5a55-298">Se abre el archivo Login.cs en el editor de código.</span><span class="sxs-lookup"><span data-stu-id="d5a55-298">The Login.cs file opens in the code editor.</span></span>  
  
3.  <span data-ttu-id="d5a55-299">Reemplace el código predeterminado por el siguiente código.</span><span class="sxs-lookup"><span data-stu-id="d5a55-299">Replace the default code with the following code.</span></span>  
  
     [!code-csharp[ClientApplicationServices#200](../../../samples/snippets/csharp/VS_Snippets_Winforms/ClientApplicationServices/CS/Login.cs#200)]  
  
 <span data-ttu-id="d5a55-300">Ahora puede ejecutar la aplicación, y verá que aparece el cuadro de diálogo de inicio de sesión.</span><span class="sxs-lookup"><span data-stu-id="d5a55-300">You can now run the application and see the login dialog box appear.</span></span> <span data-ttu-id="d5a55-301">Para probar este código, ensaye con credenciales diferentes, tanto válidas como no válidas, y confirme que solo puede acceder al formulario con credenciales válidas.</span><span class="sxs-lookup"><span data-stu-id="d5a55-301">To test this code, try different credentials, both valid and invalid, and confirm that you can access the form only with valid credentials.</span></span> <span data-ttu-id="d5a55-302">Los nombres de usuario válidos son `employee` y `manager` , con las contraseñas `employee!` y `manager!` , respectivamente.</span><span class="sxs-lookup"><span data-stu-id="d5a55-302">Valid user names are `employee` and `manager` with passwords `employee!` and `manager!` respectively.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="d5a55-303">No seleccione **Recordar mi cuenta** en este punto o no podrá iniciar sesión como otro usuario hasta que implemente el cierre de sesión más adelante en este tutorial.</span><span class="sxs-lookup"><span data-stu-id="d5a55-303">Do not select **Remember me** at this point or you will not be able to login as another user until you implement logout later in this walkthrough.</span></span>  
  
## <a name="adding-role-based-functionality"></a><span data-ttu-id="d5a55-304">Agregar funcionalidad basada en roles</span><span class="sxs-lookup"><span data-stu-id="d5a55-304">Adding Role-Based Functionality</span></span>  
 <span data-ttu-id="d5a55-305">En el siguiente procedimiento, agregará un botón al formulario y lo mostrará únicamente a los usuarios con el rol de administrador.</span><span class="sxs-lookup"><span data-stu-id="d5a55-305">In the following procedure, you add a button to the form and display it only for users in the manager role.</span></span>  
  
#### <a name="to-change-the-user-interface-based-on-user-role"></a><span data-ttu-id="d5a55-306">Para cambiar la interfaz de usuario en función del rol de usuario</span><span class="sxs-lookup"><span data-stu-id="d5a55-306">To change the user interface based on user role</span></span>  
  
1.  <span data-ttu-id="d5a55-307">En el **Explorador de soluciones**, en el proyecto ClientAppServicesDemo, seleccione Form1 y **Vista &#124; Diseñador** en el menú principal de Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="d5a55-307">In **Solution Explorer**, in the ClientAppServicesDemo project, select Form1 and then select **View &#124; Designer** from the Visual Studio main menu.</span></span>  
  
2.  <span data-ttu-id="d5a55-308">En el diseñador, agregue un control <xref:System.Windows.Forms.Button> al formulario desde el **Cuadro de herramientas**.</span><span class="sxs-lookup"><span data-stu-id="d5a55-308">In the designer, add a <xref:System.Windows.Forms.Button> control to the form from the **ToolBox**.</span></span>  
  
3.  <span data-ttu-id="d5a55-309">En la ventana **Propiedades** , establezca las propiedades siguientes del botón.</span><span class="sxs-lookup"><span data-stu-id="d5a55-309">In the **Properties** window, set the following properties for the button.</span></span>  
  
  	|<span data-ttu-id="d5a55-310">Propiedad.</span><span class="sxs-lookup"><span data-stu-id="d5a55-310">Property</span></span>|<span data-ttu-id="d5a55-311">Valor</span><span class="sxs-lookup"><span data-stu-id="d5a55-311">Value</span></span>|  
  	|--------------|-----------|  
  	|<span data-ttu-id="d5a55-312">**(Nombre)**</span><span class="sxs-lookup"><span data-stu-id="d5a55-312">**(Name)**</span></span>|<span data-ttu-id="d5a55-313">managerOnlyButton</span><span class="sxs-lookup"><span data-stu-id="d5a55-313">managerOnlyButton</span></span>|  
  	|<span data-ttu-id="d5a55-314">**Texto**</span><span class="sxs-lookup"><span data-stu-id="d5a55-314">**Text**</span></span>|<span data-ttu-id="d5a55-315">&Manager task</span><span class="sxs-lookup"><span data-stu-id="d5a55-315">&Manager task</span></span>|  
  	|<span data-ttu-id="d5a55-316">**Visible**</span><span class="sxs-lookup"><span data-stu-id="d5a55-316">**Visible**</span></span>|`False`|  
  
4.  <span data-ttu-id="d5a55-317">En el editor de código para el Form1, agregue el siguiente código al final del método `Form1_Load` .</span><span class="sxs-lookup"><span data-stu-id="d5a55-317">In the code editor for Form1, add the following code to the end of the `Form1_Load` method.</span></span>  
  
     <span data-ttu-id="d5a55-318">Este código llama al método `DisplayButtonForManagerRole` que agregará en el paso siguiente.</span><span class="sxs-lookup"><span data-stu-id="d5a55-318">This code calls the `DisplayButtonForManagerRole` method that you will add in the next step.</span></span>  
  
     [!code-csharp[ClientApplicationServices#012](../../../samples/snippets/csharp/VS_Snippets_Winforms/ClientApplicationServices/CS/Form1.cs#012)]
     [!code-vb[ClientApplicationServices#012](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/ClientApplicationServices/VB/Form1.vb#012)]  
  
5.  <span data-ttu-id="d5a55-319">Agregue el siguiente método al final de la clase Form1.</span><span class="sxs-lookup"><span data-stu-id="d5a55-319">Add the following method to the end of the Form1 class.</span></span>  
  
     <span data-ttu-id="d5a55-320">Este método llama al método <xref:System.Security.Principal.IPrincipal.IsInRole%2A> del objeto <xref:System.Security.Principal.IPrincipal> devuelto por la propiedad `static` <xref:System.Threading.Thread.CurrentPrincipal%2A?displayProperty=nameWithType> .</span><span class="sxs-lookup"><span data-stu-id="d5a55-320">This method calls the <xref:System.Security.Principal.IPrincipal.IsInRole%2A> method of the <xref:System.Security.Principal.IPrincipal> returned by the `static` <xref:System.Threading.Thread.CurrentPrincipal%2A?displayProperty=nameWithType> property.</span></span> <span data-ttu-id="d5a55-321">Para las aplicaciones configuradas para usar servicios de aplicaciones cliente, esta propiedad devuelve <xref:System.Web.ClientServices.ClientRolePrincipal>.</span><span class="sxs-lookup"><span data-stu-id="d5a55-321">For applications configured to use client application services, this property returns a <xref:System.Web.ClientServices.ClientRolePrincipal>.</span></span> <span data-ttu-id="d5a55-322">Dado que esta clase implementa la interfaz <xref:System.Security.Principal.IPrincipal> , no es necesario hacer referencia a esta explícitamente.</span><span class="sxs-lookup"><span data-stu-id="d5a55-322">Because this class implements the <xref:System.Security.Principal.IPrincipal> interface, you do not need to reference it explicitly.</span></span>  
  
     <span data-ttu-id="d5a55-323">Si el usuario tiene el rol de administrador, el método `DisplayButtonForManagerRole` establece la propiedad <xref:System.Windows.Forms.Control.Visible%2A> de `managerOnlyButton` en `true`.</span><span class="sxs-lookup"><span data-stu-id="d5a55-323">If the user is in the "manager" role, the `DisplayButtonForManagerRole` method sets the <xref:System.Windows.Forms.Control.Visible%2A> property of the `managerOnlyButton` to `true`.</span></span> <span data-ttu-id="d5a55-324">Este método también muestra un mensaje de error si se produce una <xref:System.Net.WebException> , lo que indica que el servicio de roles no está disponible.</span><span class="sxs-lookup"><span data-stu-id="d5a55-324">This method also displays an error message if a <xref:System.Net.WebException> is thrown, which indicates that the roles service is unavailable.</span></span>  
  
    > [!NOTE]
    >  <span data-ttu-id="d5a55-325">El método <xref:System.Web.ClientServices.ClientRolePrincipal.IsInRole%2A> siempre devolverá `false` si el inicio de sesión de usuario expiró.</span><span class="sxs-lookup"><span data-stu-id="d5a55-325">The <xref:System.Web.ClientServices.ClientRolePrincipal.IsInRole%2A> method will always return `false` if the user login has expired.</span></span> <span data-ttu-id="d5a55-326">Esto no sucederá si la aplicación llama al método <xref:System.Security.Principal.IPrincipal.IsInRole%2A> poco después de la autenticación, como se muestra en el código de ejemplo de este tutorial.</span><span class="sxs-lookup"><span data-stu-id="d5a55-326">This will not occur if your application calls the <xref:System.Security.Principal.IPrincipal.IsInRole%2A> method one time shortly after authentication, as shown in the example code for this walkthrough.</span></span> <span data-ttu-id="d5a55-327">Si la aplicación debe recuperar los roles de usuario en otras ocasiones, conviene agregar código para volver a validar a los usuarios cuyo inicio de sesión haya expirado.</span><span class="sxs-lookup"><span data-stu-id="d5a55-327">If your application must retrieve user roles at other times, you might want to add code to revalidate users whose login has expired.</span></span> <span data-ttu-id="d5a55-328">Si todos los usuarios válidos están asignados a roles, puede determinar si el inicio de sesión expiró llamando al método <xref:System.Web.ClientServices.Providers.ClientRoleProvider.GetRolesForUser%2A?displayProperty=nameWithType> .</span><span class="sxs-lookup"><span data-stu-id="d5a55-328">If all valid users are assigned to roles, you can determine whether the login has expired by calling the <xref:System.Web.ClientServices.Providers.ClientRoleProvider.GetRolesForUser%2A?displayProperty=nameWithType> method.</span></span> <span data-ttu-id="d5a55-329">Si no se devuelve ningún rol, el inicio de sesión expiró.</span><span class="sxs-lookup"><span data-stu-id="d5a55-329">If no roles are returned, the login has expired.</span></span> <span data-ttu-id="d5a55-330">Para obtener un ejemplo de esta funcionalidad, consulte el método <xref:System.Web.ClientServices.Providers.ClientRoleProvider.GetRolesForUser%2A> .</span><span class="sxs-lookup"><span data-stu-id="d5a55-330">For an example of this functionality, see the <xref:System.Web.ClientServices.Providers.ClientRoleProvider.GetRolesForUser%2A> method.</span></span> <span data-ttu-id="d5a55-331">Esta funcionalidad solo es necesaria si seleccionó **Exigir que los usuarios vuelvan a iniciar sesión cuando expire la cookie del servidor** en la configuración de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="d5a55-331">This functionality is only necessary if you have selected **Require users to log on again whenever the server cookie expires** in your application configuration.</span></span> <span data-ttu-id="d5a55-332">Para obtener más información, consulte [Cómo: Configurar servicios de aplicaciones cliente](../../../docs/framework/common-client-technologies/how-to-configure-client-application-services.md).</span><span class="sxs-lookup"><span data-stu-id="d5a55-332">For more information, see [How to: Configure Client Application Services](../../../docs/framework/common-client-technologies/how-to-configure-client-application-services.md).</span></span>  
  
     [!code-csharp[ClientApplicationServices#030](../../../samples/snippets/csharp/VS_Snippets_Winforms/ClientApplicationServices/CS/Form1.cs#030)]
     [!code-vb[ClientApplicationServices#030](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/ClientApplicationServices/VB/Form1.vb#030)]  
  
 <span data-ttu-id="d5a55-333">Si la autenticación es correcta, el proveedor de autenticación del cliente establece la propiedad <xref:System.Threading.Thread.CurrentPrincipal%2A?displayProperty=nameWithType> en una instancia de la clase <xref:System.Web.ClientServices.ClientRolePrincipal>.</span><span class="sxs-lookup"><span data-stu-id="d5a55-333">If authentication is successful, the client authentication provider sets the <xref:System.Threading.Thread.CurrentPrincipal%2A?displayProperty=nameWithType> property to an instance of the <xref:System.Web.ClientServices.ClientRolePrincipal> class.</span></span> <span data-ttu-id="d5a55-334">Esta clase implementa el método <xref:System.Security.Principal.IPrincipal.IsInRole%2A> para que el trabajo se delegue en el proveedor de roles configurado.</span><span class="sxs-lookup"><span data-stu-id="d5a55-334">This class implements the <xref:System.Security.Principal.IPrincipal.IsInRole%2A> method so that the work is delegated to the configured role provider.</span></span> <span data-ttu-id="d5a55-335">Al igual que antes, el código de aplicación no requiere una referencia directa al proveedor de servicios.</span><span class="sxs-lookup"><span data-stu-id="d5a55-335">As before, your application code does not require a direct reference to the service provider.</span></span>  
  
 <span data-ttu-id="d5a55-336">Ahora puede ejecutar la aplicación e iniciar sesión como empleado para comprobar que el botón no aparece y, a continuación, iniciar sesión como administrador para ver el botón.</span><span class="sxs-lookup"><span data-stu-id="d5a55-336">You can now run the application and log in as employee to see that the button does not appear, and then log in as manager to see the button.</span></span>  
  
## <a name="accessing-web-settings"></a><span data-ttu-id="d5a55-337">Acceder a la configuración web</span><span class="sxs-lookup"><span data-stu-id="d5a55-337">Accessing Web Settings</span></span>  
 <span data-ttu-id="d5a55-338">En el siguiente procedimiento, agregará un cuadro de texto al formulario y lo enlazará a una configuración web.</span><span class="sxs-lookup"><span data-stu-id="d5a55-338">In the following procedure, you add a text box to the form and bind it to a Web setting.</span></span> <span data-ttu-id="d5a55-339">Al igual que el código anterior, que usa autenticación y roles, el código de configuración no accede al proveedor de configuración directamente.</span><span class="sxs-lookup"><span data-stu-id="d5a55-339">Like the previous code that uses authentication and roles, your settings code does not access the settings provider directly.</span></span> <span data-ttu-id="d5a55-340">En su lugar, usa la clase `Settings` fuertemente tipada (a la que se accede como `Properties.Settings.Default` en C# y como `My.Settings` en Visual Basic) que Visual Studio genera para el proyecto.</span><span class="sxs-lookup"><span data-stu-id="d5a55-340">Instead, it uses the strongly-typed `Settings` class (accessed as `Properties.Settings.Default` in C# and `My.Settings` in Visual Basic) generated for your project by Visual Studio.</span></span>  
  
#### <a name="to-use-web-settings-in-your-user-interface"></a><span data-ttu-id="d5a55-341">Para usar la configuración web en la interfaz de usuario</span><span class="sxs-lookup"><span data-stu-id="d5a55-341">To use Web settings in your user interface</span></span>  
  
1.  <span data-ttu-id="d5a55-342">Compruebe el área de notificación de la barra de tareas para asegurarse de que el **servidor de desarrollo web de ASP.NET** sigue ejecutándose.</span><span class="sxs-lookup"><span data-stu-id="d5a55-342">Make sure that the **ASP.NET Web Development Server** is still running by checking the notification area of the taskbar.</span></span> <span data-ttu-id="d5a55-343">Si el servidor se detuvo, reinicie la aplicación (que inicia automáticamente el servidor) y cierre el cuadro de diálogo de inicio de sesión.</span><span class="sxs-lookup"><span data-stu-id="d5a55-343">If you have stopped the server, restart the application (which starts the server automatically) then close the login dialog box.</span></span>  
  
2.  <span data-ttu-id="d5a55-344">En el **Explorador de soluciones**, seleccione el proyecto ClientAppServicesDemo y, a continuación, en el menú **Proyecto** , seleccione **Propiedades de ClientAppServicesDemo**.</span><span class="sxs-lookup"><span data-stu-id="d5a55-344">In **Solution Explorer**, select the ClientAppServicesDemo project, and then on the **Project** menu, select **ClientAppServicesDemo Properties**.</span></span>  
  
     <span data-ttu-id="d5a55-345">Aparece el diseñador de proyectos.</span><span class="sxs-lookup"><span data-stu-id="d5a55-345">The project designer appears.</span></span>  
  
3.  <span data-ttu-id="d5a55-346">En la pestaña **Configuración** , haga clic en **Cargar configuración web**.</span><span class="sxs-lookup"><span data-stu-id="d5a55-346">On the **Settings** tab, click **Load Web Settings**.</span></span>  
  
     <span data-ttu-id="d5a55-347">Aparece el cuadro de diálogo **Inicio de sesión** .</span><span class="sxs-lookup"><span data-stu-id="d5a55-347">A **Login** dialog box appears.</span></span>  
  
4.  <span data-ttu-id="d5a55-348">Escriba las credenciales del empleado o del administrador y haga clic en **Inicio de sesión**.</span><span class="sxs-lookup"><span data-stu-id="d5a55-348">Enter credentials for employee or manager and click **Log In**.</span></span> <span data-ttu-id="d5a55-349">La configuración web que usará está configurada para permitir el acceso únicamente a los usuarios autenticados, por lo que si hace clic en **Omitir inicio de sesión** no se cargará ningún ajuste de configuración.</span><span class="sxs-lookup"><span data-stu-id="d5a55-349">The Web setting you will use is configured for access by authenticated users only, so clicking **Skip Login** will not load any settings.</span></span>  
  
     <span data-ttu-id="d5a55-350">El ajuste de configuración `WebSettingsTestText` aparece en el diseñador con el valor predeterminado de `DefaultText`.</span><span class="sxs-lookup"><span data-stu-id="d5a55-350">The `WebSettingsTestText` setting appears in the designer with the default value of `DefaultText`.</span></span> <span data-ttu-id="d5a55-351">Además, se genera para el proyecto una clase `Settings` que contiene una propiedad `WebSettingsTestText`.</span><span class="sxs-lookup"><span data-stu-id="d5a55-351">Additionally, a `Settings` class that contains a `WebSettingsTestText` property is generated for your project.</span></span>  
  
5.  <span data-ttu-id="d5a55-352">En el **Explorador de soluciones**, en el proyecto ClientAppServicesDemo, seleccione Form1 y **Vista &#124; Diseñador** en el menú principal de Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="d5a55-352">In **Solution Explorer**, in the ClientAppServicesDemo project, select Form1 and then select **View &#124; Designer** from the Visual Studio main menu.</span></span>  
  
6.  <span data-ttu-id="d5a55-353">En el diseñador, agregue un control <xref:System.Windows.Forms.TextBox> al formulario.</span><span class="sxs-lookup"><span data-stu-id="d5a55-353">In the designer, add a <xref:System.Windows.Forms.TextBox> control to the form.</span></span>  
  
7.  <span data-ttu-id="d5a55-354">En la ventana **Propiedades** , especifique **como valor de** (Nombre) `webSettingsTestTextBox`.</span><span class="sxs-lookup"><span data-stu-id="d5a55-354">In the **Properties** window, specify a **(Name)** value of `webSettingsTestTextBox`.</span></span>  
  
8.  <span data-ttu-id="d5a55-355">En el editor de código, agregue el siguiente código al final del método `Form1_Load` .</span><span class="sxs-lookup"><span data-stu-id="d5a55-355">In the code editor, add the following code to the end of the `Form1_Load` method.</span></span>  
  
     <span data-ttu-id="d5a55-356">Este código llama al método `BindWebSettingsTestTextBox` que agregará en el paso siguiente.</span><span class="sxs-lookup"><span data-stu-id="d5a55-356">This code calls the `BindWebSettingsTestTextBox` method that you will add in the next step.</span></span>  
  
     [!code-csharp[ClientApplicationServices#013](../../../samples/snippets/csharp/VS_Snippets_Winforms/ClientApplicationServices/CS/Form1.cs#013)]
     [!code-vb[ClientApplicationServices#013](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/ClientApplicationServices/VB/Form1.vb#013)]  
  
9. <span data-ttu-id="d5a55-357">Agregue el siguiente método al final de la clase Form1.</span><span class="sxs-lookup"><span data-stu-id="d5a55-357">Add the following method to the end of the Form1 class.</span></span>  
  
     <span data-ttu-id="d5a55-358">Este método enlaza la propiedad <xref:System.Windows.Forms.TextBox.Text%2A> de `webSettingsTestTextBox` con la propiedad `WebSettingsTestText` de la clase `Settings` generada anteriormente en este procedimiento.</span><span class="sxs-lookup"><span data-stu-id="d5a55-358">This method binds the <xref:System.Windows.Forms.TextBox.Text%2A> property of the `webSettingsTestTextBox` to the `WebSettingsTestText` property of the `Settings` class generated earlier in this procedure.</span></span> <span data-ttu-id="d5a55-359">Este método también muestra un mensaje de error si se produce una <xref:System.Net.WebException> , lo que indica que el servicio de configuración web no está disponible.</span><span class="sxs-lookup"><span data-stu-id="d5a55-359">This method also displays an error message if a <xref:System.Net.WebException> is thrown, which indicates that the Web settings service is unavailable.</span></span>  
  
     [!code-csharp[ClientApplicationServices#040](../../../samples/snippets/csharp/VS_Snippets_Winforms/ClientApplicationServices/CS/Form1.cs#040)]
     [!code-vb[ClientApplicationServices#040](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/ClientApplicationServices/VB/Form1.vb#040)]  
  
    > [!NOTE]
    >  <span data-ttu-id="d5a55-360">Normalmente, usará el enlace de datos para habilitar la comunicación bidireccional automática entre un control y una configuración web.</span><span class="sxs-lookup"><span data-stu-id="d5a55-360">You will typically use data binding to enable automatic two-way communication between a control and a Web setting.</span></span> <span data-ttu-id="d5a55-361">Sin embargo, también puede acceder a la configuración web directamente, tal como se muestra en el ejemplo siguiente:</span><span class="sxs-lookup"><span data-stu-id="d5a55-361">However, you can also access Web settings directly as shown in the following example:</span></span>  
  
     [!code-csharp[ClientApplicationServices#322](../../../samples/snippets/csharp/VS_Snippets_Winforms/ClientApplicationServices/CS/Class1.cs#322)]
     [!code-vb[ClientApplicationServices#322](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/ClientApplicationServices/VB/Class1.vb#322)]  
  
10. <span data-ttu-id="d5a55-362">En el diseñador, seleccione el formulario y, en la ventana **Propiedades** , haga clic en el botón **Eventos** .</span><span class="sxs-lookup"><span data-stu-id="d5a55-362">In the designer, select the form, and then, in the **Properties** window, click the **Events** button.</span></span>  
  
11. <span data-ttu-id="d5a55-363">Seleccione el evento <xref:System.Windows.Forms.Form.FormClosing> y, a continuación, presione ENTRAR para generar un controlador de eventos.</span><span class="sxs-lookup"><span data-stu-id="d5a55-363">Select the <xref:System.Windows.Forms.Form.FormClosing> event and then press ENTER to generate an event handler.</span></span>  
  
12. <span data-ttu-id="d5a55-364">Reemplace el método generado con el código siguiente.</span><span class="sxs-lookup"><span data-stu-id="d5a55-364">Replace the generated method with the following code.</span></span>  
  
     <span data-ttu-id="d5a55-365">El controlador de eventos <xref:System.Windows.Forms.Form.FormClosing> llama al método `SaveSettings` , que la funcionalidad de cierre de sesión que agregará en la sección siguiente también usa.</span><span class="sxs-lookup"><span data-stu-id="d5a55-365">The <xref:System.Windows.Forms.Form.FormClosing> event handler calls the `SaveSettings` method, which is also used by the logout functionality that you will add in the next section.</span></span> <span data-ttu-id="d5a55-366">El método `SaveSettings` confirma primero que el usuario no cerró sesión. Esto lo hace comprobando la propiedad <xref:System.Security.Principal.IIdentity.AuthenticationType%2A> del objeto <xref:System.Security.Principal.IIdentity> devuelto por la entidad de seguridad actual.</span><span class="sxs-lookup"><span data-stu-id="d5a55-366">The `SaveSettings` method first confirms that the user has not logged out. It does this by checking the <xref:System.Security.Principal.IIdentity.AuthenticationType%2A> property of the <xref:System.Security.Principal.IIdentity> returned by the current principal.</span></span> <span data-ttu-id="d5a55-367">La entidad de seguridad actual se recupera mediante la propiedad `static` <xref:System.Threading.Thread.CurrentPrincipal%2A> .</span><span class="sxs-lookup"><span data-stu-id="d5a55-367">The current principal is retrieved through the `static` <xref:System.Threading.Thread.CurrentPrincipal%2A> property.</span></span> <span data-ttu-id="d5a55-368">Si el usuario se autenticó para los servicios de aplicaciones cliente, el tipo de autenticación será "ClientForms".</span><span class="sxs-lookup"><span data-stu-id="d5a55-368">If the user has been authenticated for client application services, the authentication type will be "ClientForms".</span></span> <span data-ttu-id="d5a55-369">El método `SaveSettings` no puede comprobar la propiedad <xref:System.Security.Principal.IIdentity.IsAuthenticated%2A?displayProperty=nameWithType> porque el usuario podría tener una identidad de Windows válida después de cerrar la sesión.</span><span class="sxs-lookup"><span data-stu-id="d5a55-369">The `SaveSettings` method cannot just check the <xref:System.Security.Principal.IIdentity.IsAuthenticated%2A?displayProperty=nameWithType> property because the user might have a valid Windows identity after logout.</span></span>  
  
     <span data-ttu-id="d5a55-370">Si el usuario no cerró la sesión, el método `SaveSettings` llama al método <xref:System.Configuration.ApplicationSettingsBase.Save%2A> de la clase `Settings` generada anteriormente en este procedimiento.</span><span class="sxs-lookup"><span data-stu-id="d5a55-370">If the user has not logged out, the `SaveSettings` method calls the <xref:System.Configuration.ApplicationSettingsBase.Save%2A> method of the `Settings` class generated earlier in this procedure.</span></span> <span data-ttu-id="d5a55-371">Este método puede producir una <xref:System.Net.WebException> si la cookie de autenticación expiró.</span><span class="sxs-lookup"><span data-stu-id="d5a55-371">This method can throw a <xref:System.Net.WebException> if the authentication cookie has expired.</span></span> <span data-ttu-id="d5a55-372">Esto sucede únicamente si seleccionó **Exigir que los usuarios vuelvan a iniciar sesión cuando expire la cookie del servidor** en la configuración de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="d5a55-372">This occurs only if you have selected **Require users to log on again whenever the server cookie expires** in your application configuration.</span></span> <span data-ttu-id="d5a55-373">Para obtener más información, consulte [Cómo: Configurar servicios de aplicaciones cliente](../../../docs/framework/common-client-technologies/how-to-configure-client-application-services.md).</span><span class="sxs-lookup"><span data-stu-id="d5a55-373">For more information, see [How to: Configure Client Application Services](../../../docs/framework/common-client-technologies/how-to-configure-client-application-services.md).</span></span> <span data-ttu-id="d5a55-374">El método `SaveSettings` controla la expiración de la cookie llamando a <xref:System.Web.Security.Membership.ValidateUser%2A> para mostrar el cuadro de diálogo de inicio de sesión.</span><span class="sxs-lookup"><span data-stu-id="d5a55-374">The `SaveSettings` method handles cookie expiration by calling <xref:System.Web.Security.Membership.ValidateUser%2A> to display the login dialog box.</span></span> <span data-ttu-id="d5a55-375">Si el usuario inicia sesión correctamente, el método `SaveSettings` intenta guardar la configuración de nuevo llamándose a sí mismo.</span><span class="sxs-lookup"><span data-stu-id="d5a55-375">If the user logs in successfully, the `SaveSettings` method tries to save the settings again by calling itself.</span></span>  
  
     <span data-ttu-id="d5a55-376">Al igual que en el código anterior, el método `SaveSettings` muestra un mensaje de error si el servicio remoto no está disponible.</span><span class="sxs-lookup"><span data-stu-id="d5a55-376">Like in previous code, the `SaveSettings` method displays an error message if the remote service is unavailable.</span></span> <span data-ttu-id="d5a55-377">Si el proveedor de configuración no puede acceder al servicio remoto, la configuración sigue guardándose en la memoria caché local y se vuelve a cargar cuando se reinicia la aplicación.</span><span class="sxs-lookup"><span data-stu-id="d5a55-377">If the settings provider cannot access the remote service, the settings are still saved to the local cache and reloaded when the application restarts.</span></span>  
  
     [!code-csharp[ClientApplicationServices#050](../../../samples/snippets/csharp/VS_Snippets_Winforms/ClientApplicationServices/CS/Form1.cs#050)]
     [!code-vb[ClientApplicationServices#050](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/ClientApplicationServices/VB/Form1.vb#050)]  
  
13. <span data-ttu-id="d5a55-378">Agregue el siguiente método al final de la clase Form1.</span><span class="sxs-lookup"><span data-stu-id="d5a55-378">Add the following method to the end of the Form1 class.</span></span>  
  
     <span data-ttu-id="d5a55-379">Este código controla el evento <xref:System.Web.ClientServices.Providers.ClientSettingsProvider.SettingsSaved?displayProperty=nameWithType> y muestra una advertencia si no se pudo guardar alguno de los valores de configuración.</span><span class="sxs-lookup"><span data-stu-id="d5a55-379">This code handles the <xref:System.Web.ClientServices.Providers.ClientSettingsProvider.SettingsSaved?displayProperty=nameWithType> event and displays a warning if any of the settings could not be saved.</span></span> <span data-ttu-id="d5a55-380">El evento <xref:System.Web.ClientServices.Providers.ClientSettingsProvider.SettingsSaved> no se produce si el servicio de configuración no está disponible o si la cookie de autenticación expiró.</span><span class="sxs-lookup"><span data-stu-id="d5a55-380">The <xref:System.Web.ClientServices.Providers.ClientSettingsProvider.SettingsSaved> event does not occur if the settings service is unavailable or if the authentication cookie has expired.</span></span> <span data-ttu-id="d5a55-381">El evento <xref:System.Web.ClientServices.Providers.ClientSettingsProvider.SettingsSaved> se producirá, por ejemplo, cuando el usuario ya haya cerrado la sesión. Puede probar este controlador de eventos agregando código de cierre de sesión al método `SaveSettings` directamente antes de la llamada al método <xref:System.Configuration.ApplicationSettingsBase.Save%2A> .</span><span class="sxs-lookup"><span data-stu-id="d5a55-381">One example of when the <xref:System.Web.ClientServices.Providers.ClientSettingsProvider.SettingsSaved> event will occur is if the user has already logged out. You can test this event handler by adding logout code to the `SaveSettings` method directly before the <xref:System.Configuration.ApplicationSettingsBase.Save%2A> method call.</span></span> <span data-ttu-id="d5a55-382">El código de cierre de sesión que puede usar se describe en la sección siguiente.</span><span class="sxs-lookup"><span data-stu-id="d5a55-382">Logout code that you can use is described in the next section.</span></span>  
  
     [!code-csharp[ClientApplicationServices#090](../../../samples/snippets/csharp/VS_Snippets_Winforms/ClientApplicationServices/CS/Form1.cs#090)]
     [!code-vb[ClientApplicationServices#090](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/ClientApplicationServices/VB/Form1.vb#090)]  
  
14. <span data-ttu-id="d5a55-383">En el caso de C#, agregue el código siguiente al final del método `Form1_Load` .</span><span class="sxs-lookup"><span data-stu-id="d5a55-383">For C#, add the following code to the end of the `Form1_Load` method.</span></span> <span data-ttu-id="d5a55-384">Este código asocia el método que agregó en el último paso con el evento <xref:System.Web.ClientServices.Providers.ClientSettingsProvider.SettingsSaved> .</span><span class="sxs-lookup"><span data-stu-id="d5a55-384">This code associates the method you added in the last step with the <xref:System.Web.ClientServices.Providers.ClientSettingsProvider.SettingsSaved> event.</span></span>  
  
     [!code-csharp[ClientApplicationServices#015](../../../samples/snippets/csharp/VS_Snippets_Winforms/ClientApplicationServices/CS/Form1.cs#015)]  
  
 <span data-ttu-id="d5a55-385">Para probar la aplicación en este punto, ejecútela varias veces como empleado y como administrador, y especifique valores diferentes en el cuadro de texto.</span><span class="sxs-lookup"><span data-stu-id="d5a55-385">To test the application at this point, run it multiple times as both employee and manager, and type different values into the text box.</span></span> <span data-ttu-id="d5a55-386">Los valores se conservarán en las sesiones de cada usuario.</span><span class="sxs-lookup"><span data-stu-id="d5a55-386">The values will persist across sessions on a per-user basis.</span></span>  
  
## <a name="implementing-logout"></a><span data-ttu-id="d5a55-387">Implementar el cierre de sesión</span><span class="sxs-lookup"><span data-stu-id="d5a55-387">Implementing Logout</span></span>  
 <span data-ttu-id="d5a55-388">Cuando el usuario selecciona la casilla **Recordar mi cuenta** al iniciar sesión, la la aplicación autenticará automáticamente al usuario en las ejecuciones posteriores.</span><span class="sxs-lookup"><span data-stu-id="d5a55-388">When the user selects the **Remember me** check box when logging in, the application will automatically authenticate the user on subsequent runs.</span></span> <span data-ttu-id="d5a55-389">La autenticación automática seguirá produciéndose mientras la aplicación esté en modo sin conexión o hasta que expire la cookie de autenticación.</span><span class="sxs-lookup"><span data-stu-id="d5a55-389">Automatic authentication will then continue while the application is in offline mode or until the authentication cookie expires.</span></span> <span data-ttu-id="d5a55-390">Sin embargo, en ocasiones, varios usuarios necesitarán acceder a la aplicación, o un usuario podría iniciar sesión con credenciales diferentes.</span><span class="sxs-lookup"><span data-stu-id="d5a55-390">Sometimes, however, multiple users will need access to the application or a single user might occasionally log in with different credentials.</span></span> <span data-ttu-id="d5a55-391">Para habilitar este escenario, debe implementar la funcionalidad de cierre de sesión, tal como se describe en el procedimiento siguiente.</span><span class="sxs-lookup"><span data-stu-id="d5a55-391">To enable this scenario, you must implement logout functionality, as described in the following procedure.</span></span>  
  
#### <a name="to-implement-logout-functionality"></a><span data-ttu-id="d5a55-392">Para implementar la funcionalidad de cierre de sesión</span><span class="sxs-lookup"><span data-stu-id="d5a55-392">To implement logout functionality</span></span>  
  
1.  <span data-ttu-id="d5a55-393">En el diseñador de Form1, agregue un control <xref:System.Windows.Forms.Button> al formulario desde el **Cuadro de herramientas**.</span><span class="sxs-lookup"><span data-stu-id="d5a55-393">In the Form1 designer, add a <xref:System.Windows.Forms.Button> control to the form from the **ToolBox**.</span></span>  
  
2.  <span data-ttu-id="d5a55-394">En la ventana **Propiedades**, especifique `logoutButton` como valor de **(Nombre)** y **&Cerrar sesión** como valor de **Texto**.</span><span class="sxs-lookup"><span data-stu-id="d5a55-394">In the **Properties** window, specify a **(Name)** value of `logoutButton` and a **Text** value of **&Log Out**.</span></span>  
  
3.  <span data-ttu-id="d5a55-395">Haga doble clic en `logoutButton` para generar un controlador de eventos <xref:System.Windows.Forms.Control.Click>.</span><span class="sxs-lookup"><span data-stu-id="d5a55-395">Double-click the `logoutButton` to generate a <xref:System.Windows.Forms.Control.Click> event handler.</span></span>  
  
     <span data-ttu-id="d5a55-396">Aparece el editor de código con el cursor en el método `logoutButton_Click` .</span><span class="sxs-lookup"><span data-stu-id="d5a55-396">The code editor appears with the cursor in the `logoutButton_Click` method.</span></span>  
  
4.  <span data-ttu-id="d5a55-397">Reemplace el método `logoutButton_Click` generado con el código siguiente.</span><span class="sxs-lookup"><span data-stu-id="d5a55-397">Replace the generated `logoutButton_Click` method with the following code.</span></span>  
  
     <span data-ttu-id="d5a55-398">Este controlador de eventos llama primero al método `SaveSettings` que agregó en la sección anterior.</span><span class="sxs-lookup"><span data-stu-id="d5a55-398">This event handler first calls the `SaveSettings` method that you added in the previous section.</span></span> <span data-ttu-id="d5a55-399">A continuación, el controlador de eventos llama al método <xref:System.Web.ClientServices.Providers.ClientFormsAuthenticationMembershipProvider.Logout%2A?displayProperty=nameWithType> .</span><span class="sxs-lookup"><span data-stu-id="d5a55-399">Then, the event handler calls the <xref:System.Web.ClientServices.Providers.ClientFormsAuthenticationMembershipProvider.Logout%2A?displayProperty=nameWithType> method.</span></span> <span data-ttu-id="d5a55-400">Si el servicio de autenticación no está disponible, el método <xref:System.Web.ClientServices.Providers.ClientFormsAuthenticationMembershipProvider.Logout%2A> producirá una <xref:System.Net.WebException>.</span><span class="sxs-lookup"><span data-stu-id="d5a55-400">If the authentication service is unavailable, the <xref:System.Web.ClientServices.Providers.ClientFormsAuthenticationMembershipProvider.Logout%2A> method will throw a <xref:System.Net.WebException>.</span></span> <span data-ttu-id="d5a55-401">En este caso, el método `logoutButton_Click` muestra un mensaje de advertencia y pasa temporalmente al modo sin conexión para cerrar la sesión del usuario. El modo sin conexión se describe en la sección siguiente.</span><span class="sxs-lookup"><span data-stu-id="d5a55-401">In this case, the `logoutButton_Click` method displays a warning message and switches temporarily to offline mode to log the user out. Offline mode is described in the next section.</span></span>  
  
     <span data-ttu-id="d5a55-402">El cierre de sesión elimina la cookie de autenticación local para que vuelva a solicitarse el inicio de sesión cuando se reinicie la aplicación.</span><span class="sxs-lookup"><span data-stu-id="d5a55-402">Logout deletes the local authentication cookie so that login will be required when the application is restarted.</span></span> <span data-ttu-id="d5a55-403">Después de cerrar la sesión, el controlador de eventos reinicia la aplicación.</span><span class="sxs-lookup"><span data-stu-id="d5a55-403">After logout, the event handler restarts the application.</span></span> <span data-ttu-id="d5a55-404">Cuando se reinicia la aplicación, muestra el mensaje de bienvenida seguido del cuadro de diálogo de inicio de sesión.</span><span class="sxs-lookup"><span data-stu-id="d5a55-404">When the application restarts, it displays the welcome message followed by the login dialog box.</span></span> <span data-ttu-id="d5a55-405">El mensaje de bienvenida deja claro que se reinició la aplicación.</span><span class="sxs-lookup"><span data-stu-id="d5a55-405">The welcome message makes it clear that the application has restarted.</span></span> <span data-ttu-id="d5a55-406">Esto evita una posible confusión si el usuario debe iniciar sesión para guardar la configuración y, a continuación, debe volver a iniciar sesión porque la aplicación se reinició.</span><span class="sxs-lookup"><span data-stu-id="d5a55-406">This prevents potential confusion if the user must log in to save settings, and then must log in again because the application has restarted.</span></span>  
  
     [!code-csharp[ClientApplicationServices#070](../../../samples/snippets/csharp/VS_Snippets_Winforms/ClientApplicationServices/CS/Form1.cs#070)]
     [!code-vb[ClientApplicationServices#070](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/ClientApplicationServices/VB/Form1.vb#070)]  
  
 <span data-ttu-id="d5a55-407">Para probar la funcionalidad de cierre de sesión, ejecute la aplicación y seleccione **Recordar mi cuenta** en el cuadro de diálogo de inicio de sesión.</span><span class="sxs-lookup"><span data-stu-id="d5a55-407">To test the logout functionality, run the application and select **Remember me** on the Login dialog box.</span></span> <span data-ttu-id="d5a55-408">A continuación, cierre y reinicie la aplicación para confirmar que ya no debe iniciar sesión.</span><span class="sxs-lookup"><span data-stu-id="d5a55-408">Next, close and restart the application to confirm that you no longer have to log in.</span></span> <span data-ttu-id="d5a55-409">Por último, reinicie la aplicación haciendo clic en Cerrar sesión.</span><span class="sxs-lookup"><span data-stu-id="d5a55-409">Finally, restart the application by clicking Log out.</span></span>  
  
## <a name="enabling-offline-mode"></a><span data-ttu-id="d5a55-410">Habilitar el modo sin conexión</span><span class="sxs-lookup"><span data-stu-id="d5a55-410">Enabling Offline Mode</span></span>  
 <span data-ttu-id="d5a55-411">En el siguiente procedimiento, agregará una casilla al formulario para que el usuario pueda entrar en modo sin conexión.</span><span class="sxs-lookup"><span data-stu-id="d5a55-411">In the following procedure, you add a check box to the form to enable the user to enter offline mode.</span></span> <span data-ttu-id="d5a55-412">La aplicación indica el modo sin conexión estableciendo la propiedad `static` <xref:System.Web.ClientServices.ConnectivityStatus.IsOffline%2A?displayProperty=nameWithType> en `true`.</span><span class="sxs-lookup"><span data-stu-id="d5a55-412">Your application indicates offline mode by setting the `static` <xref:System.Web.ClientServices.ConnectivityStatus.IsOffline%2A?displayProperty=nameWithType> property to `true`.</span></span> <span data-ttu-id="d5a55-413">El estado sin conexión se almacena en el disco duro local en la ubicación indicada por la propiedad <xref:System.Windows.Forms.Application.UserAppDataPath%2A?displayProperty=nameWithType> .</span><span class="sxs-lookup"><span data-stu-id="d5a55-413">The offline status is stored on the local hard disk at the location indicated by the <xref:System.Windows.Forms.Application.UserAppDataPath%2A?displayProperty=nameWithType> property.</span></span> <span data-ttu-id="d5a55-414">Esto significa que el estado sin conexión se almacena por usuario y aplicación.</span><span class="sxs-lookup"><span data-stu-id="d5a55-414">This means that the offline status is stored on a per-user, per-application basis.</span></span>  
  
 <span data-ttu-id="d5a55-415">En el modo sin conexión, todas las solicitudes de servicio de aplicaciones cliente recuperan datos de la memoria caché local, en lugar de intentar acceder a los servicios.</span><span class="sxs-lookup"><span data-stu-id="d5a55-415">In offline mode, all client application service requests retrieve data from the local cache instead of trying to access the services.</span></span> <span data-ttu-id="d5a55-416">En la configuración predeterminada, los datos locales incluyen un formulario cifrado con la contraseña del usuario.</span><span class="sxs-lookup"><span data-stu-id="d5a55-416">In the default configuration, the local data includes an encrypted form of the user's password.</span></span> <span data-ttu-id="d5a55-417">Esto permite al usuario iniciar sesión mientras la aplicación está en modo sin conexión.</span><span class="sxs-lookup"><span data-stu-id="d5a55-417">This enables the user to log in while the application is in offline mode.</span></span> <span data-ttu-id="d5a55-418">Para obtener más información, consulta [How to: Configure Client Application Services](../../../docs/framework/common-client-technologies/how-to-configure-client-application-services.md).</span><span class="sxs-lookup"><span data-stu-id="d5a55-418">For more information, see [How to: Configure Client Application Services](../../../docs/framework/common-client-technologies/how-to-configure-client-application-services.md).</span></span>  
  
#### <a name="to-enable-offline-mode-in-your-application"></a><span data-ttu-id="d5a55-419">Para habilitar el modo sin conexión en la aplicación</span><span class="sxs-lookup"><span data-stu-id="d5a55-419">To enable offline mode in your application</span></span>  
  
1.  <span data-ttu-id="d5a55-420">En el **Explorador de soluciones**, en el proyecto ClientAppServicesDemo, seleccione Form1 y **Vista &#124; Diseñador** en el menú principal de Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="d5a55-420">In **Solution Explorer**, in the ClientAppServicesDemo project, select Form1 and then select **View &#124; Designer** from the Visual Studio main menu.</span></span>  
  
2.  <span data-ttu-id="d5a55-421">En el diseñador, agregue un control <xref:System.Windows.Forms.CheckBox> al formulario.</span><span class="sxs-lookup"><span data-stu-id="d5a55-421">In the designer, add a <xref:System.Windows.Forms.CheckBox> control to the form.</span></span>  
  
3.  <span data-ttu-id="d5a55-422">En la ventana **Propiedades**, especifique `workOfflineCheckBox` como valor de **(Nombre)** y **&Trabajar sin conexión** como valor de **Texto**.</span><span class="sxs-lookup"><span data-stu-id="d5a55-422">In the **Properties** window, specify a **(Name)** value of `workOfflineCheckBox` and a **Text** value of **&Work offline**.</span></span>  
  
4.  <span data-ttu-id="d5a55-423">En la ventana **Propiedades** , haga clic en el botón **Eventos** .</span><span class="sxs-lookup"><span data-stu-id="d5a55-423">In the **Properties** window, click the **Events** button.</span></span>  
  
5.  <span data-ttu-id="d5a55-424">Seleccione el evento <xref:System.Windows.Forms.CheckBox.CheckedChanged> y, a continuación, presione ENTRAR para generar un controlador de eventos.</span><span class="sxs-lookup"><span data-stu-id="d5a55-424">Select the <xref:System.Windows.Forms.CheckBox.CheckedChanged> event and then press ENTER to generate an event handler.</span></span>  
  
6.  <span data-ttu-id="d5a55-425">Reemplace el método generado con el código siguiente.</span><span class="sxs-lookup"><span data-stu-id="d5a55-425">Replace the generated method with the following code.</span></span>  
  
     <span data-ttu-id="d5a55-426">Este código actualiza el valor <xref:System.Web.ClientServices.ConnectivityStatus.IsOffline%2A> y vuelve a validar al usuario de forma automática cuando regresa al modo en línea.</span><span class="sxs-lookup"><span data-stu-id="d5a55-426">This code updates the <xref:System.Web.ClientServices.ConnectivityStatus.IsOffline%2A> value and silently revalidates the user when they return to online mode.</span></span> <span data-ttu-id="d5a55-427">El método <xref:System.Web.ClientServices.ClientFormsIdentity.RevalidateUser%2A?displayProperty=nameWithType> usa las credenciales almacenadas en caché para que el usuario no tenga que iniciar sesión explícitamente.</span><span class="sxs-lookup"><span data-stu-id="d5a55-427">The <xref:System.Web.ClientServices.ClientFormsIdentity.RevalidateUser%2A?displayProperty=nameWithType> method uses the cached credentials so that the user does not have to explicitly log in.</span></span> <span data-ttu-id="d5a55-428">Si el servicio de autenticación no está disponible, aparece un mensaje de advertencia y la aplicación se queda sin conexión.</span><span class="sxs-lookup"><span data-stu-id="d5a55-428">If the authentication service is unavailable, a warning message appears and the application stays offline.</span></span>  
  
    > [!NOTE]
    >  <span data-ttu-id="d5a55-429">El método <xref:System.Web.ClientServices.ClientFormsIdentity.RevalidateUser%2A> es solo para su comodidad.</span><span class="sxs-lookup"><span data-stu-id="d5a55-429">The <xref:System.Web.ClientServices.ClientFormsIdentity.RevalidateUser%2A> method is for convenience only.</span></span> <span data-ttu-id="d5a55-430">Dado que no tiene un valor devuelto, no puede indicar si hubo un error de validación.</span><span class="sxs-lookup"><span data-stu-id="d5a55-430">Because it does not have a return value, it cannot indicate whether revalidation has failed.</span></span> <span data-ttu-id="d5a55-431">La revalidación puede producir un error, por ejemplo, si las credenciales del usuario cambiaron en el servidor.</span><span class="sxs-lookup"><span data-stu-id="d5a55-431">Revalidation can fail, for example, if the user credentials have changed on the server.</span></span> <span data-ttu-id="d5a55-432">En este caso, quizás desee incluir código que valida explícitamente a los usuarios después de que se produzca un error en una llamada al servicio.</span><span class="sxs-lookup"><span data-stu-id="d5a55-432">In this case, you might want to include code that explicitly validates users after a service call fails.</span></span> <span data-ttu-id="d5a55-433">Para obtener más información, vea la sección Acceder a la configuración web anteriormente en este tutorial.</span><span class="sxs-lookup"><span data-stu-id="d5a55-433">For more information, see the Accessing Web Settings section earlier in this walkthrough.</span></span>  
  
     <span data-ttu-id="d5a55-434">Después de la revalidación, este código guarda cualquier cambio en la configuración web local llamando al método `SaveSettings` que agregó anteriormente.</span><span class="sxs-lookup"><span data-stu-id="d5a55-434">After revalidation, this code saves any changes to the local Web settings by calling the `SaveSettings` method that you added previously.</span></span> <span data-ttu-id="d5a55-435">Luego recupera los valores nuevos del servidor al llamar al método <xref:System.Configuration.ApplicationSettingsBase.Reload%2A> de la clase `Settings` del proyecto (a la que se accede como `Properties.Settings.Default` en C# y como `My.Settings` en Visual Basic).</span><span class="sxs-lookup"><span data-stu-id="d5a55-435">It then retrieves any new values on the server by calling the <xref:System.Configuration.ApplicationSettingsBase.Reload%2A> method of the project's `Settings` class (accessed as `Properties.Settings.Default` in C# and `My.Settings` in Visual Basic).</span></span>  
  
     [!code-csharp[ClientApplicationServices#080](../../../samples/snippets/csharp/VS_Snippets_Winforms/ClientApplicationServices/CS/Form1.cs#080)]
     [!code-vb[ClientApplicationServices#080](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/ClientApplicationServices/VB/Form1.vb#080)]  
  
7.  <span data-ttu-id="d5a55-436">Agregue el código siguiente al final del método `Form1_Load` para asegurarse de que la casilla muestra el estado de conexión actual.</span><span class="sxs-lookup"><span data-stu-id="d5a55-436">Add the following code to the end of the `Form1_Load` method to make sure that the check box displays the current connection state.</span></span>  
  
     [!code-csharp[ClientApplicationServices#014](../../../samples/snippets/csharp/VS_Snippets_Winforms/ClientApplicationServices/CS/Form1.cs#014)]
     [!code-vb[ClientApplicationServices#014](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/ClientApplicationServices/VB/Form1.vb#014)]  
  
 <span data-ttu-id="d5a55-437">Con esto finaliza la aplicación del ejemplo.</span><span class="sxs-lookup"><span data-stu-id="d5a55-437">This completes the example application.</span></span> <span data-ttu-id="d5a55-438">Para probar la funcionalidad sin conexión, ejecute la aplicación, inicie sesión como empleado o como administrador y seleccione **Trabajar sin conexión**.</span><span class="sxs-lookup"><span data-stu-id="d5a55-438">To test the offline capability, run the application, log in as either employee or manager, and then select **Work offline**.</span></span> <span data-ttu-id="d5a55-439">Modifique el valor del cuadro de texto y, a continuación, cierre la aplicación.</span><span class="sxs-lookup"><span data-stu-id="d5a55-439">Modify the value in the text box, and then close the application.</span></span> <span data-ttu-id="d5a55-440">Reinicie la aplicación.</span><span class="sxs-lookup"><span data-stu-id="d5a55-440">Restart the application.</span></span> <span data-ttu-id="d5a55-441">Antes de iniciar sesión, haga clic con el botón derecho en el icono del servidor de desarrollo de ASP.NET en el área de notificación de la barra de tareas y, después, haga clic en **Detener**.</span><span class="sxs-lookup"><span data-stu-id="d5a55-441">Before you log in, right-click the ASP.NET Development Server icon in the notification area of the taskbar and then click **Stop**.</span></span> <span data-ttu-id="d5a55-442">A continuación, inicie sesión como lo haría normalmente.</span><span class="sxs-lookup"><span data-stu-id="d5a55-442">Then, log in like normal.</span></span> <span data-ttu-id="d5a55-443">Incluso si no se está ejecutando el servidor, podrá iniciar sesión.</span><span class="sxs-lookup"><span data-stu-id="d5a55-443">Even when the server is not running, you can still log in.</span></span> <span data-ttu-id="d5a55-444">Modifique el valor del cuadro de texto, salga y reinicie para ver el valor modificado.</span><span class="sxs-lookup"><span data-stu-id="d5a55-444">Modify the text box value, exit, and restart to see the modified value.</span></span>  
  
## <a name="summary"></a><span data-ttu-id="d5a55-445">Resumen</span><span class="sxs-lookup"><span data-stu-id="d5a55-445">Summary</span></span>  
 <span data-ttu-id="d5a55-446">En este tutorial, aprendió a habilitar y usar servicios de aplicaciones cliente en una aplicación de Windows Forms.</span><span class="sxs-lookup"><span data-stu-id="d5a55-446">In this walkthrough, you learned how to enable and use client application services in a Windows Forms application.</span></span> <span data-ttu-id="d5a55-447">Después de configurar un servidor de prueba, agregó código a la aplicación para autenticar a los usuarios y recuperar los roles de usuario y la configuración de la aplicación del servidor.</span><span class="sxs-lookup"><span data-stu-id="d5a55-447">After setting up a test server, you added code to your application to authenticate users and retrieve user roles and application settings from the server.</span></span> <span data-ttu-id="d5a55-448">También aprendió a habilitar el modo sin conexión para que la aplicación use una caché de datos local en lugar de los servicios remotos cuando la conectividad no está disponible.</span><span class="sxs-lookup"><span data-stu-id="d5a55-448">You also learned how to enable offline mode so that your application uses a local data cache instead of the remote services when connectivity is not available.</span></span>  
  
## <a name="next-steps"></a><span data-ttu-id="d5a55-449">Pasos siguientes</span><span class="sxs-lookup"><span data-stu-id="d5a55-449">Next Steps</span></span>  
 <span data-ttu-id="d5a55-450">En una aplicación real, accederá a datos de muchos usuarios desde un servidor remoto que podría no estar siempre disponible, o que podría fallar sin previo aviso.</span><span class="sxs-lookup"><span data-stu-id="d5a55-450">In a real-world application, you will access data for many users from a remote server that may not always be available, or may go down without notice.</span></span> <span data-ttu-id="d5a55-451">Para que la aplicación sea sólida, debe responder apropiadamente a situaciones en las que el servicio no esté disponible.</span><span class="sxs-lookup"><span data-stu-id="d5a55-451">To make your application robust, you must respond appropriately to situations where the service is not available.</span></span> <span data-ttu-id="d5a55-452">Este tutorial incluye bloques try/catch para detectar una <xref:System.Net.WebException> y mostrar un mensaje de error cuando el servicio no está disponible.</span><span class="sxs-lookup"><span data-stu-id="d5a55-452">This walkthrough includes try/catch blocks to catch a <xref:System.Net.WebException> and display an error message when the service is not available.</span></span> <span data-ttu-id="d5a55-453">En el código de producción, quizás desee controlar este caso cambiando al modo sin conexión, saliendo de la aplicación o denegando el acceso a una funcionalidad específica.</span><span class="sxs-lookup"><span data-stu-id="d5a55-453">In production code, you might want to handle this case by switching to offline mode, exiting the application, or denying access to specific functionality.</span></span>  
  
 <span data-ttu-id="d5a55-454">Para aumentar la seguridad de su aplicación, asegúrese de probar exhaustivamente la aplicación y el servidor antes de la implementación.</span><span class="sxs-lookup"><span data-stu-id="d5a55-454">To increase the security of your application, make sure to thoroughly test the application and server before deployment.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="d5a55-455">Vea también</span><span class="sxs-lookup"><span data-stu-id="d5a55-455">See Also</span></span>  
 [<span data-ttu-id="d5a55-456">Servicios de aplicación cliente</span><span class="sxs-lookup"><span data-stu-id="d5a55-456">Client Application Services</span></span>](../../../docs/framework/common-client-technologies/client-application-services.md)  
 [<span data-ttu-id="d5a55-457">Información general sobre los servicios de aplicaciones cliente</span><span class="sxs-lookup"><span data-stu-id="d5a55-457">Client Application Services Overview</span></span>](../../../docs/framework/common-client-technologies/client-application-services-overview.md)  
 [<span data-ttu-id="d5a55-458">Cómo: Configurar servicios de aplicaciones cliente</span><span class="sxs-lookup"><span data-stu-id="d5a55-458">How to: Configure Client Application Services</span></span>](../../../docs/framework/common-client-technologies/how-to-configure-client-application-services.md)  
 [<span data-ttu-id="d5a55-459">Herramienta de administración de sitios web de ASP.NET</span><span class="sxs-lookup"><span data-stu-id="d5a55-459">ASP.NET Web Site Administration Tool</span></span>](https://msdn.microsoft.com/library/100ddd8b-7d11-4df9-91ef-0bbbe92e5aec)  
 [<span data-ttu-id="d5a55-460">Crear y configurar la base de datos de servicios de la aplicación para SQL Server</span><span class="sxs-lookup"><span data-stu-id="d5a55-460">Creating and Configuring the Application Services Database for SQL Server</span></span>](https://msdn.microsoft.com/library/ab894e83-7e2f-4af8-a116-b1bff8f815b2)  
 [<span data-ttu-id="d5a55-461">Tutorial: Usar servicios de aplicación ASP.NET</span><span class="sxs-lookup"><span data-stu-id="d5a55-461">Walkthrough: Using ASP.NET Application Services</span></span>](https://msdn.microsoft.com/library/f3f394f0-20d6-4361-aa8f-4b21bf4933eb)
