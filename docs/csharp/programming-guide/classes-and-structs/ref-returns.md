---
title: "Valores devueltos y variables locales de tipo ref (Guía de C#)"
description: "Obtenga información sobre cómo definir y usar valores locales y devueltos de tipo ref"
author: rpetrusha
ms.author: ronpet
ms.date: 01/23/2017
ms.topic: article
ms.prod: .net
ms.technology: devlang-csharp
ms.devlang: csharp
ms.openlocfilehash: a74563c0d24b6cd2a2fa8534787f078f3cc92674
ms.sourcegitcommit: cf22b29db780e532e1090c6e755aa52d28273fa6
ms.translationtype: HT
ms.contentlocale: es-ES
ms.lasthandoff: 02/01/2018
---
# <a name="ref-returns-and-ref-locals"></a><span data-ttu-id="c2de2-103">Valores devueltos y variables locales de tipo ref</span><span class="sxs-lookup"><span data-stu-id="c2de2-103">Ref returns and ref locals</span></span>

<span data-ttu-id="c2de2-104">A partir de C# 7, C# admite los valores devueltos de referencia (valores devueltos de tipo ref).</span><span class="sxs-lookup"><span data-stu-id="c2de2-104">Starting with C# 7, C# supports reference return values (ref returns).</span></span> <span data-ttu-id="c2de2-105">Un valor devuelto de referencia permite que un método devuelva una referencia a una variable, en lugar de un valor, al autor de una llamada.</span><span class="sxs-lookup"><span data-stu-id="c2de2-105">A reference return value allows a method to return a reference to a variable, rather than a value, back to a caller.</span></span> <span data-ttu-id="c2de2-106">El autor de la llamada puede tratar la variable devuelta como si se hubiera devuelto por valor o por referencia.</span><span class="sxs-lookup"><span data-stu-id="c2de2-106">The caller can then choose to treat the returned variable as if it were returned by value or by reference.</span></span> <span data-ttu-id="c2de2-107">El autor de la llamada puede crear una variable que sea una referencia al valor devuelto, lo que se conoce como una referencia local.</span><span class="sxs-lookup"><span data-stu-id="c2de2-107">The caller can create a new variable that is itself a reference to the returned value, called a ref local.</span></span>

## <a name="what-is-a-reference-return-value"></a><span data-ttu-id="c2de2-108">¿Qué es un valor devuelto de referencia?</span><span class="sxs-lookup"><span data-stu-id="c2de2-108">What is a reference return value?</span></span>

<span data-ttu-id="c2de2-109">La mayoría de los desarrolladores están familiarizados con pasar un argumento a un método llamado *por referencia*.</span><span class="sxs-lookup"><span data-stu-id="c2de2-109">Most developers are familiar with passing an argument to a called method *by reference*.</span></span> <span data-ttu-id="c2de2-110">La lista de argumentos de un método llamado incluye una variable pasada por referencia y los cambios que realiza en su valor el método llamado los observa el autor de la llamada.</span><span class="sxs-lookup"><span data-stu-id="c2de2-110">A called method's argument list includes a variable passed by reference, and any changes made to its value by the called method are observed by the caller.</span></span> <span data-ttu-id="c2de2-111">Un *valor devuelto de referencia* significa que un método devuelve una *referencia* o un alias a alguna variable cuyo ámbito incluye el método y cuya duración debe extenderse más allá de la devolución del método.</span><span class="sxs-lookup"><span data-stu-id="c2de2-111">A *reference return value* means that a method returns a *reference* (or an alias) to some variable whose scope includes the method and whose lifetime must extend beyond the return of the method.</span></span> <span data-ttu-id="c2de2-112">Las modificaciones en el valor del método devuelto por el autor de la llamada se realizan en la variable devuelta por el método.</span><span class="sxs-lookup"><span data-stu-id="c2de2-112">Modifications to the method's return value by the caller are made to the variable that is returned by the method.</span></span>

<span data-ttu-id="c2de2-113">Declarar que un método devuelve un *valor devuelto de referencia* indica que el método devuelve un alias a una variable.</span><span class="sxs-lookup"><span data-stu-id="c2de2-113">Declaring that a method returns a *reference return value* indicates that the method returns an alias to a variable.</span></span> <span data-ttu-id="c2de2-114">El diseño suele pretender que el código de llamada acceda a dicha variable con el alias, incluso para modificarla.</span><span class="sxs-lookup"><span data-stu-id="c2de2-114">The design intent is often that the calling code should have access to that variable through the alias, including to modify it.</span></span> <span data-ttu-id="c2de2-115">Por tanto, los métodos devueltos por referencia no pueden tener el tipo de valor devuelto `void`.</span><span class="sxs-lookup"><span data-stu-id="c2de2-115">It follows that methods returning by reference cannot have the return type `void`.</span></span>

<span data-ttu-id="c2de2-116">Hay algunas restricciones en la expresión que un método puede devolver como un valor devuelto de referencia.</span><span class="sxs-lookup"><span data-stu-id="c2de2-116">There are some restrictions on the expression that a method can return as a reference return value.</span></span> <span data-ttu-id="c2de2-117">Se incluyen los siguientes:</span><span class="sxs-lookup"><span data-stu-id="c2de2-117">These include:</span></span>

- <span data-ttu-id="c2de2-118">El valor devuelto debe tener una duración que se extienda más allá de la ejecución del método.</span><span class="sxs-lookup"><span data-stu-id="c2de2-118">The return value must have a lifetime that extends beyond the execution of the method.</span></span> <span data-ttu-id="c2de2-119">En otras palabras, no puede tratarse de una variable local del método que la devuelve.</span><span class="sxs-lookup"><span data-stu-id="c2de2-119">In other words, it cannot be a local variable in the method that returns it.</span></span> <span data-ttu-id="c2de2-120">Puede ser una instancia o un campo estático de una clase, o puede ser un argumento pasado al método.</span><span class="sxs-lookup"><span data-stu-id="c2de2-120">It can be an instance or static field of a class, or it can be an argument passed to the method.</span></span> <span data-ttu-id="c2de2-121">Al intentar devolver una variable local, se genera el error del compilador CS8168, "No se puede devolver por referencia la variable local 'obj' porque no es de tipo ref".</span><span class="sxs-lookup"><span data-stu-id="c2de2-121">Attempting to return a local variable generates compiler error CS8168, "Cannot return local 'obj' by reference because it is not a ref local."</span></span>

- <span data-ttu-id="c2de2-122">El valor devuelto no puede ser el literal `null`.</span><span class="sxs-lookup"><span data-stu-id="c2de2-122">The return value cannot be the literal `null`.</span></span> <span data-ttu-id="c2de2-123">Si intenta devolver `null`, se genera el error del compilador CS8156, "No se puede usar una expresión en este contexto porque no se puede devolver por referencia".</span><span class="sxs-lookup"><span data-stu-id="c2de2-123">Attempting to return `null` generates compiler error CS8156, "An expression cannot be used in this context because it may not be returned by reference."</span></span>

   <span data-ttu-id="c2de2-124">Un método con un valor devuelto de referencia puede devolver un alias a una variable cuyo valor es actualmente el valor null (sin instancias) o un [tipo que acepta valores NULL](../nullable-types/index.md) para un tipo de valor.</span><span class="sxs-lookup"><span data-stu-id="c2de2-124">A method with a ref return can return an alias to a variable whose value is currently the null (uninstantiated) value or a [nullable type](../nullable-types/index.md) for a value type.</span></span>
 
- <span data-ttu-id="c2de2-125">El valor devuelto no puede ser una constante, un miembro de enumeración, el valor devuelto por valor desde una propiedad o un método de `class` o `struct`.</span><span class="sxs-lookup"><span data-stu-id="c2de2-125">The return value cannot be a constant, an enumeration member, the by-value return value from a property, or a method of a `class` or `struct`.</span></span> <span data-ttu-id="c2de2-126">Si intenta devolver estos, se genera el error del compilador CS8156, "No se puede usar una expresión en este contexto porque no se puede devolver por referencia".</span><span class="sxs-lookup"><span data-stu-id="c2de2-126">Attempting to return these generates compiler error CS8156, "An expression cannot be used in this context because it may not be returned by reference."</span></span>

<span data-ttu-id="c2de2-127">Además, puesto que un método asincrónico puede volver antes de que haya terminado de ejecutarse, mientras su valor devuelto siga siendo desconocido, los valores devueltos de referencia no se permiten en métodos asincrónicos.</span><span class="sxs-lookup"><span data-stu-id="c2de2-127">In addition, because an asynchronous method may return before it has finished execution, while its return value is still unknown, reference return values are not allowed on async methods.</span></span>
 
## <a name="defining-a-ref-return-value"></a><span data-ttu-id="c2de2-128">Definir un valor devuelto de tipo ref</span><span class="sxs-lookup"><span data-stu-id="c2de2-128">Defining a ref return value</span></span>

<span data-ttu-id="c2de2-129">Para definir un valor devuelto de tipo ref, agregue la palabra clave [ref](../../language-reference/keywords/ref.md) al tipo de valor devuelto de la firma del método.</span><span class="sxs-lookup"><span data-stu-id="c2de2-129">You define a ref return value by adding the [ref](../../language-reference/keywords/ref.md) keyword to the return type of the method signature.</span></span> <span data-ttu-id="c2de2-130">Por ejemplo, la siguiente firma indica que la propiedad `GetContactInformation` devuelve una referencia a un objeto `Person` al autor de la llamada:</span><span class="sxs-lookup"><span data-stu-id="c2de2-130">For example, the following signature indicates that the `GetContactInformation` property returns a reference to a `Person` object to the caller:</span></span>

```csharp
public ref Person GetContactInformation(string fname, string lname);
```

<span data-ttu-id="c2de2-131">Además, el nombre del objeto devuelto por cada instrucción [return](../../language-reference/keywords/return.md) en el cuerpo del método debe ir precedido de la palabra clave [ref](../../language-reference/keywords/ref.md).</span><span class="sxs-lookup"><span data-stu-id="c2de2-131">In addition, the name of the object returned by each [return](../../language-reference/keywords/return.md) statement in the method body must be preceded by the [ref](../../language-reference/keywords/ref.md) keyword.</span></span> <span data-ttu-id="c2de2-132">Por ejemplo, la siguiente instrucción `return` devuelve una referencia a un objeto `Person` denominado `p`:</span><span class="sxs-lookup"><span data-stu-id="c2de2-132">For example, the following `return` statement returns a reference to a `Person` object named `p`:</span></span>

```csharp
return ref p;
```

## <a name="consuming-a-ref-return-value"></a><span data-ttu-id="c2de2-133">Usar un valor devuelto de tipo ref</span><span class="sxs-lookup"><span data-stu-id="c2de2-133">Consuming a ref return value</span></span>

<span data-ttu-id="c2de2-134">El valor devuelto de tipo ref es un alias para otra variable en el ámbito del método llamado.</span><span class="sxs-lookup"><span data-stu-id="c2de2-134">The ref return value is an alias to another variable in the called method's scope.</span></span> <span data-ttu-id="c2de2-135">Puede interpretar cualquier uso del valor devuelto tipo ref como si se usara la variable a la que se asigna el alias:</span><span class="sxs-lookup"><span data-stu-id="c2de2-135">You can interpret any use of the ref return as using the variable it aliases:</span></span>

- <span data-ttu-id="c2de2-136">Al asignar su valor, se asigna un valor a la variable a la que se asigna el alias.</span><span class="sxs-lookup"><span data-stu-id="c2de2-136">When you assign its value, you are assigning a value to the variable it aliases.</span></span>
- <span data-ttu-id="c2de2-137">Al leer su valor, se lee un valor a la variable a la que se asigna el alias.</span><span class="sxs-lookup"><span data-stu-id="c2de2-137">When you read its value, you are reading the value of the variable it aliases.</span></span>
- <span data-ttu-id="c2de2-138">Si la devolución se realiza *por referencia*, entonces devuelve un alias a esa misma variable.</span><span class="sxs-lookup"><span data-stu-id="c2de2-138">If you return it *by reference* you are returning an alias to that same variable.</span></span>
- <span data-ttu-id="c2de2-139">Si pasa el valor a otro método *por referencia*, pasará una referencia a la variable a la que se asigna el alias.</span><span class="sxs-lookup"><span data-stu-id="c2de2-139">If you pass it to another method *by reference* you are passing a reference to the variable it aliases.</span></span>
- <span data-ttu-id="c2de2-140">Al asignar un alias [local tipo ref](#ref-local), crea un alias para la misma variable.</span><span class="sxs-lookup"><span data-stu-id="c2de2-140">When you make a [ref local](#ref-local) alias, you make a new alias to the same variable.</span></span>


## <a name="ref-locals"></a><span data-ttu-id="c2de2-141">Variables locales de tipo ref</span><span class="sxs-lookup"><span data-stu-id="c2de2-141">Ref locals</span></span>

<span data-ttu-id="c2de2-142">Suponga que el método `GetContactInformation` se declara como un valor devuelto tipo ref:</span><span class="sxs-lookup"><span data-stu-id="c2de2-142">Assume the `GetContactInformation` method is declared as a ref return:</span></span>

```csharp
public ref Person GetContactInformation(string fname, string lname)
```

<span data-ttu-id="c2de2-143">Una asignación por valor lee el valor de una variable y lo asigna a una nueva variable:</span><span class="sxs-lookup"><span data-stu-id="c2de2-143">A by-value assignment reads the value of a variable and assigns it to a new variable:</span></span>

```csharp
Person p = contacts.GetContactInformation("Brandie", "Best");
```

<span data-ttu-id="c2de2-144">La asignación anterior declara `p` como una variable local.</span><span class="sxs-lookup"><span data-stu-id="c2de2-144">The preceding assignment declares `p` as a local variable.</span></span> <span data-ttu-id="c2de2-145">Su valor inicial se copia a partir de la lectura del valor devuelto por `GetContactInformation`.</span><span class="sxs-lookup"><span data-stu-id="c2de2-145">Its initial value is copied from reading the value returned by `GetContactInformation`.</span></span> <span data-ttu-id="c2de2-146">Las asignaciones futuras a `p` no cambiarán el valor de la variable devuelta por `GetContactInformation`.</span><span class="sxs-lookup"><span data-stu-id="c2de2-146">Any future assignments to `p` will not change the value of the variable returned by `GetContactInformation`.</span></span> <span data-ttu-id="c2de2-147">La variable `p` ya no es un alias de la variable devuelta.</span><span class="sxs-lookup"><span data-stu-id="c2de2-147">The variable `p` is no longer an alias to the variable returned.</span></span>

<span data-ttu-id="c2de2-148">Se declara una variable *local tipo ref* para copiar el alias en el valor original.</span><span class="sxs-lookup"><span data-stu-id="c2de2-148">You declare a *ref local* variable to copy the alias to the original value.</span></span> <span data-ttu-id="c2de2-149">En la siguiente asignación, `p` es un alias para la variable devuelta desde `GetContactInformation`.</span><span class="sxs-lookup"><span data-stu-id="c2de2-149">In the following assignment, `p` is an alias to the variable returned from `GetContactInformation`.</span></span>

```csharp
ref Person p = ref contacts.GetContactInformation("Brandie", "Best");
```

<span data-ttu-id="c2de2-150">El uso posterior de `p` es lo mismo que usar la variable devuelta por `GetContactInformation`, porque `p` es un alias para dicha variable.</span><span class="sxs-lookup"><span data-stu-id="c2de2-150">Subsequent usage of `p` is the same as using the variable returned by `GetContactInformation` because `p` is an alias for that variable.</span></span> <span data-ttu-id="c2de2-151">Los cambios realizados en `p` también modifican la variable devuelta desde `GetContactInformation`.</span><span class="sxs-lookup"><span data-stu-id="c2de2-151">Changes to `p` also change the variable returned from `GetContactInformation`.</span></span>

<span data-ttu-id="c2de2-152">Tenga en cuenta que la palabra clave `ref` se usa antes de la declaración de variable local *y* antes de la llamada al método.</span><span class="sxs-lookup"><span data-stu-id="c2de2-152">Note that the `ref` keyword is used both before the local variable declaration *and* before the method call.</span></span> <span data-ttu-id="c2de2-153">Si no se incluyen ambas palabras clave `ref` en la asignación y declaración de variable, se produce el error del compilador CS8172, "No se puede inicializar una variable por referencia con un valor".</span><span class="sxs-lookup"><span data-stu-id="c2de2-153">Failure to include both `ref` keywords in the variable declaration and assignment results in compiler error CS8172, "Cannot initialize a by-reference variable with a value."</span></span> 
 
## <a name="ref-returns-and-ref-locals-an-example"></a><span data-ttu-id="c2de2-154">Valores devueltos y variables locales de tipo ref: un ejemplo</span><span class="sxs-lookup"><span data-stu-id="c2de2-154">Ref returns and ref locals: an example</span></span>

<span data-ttu-id="c2de2-155">En el ejemplo siguiente, se define una clase `NumberStore` que almacena una matriz de valores enteros.</span><span class="sxs-lookup"><span data-stu-id="c2de2-155">The following example defines a `NumberStore` class that stores an array of integer values.</span></span> <span data-ttu-id="c2de2-156">El método `FindNumber` devuelve por referencia el primer número que es mayor o igual que el número que se pasa como argumento.</span><span class="sxs-lookup"><span data-stu-id="c2de2-156">The `FindNumber` method returns by reference the first number that is greater than or equal to the number passed as an argument.</span></span> <span data-ttu-id="c2de2-157">Si ningún número es mayor o igual que el argumento, el método devuelve el número en el índice 0.</span><span class="sxs-lookup"><span data-stu-id="c2de2-157">If no number is greater than or equal to the argument, the method returns the number in index 0.</span></span> 

[!code-csharp[ref-returns](../../../../samples/snippets/csharp/programming-guide/ref-returns/ref-returns1.cs#1)]

<span data-ttu-id="c2de2-158">En el ejemplo siguiente, se llama al método `NumberStore.FindNumber` para recuperar el primer valor que es mayor o igual que 16.</span><span class="sxs-lookup"><span data-stu-id="c2de2-158">The following example calls the `NumberStore.FindNumber` method to retrieve the first value that is greater than or equal to 16.</span></span> <span data-ttu-id="c2de2-159">Después, el autor de la llamada duplica el valor devuelto por el método.</span><span class="sxs-lookup"><span data-stu-id="c2de2-159">The caller then doubles the value returned by the method.</span></span> <span data-ttu-id="c2de2-160">Como se muestra en el resultado del ejemplo, este cambio se refleja en el valor de los elementos de matriz de la instancia `NumberStore`.</span><span class="sxs-lookup"><span data-stu-id="c2de2-160">As the output from the example shows, this change is reflected in the value of the array elements of the `NumberStore` instance.</span></span>

[!code-csharp[ref-returns](../../../../samples/snippets/csharp/programming-guide/ref-returns/ref-returns1.cs#2)]

<span data-ttu-id="c2de2-161">Sin que se admitan los valores devueltos de referencia, este tipo de operación se realiza normalmente devolviendo el índice del elemento de matriz junto con su valor.</span><span class="sxs-lookup"><span data-stu-id="c2de2-161">Without support for reference return values, such an operation is usually performed by returning the index of the array element along with its value.</span></span> <span data-ttu-id="c2de2-162">Después, el autor de la llamada puede usar este índice para modificar el valor en una llamada al método independiente.</span><span class="sxs-lookup"><span data-stu-id="c2de2-162">The caller can then use this index to modify the value in a separate method call.</span></span> <span data-ttu-id="c2de2-163">En cambio, el autor de la llamada también puede modificar el índice para tener acceso a otros valores de matriz y, posiblemente, modificarlos.</span><span class="sxs-lookup"><span data-stu-id="c2de2-163">However, the caller can also modify the index to access and possibly modify other array values.</span></span>  
 
## <a name="see-also"></a><span data-ttu-id="c2de2-164">Vea también</span><span class="sxs-lookup"><span data-stu-id="c2de2-164">See also</span></span>

[<span data-ttu-id="c2de2-165">ref (palabra clave)</span><span class="sxs-lookup"><span data-stu-id="c2de2-165">ref keyword</span></span>](../../language-reference/keywords/ref.md)
