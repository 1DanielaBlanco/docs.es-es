---
title: "Valores devueltos y variables locales de tipo ref (Guía de C#)"
description: "Obtenga información sobre cómo definir y usar valores locales y devueltos de tipo ref"
author: rpetrusha
ms.author: ronpet
ms.date: 05/30/2017
ms.topic: article
ms.prod: .net
ms.technology: devlang-csharp
ms.devlang: csharp
ms.assetid: 18cf7a4b-29f0-4b14-85b8-80af754aabd8
ms.openlocfilehash: 1d8fb092b578602b5d4f791a3fd14f47dfae1ba6
ms.sourcegitcommit: 7e99f66ef09d2903e22c789c67ff5a10aa953b2f
ms.translationtype: HT
ms.contentlocale: es-ES
ms.lasthandoff: 11/18/2017
---
# <a name="ref-returns-and-ref-locals"></a><span data-ttu-id="cd5c3-103">Valores devueltos y variables locales de tipo ref</span><span class="sxs-lookup"><span data-stu-id="cd5c3-103">Ref returns and ref locals</span></span>

<span data-ttu-id="cd5c3-104">A partir de C# 7, C# admite los valores devueltos de referencia (valores devueltos de tipo ref).</span><span class="sxs-lookup"><span data-stu-id="cd5c3-104">Starting with C# 7, C# supports reference return values (ref returns).</span></span> <span data-ttu-id="cd5c3-105">Un valor devuelto de referencia permite que un método devuelva una referencia a un objeto, en lugar de un valor, al autor de una llamada.</span><span class="sxs-lookup"><span data-stu-id="cd5c3-105">A reference return value allows a method to return a reference to an object, rather than a value, back to a caller.</span></span> <span data-ttu-id="cd5c3-106">El autor de la llamada puede tratar el objeto devuelto como si se hubiera devuelto por valor o por referencia.</span><span class="sxs-lookup"><span data-stu-id="cd5c3-106">The caller can then choose to treat the returned object returned as if it were returned by value or by reference.</span></span> <span data-ttu-id="cd5c3-107">Un valor devuelto por referencia que el autor de la llamada trata como una referencia en lugar de un valor es una variable local de tipo ref.</span><span class="sxs-lookup"><span data-stu-id="cd5c3-107">A value returned by reference that the caller handles as a reference rather than a value is a ref local.</span></span>

## <a name="what-is-a-reference-return-value"></a><span data-ttu-id="cd5c3-108">¿Qué es un valor devuelto de referencia?</span><span class="sxs-lookup"><span data-stu-id="cd5c3-108">What is a reference return value?</span></span>

<span data-ttu-id="cd5c3-109">La mayoría de los desarrolladores están familiarizados con pasar un argumento a un método llamado *por referencia*.</span><span class="sxs-lookup"><span data-stu-id="cd5c3-109">Most developers are familiar with passing an argument to a called method *by reference*.</span></span> <span data-ttu-id="cd5c3-110">La lista de argumentos de un método llamado incluye un valor pasado por referencia y los cambios que realiza en su valor el método llamado se devuelven al autor de la llamada.</span><span class="sxs-lookup"><span data-stu-id="cd5c3-110">A called method's argument list includes a value passed by reference, and any changes made to its value by the called method are returned to the caller.</span></span> <span data-ttu-id="cd5c3-111">Un *valor devuelto de referencia* es lo contrario:</span><span class="sxs-lookup"><span data-stu-id="cd5c3-111">A *reference return value* is the opposite:</span></span>

- <span data-ttu-id="cd5c3-112">El valor devuelto del método llamado, en lugar de un argumento que se le pasa, es una referencia.</span><span class="sxs-lookup"><span data-stu-id="cd5c3-112">The called method's return value, rather than an argument passed to it, is a reference.</span></span>

- <span data-ttu-id="cd5c3-113">El autor de la llamada, en lugar del método llamado, puede modificar el valor devuelto por el método.</span><span class="sxs-lookup"><span data-stu-id="cd5c3-113">The caller, rather than the called method, can modify the value returned by the method.</span></span>

- <span data-ttu-id="cd5c3-114">En lugar de modificaciones al argumento que se reflejan en el estado del objeto en el autor de la llamada, las modificaciones al valor devuelto del método realizadas por el autor de la llamada se reflejan en el estado del objeto cuyo método se ha llamado.</span><span class="sxs-lookup"><span data-stu-id="cd5c3-114">Instead of modifications to the argument that are reflected in state of the object on the caller, modifications to the method's return value by the caller are reflected in the state of the object whose method was called.</span></span>

<span data-ttu-id="cd5c3-115">Los valores devueltos de referencia pueden generar código más compacto, así como permitir que un objeto exponga solo los elementos de datos individuales, como un elemento de matriz, que son de interés para el autor de la llamada.</span><span class="sxs-lookup"><span data-stu-id="cd5c3-115">Reference return values can produce more compact code, as well as allow an object to expose only the individual data items, such as an array element, that are of interest to the caller.</span></span> <span data-ttu-id="cd5c3-116">Esto reduce la probabilidad de que el autor de la llamada modifique accidentalmente el estado del objeto.</span><span class="sxs-lookup"><span data-stu-id="cd5c3-116">This reduces the likelihood that the caller will inadvertently modify the object's state.</span></span>

<span data-ttu-id="cd5c3-117">Hay algunas restricciones en el valor que un método puede devolver como un valor devuelto de referencia.</span><span class="sxs-lookup"><span data-stu-id="cd5c3-117">There are some restrictions on the value that a method can return as a reference return value.</span></span> <span data-ttu-id="cd5c3-118">Se incluyen los siguientes:</span><span class="sxs-lookup"><span data-stu-id="cd5c3-118">These include:</span></span>

- <span data-ttu-id="cd5c3-119">El valor devuelto no puede ser `void`.</span><span class="sxs-lookup"><span data-stu-id="cd5c3-119">The return value cannot be `void`.</span></span> <span data-ttu-id="cd5c3-120">Al intentar definir un método con un valor devuelto de referencia `void`, se genera el error del compilador CS1547, "La palabra clave 'void' no se puede usar en este contexto".</span><span class="sxs-lookup"><span data-stu-id="cd5c3-120">Attempting to define a method with a `void` reference return value generates compiler error CS1547, "Keyword 'void' cannot be used in this context."</span></span>
 
- <span data-ttu-id="cd5c3-121">El valor devuelto no puede ser una variable local en el método que lo devuelve; debe tener un ámbito que esté fuera del método que lo devuelve.</span><span class="sxs-lookup"><span data-stu-id="cd5c3-121">The return value cannot be a local variable in the method that returns it; it must have a scope that is outside the method that returns it.</span></span> <span data-ttu-id="cd5c3-122">Puede ser una instancia o un campo estático de una clase, o puede ser un argumento pasado al método.</span><span class="sxs-lookup"><span data-stu-id="cd5c3-122">It can be an instance or static field of a class, or it can be an argument passed to the method.</span></span> <span data-ttu-id="cd5c3-123">Al intentar devolver una variable local, se genera el error del compilador CS8168, "No se puede devolver por referencia la variable local 'obj' porque no es de tipo ref".</span><span class="sxs-lookup"><span data-stu-id="cd5c3-123">Attempting to return a local variable generates compiler error CS8168, "Cannot return local 'obj' by reference because it is not a ref local."</span></span>

- <span data-ttu-id="cd5c3-124">El valor devuelto no puede ser `null`.</span><span class="sxs-lookup"><span data-stu-id="cd5c3-124">The return value cannot be a `null`.</span></span> <span data-ttu-id="cd5c3-125">Si intenta devolver `null`, se genera el error del compilador CS8156, "No se puede usar una expresión en este contexto porque no se puede devolver por referencia".</span><span class="sxs-lookup"><span data-stu-id="cd5c3-125">Attempting to return `null` generates compiler error CS8156, "An expression cannot be used in this context because it may not be returned by reference."</span></span>

   <span data-ttu-id="cd5c3-126">Si un método con un valor devuelto de tipo ref necesita devolver un valor NULL, puede devolver un valor NULL (sin instancia) para un tipo de referencia o un [tipo que acepta valores NULL](../nullable-types/index.md) para un tipo de valor.</span><span class="sxs-lookup"><span data-stu-id="cd5c3-126">If a method with a ref return needs to return a null value, you can either return a null (uninstantiated) value for a reference type or a [nullable type](../nullable-types/index.md) for a value type.</span></span>
 
- <span data-ttu-id="cd5c3-127">El valor devuelto no puede ser una constante, un miembro de enumeración o una propiedad de una `class` o `struct`.</span><span class="sxs-lookup"><span data-stu-id="cd5c3-127">The return value cannot be a constant, an enumeration member, or a property of a `class` or `struct`.</span></span> <span data-ttu-id="cd5c3-128">Si intenta devolver estos, se genera el error del compilador CS8156, "No se puede usar una expresión en este contexto porque no se puede devolver por referencia".</span><span class="sxs-lookup"><span data-stu-id="cd5c3-128">Attempting to return these generates compiler error CS8156, "An expression cannot be used in this context because it may not be returned by reference."</span></span>

<span data-ttu-id="cd5c3-129">Además, puesto que un método asincrónico puede volver antes de que haya terminado de ejecutarse, mientras su valor devuelto siga siendo desconocido, los valores devueltos de referencia no se permiten en métodos asincrónicos.</span><span class="sxs-lookup"><span data-stu-id="cd5c3-129">In addition, because an asynchronous method may return before it has finished execution, while its return value is still unknown, reference return values are not allowed on async methods.</span></span>
 
## <a name="defining-a-ref-return-value"></a><span data-ttu-id="cd5c3-130">Definir un valor devuelto de tipo ref</span><span class="sxs-lookup"><span data-stu-id="cd5c3-130">Defining a ref return value</span></span>

<span data-ttu-id="cd5c3-131">Para definir un valor devuelto de tipo ref, agregue la palabra clave [ref](../../language-reference/keywords/ref.md) al tipo de valor devuelto de la firma del método.</span><span class="sxs-lookup"><span data-stu-id="cd5c3-131">You define a ref return value by adding the [ref](../../language-reference/keywords/ref.md) keyword to the return type of the method signature.</span></span> <span data-ttu-id="cd5c3-132">Por ejemplo, la siguiente firma indica que la propiedad `GetContactInformation` devuelve una referencia a un objeto `Person` al autor de la llamada:</span><span class="sxs-lookup"><span data-stu-id="cd5c3-132">For example, the following signature indicates that the `GetContactInformation` property returns a reference to a `Person` object to the caller:</span></span>

```csharp
public ref Person GetContactInformation(string fname, string lname);
```

<span data-ttu-id="cd5c3-133">Además, el nombre del objeto devuelto por cada instrucción [return](../../language-reference/keywords/return.md) en el cuerpo del método debe ir precedido de la palabra clave [ref](../../language-reference/keywords/ref.md).</span><span class="sxs-lookup"><span data-stu-id="cd5c3-133">In addition, the name of the object returned by each [return](../../language-reference/keywords/return.md) statement in the method body must be preceded by the [ref](../../language-reference/keywords/ref.md) keyword.</span></span> <span data-ttu-id="cd5c3-134">Por ejemplo, la siguiente instrucción `return` devuelve un objeto `Person` denominado `p` por referencia:</span><span class="sxs-lookup"><span data-stu-id="cd5c3-134">For example, the following `return` statement returns a `Person` object named `p` by reference:</span></span>

```csharp
return ref p;
```

## <a name="consuming-a-ref-return-value"></a><span data-ttu-id="cd5c3-135">Usar un valor devuelto de tipo ref</span><span class="sxs-lookup"><span data-stu-id="cd5c3-135">Consuming a ref return value</span></span>

<span data-ttu-id="cd5c3-136">El autor de una llamada puede controlar un valor devuelto de tipo ref de una de estas dos formas:</span><span class="sxs-lookup"><span data-stu-id="cd5c3-136">A caller can handle a ref return value in either of two ways:</span></span>

- <span data-ttu-id="cd5c3-137">Como un valor normal devuelto por valor desde un método.</span><span class="sxs-lookup"><span data-stu-id="cd5c3-137">As an ordinary value returned by value from a method.</span></span> <span data-ttu-id="cd5c3-138">El autor de la llamada puede optar por omitir que el valor devuelto es un valor devuelto de referencia.</span><span class="sxs-lookup"><span data-stu-id="cd5c3-138">The caller can choose to ignore that the return value is a reference return value.</span></span> <span data-ttu-id="cd5c3-139">En este caso, los cambios realizados en el valor devuelto por la llamada al método no se reflejan en el estado del tipo llamado.</span><span class="sxs-lookup"><span data-stu-id="cd5c3-139">In this case, any changes made to the value returned by the method call are not reflected in the state of the called type.</span></span> <span data-ttu-id="cd5c3-140">Si el valor devuelto es un tipo de valor, los cambios realizados en el valor devuelto por la llamada al método no se reflejan en el estado del tipo llamado.</span><span class="sxs-lookup"><span data-stu-id="cd5c3-140">If the returned value is a value type, any changes made to the value returned by the method call are not reflected in the state of the called type.</span></span>

- <span data-ttu-id="cd5c3-141">Como un valor devuelto de referencia.</span><span class="sxs-lookup"><span data-stu-id="cd5c3-141">As a reference return value.</span></span> <span data-ttu-id="cd5c3-142">El autor de la llamada debe definir la variable a la que se asigna el valor devuelto de referencia como una [variable local de tipo ref](#ref-local), y cualquier cambio en el valor devuelto por la llamada al método se refleja en el estado del tipo llamado.</span><span class="sxs-lookup"><span data-stu-id="cd5c3-142">The caller must define the variable to which the reference return value is assigned as a [ref local](#ref-local), and any changes to the value returned by the method call are reflected in the state of the called type.</span></span> 

## <a name="ref-locals"></a><span data-ttu-id="cd5c3-143">Variables locales de tipo ref</span><span class="sxs-lookup"><span data-stu-id="cd5c3-143">Ref locals</span></span>

<span data-ttu-id="cd5c3-144">Para controlar el valor devuelto de referencia como una referencia, el autor de la llamada debe declarar el valor para que sea una *variable local de tipo ref* mediante la palabra clave `ref`.</span><span class="sxs-lookup"><span data-stu-id="cd5c3-144">To handle the reference return value as a reference, the caller must declare the value to be a *ref local* by using the `ref` keyword.</span></span> <span data-ttu-id="cd5c3-145">Por ejemplo, si el valor devuelto por el método `Person.GetContactInfomation` debe usarse como una referencia en lugar de un valor, la llamada al método aparece como:</span><span class="sxs-lookup"><span data-stu-id="cd5c3-145">For example, if the value returned by the `Person.GetContactInfomation` method is to be consumed as a reference rather than a value, the method call appears as:</span></span>

```csharp
ref Person p = ref contacts.GetContactInformation("Brandie", "Best");
```

<span data-ttu-id="cd5c3-146">Tenga en cuenta que la palabra clave `ref` se usa antes de la declaración de variable local *y* antes de la llamada al método.</span><span class="sxs-lookup"><span data-stu-id="cd5c3-146">Note that the `ref` keyword is used both before the local variable declaration *and* before the method call.</span></span> <span data-ttu-id="cd5c3-147">Si no se incluyen ambas palabras clave `ref` en la asignación y declaración de variable, se produce el error del compilador CS8172, "No se puede inicializar una variable por referencia con un valor".</span><span class="sxs-lookup"><span data-stu-id="cd5c3-147">Failure to include both `ref` keywords in the variable declaration and assignment results in compiler error CS8172, "Cannot initialize a by-reference variable with a value."</span></span> 
 
<span data-ttu-id="cd5c3-148">Los cambios posteriores en el objeto `Person` devuelto por el método se reflejan en el objeto `contacts`.</span><span class="sxs-lookup"><span data-stu-id="cd5c3-148">Subsequent changes to the `Person` object returned by the method are reflected in the `contacts` object.</span></span>

<span data-ttu-id="cd5c3-149">Si `p` no está definido como una variable local de tipo ref mediante la palabra clave `ref`, los cambios que realiza en `p` el autor de la llamada no se reflejan en el objeto `contacts`.</span><span class="sxs-lookup"><span data-stu-id="cd5c3-149">If `p` is not defined as a ref local by using the `ref` keyword, any changes made to `p` by the caller are not reflected in the `contacts` object.</span></span>
 
## <a name="ref-returns-and-ref-locals-an-example"></a><span data-ttu-id="cd5c3-150">Valores devueltos y variables locales de tipo ref: un ejemplo</span><span class="sxs-lookup"><span data-stu-id="cd5c3-150">Ref returns and ref locals: an example</span></span>

<span data-ttu-id="cd5c3-151">En el ejemplo siguiente, se define una clase `NumberStore` que almacena una matriz de valores enteros.</span><span class="sxs-lookup"><span data-stu-id="cd5c3-151">The following example defines a `NumberStore` class that stores an array of integer values.</span></span> <span data-ttu-id="cd5c3-152">El método `FindNumber` devuelve por referencia el primer número que es mayor o igual que el número que se pasa como argumento.</span><span class="sxs-lookup"><span data-stu-id="cd5c3-152">The `FindNumber` method returns by reference the first number that is greater than or equal to the number passed as an argument.</span></span> <span data-ttu-id="cd5c3-153">Si ningún número es mayor o igual que el argumento, el método devuelve el número en el índice 0.</span><span class="sxs-lookup"><span data-stu-id="cd5c3-153">If no number is greater than or equal to the argument, the method returns the number in index 0.</span></span> 

[!code-csharp[ref-returns](../../../../samples/snippets/csharp/programming-guide/ref-returns/ref-returns1.cs#1)]

<span data-ttu-id="cd5c3-154">En el ejemplo siguiente, se llama al método `NumberStore.FindNumber` para recuperar el primer valor que es mayor o igual que 16.</span><span class="sxs-lookup"><span data-stu-id="cd5c3-154">The following example calls the `NumberStore.FindNumber` method to retrieve the first value that is greater than or equal to 16.</span></span> <span data-ttu-id="cd5c3-155">Después, el autor de la llamada duplica el valor devuelto por el método.</span><span class="sxs-lookup"><span data-stu-id="cd5c3-155">The caller then doubles the value returned by the method.</span></span> <span data-ttu-id="cd5c3-156">Como se muestra en el resultado del ejemplo, este cambio se refleja en el valor de los elementos de matriz de la instancia `NumberStore`.</span><span class="sxs-lookup"><span data-stu-id="cd5c3-156">As the output from the example shows, this change is reflected in the value of the array elements of the `NumberStore` instance.</span></span>

[!code-csharp[ref-returns](../../../../samples/snippets/csharp/programming-guide/ref-returns/ref-returns1.cs#2)]

<span data-ttu-id="cd5c3-157">Sin que se admitan los valores devueltos de referencia, este tipo de operación se realiza normalmente devolviendo el índice del elemento de matriz junto con su valor.</span><span class="sxs-lookup"><span data-stu-id="cd5c3-157">Without support for reference return values, such an operation is usually performed by returning the index of the array element along with its value.</span></span> <span data-ttu-id="cd5c3-158">Después, el autor de la llamada puede usar este índice para modificar el valor en una llamada al método independiente.</span><span class="sxs-lookup"><span data-stu-id="cd5c3-158">The caller can then use this index to modify the value in a separate method call.</span></span> <span data-ttu-id="cd5c3-159">En cambio, el autor de la llamada también puede modificar el índice para tener acceso a otros valores de matriz y, posiblemente, modificarlos.</span><span class="sxs-lookup"><span data-stu-id="cd5c3-159">However, the caller can also modify the index to access and possibly modify other array values.</span></span>  
 
## <a name="see-also"></a><span data-ttu-id="cd5c3-160">Vea también</span><span class="sxs-lookup"><span data-stu-id="cd5c3-160">See also</span></span>

[<span data-ttu-id="cd5c3-161">ref (palabra clave)</span><span class="sxs-lookup"><span data-stu-id="cd5c3-161">ref keyword</span></span>](../../language-reference/keywords/ref.md)
